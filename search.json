[{"title":"关于寻物解谜游戏的一些想法","url":"/%E7%AC%94%E8%AE%B0/Gameplay/%E5%85%B3%E4%BA%8E%E5%AF%BB%E7%89%A9%E8%A7%A3%E8%B0%9C%E6%B8%B8%E6%88%8F%E7%9A%84%E4%B8%80%E4%BA%9B%E6%83%B3%E6%B3%95/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>最近准备做个简单的寻物解谜游戏，所以对这个类型的游戏做了一点研究，记录一下过程中的想法。</p>\n<h2 id=\"寻物解谜游戏的特点\"><a href=\"#寻物解谜游戏的特点\" class=\"headerlink\" title=\"寻物解谜游戏的特点\"></a>寻物解谜游戏的特点</h2><p>在我看来，寻物解谜游戏的核心流程比较简单：即从游戏场景中获取信息或道具，利用这些来解开锁，开锁之后又获得新的信息或道具，继续解锁，直到达到目标，通关游戏。</p>\n<img src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjIyMXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTQ1cHg7aGVpZ2h0OjIyMXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDE0NSAyMjEiIHdpZHRoPSIxNDVweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1lbnRpdHkgPz8/Pz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSIuLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxIiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImVudGl0eV8uLi4uLi4uIj48ZWxsaXBzZSBjeD0iNzIuNzI1MiIgY3k9IjIxLjc0NSIgZmlsbD0iI0YxRjFGMSIgcng9IjY2LjcyNTIiIHJ5PSIxNS43NDUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjIzLjcyNTQiIHk9IjI2LjM5MzUiPiYjMzM3MTk7JiMyMTQ2MjsmIzM2OTQ3OyYjMjA4NTU7JiMyNTExMDsmIzIwNDQ5OyYjMjQ2ODc7PC90ZXh0PjwvZz48IS0tZW50aXR5ID8/LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uIiBkYXRhLXNvdXJjZS1saW5lPSIxIiBkYXRhLXVpZD0iZW50MDAwMyIgaWQ9ImVudGl0eV8uLiI+PGVsbGlwc2UgY3g9IjcyLjcyODkiIGN5PSIxMTIuMDIzNiIgZmlsbD0iI0YxRjFGMSIgcng9IjIyLjc5ODkiIHJ5PSIxNC41MjM2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNy45OTk5IiB4PSI1OC43MjkiIHk9IjExNi42NzIxIj4mIzI0MzIwOyYjMzgxNDU7PC90ZXh0PjwvZz48IS0tZW50aXR5ID8/LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uIiBkYXRhLXNvdXJjZS1saW5lPSIzIiBkYXRhLXVpZD0iZW50MDAwNiIgaWQ9ImVudGl0eV8uLiI+PGVsbGlwc2UgY3g9IjcyLjcyODkiIGN5PSIyMDEuMDczNiIgZmlsbD0iI0YxRjFGMSIgcng9IjIyLjc5ODkiIHJ5PSIxNC41MjM2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNy45OTk5IiB4PSI1OC43MjkiIHk9IjIwNS43MjIxIj4mIzM2ODkwOyYjMjA4NTE7PC90ZXh0PjwvZz48IS0tbGluayA/Pz8/Pz8/IHRvID8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9Ii4uLi4uLi4iIGRhdGEtZW50aXR5LTI9Ii4uIiBkYXRhLXNvdXJjZS1saW5lPSIxIiBkYXRhLXVpZD0ibG5rNCIgaWQ9ImxpbmtfLi4uLi4uLl8uLiI+PHBhdGggZD0iTTYyLjg3LDM3LjcyIEM1OC44Myw1NC43NCA1Ny40MjYsNzYuNDQ1NiA2MS44NDYsOTIuNDg1NiIgZmlsbD0ibm9uZSIgaWQ9IiYjMzM3MTk7JiMyMTQ2MjsmIzM2OTQ3OyYjMjA4NTU7JiMyNTExMDsmIzIwNDQ5OyYjMjQ2ODc7LXRvLSYjMjQzMjA7JiMzODE0NTsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjYzLjQ0LDk4LjI3LDY0LjkwNTMsODguNTMwOCw2Mi4xMTE3LDkzLjQ0OTcsNTcuMTkyOCw5MC42NTYsNjMuNDQsOTguMjciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgPz8gdG8gPz8/Pz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIuLiIgZGF0YS1lbnRpdHktMj0iLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMiIgZGF0YS11aWQ9ImxuazUiIGlkPSJsaW5rXy4uXy4uLi4uLi4iPjxwYXRoIGQ9Ik04Mi40OCw5OC41NSBDODcuMjQsODIuNTUgODguOTIxNiw2MC42NTkzIDg0LjYyMTYsNDMuNTM5MyIgZmlsbD0ibm9uZSIgaWQ9IiYjMjQzMjA7JiMzODE0NTstdG8tJiMzMzcxOTsmIzIxNDYyOyYjMzY5NDc7JiMyMDg1NTsmIzI1MTEwOyYjMjA0NDk7JiMyNDY4NzsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjgzLjE2LDM3LjcyLDgxLjQ3MjksNDcuNDIzMyw4NC4zNzgsNDIuNTY5NCw4OS4yMzE5LDQ1LjQ3NDUsODMuMTYsMzcuNzIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgPz8gdG8gPz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4iIGRhdGEtZW50aXR5LTI9Ii4uIiBkYXRhLXNvdXJjZS1saW5lPSIzIiBkYXRhLXVpZD0ibG5rNyIgaWQ9ImxpbmtfLi5fLi4iPjxwYXRoIGQ9Ik03Mi43MywxMjcgQzcyLjczLDE0My4yNSA3Mi43MywxNjMuODkgNzIuNzMsMTgwLjEyIiBmaWxsPSJub25lIiBpZD0iJiMyNDMyMDsmIzM4MTQ1Oy10by0mIzM2ODkwOyYjMjA4NTE7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3Mi43MywxODYuMTIsNzYuNzMsMTc3LjEyLDcyLjczLDE4MS4xMiw2OC43MywxNzcuMTIsNzIuNzMsMTg2LjEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1TUkM9W3F0WkhqX3JmX3hJTlpQRVZqY3Zfclo3am9WdzVwbmhOUW9oZXdqZWZRM3BUcV8xb0lnQ2M1dW0xNFNNazBxdEhvdVBQSnJpdFFtODBdLS0+PC9nPjwvc3ZnPg=='>\n\n<p>因此，在设计描述关卡时，可以直接用有向图来描述整个流程。例如，《锈湖：地铁繁花》第一章襁褓站的流程图如下：</p>\n<img src='data:image/svg+xml;base64,ZXJyb3IgY29kZTogNTIw'>\n\n<p>《纸嫁衣》第一部第一章拜堂的流程图如下：</p>\n<img src='data:image/svg+xml;base64,ZXJyb3IgY29kZTogNTIw'>\n\n<p>流程里，“开锁”中的锁，并不局限于门锁、箱子锁这种物理意义上的锁。在游戏中通常会使用小游戏作为包装，增强游戏的交互性和可玩姓。例如，首先需要找齐拼图碎片的拼图游戏，首先需要获取关键信息的类华容道游戏等。这其中，“拼图碎片”和“关键信息”就分别是解开“拼图游戏”和“类华容道游戏”前置锁的道具。</p>\n<p>道具之间组合可以获得新道具。一把锁可能需要多个道具解锁，或者一件道具可以解锁多把锁。</p>\n<h2 id=\"需要注意的事情\"><a href=\"#需要注意的事情\" class=\"headerlink\" title=\"需要注意的事情\"></a>需要注意的事情</h2><h3 id=\"让玩家知道现在应该做什么\"><a href=\"#让玩家知道现在应该做什么\" class=\"headerlink\" title=\"让玩家知道现在应该做什么\"></a>让玩家知道现在应该做什么</h3><p>道具解锁的逻辑需要基础而底层。说白了，寻物解谜的过程，就是玩家与设计者对脑电波的过程，所以适宜使用一些世界通用的逻辑。例如水浇灭火、火点蜡烛、保险丝接通电路、金属棍卡住排风扇叶这种朴实逻辑。如果实在需要特殊的逻辑，则最好在游戏内的文本清晰说明，或让NPC明确交代。</p>\n<p>如此，玩家看到锁孔就会想到要找钥匙，看到钓竿和鱼钩就会想到要找鱼饵；或者是，玩家手里有锤子就想砸点什么，手里有螺丝刀就想拧点螺丝。</p>\n<p>同时需要注意，在设计的解谜流程之外，如果有一些符合朴素逻辑的道具解锁的交互，应当提前想好让这些交互无效的理由。不能让玩家产生“锤子能砸碎花瓶，为什么不能砸碎玻璃门？”的疑问。</p>\n<p>虽然道具解锁的逻辑需要基础而底层，但开锁获取道具的逻辑可以天马行空。例如，看到拼图碎片而想到需要拼图是基础逻辑，而拼图成功后，拼图底座的盒子突然打开了，这个盒子打开的机械原理一般不需要交代。</p>\n<h3 id=\"关于道具和锁\"><a href=\"#关于道具和锁\" class=\"headerlink\" title=\"关于道具和锁\"></a>关于道具和锁</h3><p>核心流程就是获取道具开锁，但可以让获取道具的过程更加曲折，加上更多步骤和交互，丰富视听。令道具和锁之间的步骤更多，距离更远，让玩家奔忙，令游戏过程更有沉浸感。例如《锈湖：地铁繁花》第四章鸟桥站中，玩家需要在Laura和Robert之间反复对话多次后才能获得新的道具。</p>\n<p>但道具和锁之间的距离也不宜过远。首先会让操作更为繁琐，然后也会让玩家更难找到道具和锁之间的联系，令玩家感到挫败，大幅降低游戏体验。在《机械迷城》中，进度到达进入城市后，一些谜题所需要的道具可能分布在三、四个场景之外，加上玩家需要控制角色走动到地图边缘才能换场景，导致一个谜题解谜的过程可能很大一部分时间花在了走路上。</p>\n<p>在《未上锁的房间》中，通常游戏场景被限制在一个机关盒上，设计者很巧妙地使用了镜片道具，在有限的空间中加入了更多的信息。然而游戏中道具和信息密度也不能过高，同时分布不能杂乱。无用的道具需要及时删除。区域解锁也是一个很常用的方案：玩家在第一个区域中解决了大部分谜题，同时解锁了第二个区域，然后第一个区域内剩余的少部分谜题，需要第二个区域内的道具或信息才能解开。</p>\n<p>另外，在所有类型的解谜游戏中，如果一个操作不可逆，那么它必须要是正确的。</p>\n<h3 id=\"寻物解谜不止寻物\"><a href=\"#寻物解谜不止寻物\" class=\"headerlink\" title=\"寻物解谜不止寻物\"></a>寻物解谜不止寻物</h3><p>如果寻物解谜游戏只有找东西，那就非常枯燥乏味了。</p>\n<p>对于我个人来说，《未上锁的房间》《特斯拉密室》这种游戏的玩点很大程度上在于各种模拟现实的交互，拖、扭、按、视角变换等，提供一种拟真体验，毕竟很少能有人能在现实生活中做一回侦探。《锈湖》系列的玩点在于惊悚氛围，观赏诡异的道具获取逻辑，以及贯穿系列引人入胜的故事。《纸嫁衣》系列的玩点在于恐怖氛围，跳脸杀，和拥有大量文本的民俗剧情。当然，游戏是文化产品，美术、音乐是所有游戏中不得不重视的元素。</p>\n<p>在寻物解谜游戏中，不仅需要谜题，还要在一定程度上解释谜题为何存在。上述几款游戏或多或少都使用了神秘学。应当是一个很便捷的方案。</p>\n","categories":["Gameplay"]},{"title":"游戏中实现平台跳跃的技巧","url":"/%E7%AC%94%E8%AE%B0/Gameplay/%E6%B8%B8%E6%88%8F%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%B9%B3%E5%8F%B0%E8%B7%B3%E8%B7%83%E7%9A%84%E6%8A%80%E5%B7%A7/","content":"<p>这是一篇翻译稿</p>\n<blockquote>\n<p>原文链接：<a href=\"https://www.gamedeveloper.com/design/gamemaker-platformer-jumping-tips\">GameMaker Platformer Jumping Tips</a></p>\n</blockquote>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>原始文章发布于<a href=\"https://www.patreon.com/posts/14531948\">Patreon</a></p>\n<p>我想谈谈新手在平台跳跃游戏制作中经常出现的一些跳跃手感问题。这篇文章非常适合正在学习游戏开发的学生，或是正学习GameMaker准备首次参加Game Jam的业余爱好者阅读。</p>\n<p>我发现学生制作的游戏总是有相同的问题，所以我调查了他们使用的教程。很多GameMaker的学生在制作第一款游戏时，参考的是 Shaun Spalding’s excellent platformer tutorials。我也挺喜欢这些教程，因为它们简单直接，甚至对没有代码基础的初学者也十分友好。</p>\n<p><a href=\"https://www.youtube.com/watch?v=IysShLIaosk\">The original tutorial for Gamemaker Studio</a></p>\n<p><a href=\"https://www.youtube.com/watch?v=izNXbMdu348\">And an updated one for Gamemaker Studio 2</a></p>\n<p>然而，这种简单方法，会引发一些游戏跳跃手感问题。下面我会主要讲两个方法，能让初学者在教程基础上修改后，使游戏跳跃手感更佳。这两个方法分别是边缘辅助（Ledge Assistance）和跳跃输入缓冲（Jump Input Buffering）。</p>\n<p>这些是平台跳跃游戏中常用的技术实现，所以好消息是它们的概念已有诸多优秀深入的研究。但这些事情可能不是首次开发平台跳跃游戏的初学者要考虑的。因为从零开始构建一个平台跳跃游戏的所有部分，甚至实现游戏角色的基础移动，对他们而言已经不是容易的事情。</p>\n<p>我希望的是能将这些概念与基础教程联系起来，让学生们在后续制作游戏的过程中，开始考虑这些事情的时候，能有个平缓的过渡。开始！</p>\n<h2 id=\"边缘辅助（Ledge-Assistance）\"><a href=\"#边缘辅助（Ledge-Assistance）\" class=\"headerlink\" title=\"边缘辅助（Ledge Assistance）\"></a>边缘辅助（Ledge Assistance）</h2><p>也被称作边缘宽限（Ledge Forgiveness）、宽限期跳跃（Grace Period Jumping）、土狼时间（Coyote Time）等术语。你可能也遇到过这种情况：尝试在最后一刻从边缘起跳，来越过一条很远的沟，但最终跳跃输入并未生效，角色从边缘掉入沟中。边缘辅助就是用来处理这类问题的。</p>\n<p>解决思路是，当玩家离开边缘不处于平面上后，在几帧范围内仍然接受跳跃输入，即从边缘跳跃时的宽限期。</p>\n<p>关于这个概念的深度解读和图示，我强烈推荐阅读 <a href=\"http://kpulv.com/123/Platforming_Ledge_Forgiveness/\">Kyle Pulver’s article on this topic</a>。</p>\n<p>由于这个概念跟输入和手感深度绑定，单单通过文字和视觉很难完全理解。所以我制作了一个简单的示例来帮助理解宽限期是如何影响跳跃手感的。</p>\n<p><a href=\"http://storage.wertle.com/patreon/platformerFeel/Ledge%20Assistance/\">边缘辅助示例（需要键盘）</a></p>\n<p>这是一个基于Spalding教程的平台跳跃游戏设置，非常简单，但可以调整边缘辅助的宽限期帧数。</p>\n<p>宽限期帧数初始为0，也就是默认教程中的效果。在两块平台之间跳跃时应该能体会到，试图在最后一刻进行跳跃，结果却掉下去的感觉。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Gameplay/%E6%B8%B8%E6%88%8F%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%B9%B3%E5%8F%B0%E8%B7%B3%E8%B7%83%E7%9A%84%E6%8A%80%E5%B7%A7/Ledge%20Assistance%201.gif\" alt=\"Ledge Assistance 1.gif\"></p>\n<p>当输入和期望结果不匹配时感觉是很糟糕的。<a href=\"http://kpulv.com/123/Platforming_Ledge_Forgiveness/\">Kyle的文章</a>对这种现象进行了更深入的探讨，并提供了一种可选解决方案，也就是上述增加宽限期的方式。</p>\n<p>通过调整宽限帧（点击上&#x2F;下箭头按钮），你可以控制玩家悬空但仍能输入有效跳跃指令的帧数。这就是Kyle在他的文章中提到的“grace timer”。<a href=\"http://storage.wertle.com/patreon/platformerFeel/Ledge%20Assistance/\">尝试不同帧数</a>来感受其对跳跃的影响。选中“显示反馈”按钮开启宽限期生效时的视觉提示。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Gameplay/%E6%B8%B8%E6%88%8F%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%B9%B3%E5%8F%B0%E8%B7%B3%E8%B7%83%E7%9A%84%E6%8A%80%E5%B7%A7/Ledge%20Assistance%202.gif\" alt=\"Ledge Assistance 2.gif\"></p>\n<p><strong>宽限期设置在多少帧才合适呢？</strong></p>\n<p>这完全取决于游戏和追求的游戏感受。如果想制作一款困难、需要精确操控的平台跳跃游戏，或许需要将帧数控制的尽可能少，但仍要补偿人类的反应时间（若想定量讨论的话，人类反应时间在215ms左右，再依据目标FPS来定，或者直接根据自我感觉定。我推荐初始设为6帧，再不断调整）。</p>\n<p>然而，假设制作的游戏，是一只懒洋洋的蝙蝠通过拍打翅膀来做一次“跳跃”，这种跳跃如果拥有很长的宽限期，显得超级轻盈，也能说的通，所以蝙蝠可以直接从平台边缘跳下来，眼看要坠落但又重新进行了“跳跃”。我只是突然想到这个随便举个例子。</p>\n<p>我想表达的是，这个问题不存在通用的标准答案，需要根据追求的游戏感受不断调整，这得考虑很多事情：难度等级、目标玩家的经验和反应时间、输入设备和动作美感（the fantasy of your movement）等等。</p>\n<p>文档末尾有脚本示例。</p>\n<h2 id=\"跳跃输入缓存（Jump-Input-Buffering）\"><a href=\"#跳跃输入缓存（Jump-Input-Buffering）\" class=\"headerlink\" title=\"跳跃输入缓存（Jump Input Buffering）\"></a>跳跃输入缓存（Jump Input Buffering）</h2><p>我看到很多学生们制做的平台跳跃游戏，存在的另一个问题是没有跳跃输入缓存，当游戏需要很多重复、精确跳跃时，会带来糟糕的游戏感受。同样地，<a href=\"http://kpulv.com/106/Jump_Input_Buffering/\">Kyle Pulver展开讲解了这个问题</a>，推荐阅读这篇文章。</p>\n<p>这个问题的解决思路和边缘辅助相反：仍需要一个让跳跃输入生效的宽限期，但这回是设置在按下跳跃按钮<strong>之后</strong>而不是之前。</p>\n<p><a href=\"http://storage.wertle.com/patreon/platformerFeel/Jump%20Buffering/\">尝试跳跃输入缓存示例（需要键盘）</a></p>\n<p>和另一个示例一样，跳跃输入缓存帧设为0时，就是基础教程的版本。如果正好在角色碰到地面<strong>之前</strong>一点点时按下跳跃按钮，跳跃不会生效，角色会呆坐在地上，你可能也会觉得很呆。当尝试进行连续跳跃，在角色刚落地就跳跃时，这种问题会更频繁地发生。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Gameplay/%E6%B8%B8%E6%88%8F%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%B9%B3%E5%8F%B0%E8%B7%B3%E8%B7%83%E7%9A%84%E6%8A%80%E5%B7%A7/Jump%20Input%20Buffering%201.gif\" alt=\"Jump Input Buffering 1.gif\"></p>\n<p>增加跳跃输入缓存帧大致就是“如果玩家按下跳跃后，在经过这个帧数之前落地，那在落地后就立即执行跳跃”。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Gameplay/%E6%B8%B8%E6%88%8F%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%B9%B3%E5%8F%B0%E8%B7%B3%E8%B7%83%E7%9A%84%E6%8A%80%E5%B7%A7/Jump%20Input%20Buffering%202.gif\" alt=\"Kump Input Buffering 2.gif\"></p>\n<p>同样地，跳跃输入缓存帧应该设置多长也不存在通用的标准答案。<a href=\"http://storage.wertle.com/patreon/platformerFeel/Jump%20Buffering/\">设置不同帧数进行游玩</a>来试着感受它对跳跃带来的影响。需要在补偿玩家反应时间和让角色动作看起来真实之间尽可能做好平衡。</p>\n<p>然后思考你的游戏想达到什么游玩感受。有个很长的跳跃输入缓存帧是否合理？游戏会变成什么样？应该如何做好设定（fantasy）能让其变得合理？或许你应该可以开始尝试制作自己的游戏了！</p>\n<p>文档末尾有脚本示例。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>相对于游戏感受这个大的话题，这些只算是两个小的调整，玩家输入手感的打磨仍可深入研究。有很多其他主题可以探索：可变跳跃高度、微调辅助（nudge assistance）和调整跳跃最高点的停留时间等等。</p>\n<p>但如果你刚开始制作第一款平台跳跃游戏，但觉得对基础已有一定掌握，我认为在这两个方面调整玩家输入是个很好的开始。但注意一开始就考虑太多的话，也很容易感到不知所措，尤其是没有代码基础时。</p>\n<p>通过阅读下方的脚本也可以看出来，仅这两个调整就能让玩家的移动脚本变得比原始教程复杂很多。</p>\n<p>但我认为这是很好的开始，为第一款平台跳跃游戏稍稍增色的好办法，在经典项目或game jam里尝试使用吧，或者就随便玩玩。</p>\n<h2 id=\"脚本示例\"><a href=\"#脚本示例\" class=\"headerlink\" title=\"脚本示例\"></a>脚本示例</h2><p>如果你参考的是Spalding的GameMaker教程，应该可以直接将这些脚本分别复制粘贴到player对象的Create event 和 Step events中。将grace_jump_time 和 jump_buffer 设置成游玩上面两个示例时觉得不错的数值。我尽可能详细地写了注释。或者可以直接查看下方贴出的GameMaker工程。祝好运！</p>\n<p><a href=\"http://storage.wertle.com/patreon/platformerFeel/ModifiedPlayerCreateEvent.txt\">修改Player Create Event</a></p>\n<p><a href=\"http://storage.wertle.com/patreon/platformerFeel/ModifiedPlayerStepEvent.txt\">修改Player Step Event</a></p>\n<h2 id=\"链接汇总\"><a href=\"#链接汇总\" class=\"headerlink\" title=\"链接汇总\"></a>链接汇总</h2><ul>\n<li><a href=\"https://www.youtube.com/watch?v=IysShLIaosk\">Shaun Spalding platformer tutorial for Gamemaker Studio</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=izNXbMdu348\">Shaun Spalding platformer tutorial for Gamemaker Studio 2</a></li>\n<li><a href=\"http://kpulv.com/123/Platforming_Ledge_Forgiveness/\">Kyle Pulver’s article on ledge forgiveness</a></li>\n<li><a href=\"http://storage.wertle.com/patreon/platformerFeel/Ledge%20Assistance/\">Ledge Assistance Demo (keyboard required)</a></li>\n<li><a href=\"http://kpulv.com/106/Jump_Input_Buffering/\">Kyle Pulver article on jump buffering</a></li>\n<li><a href=\"http://storage.wertle.com/patreon/platformerFeel/Jump%20Buffering/\">Jump Input Buffering Demo (keyboard required)</a></li>\n<li><a href=\"http://storage.wertle.com/patreon/platformerFeel/ModifiedPlayerCreateEvent.txt\">Modified Player Create Event</a></li>\n<li><a href=\"http://storage.wertle.com/patreon/platformerFeel/ModifiedPlayerStepEvent.txt\">Modified Player Step Event</a></li>\n</ul>\n","categories":["Gameplay"]},{"title":"游戏性：风险回报理论","url":"/%E7%AC%94%E8%AE%B0/Gameplay/%E6%B8%B8%E6%88%8F%E6%80%A7%EF%BC%9A%E9%A3%8E%E9%99%A9%E5%9B%9E%E6%8A%A5%E7%90%86%E8%AE%BA/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><blockquote>\n<p>视频链接：<a href=\"https://www.bilibili.com/video/BV1be4y1d781\">《游戏性：风险回报理论》</a></p>\n</blockquote>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>什么是游戏性（Game Essence）？这个词语描述了游戏的乐趣所在，不过这个说法也比较抽象。</p>\n<p>樱井政博老师对此的定义则是游戏的“拉扯程度”（Pull and Push）或“风险回报”（Risk and Reward）</p>\n<h3 id=\"《太空侵略者》\"><a href=\"#《太空侵略者》\" class=\"headerlink\" title=\"《太空侵略者》\"></a>《太空侵略者》</h3><p>1978年发行的飞行射击类型的街机游戏<a href=\"https://baike.baidu.com/item/%E5%A4%AA%E7%A9%BA%E4%BE%B5%E7%95%A5%E8%80%85/1358853\">《太空侵略者》</a>，于日本引起了社会现象，乃射击游戏类别的鼻祖之一。游戏理念很简单，操作下方炮台歼灭空中左右移动的侵略者，侵略者会水平运动，在触碰屏幕边界后再往下推进，若侵略者抵达屏幕最下方，则敌人侵略成功，游戏结束。</p>\n<p>以此游戏为例来诠释何为“风险回报”理论。</p>\n<h3 id=\"游戏性\"><a href=\"#游戏性\" class=\"headerlink\" title=\"游戏性\"></a>游戏性</h3><p>因为自机和侵略者只能垂直射击，所以假设自机和敌人保持不动且不在同一条垂直线上的话，双方都不会打中对方，此时处于“无风险，无回报”的状态。当自机逐渐向敌人所在的垂直线移动时，自机被击中的风险逐渐增加，而获得的收益是离敌人越来越近直至可以击中敌人。</p>\n<p><strong>冒“风险”以获得“回报”，这就是“拉扯程度”以及“游戏性”的本质。</strong></p>\n<h3 id=\"攻略\"><a href=\"#攻略\" class=\"headerlink\" title=\"攻略\"></a>攻略</h3><p>这对“攻略”（Strategy）要素也有着重大的影响。“攻略”和“游戏性”其实是同一个概念的不同表述。</p>\n<p>“游戏性”是指控制风险并获得回报的乐趣，而“攻略”则是控制风险并获得回报的方法。前者是游戏系统的角度，后者是玩家的角度。</p>\n<p>回到《太空侵略者》，由于敌人是一边水平移动一边射击的，所以子弹到达玩家所在水平线时相对于敌人本身的位置是要滞后的。当追击敌人（和敌人移动方向一致），玩家进入敌人子弹射程时，和敌人本身的位置还很远，没法击中敌人；当迎击敌人（和敌人移动方向相反），玩家进入敌人子弹射程时，和敌人本身的位置很近，可以击中敌人。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Gameplay/%E6%B8%B8%E6%88%8F%E6%80%A7%EF%BC%9A%E9%A3%8E%E9%99%A9%E5%9B%9E%E6%8A%A5%E7%90%86%E8%AE%BA/%E3%80%8A%E5%A4%AA%E7%A9%BA%E4%BE%B5%E7%95%A5%E8%80%85%E3%80%8B%E8%BF%BD%E5%87%BB%E6%95%8C%E4%BA%BA.png\" alt=\"《太空侵略者》追击敌人.png\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Gameplay/%E6%B8%B8%E6%88%8F%E6%80%A7%EF%BC%9A%E9%A3%8E%E9%99%A9%E5%9B%9E%E6%8A%A5%E7%90%86%E8%AE%BA/%E3%80%8A%E5%A4%AA%E7%A9%BA%E4%BE%B5%E7%95%A5%E8%80%85%E3%80%8B%E8%BF%8E%E5%87%BB%E6%95%8C%E4%BA%BA.png\" alt=\"《太空侵略者》迎击敌人.png\"></p>\n<p>所以《太空侵略者》的攻略是：迎击优于追击</p>\n<p>此外，自机的宽度判定是游戏平衡性的关键因素，因为改因素决定了风险程度，这段距离不仅是视觉设计，也决定的游戏的深度与乐趣。能控制风险的机制也是游戏平衡性的关键，比如可以抵挡敌人子弹的掩体。</p>\n<p><strong>控制并降低“风险”，从而更容易获得“回报”，此为“攻略”。</strong></p>\n<p>大家可以想象一下如果自机能够发生三向激光的场景，虽然观感貌似酷炫，但不一定是最好的游戏设计。当然如果敌人也能斜向射击，或自身存在子弹数量限制的话，就另当别论了。</p>\n<h3 id=\"死亡之墙打法\"><a href=\"#死亡之墙打法\" class=\"headerlink\" title=\"死亡之墙打法\"></a>死亡之墙打法</h3><p>只要一个侵略者到达屏幕底部，自机无论剩多少条命都会立即游戏结束，这种情况下风险已达到极限。但此时敌人的激光是无法击中自机的，故风险又降低了不少。也就是说，死亡之墙打法就是“风险”和“回报”均处于最大的状态，操作稍有闪失就会游戏失败，但同时自机却处于无敌状态。此“攻略”可谓简单刺激，不过此打法本身可能是判定的bug。</p>\n<h3 id=\"《超级马里奥兄弟》\"><a href=\"#《超级马里奥兄弟》\" class=\"headerlink\" title=\"《超级马里奥兄弟》\"></a>《超级马里奥兄弟》</h3><p>《超级马里奥兄弟》游戏中乌龟和龟壳的例子。</p>\n<p>开始时马里奥距离乌龟很远，不会受伤也无法击杀乌龟；随着二者距离拉近，受伤风险逐渐上升；即将接触时，马里奥需要跳跃来规避风险，与此同时也是主动进攻的的时机；击杀乌龟的时刻，也是风险到最大值的时刻。</p>\n<p>之后，马里奥可以踢开龟壳击杀敌人刷分或刷命，“回报”非常可观，但一并到来的“风险”，是龟壳可能碰到障碍物反弹回来打到自己。可谓是教科书般的机制设计。</p>\n<p><strong>风险与回报之间必须紧密连接，同时还要具备适当的量度。</strong></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ul>\n<li>冒“风险”以获得“回报”，这就是“拉扯程度”以及“游戏性”的本质。</li>\n<li>控制并降低“风险”，从而更容易获得“回报”，此为“攻略”。</li>\n<li>风险与回报之间必须紧密连接，同时还要具备适当的量度。</li>\n<li>所谓的“游戏性”或“拉扯程度”，只是电子游戏本身的一个特征，令玩家感受到沉浸感并使人娱乐其间的体验形式还有不少，并非所有游戏都是通过“游戏性”来传达体验的。</li>\n<li>当一款游戏的“游戏性”提高了之后，其所谓的“公众性”（Broad Appeal）会随之降低。以《星之卡比》初代为例，选择了简化操作，从而吸引更广泛的玩家群体。</li>\n</ul>\n<h2 id=\"联想\"><a href=\"#联想\" class=\"headerlink\" title=\"联想\"></a>联想</h2><p>看完视频后，联想到了《空洞骑士》。其中令我印象深刻的设计之一，是主角的跳跃下劈攻击。玩家跳跃到敌人的上方，在就要下落接触到敌人，即将受到伤害时，按住下方向键加攻击键执行下劈攻击。此时由于命中敌人的击退效果，玩家会停止下落，反而向上弹跳一小段距离，而后再次下落，此时可以再次使用下劈攻击，如此重复。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Gameplay/%E6%B8%B8%E6%88%8F%E6%80%A7%EF%BC%9A%E9%A3%8E%E9%99%A9%E5%9B%9E%E6%8A%A5%E7%90%86%E8%AE%BA/%E7%A9%BA%E6%B4%9E%E9%AA%91%E5%A3%AB%E8%B7%B3%E8%B7%83%E4%B8%8B%E5%8A%88.gif\" alt=\"空洞骑士跳跃下劈.gif\"></p>\n<p>由于很多小怪敌人的观察、移动和攻击轨迹都只有水平方向，所以使用这种攻击方式时，敌人根本没法主动反击，甚至丢失主角目标。当然，这种巨大“回报”，也是伴随更高“风险”的。开始跳跃下劈攻击后，实际进入了一个连续QTE的状态，每次都要在恰好的时机执行攻击，否则就会下落接触敌人受到伤害。</p>\n<p>但还好游戏其他很多敌人是不适合对其使用这种攻击的，例如会向上持盾或攻击的敌人、会飞行的敌人、频繁跳跃的敌人、头顶没有空旷空间的敌人等等。否则相当于练好这一招游戏就没啥难度了。当然下劈攻击的精妙之处不止如此，更高级的使用方式在此便不再赘述。</p>\n<p>再联想更远一些，另一款平台跳跃游戏《奥日2萤火意志》，主角利用敌人弹跳的“猛击”技能也是类似，主角与敌人的距离逐渐靠近，收到伤害的“风险”升高，得到的回报是，可以利用敌人弹跳进行移动，或将敌人弹向地形直接击杀。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Gameplay/%E6%B8%B8%E6%88%8F%E6%80%A7%EF%BC%9A%E9%A3%8E%E9%99%A9%E5%9B%9E%E6%8A%A5%E7%90%86%E8%AE%BA/%E5%A5%A5%E6%97%A52%E7%8C%9B%E5%87%BB%E6%8A%80%E8%83%BD.gif\" alt=\"奥日2猛击技能.gif\"></p>\n<p>再联想更远一些，很多抓时机的机制都可以从“风险回报”这个角度去理解。格斗游戏中的当身技；《英雄联盟》中剑姬W技能的招架，战争女神希维尔E技能的护盾；《只狼》中的弹反等等。总之，通常都是缩短反应时间，提高成功的回报。</p>\n","categories":["Gameplay"]},{"title":"DOTween停止动画对回调的影响","url":"/%E7%AC%94%E8%AE%B0/Unity/DOTween%E5%81%9C%E6%AD%A2%E5%8A%A8%E7%94%BB%E5%AF%B9%E5%9B%9E%E8%B0%83%E7%9A%84%E5%BD%B1%E5%93%8D/","content":"<h2 id=\"DOTween停止动画对回调的影响\"><a href=\"#DOTween停止动画对回调的影响\" class=\"headerlink\" title=\"DOTween停止动画对回调的影响\"></a>DOTween停止动画对回调的影响</h2><p>DOTween中的回调，一般有OnComplete加在动画结束，以及Insert&#x2F;AppendCallback插在动画中间。OnStart也可添加回调，但停止动画时一般都已经执行，故不做讨论。</p>\n<p>DOTween的停止动画，可用Complete方法使动画立即播放完毕，也可用Kill方法使动画中断。</p>\n<p>以下是几种DOTween停止动画时，对回调方法执行情况影响的测试结果：</p>\n<ul>\n<li>DOTween.Complete(false) 方法会执行OnComplete回调，但不会执行AppendCallback中的方法</li>\n<li>DOTween.Complete(True) 方法会执行OnComplete回调，也会执行AppendCallback中的方法</li>\n<li>DOTween.Kill(false) 暴力停止，动画若未执行完，则其主体会留在当时所处状态。后面未执行到的任何回调也都不再执行</li>\n<li>DOTween.Kill(True) 方法会执行OnComplete回调，但不会执行AppendCallback中的方法</li>\n</ul>\n","categories":["Unity"],"tags":["C#"]},{"title":"QFramework-Architecture初始化","url":"/%E7%AC%94%E8%AE%B0/Unity/QFramework-Architecture%E5%88%9D%E5%A7%8B%E5%8C%96/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p><a href=\"https://github.com/liangxiegame/QFramework\">QFramework</a>是提供一套简单、强大、易上手、符合 SOLID 原则、支持领域驱动设计（DDD）、事件驱动、数据驱动、分层、MVC 、CQRS、模块化、易扩展的架构，她的源码只有不到 800 行，完全可以把她放在笔记应用里保存。</p>\n<p>读源码时发现了一些有趣的设计，简单做一下记录。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><h3 id=\"Architecture组件\"><a href=\"#Architecture组件\" class=\"headerlink\" title=\"Architecture组件\"></a>Architecture组件</h3><p>架构中有Architecture组件，含义是一个架构，提供MVC、分层、模块管理等功能。例如下面的使用</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 定义一个架构（提供 MVC、分层、模块管理等）</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">CounterApp</span> : <span class=\"title\">Architecture</span>&lt;<span class=\"title\">CounterApp</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">override</span> <span class=\"keyword\">void</span> <span class=\"title\">Init</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 注册成就系统 System </span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.RegisterSystem&lt;IAchievementSystem&gt;(<span class=\"keyword\">new</span> AchievementSystem());</span><br><span class=\"line\">        <span class=\"comment\">// 注册计数器数据模型 Model</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.RegisterModel&lt;ICounterAppModel&gt;(<span class=\"keyword\">new</span> CounterAppModel());</span><br><span class=\"line\">        <span class=\"comment\">// 注册存储工具的对象</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.RegisterUtility&lt;IStorage&gt;(<span class=\"keyword\">new</span> Storage());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里的System组件就相当于一个模块，在Architecture中对其进行注册。</p>\n<h3 id=\"Architecture源码\"><a href=\"#Architecture源码\" class=\"headerlink\" title=\"Architecture源码\"></a>Architecture源码</h3><p>Architecture的部分源码贴在这里</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title\">Architecture</span>&lt;<span class=\"title\">T</span>&gt; : <span class=\"title\">IArchitecture</span> <span class=\"keyword\">where</span> <span class=\"title\">T</span> : <span class=\"title\">Architecture</span>&lt;<span class=\"title\">T</span>&gt;, <span class=\"title\">new</span>() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> mInited = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> HashSet&lt;ISystem&gt; mSystems = <span class=\"keyword\">new</span> HashSet&lt;ISystem&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> HashSet&lt;IModel&gt; mModels = <span class=\"keyword\">new</span> HashSet&lt;IModel&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Action&lt;T&gt; OnRegisterPatch = architecture =&gt; &#123; &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> T mArchitecture;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> IArchitecture Interface &#123;</span><br><span class=\"line\">            <span class=\"keyword\">get</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (mArchitecture == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    MakeSureArchitecture();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">return</span> mArchitecture;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">MakeSureArchitecture</span>()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (mArchitecture == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                mArchitecture = <span class=\"keyword\">new</span> T();</span><br><span class=\"line\">                mArchitecture.Init();</span><br><span class=\"line\"></span><br><span class=\"line\">                OnRegisterPatch?.Invoke(mArchitecture);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> architectureModel <span class=\"keyword\">in</span> mArchitecture.mModels) &#123;</span><br><span class=\"line\">                    architectureModel.Init();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                mArchitecture.mModels.Clear();</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> architectureSystem <span class=\"keyword\">in</span> mArchitecture.mSystems) &#123;</span><br><span class=\"line\">                    architectureSystem.Init();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                mArchitecture.mSystems.Clear();</span><br><span class=\"line\"></span><br><span class=\"line\">                mArchitecture.mInited = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">Init</span>()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> IOCContainer mContainer = <span class=\"keyword\">new</span> IOCContainer(); <span class=\"comment\">// IOC容器</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">RegisterSystem</span>&lt;<span class=\"title\">TSystem</span>&gt;(<span class=\"params\">TSystem system</span>) <span class=\"keyword\">where</span> TSystem : ISystem</span> &#123;</span><br><span class=\"line\">            system.SetArchitecture(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">            mContainer.Register&lt;TSystem&gt;(system);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!mInited) &#123;</span><br><span class=\"line\">                mSystems.Add(system);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                system.Init();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// RegisterModel几乎一样的，还有其他一些无关内容，就省略了...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"单例\"><a href=\"#单例\" class=\"headerlink\" title=\"单例\"></a>单例</h3><p>显然Architecture组件是以单例使用的，且是懒汉式，Interface是其的单例对象。</p>\n<p>实例化方法放到了MakeSureArchitecture()中，需要注意的是，Architecture的初始化方法也在这里执行了。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> T mArchitecture;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> IArchitecture Interface &#123;</span><br><span class=\"line\">    <span class=\"keyword\">get</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mArchitecture == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            MakeSureArchitecture();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mArchitecture;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">MakeSureArchitecture</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mArchitecture == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        mArchitecture = <span class=\"keyword\">new</span> T();</span><br><span class=\"line\">        mArchitecture.Init();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>但我感兴趣的是Architecture里维护的两个HashSet，mSystems和mModels具体起了什么作用。</p>\n<p>实例化方法中，逐个取出了其中的System和Model，执行它们的初始化方法，最后将HashSet清空。</p>\n<h3 id=\"两个HashSet\"><a href=\"#两个HashSet\" class=\"headerlink\" title=\"两个HashSet\"></a>两个HashSet</h3><figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">MakeSureArchitecture</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mArchitecture == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> architectureModel <span class=\"keyword\">in</span> mArchitecture.mModels) &#123;</span><br><span class=\"line\">            architectureModel.Init();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mArchitecture.mModels.Clear();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> architectureSystem <span class=\"keyword\">in</span> mArchitecture.mSystems) &#123;</span><br><span class=\"line\">            architectureSystem.Init();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mArchitecture.mSystems.Clear();</span><br><span class=\"line\"></span><br><span class=\"line\">        mArchitecture.mInited = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>HashSet的内容是在组件的注册方法中填充的，将组件自身传入，例如RegisterSystem()</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">RegisterSystem</span>&lt;<span class=\"title\">TSystem</span>&gt;(<span class=\"params\">TSystem system</span>) <span class=\"keyword\">where</span> TSystem : ISystem</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// ...</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!mInited) &#123;</span><br><span class=\"line\">                mSystems.Add(system);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                system.Init();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<p>标志量mInited为true，直接执行System的初始化方法；为false，说明Architecture还没有的实例，Architecture自身的初始化方法也还没执行过。</p>\n<p>回头去看MakeSureArchitecture()方法，执行顺序是先初始化Architecture，后初始化HashSet中的各个组件。而这些组件都是尝试在Architecture初始化之前进行注册的。</p>\n<p>当Architecture初始化完成后，mInited被置为true，再注册其他组件时，就直接执行初始化方法了。</p>\n<p>如此，保证了各种情况下，Architecture的初始化总是能先于其注册的下层组件。例如避免了组件尝试通过Architecture获取其他组件时，其他组件还未被注册的情况。</p>\n","categories":["Unity"],"tags":["C#"]},{"title":"Unity代码剥离相关","url":"/%E7%AC%94%E8%AE%B0/Unity/Unity%E4%BB%A3%E7%A0%81%E5%89%A5%E7%A6%BB%E7%9B%B8%E5%85%B3/","content":"<h2 id=\"Unity的代码剥离\"><a href=\"#Unity的代码剥离\" class=\"headerlink\" title=\"Unity的代码剥离\"></a>Unity的代码剥离</h2><p>如同编译Java时需先将源码转成字节码，Unity打包编译源码时也有类似过程。</p>\n<p>在此过程中，Unity会检测代码引用情况，将类中从未使用过的成员、方法和不会执行到的代码删除，此过程称为<a href=\"https://docs.unity3d.com/Manual/ManagedCodeStripping.html\">代码剥离</a>。这样做的效果是能够显著减少包体大小。</p>\n<p>这个检测过程是静态的，动态生成代码中的引用情况无法检测到。所以例如反射的情况，检测时未发现相关引用会将其删除，导致反射时找不到类或方法。</p>\n<h2 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h2><p>Unity工程使用了EasySave3插件，从存档中恢复游戏的功能，在编辑器时正常；打包安装在安卓设备后，会报错无法恢复。</p>\n<p>进行存取的是一个<code>System.Collections.Generic.Stack</code>对象。根据<a href=\"https://docs.moodkie.com/easy-save-3/es3-guides/es3-supported-types/\">EasySave官方文档</a>描述，Stack容器的序列&#x2F;反序列化是被支持的。后使用<code>Stack&lt;string&gt;</code>类型对象进行测试，报错如下：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">MissingMethodException: Constructor on type &#x27;System.Collections.Generic.Stack`1[[System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=&#123;hash&#125;]]&#x27; not found.</span><br><span class=\"line\">    at System.RuntimeType.CreateInstanceImpl </span><br></pre></td></tr></table></figure>\n\n<p>从现象推断，Stack的无参构造函数在Unity的代码剥离过程被删除。EasySave在恢复存档进行反序列化时应该使用的反射，在尝试获取Stack无参构造时报错。</p>\n<h2 id=\"可选方案\"><a href=\"#可选方案\" class=\"headerlink\" title=\"可选方案\"></a>可选方案</h2><h3 id=\"禁止代码剥离\"><a href=\"#禁止代码剥离\" class=\"headerlink\" title=\"禁止代码剥离\"></a>禁止代码剥离</h3><p>Edit &gt; Project Settings &gt; Player选项，可控制代码剥离的程度。选择Disabled即可禁用代码剥离，但只能在使用Mono打包时使用此选项。这样做的话，最终包体积会更大些。</p>\n<h3 id=\"根节点注解\"><a href=\"#根节点注解\" class=\"headerlink\" title=\"根节点注解\"></a>根节点注解</h3><p>虽然Unity文档并未说明代码剥离时检测代码引用情况使用的具体方法，但从各方面的描述可推测其使用的方法，类似JVM垃圾回收中的引用计数。从根节点查找引用，最终形成一个树结构。</p>\n<p>所以为防止特定类型或成员被剥离，可手动为其加上<code>[Preserve]</code>注解。将其设置为根节点，因为Unity规定根节点一定不会被剥离。</p>\n<p>另一种方式是通过link.xml文件设置。文件只需在Assets文件夹下，工程内可有多个文件。示例如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">linker</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--Preserve types and members in an assembly--&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">assembly</span> <span class=\"attr\">fullname</span>=<span class=\"string\">&quot;AssemblyName&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--Preserve an entire type--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span> <span class=\"attr\">fullname</span>=<span class=\"string\">&quot;AssemblyName.MethodName&quot;</span> <span class=\"attr\">preserve</span>=<span class=\"string\">&quot;all&quot;</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--No &quot;preserve&quot; attribute and no members specified means preserve all members--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span> <span class=\"attr\">fullname</span>=<span class=\"string\">&quot;AssemblyName.MethodName&quot;</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--Preserve all fields on a type--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span> <span class=\"attr\">fullname</span>=<span class=\"string\">&quot;AssemblyName.MethodName&quot;</span> <span class=\"attr\">preserve</span>=<span class=\"string\">&quot;fields&quot;</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--Preserve all fields on a type--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span> <span class=\"attr\">fullname</span>=<span class=\"string\">&quot;AssemblyName.MethodName&quot;</span> <span class=\"attr\">preserve</span>=<span class=\"string\">&quot;methods&quot;</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--Preserve the type only--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span> <span class=\"attr\">fullname</span>=<span class=\"string\">&quot;AssemblyName.MethodName&quot;</span> <span class=\"attr\">preserve</span>=<span class=\"string\">&quot;nothing&quot;</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--Preserving only specific members of a type--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span> <span class=\"attr\">fullname</span>=<span class=\"string\">&quot;AssemblyName.MethodName&quot;</span>&gt;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">      <span class=\"comment\">&lt;!--Fields--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">field</span> <span class=\"attr\">signature</span>=<span class=\"string\">&quot;System.Int32 FieldName&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--Preserve a field by name rather than signature--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">field</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;FieldName&quot;</span> /&gt;</span></span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">&lt;!--Methods--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">method</span> <span class=\"attr\">signature</span>=<span class=\"string\">&quot;System.Void MethodName()&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--Preserve a method with parameters--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">method</span> <span class=\"attr\">signature</span>=<span class=\"string\">&quot;System.Void MethodName(System.Int32,System.String)&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--Preserve a method by name rather than signature--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">method</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;MethodName&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--Properties--&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--Preserve a property, its backing field (if present), </span></span><br><span class=\"line\"><span class=\"comment\">          getter, and setter methods--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">signature</span>=<span class=\"string\">&quot;System.Int32 PropertyName&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">signature</span>=<span class=\"string\">&quot;System.Int32 PropertyName&quot;</span> <span class=\"attr\">accessors</span>=<span class=\"string\">&quot;all&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--Preserve a property, its backing field (if present), and getter method--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">signature</span>=<span class=\"string\">&quot;System.Int32 PropertyName&quot;</span> <span class=\"attr\">accessors</span>=<span class=\"string\">&quot;get&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--Preserve a property, its backing field (if present), and setter method--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">signature</span>=<span class=\"string\">&quot;System.Int32 PropertyName&quot;</span> <span class=\"attr\">accessors</span>=<span class=\"string\">&quot;set&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--Preserve a property by name rather than signature--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;PropertyName&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--Events--&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--Preserve an event, its backing field (if present), add, and remove methods--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">event</span> <span class=\"attr\">signature</span>=<span class=\"string\">&quot;System.EventHandler EventName&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--Preserve an event by name rather than signature--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">event</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;EventName&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">assembly</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">linker</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>更多示例见<a href=\"https://docs.unity3d.com/Manual/ManagedCodeStripping.html#LinkXMLAnnotation\">官方文档</a>。</p>\n<h3 id=\"依赖注解\"><a href=\"#依赖注解\" class=\"headerlink\" title=\"依赖注解\"></a>依赖注解</h3><p>除了直接将代码元素定义为根节点，也能通过重建节点间的联系防止剥离。依赖注解能够显式定义代码元素间关系，在某些代码关系无法被静态检测时尤为有用，例如反射。注解名称如下：</p>\n<ul>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/Scripting.RequireImplementorsAttribute.html\">RequireImplementorsAttribute</a>: 将所有实现此接口的类标记为依赖。</li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/Scripting.RequireDerivedAttribute.html\">RequireDerivedAttribute</a>: 将所有继承此类的类标记为依赖。</li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/Scripting.RequiredInterfaceAttribute.html\">RequiredInterfaceAttribute</a>: 将此类实现的接口标记为依赖。</li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/Scripting.RequiredMemberAttribute.html\">RequiredMemberAttribute</a>: 将此类的成员标记为依赖。</li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/Scripting.RequireAttributeUsagesAttribute.html\">RequireAttributeUsagesAttribute</a>: 标记自定义注解为依赖。</li>\n</ul>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><p>使用添加根节点注解的方式。因为Stack是系统类，不适合改代码，故添加link.xml文件。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">linker</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">assembly</span> <span class=\"attr\">fullname</span>=<span class=\"string\">&quot;netstandard&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span> <span class=\"attr\">fullname</span>=<span class=\"string\">&quot;System.Collections.Generic.Stack`1&quot;</span> <span class=\"attr\">preserve</span>=<span class=\"string\">&quot;all&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">assembly</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">linker</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>关于assembly的全名，是在<a href=\"https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.generic.stack-1?view=netstandard-2.0\">官方API文档</a>中找到的。</p>\n<p>关于泛型，对于IL2CPP编译器，基本类型的泛型直接是有区别的，例如<code>List&lt;int&gt;</code>和<code>List&lt;float&gt;</code>是不同的；引用类型则会共享代码，如<code>List&lt;object&gt;</code>和<code>List&lt;string&gt;</code>。</p>\n<p>模仿报错中的<code>System.Collections.Generic.Stack`1</code>写法，对Stack的所有泛型做了保留。</p>\n","categories":["Unity"]},{"title":"Unity协程笔记","url":"/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%8D%8F%E7%A8%8B%E7%AC%94%E8%AE%B0/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><blockquote>\n<p>原视频：<a href=\"https://www.bilibili.com/video/BV1g14y1T7V6\">【Unity教程搬运】驯服协程 - Unity小贴士</a></p>\n</blockquote>\n<h2 id=\"枚举器\"><a href=\"#枚举器\" class=\"headerlink\" title=\"枚举器\"></a>枚举器</h2><p>在C#中，如果想使用foreach循环来迭代一个集合，那么此集合需要实现IEnumerable接口。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> element <span class=\"keyword\">in</span> collection) &#123;</span><br><span class=\"line\">    Debug.Log(element);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>IEnumerable接口只声明一个返回枚举器 IEnumerator 的方法。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title\">IEnumerable</span> &#123;</span><br><span class=\"line\">    <span class=\"function\">IEnumerator <span class=\"title\">GetEnumerator</span>()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>IEnumerator 用于列举事物的元素。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title\">IEnumerator</span> &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"built_in\">bool</span> <span class=\"title\">MoveNext</span>()</span>;</span><br><span class=\"line\">    <span class=\"built_in\">object</span> Current &#123; <span class=\"keyword\">get</span>; &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Reset</span>()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>foreach的执行原理，就是调用 MoveNext() 方法逐个获取迭代器中的下一个元素，直至到达末尾，此时方法返回false</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> enumerator = collection.GetEnumerator();</span><br><span class=\"line\"><span class=\"keyword\">while</span>(enumerator.MoveNext()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> element = enumerator.Current;</span><br><span class=\"line\">    Debug.Log(element);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"迭代器方法\"><a href=\"#迭代器方法\" class=\"headerlink\" title=\"迭代器方法\"></a>迭代器方法</h2><p>将这种迭代的思想套用在方法中，方法可以不只是返回一个值然后结束，而是能够继续返回任意多个后续值，本质上就是枚举它们。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">enumerate</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> value1;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> value2;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> value3;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> value4;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> value5;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> value6;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这种思想在不同语言中有不同的名称，在C#中我们将其称为迭代器方法（Iterator Method）</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">IEnumerator <span class=\"title\">Iterator</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>C# 的迭代器方法返回一个枚举器，并使用yield语句返回值或发出枚举已完成的信号。</p>\n<p>当调用迭代器方法时，方法中的具体内容并不会执行，而是会创建返回一个枚举器。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> IEnumerator Iterator &#123;</span><br><span class=\"line\">    DoSomething();</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    DoSomethingElse();</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    condition = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (condition)</span><br><span class=\"line\">        <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>调用枚举器的MoveNext()方法时，会开始执行迭代器方法，遇到yield关键字时，将其return的值赋给Current属性，然后方法停止执行。</p>\n<p>再次调用MoveNext()方法，方法会从上次停止的位置开始执行。这个过程会不断重复，直至遇到 yield break 语句，或方法全部执行完。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">Example</span>()</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> enumerator = Iterator();</span><br><span class=\"line\"></span><br><span class=\"line\">    enumerator.MoveNext(); <span class=\"comment\">// true</span></span><br><span class=\"line\">    Debug.Log(enumerator.Current); <span class=\"comment\">// 0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    enumerator.MoveNext(); <span class=\"comment\">// true</span></span><br><span class=\"line\">    Debug.Log(enumerator.Current); <span class=\"comment\">// 1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    enumerator.MoveNext(); <span class=\"comment\">// true</span></span><br><span class=\"line\">    Debug.Log(enumerator.Current); <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br><span class=\"line\">    enumerator.MoveNext(); <span class=\"comment\">// false</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如此，就创造了一个可以暂停和恢复执行的方法。</p>\n<h2 id=\"Unity协程\"><a href=\"#Unity协程\" class=\"headerlink\" title=\"Unity协程\"></a>Unity协程</h2><p>Unity中的协程就是利用这种方式来实现异步代码的效果。</p>\n<p>调用StartCoroutine()方法，以枚举器作为方法参数，启动协程。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> IEnumerator <span class=\"title\">Coroutine</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">Example</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> enumerator = Coroutine();</span><br><span class=\"line\">    StartCoroutine(enumerator);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>现在Unity会帮我们自动调用MoveNext()方法。但我们可以通过不同的yield语句来影响执行过程。</p>\n<p>大致有三类yield语句：</p>\n<ul>\n<li>返回指令<ul>\n<li>WaitForSeconds，等待固定时长</li>\n<li>LoadSceneAsync，等待场景异步加载</li>\n<li>WaitForEndOfFrame，等待帧结束</li>\n<li>WaitForFixedUpdate，等待物理帧结束</li>\n</ul>\n</li>\n<li>返回另一个枚举器<ul>\n<li><code>yield return AnotherCoroutine();</code> ，类似于直接调用一个方法，等待这个方法执行完成</li>\n</ul>\n</li>\n<li>返回空<ul>\n<li><code>yield return null;</code>，什么都不做，在下一帧再次尝试调用MoveNext方法</li>\n<li><code>yield return break</code>，停止协程</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"协程调度改进\"><a href=\"#协程调度改进\" class=\"headerlink\" title=\"协程调度改进\"></a>协程调度改进</h2><p>假设有两个任务要同时执行。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">yield</span> IEnumerator <span class=\"title\">TaskA</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title\">WaitForSeconds</span>(<span class=\"params\"><span class=\"number\">1</span></span>)</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">yield</span> IEnumerator <span class=\"title\">TaskB</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title\">WaitForSeconds</span>(<span class=\"params\"><span class=\"number\">3</span></span>)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果像下面这样调用的话，TaskA执行完之后才会执行TaskB，TaskB执行完后再执行之后的部分。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> IEnumerator <span class=\"title\">Start</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"title\">TaskA</span>()</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"title\">TaskB</span>()</span>;</span><br><span class=\"line\">    <span class=\"comment\">// Both tasks have finished!</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将两个任务如下分别作为单独的协程执行。则两个任务会同时开始执行，等两个方法都执行完成后再执行之后的部分。</p>\n<p>StartCoroutine方法返回一个Coroutine对象，也是一个yield指令</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> IEnumerator <span class=\"title\">Start</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> taskA = StartCoroutine(TaskA());</span><br><span class=\"line\">    <span class=\"keyword\">var</span> taskB = StartCoroutine(TaskB());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> taskA;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> taskB;</span><br><span class=\"line\">    <span class=\"comment\">// Both tasks have finished!</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果想等两个任务中任意一个执行完成，就开始执行之后的部分，该如何实现。</p>\n<p>如果使用AsyncOperations类的话，可以通过检查isDone属性轻松做到这一点。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> IEnumerator <span class=\"title\">Start</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> operationA = requeset.SendWebRequest();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> operationB = SceneManager.LoadSceneAsync(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(!operationA.isDone &amp;&amp; !operationB.isDone) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// One of the operations has finished!</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Coroutine对象没有这个属性，但这个问题很容易解决。</p>\n<p>创建一个 IEnumerator 的子类，增加 IsDone 属性</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">CoroutineHandler</span> : <span class=\"title\">IEnumerator</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">bool</span> IsDone &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">private</span> <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">object</span> Current &#123; <span class=\"keyword\">get</span>; &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"built_in\">bool</span> <span class=\"title\">MoveNext</span>()</span> =&gt; !IsDone;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Reset</span>()</span> &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CoroutineHandler</span>(<span class=\"params\">MonoBehaviour owner, IEnumerator coroutine</span>)</span> &#123;</span><br><span class=\"line\">        Current = owner.StartCoroutine(Wrap(coroutine));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> IEnumerator <span class=\"title\">Wrap</span>(<span class=\"params\">IEnumerator coroutine</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> coroutine;</span><br><span class=\"line\">        IsDone = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>只要协程未执行完成，MoveNext()方法就返回true</p>\n<p>构造方法传入两个参数，启动协程的MonoBehavior，以及要运行的枚举器。枚举器不会被直接运行，而是用Wrap()方法将其包装在另一个枚举器中。</p>\n<p>Wrap方法只是将原枚举器yield返回，然后将IsDone属性设置为true。</p>\n<p>最后，将创建的协程赋给Current属性。</p>\n<p>这样，如果在方法中 yield return 一个 CoroutineHandler 对象，它将传递原始的 Coroutine 对象。</p>\n<p>另外，可以创建扩展方法做一下简化。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> calss MonoBehaviourExtensions &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> CoroutineHandler <span class=\"title\">RunCoroutine</span>(<span class=\"params\"><span class=\"keyword\">this</span> MonoBehaviour owner, IEnumerator coroutine</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> CoroutineHandler(owner, coroutine);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>现在，可以使用这种方式启动协程，并使用IsDone检查协程是否执行完成</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> IEnumerator <span class=\"title\">Start</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> handlerA = <span class=\"keyword\">this</span>.RunCoroutine(TaskA());</span><br><span class=\"line\">    <span class=\"keyword\">var</span> handlerB = <span class=\"keyword\">this</span>.RunCoroutine(TaskB());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!handlerA.IsDone &amp;&amp; !handlerB.IsDone) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// One of the tasks has finished!</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这种思路还能够进一步扩展。例如，可以添加一个事件，该时间将在协程完成时发送通知。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">CoroutineHandler</span> : <span class=\"title\">IEnumerator</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">event</span> Action&lt;CoroutineHandler&gt; Completed;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">bool</span> IsDone &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">private</span> <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">object</span> Current &#123; <span class=\"keyword\">get</span>; &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"built_in\">bool</span> <span class=\"title\">MoveNext</span>()</span> =&gt; !IsDone;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Reset</span>()</span> &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CoroutineHandler</span>(<span class=\"params\">MonoBehaviour owner, IEnumerator coroutine</span>)</span> &#123;</span><br><span class=\"line\">        Current = owner.StartCoroutine(Wrap(coroutine));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> IEnumerator <span class=\"title\">Wrap</span>(<span class=\"params\">IEnumerator coroutine</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> coroutine;</span><br><span class=\"line\">        IsDone = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        Completed?.Invoke(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["Unity"],"tags":["C#"]},{"title":"Unity实现卡牌弯曲翻转效果","url":"/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E5%8D%A1%E7%89%8C%E5%BC%AF%E6%9B%B2%E7%BF%BB%E8%BD%AC%E6%95%88%E6%9E%9C/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>卡牌弯曲翻转的效果，预览：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E5%8D%A1%E7%89%8C%E5%BC%AF%E6%9B%B2%E7%BF%BB%E8%BD%AC%E6%95%88%E6%9E%9C/%E5%8D%A1%E7%89%8C%E5%BC%AF%E6%9B%B2%E7%BF%BB%E8%BD%AC%E6%95%88%E6%9E%9C.gif\" alt=\"卡牌弯曲翻转效果.gif\"></p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><p>运动分解成两部分，弯曲和翻转。弯曲的弧面使用Mesh Renderer手搓。</p>\n<h3 id=\"弯曲\"><a href=\"#弯曲\" class=\"headerlink\" title=\"弯曲\"></a>弯曲</h3><p>也就是需要展现一个弧面。</p>\n<p>如果卡牌使用Sprite物体，可以考虑写shader。但感觉模拟三维的像素转换有点复杂，就没有采用这种方式。</p>\n<p>主要参考的是CSDN上这篇<a href=\"https://blog.csdn.net/biezhihua/article/details/78789794\">博客</a>的方式，使用Mesh Renderer。文章写的很好，无需多言。</p>\n<h3 id=\"翻转\"><a href=\"#翻转\" class=\"headerlink\" title=\"翻转\"></a>翻转</h3><p>卡牌的一条侧边贴着桌面滑行，卡牌中点的左右位置始终不变，效果如下：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E5%8D%A1%E7%89%8C%E5%BC%AF%E6%9B%B2%E7%BF%BB%E8%BD%AC%E6%95%88%E6%9E%9C/%E5%8D%A1%E7%89%8C%E7%BF%BB%E8%BD%AC%E6%95%88%E6%9E%9C.gif\" alt=\"卡牌翻转效果.gif\"></p>\n<p>可以看作是卡牌上的每个点都旋转了θ角度，然后向上平移了 $卡牌宽度 * sinθ &#x2F; 2$</p>\n<p>旋转公式：若将点$P(x, y)$绕原点旋转θ角度，得到点$P’(x’, y’)$，则有：</p>\n<p>$x &#x3D; cosθ⋅x’ + sinθ⋅y’$</p>\n<p>$y &#x3D; cosθ⋅y’ - sinθ⋅x’$</p>\n<p>本质上是用Mesh的顶点坐标做了翻转，卡牌游戏物体的Transform.localRotation没有变。</p>\n<h3 id=\"材质\"><a href=\"#材质\" class=\"headerlink\" title=\"材质\"></a>材质</h3><p>使用这种方案后，Mesh Renderer的正反两面都需要渲染，卡牌的材质需要卡面和卡背两张贴图。</p>\n<p>每一面的Pass都将另一面Cull掉。如果卡背的图案不是镜面对称的，片元函数里需要将uv翻转一下。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Shader &quot;Custom/Game/Card&quot;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Properties</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        _MainTex (&quot;Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class=\"line\">        _CardBack (&quot;Card Back&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    SubShader</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Tags &#123; &quot;QUEUE&quot;=&quot;Transparent&quot; &quot;IGNOREPROJECTOR&quot;=&quot;true&quot; &quot;RenderType&quot;=&quot;Transparent&quot; &#125;</span><br><span class=\"line\">        LOD 100</span><br><span class=\"line\">        ZWrite On</span><br><span class=\"line\">        Blend SrcAlpha OneMinusSrcAlpha</span><br><span class=\"line\">        </span><br><span class=\"line\">        Pass</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Cull Front</span><br><span class=\"line\">            CGPROGRAM</span><br><span class=\"line\">            #pragma vertex vert</span><br><span class=\"line\">            #pragma fragment frag</span><br><span class=\"line\"></span><br><span class=\"line\">            #include &quot;UnityCG.cginc&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">            struct appdata</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                float4 vertex : POSITION;</span><br><span class=\"line\">                float2 uv : TEXCOORD0;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            struct v2f</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                float2 uv : TEXCOORD0;</span><br><span class=\"line\">                float4 vertex : SV_POSITION;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            sampler2D _CardBack;</span><br><span class=\"line\">            float4 _CardBack_ST;</span><br><span class=\"line\"></span><br><span class=\"line\">            v2f vert (appdata v)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                v2f o;</span><br><span class=\"line\">                o.vertex = UnityObjectToClipPos(v.vertex);</span><br><span class=\"line\">                o.uv = TRANSFORM_TEX(v.uv, _CardBack);</span><br><span class=\"line\">                o.uv.x = 1 - v.uv.x;</span><br><span class=\"line\">                return o;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            fixed4 frag (v2f i) : SV_Target</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                fixed4 col = tex2D(_CardBack, i.uv);</span><br><span class=\"line\">                clip (col.a - 0.1);</span><br><span class=\"line\">                return col;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            ENDCG</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        Pass</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Cull Back</span><br><span class=\"line\">            CGPROGRAM</span><br><span class=\"line\">            #pragma vertex vert</span><br><span class=\"line\">            #pragma fragment frag</span><br><span class=\"line\"></span><br><span class=\"line\">            #include &quot;UnityCG.cginc&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">            struct appdata</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                float4 vertex : POSITION;</span><br><span class=\"line\">                float2 uv : TEXCOORD0;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            struct v2f</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                float2 uv : TEXCOORD0;</span><br><span class=\"line\">                float4 vertex : SV_POSITION;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            sampler2D _MainTex;</span><br><span class=\"line\">            float4 _MainTex_ST;</span><br><span class=\"line\"></span><br><span class=\"line\">            v2f vert (appdata v)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                v2f o;</span><br><span class=\"line\">                o.vertex = UnityObjectToClipPos(v.vertex);</span><br><span class=\"line\">                o.uv = TRANSFORM_TEX(v.uv, _MainTex);</span><br><span class=\"line\">                return o;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            fixed4 frag (v2f i) : SV_Target</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                fixed4 col = tex2D(_MainTex, i.uv);</span><br><span class=\"line\">                clip(col.a - 0.1);</span><br><span class=\"line\">                return col;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            ENDCG</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><p>基本照抄，按自己的命名习惯改了变量名。</p>\n<p>其中spinBy函数就是之前提到的旋转公式。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> UnityEngine;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">ArcRotate</span> : <span class=\"title\">MonoBehaviour</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"built_in\">float</span> planeWidth = <span class=\"number\">1.44f</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"built_in\">float</span> planeHeight = <span class=\"number\">2.02f</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"built_in\">int</span> segmentCnt = <span class=\"number\">16</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">InitMesh</span>()</span> &#123;</span><br><span class=\"line\">        GetComponent&lt;MeshFilter&gt;().mesh = createSurface();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">SetRotate</span>(<span class=\"params\"><span class=\"built_in\">int</span> degree</span>)</span> &#123;</span><br><span class=\"line\">        Vector3[] vertices = GetComponent&lt;MeshFilter&gt;().mesh.vertices;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">float</span> rotateRad = degree * Mathf.PI / <span class=\"number\">180</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 弧面对应扇形的弧度，根据旋转程度变化</span></span><br><span class=\"line\">        <span class=\"built_in\">float</span> arcRad = (<span class=\"number\">90</span> - Mathf.Abs(<span class=\"number\">90</span> - degree)) * Mathf.PI / <span class=\"number\">120</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 普通平面步</span></span><br><span class=\"line\">        <span class=\"built_in\">float</span> widthDelta = planeWidth / segmentCnt;</span><br><span class=\"line\">        <span class=\"comment\">// 半径</span></span><br><span class=\"line\">        <span class=\"built_in\">float</span> r = planeWidth / (Mathf.Sin(arcRad / <span class=\"number\">2</span>) * <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 弧度步</span></span><br><span class=\"line\">        <span class=\"built_in\">float</span> radDelta = arcRad / segmentCnt;</span><br><span class=\"line\">        <span class=\"comment\">// 初始角度</span></span><br><span class=\"line\">        <span class=\"built_in\">float</span> offsetRad = (Mathf.PI - arcRad) / <span class=\"number\">2</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 弓形高度差值（半径-高度）</span></span><br><span class=\"line\">        <span class=\"built_in\">float</span> chordDist = r * Mathf.Cos(arcRad / <span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">int</span> vi = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> si = <span class=\"number\">0</span>; si &lt;= segmentCnt; si++) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (degree == <span class=\"number\">0</span>) &#123; <span class=\"comment\">// 翻转角度为0或180时，按照普通平面设置顶点</span></span><br><span class=\"line\">                <span class=\"built_in\">float</span> x = widthDelta * si;</span><br><span class=\"line\"></span><br><span class=\"line\">                vertices[vi].x = planeWidth / <span class=\"number\">2</span> - x;</span><br><span class=\"line\">                vertices[vi].y = planeHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\">                vertices[vi++].z = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                vertices[vi].x = planeWidth / <span class=\"number\">2</span> - x;</span><br><span class=\"line\">                vertices[vi].y = -planeHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\">                vertices[vi++].z = <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (degree == <span class=\"number\">180</span>) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">float</span> x = widthDelta * si;</span><br><span class=\"line\"></span><br><span class=\"line\">                vertices[vi].x = x - planeWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\">                vertices[vi].y = planeHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\">                vertices[vi++].z = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                vertices[vi].x = x - planeWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\">                vertices[vi].y = -planeHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\">                vertices[vi++].z = <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"built_in\">float</span> x = r * Mathf.Cos(offsetRad + radDelta * si);</span><br><span class=\"line\">                <span class=\"built_in\">float</span> z = r * Mathf.Sin(offsetRad + radDelta * si);</span><br><span class=\"line\"></span><br><span class=\"line\">                Vector2 point = spinBy(x, z - chordDist, -rotateRad);</span><br><span class=\"line\"></span><br><span class=\"line\">                vertices[vi].x = point.x;</span><br><span class=\"line\">                vertices[vi].y = planeHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\">                vertices[vi++].z = -planeWidth * Mathf.Sin(rotateRad) / <span class=\"number\">2</span> + point.y;</span><br><span class=\"line\"></span><br><span class=\"line\">                vertices[vi].x = point.x;</span><br><span class=\"line\">                vertices[vi].y = -planeHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\">                vertices[vi++].z = -planeWidth * Mathf.Sin(rotateRad) / <span class=\"number\">2</span> + point.y;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        Mesh mesh = GetComponent&lt;MeshFilter&gt;().mesh;</span><br><span class=\"line\">        mesh.vertices = vertices;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Vector2 <span class=\"title\">spinBy</span>(<span class=\"params\"><span class=\"built_in\">float</span> x, <span class=\"built_in\">float</span> y, <span class=\"built_in\">float</span> angle</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">float</span> newX = x * Mathf.Cos(angle) - y * Mathf.Sin(angle);</span><br><span class=\"line\">        <span class=\"built_in\">float</span> newY = x * Mathf.Sin(angle) + y * Mathf.Cos(angle);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Vector2(newX, newY);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Mesh <span class=\"title\">createSurface</span>()</span> &#123;</span><br><span class=\"line\">        Mesh mesh = <span class=\"keyword\">new</span> Mesh();</span><br><span class=\"line\">        <span class=\"built_in\">int</span> vertexCnt = (segmentCnt + <span class=\"number\">1</span>) * <span class=\"number\">2</span>;</span><br><span class=\"line\">        Vector3[] vertices = <span class=\"keyword\">new</span> Vector3[vertexCnt];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">float</span> widthDelta = planeWidth / segmentCnt;</span><br><span class=\"line\">        <span class=\"built_in\">int</span> vi = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> si = <span class=\"number\">0</span>; si &lt;= segmentCnt; si++) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">float</span> x = widthDelta * si;</span><br><span class=\"line\">            vertices[vi++] = <span class=\"keyword\">new</span> Vector3(planeWidth / <span class=\"number\">2</span> - x, planeHeight / <span class=\"number\">2</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">            vertices[vi++] = <span class=\"keyword\">new</span> Vector3(planeWidth / <span class=\"number\">2</span> - x, -planeHeight / <span class=\"number\">2</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">int</span> indices_count = segmentCnt * <span class=\"number\">3</span> * <span class=\"number\">2</span>;</span><br><span class=\"line\">        <span class=\"built_in\">int</span>[] triangles = <span class=\"keyword\">new</span> <span class=\"built_in\">int</span>[indices_count];</span><br><span class=\"line\">        <span class=\"built_in\">int</span> vert = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">int</span> ti = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> si = <span class=\"number\">0</span>; si &lt; segmentCnt; si++) &#123;</span><br><span class=\"line\">            triangles[ti++] = vert + <span class=\"number\">1</span>;</span><br><span class=\"line\">            triangles[ti++] = vert;</span><br><span class=\"line\">            triangles[ti++] = vert + <span class=\"number\">3</span>;</span><br><span class=\"line\">            triangles[ti++] = vert;</span><br><span class=\"line\">            triangles[ti++] = vert + <span class=\"number\">2</span>;</span><br><span class=\"line\">            triangles[ti++] = vert + <span class=\"number\">3</span>;</span><br><span class=\"line\">            vert += <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mesh.vertices = vertices;</span><br><span class=\"line\">        mesh.triangles = triangles;</span><br><span class=\"line\"></span><br><span class=\"line\">        Vector2[] uv = <span class=\"keyword\">new</span> Vector2[vertices.Length];</span><br><span class=\"line\">        <span class=\"built_in\">float</span> uvDelta = <span class=\"number\">1.0f</span> / segmentCnt;</span><br><span class=\"line\">        <span class=\"built_in\">int</span> idx = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> uvi = <span class=\"number\">0</span>; uvi &lt; uv.Length; uvi = uvi + <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">            uv[uvi] = <span class=\"keyword\">new</span> Vector2(uvDelta * idx, <span class=\"number\">1</span>);</span><br><span class=\"line\">            uv[uvi + <span class=\"number\">1</span>] = <span class=\"keyword\">new</span> Vector2(uvDelta * idx, <span class=\"number\">0</span>);</span><br><span class=\"line\">            idx++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mesh.uv = uv;</span><br><span class=\"line\">        mesh.RecalculateBounds();</span><br><span class=\"line\">        mesh.RecalculateNormals();</span><br><span class=\"line\">        mesh.RecalculateTangents();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mesh;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><h3 id=\"洗牌动画\"><a href=\"#洗牌动画\" class=\"headerlink\" title=\"洗牌动画\"></a>洗牌动画</h3><p>知道如何展现弯曲平面后，做洗牌动画时也做了类似的效果：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E5%8D%A1%E7%89%8C%E5%BC%AF%E6%9B%B2%E7%BF%BB%E8%BD%AC%E6%95%88%E6%9E%9C/%E6%B4%97%E7%89%8C%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C.gif\" alt=\"洗牌动画效果.gif\"></p>\n<p>仍是使用同样的弧面原理，只是总有一个端点的位置始终不变，卡牌左边翘起和右边翘起，弧面上的每个点位置的计算方式不同，原理如下：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E5%8D%A1%E7%89%8C%E5%BC%AF%E6%9B%B2%E7%BF%BB%E8%BD%AC%E6%95%88%E6%9E%9C/%E6%B4%97%E7%89%8C%E5%BC%AF%E6%9B%B2%E7%A4%BA%E6%84%8F%E5%9B%BE.png\" alt=\"洗牌弯曲示意图.png\"></p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">SetBend</span>(<span class=\"params\"><span class=\"built_in\">int</span> degree, <span class=\"built_in\">bool</span> isLeft</span>)</span> &#123;</span><br><span class=\"line\">    Vector3[] vertices = GetComponent&lt;MeshFilter&gt;().mesh.vertices;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">float</span> rotateRad = degree * Mathf.PI / <span class=\"number\">180</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 弧面对应扇形的弧度，根据旋转程度变化</span></span><br><span class=\"line\">    <span class=\"built_in\">float</span> arcRad = <span class=\"number\">2</span> * rotateRad;</span><br><span class=\"line\">    <span class=\"comment\">// 普通平面步</span></span><br><span class=\"line\">    <span class=\"built_in\">float</span> widthDelta = planeWidth / segmentCnt;</span><br><span class=\"line\">    <span class=\"comment\">// 半径</span></span><br><span class=\"line\">    <span class=\"built_in\">float</span> r = planeWidth / (Mathf.Sin(arcRad / <span class=\"number\">2</span>) * <span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 弧度步</span></span><br><span class=\"line\">    <span class=\"built_in\">float</span> radDelta = arcRad / segmentCnt;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">int</span> vi = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> si = <span class=\"number\">0</span>; si &lt;= segmentCnt; si++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (degree == <span class=\"number\">0</span>) &#123; <span class=\"comment\">// 掀开角度为0，按照普通平面设置顶点</span></span><br><span class=\"line\">            <span class=\"built_in\">float</span> x = widthDelta * si;</span><br><span class=\"line\"></span><br><span class=\"line\">            vertices[vi].x = planeWidth / <span class=\"number\">2</span> - x;</span><br><span class=\"line\">            vertices[vi].y = planeHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\">            vertices[vi++].z = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            vertices[vi].x = planeWidth / <span class=\"number\">2</span> - x;</span><br><span class=\"line\">            vertices[vi].y = -planeHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\">            vertices[vi++].z = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">float</span> x;</span><br><span class=\"line\">            <span class=\"built_in\">float</span> z;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (isLeft) &#123;</span><br><span class=\"line\">                x = planeWidth - r * Mathf.Sin(arcRad - radDelta * si);</span><br><span class=\"line\">                z = r * (<span class=\"number\">1</span> - Mathf.Cos(arcRad - radDelta * si));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                x = r * Mathf.Sin(radDelta * si);</span><br><span class=\"line\">                z = r * (<span class=\"number\">1</span> - Mathf.Cos(radDelta * si));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            vertices[vi].x = planeWidth / <span class=\"number\">2</span> - x;</span><br><span class=\"line\">            vertices[vi].y = planeHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\">            vertices[vi++].z = -z;</span><br><span class=\"line\"></span><br><span class=\"line\">            vertices[vi].x = planeWidth / <span class=\"number\">2</span> - x;</span><br><span class=\"line\">            vertices[vi].y = -planeHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\">            vertices[vi++].z = -z;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Mesh mesh = GetComponent&lt;MeshFilter&gt;().mesh;</span><br><span class=\"line\">    mesh.vertices = vertices;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["Unity"],"tags":["C#"]},{"title":"Unity实现扫光效果","url":"/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%89%AB%E5%85%89%E6%95%88%E6%9E%9C/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>Unity Shader实现的扫光效果，可用在一些UI的提示动画中。实际效果如下：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%89%AB%E5%85%89%E6%95%88%E6%9E%9C/%E6%89%AB%E5%85%89%E6%95%88%E6%9E%9C.gif\" alt=\"扫光效果.gif\"></p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><h3 id=\"光线\"><a href=\"#光线\" class=\"headerlink\" title=\"光线\"></a>光线</h3><p>首先需要一道光线。可以使用贴图，但如果不需要太复杂的效果，光线就是一条线，可以直接代码实现。</p>\n<p>假设在单位正方形上，光线直线与水平线的夹角为α，且经过uv坐标系的中心，计算uv坐标系下任意点与此直线的距离。</p>\n<p>直线函数为</p>\n<p><code>y = tan(α) * x + 0.5 - 0.5 * tan(α)</code>，</p>\n<p>根据点到直线的距离公式</p>\n<p><code>d = |Ax + By + C| / √(A^2 + B^2)</code>，</p>\n<p>计算得到任意点 (u, v) 到直线的距离为</p>\n<p><code>d = |sin(α) * u - cos(α) * v - 0.5 * (sin(α) - cos(α))|</code>。</p>\n<p>对uv上任意一点，需要设置其“亮度”和其距光线直线的距离反相关。</p>\n<p>下图较为直观地显示了uv中任意点和直线的距离。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%89%AB%E5%85%89%E6%95%88%E6%9E%9C/ASE%E5%88%B6%E4%BD%9C%E5%85%89%E7%BA%BF%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F.png\" alt=\"ASE制作光线流程示意.png\"></p>\n<h3 id=\"距离归一化\"><a href=\"#距离归一化\" class=\"headerlink\" title=\"距离归一化\"></a>距离归一化</h3><p>首先，取到绝对值计算之前的，带有负值的距离，即</p>\n<p><code>d&#39; = sin(α) * u - cos(α) * v - 0.5 * (sin(α) - cos(α))</code>，</p>\n<p>然后对uv中的点到光线直线的距离做归一化。最大距离是顶点到直线的距离，即</p>\n<p><code>maxDist = max(|sin(α) + cos(α)|, |sin(α) - cos(α)|) / 2</code></p>\n<p>令</p>\n<p><code>d&#39; = d&#39; / maxDist</code></p>\n<p>这样uv坐标系内任意点d’的范围就是 <code>[-1, 1]</code>，光线的宽度始终为2，覆盖整个uv。</p>\n<h4 id=\"光线平移\"><a href=\"#光线平移\" class=\"headerlink\" title=\"光线平移\"></a>光线平移</h4><p>对计算出的d’加上一个值，相当于将光线，沿垂直于光线的方向平移，如下图所示。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%89%AB%E5%85%89%E6%95%88%E6%9E%9C/ASE%E6%BC%94%E7%A4%BA%E5%85%89%E7%BA%BF%E5%B9%B3%E7%A7%BB.gif\" alt=\"ASE演示光线平移.gif\"></p>\n<p>平移距离是两个光线宽度，即4，距离偏移值的范围为 <code>[-2, 2]</code>。先直接取时间值算作距离偏移值，对4取余数再-2，就能让其随时间平移。即</p>\n<p><code>偏移 = mod(time, 4) - 2</code></p>\n<h3 id=\"光线宽度\"><a href=\"#光线宽度\" class=\"headerlink\" title=\"光线宽度\"></a>光线宽度</h3><p>引入一个光线宽度的倍数<code>_LightWidth</code>。假设宽度是原来的2倍，那么原先d’ &#x3D; 2 的位置变成光线的边缘，此时d’应该等于1。所以其实d’需要除这个宽度倍数。</p>\n<p>另外宽度变化后，对平移的距离也产生了影响，偏移值的范围变成 <code>[-(1 + 1 / _LightWidth), 1 + 1 / _LightWidth]</code>，故此时</p>\n<p><code>偏移 = mod(time, 2 * (1 + 1 / _LightWidth)) - 1 - 1 / _LightWidth</code></p>\n<p><code>d&#39; = d&#39; / _LightWidth + 偏移</code></p>\n<h3 id=\"速度\"><a href=\"#速度\" class=\"headerlink\" title=\"速度\"></a>速度</h3><p>上述直接取时间值算作偏移距离了，所以速度值是1，引入速度参数<code>_Speed</code>后，直接给time乘以<code>_Speed</code>，更新</p>\n<p><code>偏移 = mod(time * _Speed, 2 * (1 + 1 / _LightWidth)) - 1 - 1 / _LightWidth</code></p>\n<h3 id=\"间隔\"><a href=\"#间隔\" class=\"headerlink\" title=\"间隔\"></a>间隔</h3><p>设置两次扫光之间的间隔<code>_Interval</code>，就是将偏移值范围延长<code>_Interval</code>，更新</p>\n<p><code>偏移 = mod(time * _Speed, 2 * (1 + 1 / _LightWidth) + _Interval) - 1 - 1 / _LightWidth</code></p>\n<h3 id=\"叠加\"><a href=\"#叠加\" class=\"headerlink\" title=\"叠加\"></a>叠加</h3><p>“亮度”和其距光线直线的距离反相关。</p>\n<p><code>light = 1 - abs(d&#39;)</code></p>\n<p>将光线和贴图混合，但仍保留贴图原始的透明度。</p>\n<p><code>blendCol = light * (1, 1, 1) + (1 - light) * texColor.rgb + (0, 0, 0, texColor.a)</code></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%89%AB%E5%85%89%E6%95%88%E6%9E%9C/ASE%E6%BC%94%E7%A4%BA%E9%A2%9C%E8%89%B2%E5%8F%A0%E5%8A%A0.gif\" alt=\"ASE演示颜色叠加.gif\"></p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Shader &quot;Unlit/LightSweep&quot;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Properties</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        [PerRendererData] _MainTex (&quot;Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class=\"line\">        _SweepAngle (&quot;SweepAngle&quot;, Range(-180, 180)) = 45</span><br><span class=\"line\">        _SweepSpeed (&quot;_SweepSpeed&quot;, Range(1, 10)) = 1</span><br><span class=\"line\">        _Interval (&quot;_Interval&quot;, Range(0, 10)) = 0</span><br><span class=\"line\">        _LightWidth (&quot;_LightWidth&quot;, Range(0.1, 10)) = 0.3</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    SubShader</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Tags &#123; &quot;RenderType&quot;=&quot;Opaque&quot; &#125;</span><br><span class=\"line\">        LOD 100</span><br><span class=\"line\">        Blend SrcAlpha OneMinusSrcAlpha</span><br><span class=\"line\"></span><br><span class=\"line\">        Pass</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            CGPROGRAM</span><br><span class=\"line\">            #pragma vertex vert</span><br><span class=\"line\">            #pragma fragment frag</span><br><span class=\"line\"></span><br><span class=\"line\">            #include &quot;UnityCG.cginc&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">            struct appdata</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                float4 vertex : POSITION;</span><br><span class=\"line\">                float2 uv : TEXCOORD0;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            struct v2f</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                float2 uv : TEXCOORD0;</span><br><span class=\"line\">                float4 vertex : SV_POSITION;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            sampler2D _MainTex;</span><br><span class=\"line\">            float _SweepSpeed;</span><br><span class=\"line\">            float _SweepAngle;</span><br><span class=\"line\">            float _Interval;</span><br><span class=\"line\">            float _LightWidth;</span><br><span class=\"line\">            float4 _MainTex_ST;</span><br><span class=\"line\"></span><br><span class=\"line\">            v2f vert (appdata v)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                v2f o;</span><br><span class=\"line\">                o.vertex = UnityObjectToClipPos(v.vertex);</span><br><span class=\"line\">                o.uv = TRANSFORM_TEX(v.uv, _MainTex);</span><br><span class=\"line\">                return o;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            fixed4 frag (v2f i) : SV_Target</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                float sa = _SweepAngle * 3.141592 / 180;</span><br><span class=\"line\">                float vDist = sin(sa) * i.uv.x - cos(sa) * i.uv.y - 0.5 * (sin(sa) - cos(sa));</span><br><span class=\"line\"></span><br><span class=\"line\">                float maxDist = max(abs(sin(sa) + cos(sa)), abs(sin(sa) - cos(sa))) / 2;</span><br><span class=\"line\"></span><br><span class=\"line\">                // Normalize</span><br><span class=\"line\">                vDist /= maxDist;</span><br><span class=\"line\"></span><br><span class=\"line\">                float widthFactor = 1 / _LightWidth;</span><br><span class=\"line\">                // Apply width</span><br><span class=\"line\">                vDist *= widthFactor;</span><br><span class=\"line\"></span><br><span class=\"line\">                float offset = fmod(_Time.y * _SweepSpeed, (2 * (1 + widthFactor) + _Interval)) - (1 + widthFactor);</span><br><span class=\"line\"></span><br><span class=\"line\">                float light = 1 - abs(vDist + offset);</span><br><span class=\"line\">                light = max(0, light);</span><br><span class=\"line\"></span><br><span class=\"line\">                fixed4 col = tex2D(_MainTex, i.uv);</span><br><span class=\"line\"></span><br><span class=\"line\">                float3 blendCol = float3(light, light, light) + (1 - light) * col.xyz;</span><br><span class=\"line\"></span><br><span class=\"line\">                return fixed4(blendCol.x, blendCol.y, blendCol.z, col.a);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            ENDCG</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["Unity"],"tags":["ShaderLab"]},{"title":"Unity实现抓钩效果","url":"/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%8A%93%E9%92%A9%E6%95%88%E6%9E%9C/","content":"<h2 id=\"代码来源\"><a href=\"#代码来源\" class=\"headerlink\" title=\"代码来源\"></a>代码来源</h2><blockquote>\n<p>B站视频：<a href=\"https://www.bilibili.com/video/BV1A84y1a76z\">【Unity教程搬运】我创造了完美的抓钩… 你也可以！ UNITY 2D</a></p>\n</blockquote>\n<blockquote>\n<p>源码：<a href=\"https://bitbucket.org/Vespper/grappling-hook/src/master/\">Grappling Hook</a></p>\n</blockquote>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>视频演示的抓钩效果如下：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%8A%93%E9%92%A9%E6%95%88%E6%9E%9C/%E6%8A%93%E9%92%A9%E6%95%88%E6%9E%9C.gif\" alt=\"抓钩效果.gif\"></p>\n<p>整个抓钩效果可大致分为两部分，一个是抓钩绳子的动画绘制，一个是物体的移动。</p>\n<p>动画绘制用到了AnimationCurve和LineRenderer组件，第一次接触到，感觉挺有意思的，正好视频作者对绘制过程没有细说，在此就记录一下这部分的逻辑。</p>\n<p>动画绘制，在Tutorial_GrapplingRope中。为简化说明，做了一个删去物体移动的版本，代码会和作者原版有一点小区别，但应该影响不大，完整版在文章末尾。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><h3 id=\"鼠标交互\"><a href=\"#鼠标交互\" class=\"headerlink\" title=\"鼠标交互\"></a>鼠标交互</h3><p>GetKeyDown方法，只在按键按下的第一帧执行，之后鼠标持续处于按下时不会执行。在这里为抓钩绳子的绘制做一些初始化操作。</p>\n<p>GetKey方法，在按键持续按下时执行。在这里绘制抓钩的绳子。</p>\n<p>GetKeyUp方法，在按键松开的一帧执行。做收尾的工作，禁用LineRenderer，隐藏抓钩的绳子。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Update</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Input.GetKeyDown(KeyCode.Mouse0)) &#123;</span><br><span class=\"line\">        InitLineRenderer();</span><br><span class=\"line\">        mLineRenderer.enabled = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (Input.GetKey(KeyCode.Mouse0)) &#123;</span><br><span class=\"line\">        moveTime += Time.deltaTime;</span><br><span class=\"line\">        DrawRope();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (Input.GetKeyUp(KeyCode.Mouse0)) &#123;</span><br><span class=\"line\">        mLineRenderer.enabled = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>绘制抓钩绳的初始化工作</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">InitLineRenderer</span>()</span> &#123;</span><br><span class=\"line\">    startPos = transform.position;</span><br><span class=\"line\">    endPos = Camera.main.ScreenToWorldPoint(Input.mousePosition);</span><br><span class=\"line\">    direction = endPos - startPos;</span><br><span class=\"line\"></span><br><span class=\"line\">    waveSize = MaxWaveSize;</span><br><span class=\"line\">    moveTime = <span class=\"number\">0</span>;</span><br><span class=\"line\">    isStraight = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    mLineRenderer.positionCount = percision;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; percision; i++) &#123;</span><br><span class=\"line\">        mLineRenderer.SetPosition(i, startPos);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>startPos，物体当前的位置</li>\n<li>endPos，当前鼠标的位置</li>\n<li>direction，抓钩伸出的方向，即从物体位置指向向鼠标位置</li>\n<li>waveSize，抓钩的实时宽度。在抓钩绳由松弛曲线逐渐紧绷直成为直线的过程，waveSize会不断减小直至为0。初始设置为最大宽度。</li>\n<li>moveTime，绘制抓钩已用的时间。辅助计算抓钩运行到了什么位置</li>\n<li>isStraight，当前抓钩绳是直线还是曲线。绳是由松弛曲线逐渐紧绷成为直线的，故初始设为false</li>\n<li>percision，绘制绳子曲线时的精细度，即绘制曲线时，使用多少个点。</li>\n</ul>\n<p>最后需要为LineRenderer的Position信息初始化。</p>\n<h3 id=\"绘制抓钩\"><a href=\"#绘制抓钩\" class=\"headerlink\" title=\"绘制抓钩\"></a>绘制抓钩</h3><p>在鼠标持续按下时会绘制抓钩的绳子，执行此方法。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">DrawRope</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isStraight) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mLineRenderer.GetPosition(percision - <span class=\"number\">1</span>).x == endPos.x) &#123;</span><br><span class=\"line\">            isStraight = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            DrawCurvedRope();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (waveSize &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            waveSize -= Time.deltaTime * straightenLineSpeed;</span><br><span class=\"line\">            DrawCurvedRope();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            DrawStraightRope();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>当isStraight为false<ul>\n<li>当抓钩末端已到达终点，则将isStraight置为true，准备绘制直线</li>\n<li>当抓钩末端未到达终点，绘制曲线</li>\n</ul>\n</li>\n<li>当isStraight为true<ul>\n<li>waveSize &gt; 0，说明抓钩正在由松弛曲线绷成直线，让waveSize继续随时间减小。straightenLineSpeed 就是这个绷直过程的速度</li>\n<li>waveSize &lt;&#x3D; 0，说明抓钩已经绷成直线，绘制直线</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"绘制直线\"><a href=\"#绘制直线\" class=\"headerlink\" title=\"绘制直线\"></a>绘制直线</h3><figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">DrawStraightRope</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mLineRenderer.positionCount != <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        mLineRenderer.positionCount = <span class=\"number\">2</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    mLineRenderer.SetPosition(<span class=\"number\">0</span>, startPos);</span><br><span class=\"line\">    mLineRenderer.SetPosition(<span class=\"number\">1</span>, endPos);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://docs.unity3d.com/cn/2020.3/ScriptReference/LineRenderer.html\">LineRenderer</a>。就是个用来画线的组件。用 SetPosition 设置线中各点的位置，组件就能将其连成一条线画出来。</p>\n<p>很简单，只设置两个点，分别处于抓钩的两端就行。开头对LineRenderer点数量的设置并非必要，只是做下优化，减少渲染的工作量。</p>\n<h3 id=\"绘制曲线\"><a href=\"#绘制曲线\" class=\"headerlink\" title=\"绘制曲线\"></a>绘制曲线</h3><figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">DrawCurvedRope</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; percision; i++) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">float</span> delta = (<span class=\"built_in\">float</span>)i / (percision - <span class=\"number\">1</span>);</span><br><span class=\"line\">        Vector2 offset = ropeAnimationCurve.Evaluate(delta) * waveSize * Vector2.Perpendicular(direction).normalized;</span><br><span class=\"line\">        Vector2 targetPosition = Vector2.Lerp(startPos, endPos, delta) + offset;</span><br><span class=\"line\">        Vector2 currentPositoin = Vector2.Lerp(startPos, targetPosition, ropeProcessCurve.Evaluate(moveTime) * ropeProgressionSpeed);</span><br><span class=\"line\"></span><br><span class=\"line\">        mLineRenderer.SetPosition(i, currentPositoin);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://docs.unity3d.com/cn/2020.3/ScriptReference/AnimationCurve.html\">AnimationCurve</a>。可以理解为设置一个曲线函数f(x)，调用AnimationCurve.Evaluate(x)方法时，返回的值就是f(x)。</p>\n<p>这里用到了两个AnimationCurve，ropeAnimationCurve用于表现抓钩绳子的形状，ropeProgressionSpeed用于标识抓钩移动的速度特征。</p>\n<p>首先根据 percision 将绳索的绘制分为各个小段，这里的delta可理解成ropeAnimationCurve曲线中的横坐标。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%8A%93%E9%92%A9%E6%95%88%E6%9E%9C/delta%E5%90%AB%E4%B9%89.png\" alt=\"delta含义.png\"></p>\n<p>offset矢量是取抓钩伸出方向（即direction）的垂直方向，大小乘以ropeAnimationCurve曲线中对应delta的纵坐标。大小还乘了一个waveSize，可以手动控制曲线弯曲的幅度。</p>\n<p>如果曲线x轴方向对应抓钩伸出的方向，则各个i值对应的offset表示如下，这里暂时没有考虑waveSize的影响。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%8A%93%E9%92%A9%E6%95%88%E6%9E%9C/offset%E5%90%AB%E4%B9%89.png\" alt=\"offset含义.png\"></p>\n<p><a href=\"https://docs.unity3d.com/cn/2020.3/ScriptReference/Vector2.Lerp.html\">Vector2.Lerp()线性插值</a>。线性填充两点之间的空隙。</p>\n<p>targetPosition指的是曲线上的每个点，从startPoint出发，运动的最终目的地是哪里。使用Vector2.Lerp()函数，正好取得direction上每一小段的矢量。和offset相加，成为目标地点。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%8A%93%E9%92%A9%E6%95%88%E6%9E%9C/targetPosition%E5%90%AB%E4%B9%89.png\" alt=\"targetPosition含义.png\"></p>\n<p>currentPositoin 则是将 从startPosition开始，到targetPosition结束的矢量，利用线性插值分成各个小段，随时间推移，线上的点逐渐从startPosition移动到targetPosition。分段的紧密程度，也就是移动速度是先快后慢，还是先慢后快，还是匀速，由ropeProcessCurve速度特征曲线决定。这里使用的是直线，即为匀速。</p>\n<p>以其中的一个点为例，currentPosition随时间偏移的位置变化如下。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%8A%93%E9%92%A9%E6%95%88%E6%9E%9C/currentPosition%E5%90%AB%E4%B9%89.png\" alt=\"currentPosition含义.png\"></p>\n<p>currentPositoin的计算方式也许可以改进一下，当前曲线绘制的时间是固定的，和起始点的距离没关系。Evalue函数可以传(moveTime * ropeProgressionSpeed &#x2F; direction.magnitude)。</p>\n<p>这样一说，waveSize其实也可以和距离挂钩。在初始化的时候将waveSize设置为 maxWaveSize * direction.magnitude，此时maxWaveSize的含义就不是曲线最大宽度了，而是曲线最大宽度根据距离长短变化的系数。</p>\n<h2 id=\"完整代码\"><a href=\"#完整代码\" class=\"headerlink\" title=\"完整代码\"></a>完整代码</h2><figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> UnityEngine;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Rope</span> : <span class=\"title\">MonoBehaviour</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LineRenderer mLineRenderer;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"meta\">Header(<span class=\"string\">&quot;General Settings:&quot;</span>)</span>]</span><br><span class=\"line\">    [<span class=\"meta\">SerializeField</span>] <span class=\"keyword\">private</span> <span class=\"built_in\">int</span> percision = <span class=\"number\">40</span>;</span><br><span class=\"line\">    [<span class=\"meta\">Range(0, 20)</span>][SerializeField] <span class=\"keyword\">private</span> <span class=\"built_in\">float</span> straightenLineSpeed = <span class=\"number\">5</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"meta\">Header(<span class=\"string\">&quot;Rope Animation Settings:&quot;</span>)</span>]</span><br><span class=\"line\">    [<span class=\"meta\">SerializeField</span>] <span class=\"keyword\">private</span> AnimationCurve ropeAnimationCurve;</span><br><span class=\"line\">    [<span class=\"meta\">Range(0.01f, 4)</span>][SerializeField] <span class=\"keyword\">private</span> <span class=\"built_in\">float</span> MaxWaveSize = <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">float</span> waveSize;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"meta\">Header(<span class=\"string\">&quot;Rope Progression:&quot;</span>)</span>]</span><br><span class=\"line\">    [<span class=\"meta\">SerializeField</span>] <span class=\"keyword\">private</span> AnimationCurve ropeProcessCurve;</span><br><span class=\"line\">    [<span class=\"meta\">SerializeField</span>][Range(<span class=\"number\">1</span>, <span class=\"number\">50</span>)] <span class=\"keyword\">private</span> <span class=\"built_in\">float</span> ropeProgressionSpeed = <span class=\"number\">6</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Vector2 startPos;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Vector2 endPos;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Vector2 direction;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">float</span> moveTime;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> isStraight;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">Awake</span>()</span> &#123;</span><br><span class=\"line\">        mLineRenderer = GetComponent&lt;LineRenderer&gt;();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Update</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Input.GetKeyDown(KeyCode.Mouse0)) &#123;</span><br><span class=\"line\">            InitLineRenderer();</span><br><span class=\"line\">            mLineRenderer.enabled = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (Input.GetKey(KeyCode.Mouse0)) &#123;</span><br><span class=\"line\">            moveTime += Time.deltaTime;</span><br><span class=\"line\">            DrawRope();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (Input.GetKeyUp(KeyCode.Mouse0)) &#123;</span><br><span class=\"line\">            mLineRenderer.enabled = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">DrawRope</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!isStraight) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (mLineRenderer.GetPosition(percision - <span class=\"number\">1</span>).x == endPos.x) &#123;</span><br><span class=\"line\">                isStraight = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                DrawCurvedRope();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (waveSize &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                waveSize -= Time.deltaTime * straightenLineSpeed;</span><br><span class=\"line\">                DrawCurvedRope();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                DrawStraightRope();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">InitLineRenderer</span>()</span> &#123;</span><br><span class=\"line\">        startPos = transform.position;</span><br><span class=\"line\">        endPos = Camera.main.ScreenToWorldPoint(Input.mousePosition);</span><br><span class=\"line\">        direction = endPos - startPos;</span><br><span class=\"line\"></span><br><span class=\"line\">        waveSize = MaxWaveSize;</span><br><span class=\"line\">        moveTime = <span class=\"number\">0</span>;</span><br><span class=\"line\">        isStraight = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        mLineRenderer.positionCount = percision;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; percision; i++) &#123;</span><br><span class=\"line\">            mLineRenderer.SetPosition(i, startPos);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">DrawCurvedRope</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> i = <span class=\"number\">0</span>; i &lt; percision; i++) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">float</span> delta = (<span class=\"built_in\">float</span>)i / (percision - <span class=\"number\">1</span>);</span><br><span class=\"line\">            Vector2 offset = ropeAnimationCurve.Evaluate(delta) * waveSize * Vector2.Perpendicular(direction).normalized;</span><br><span class=\"line\">            Vector2 targetPosition = Vector2.Lerp(startPos, endPos, delta) + offset;</span><br><span class=\"line\">            Vector2 currentPositoin = Vector2.Lerp(startPos, targetPosition, ropeProcessCurve.Evaluate(moveTime) * ropeProgressionSpeed);</span><br><span class=\"line\"></span><br><span class=\"line\">            mLineRenderer.SetPosition(i, currentPositoin);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">DrawStraightRope</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mLineRenderer.positionCount != <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">            mLineRenderer.positionCount = <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        mLineRenderer.SetPosition(<span class=\"number\">0</span>, startPos);</span><br><span class=\"line\">        mLineRenderer.SetPosition(<span class=\"number\">1</span>, endPos);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["Unity"],"tags":["C#"]},{"title":"Unity实现溶解效果","url":"/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%BA%B6%E8%A7%A3%E6%95%88%E6%9E%9C/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>Unity Shader实现的溶解效果，可用在一些UI的消失动画中。实际效果如下：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%BA%B6%E8%A7%A3%E6%95%88%E6%9E%9C/%E6%BA%B6%E8%A7%A3%E6%95%88%E6%9E%9C.gif\" alt=\"溶解效果.gif\"></p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%BA%B6%E8%A7%A3%E6%95%88%E6%9E%9C/%E5%99%AA%E5%A3%B0%E5%9B%BE.jpg\" alt=\"噪声图.jpg\"></p>\n<p>上面是溶解效果使用的噪声图，每个像素点表示一个浮点数，表现在视觉上就是灰色的深浅（假色彩图像）；反之从像素点的任意颜色通道取出的就是其代表的数值。</p>\n<p>引入一个参数<code>_DissolveFactor</code>，范围在[0, 1]。对噪声图每个像素点代表的浮点数进行判断。如果其大于<code>_DissolveFactor</code>，通过uv映射到纹理贴图对应的像素点，其透明度为0；反之，贴图对应像素点的透明度为1。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E6%BA%B6%E8%A7%A3%E6%95%88%E6%9E%9C/ASE%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F.png\" alt=\"ASE流程示意.png\"></p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Shader &quot;Unlit/Dissolve&quot;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Properties</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        [PerRendererData] _MainTex (&quot;Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class=\"line\">        _NoiseTex (&quot;Noise&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class=\"line\">        _DissolveFactor (&quot;DissolveFactor&quot;, Range(0, 1)) = 0</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    SubShader</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Tags &#123; &quot;RenderType&quot;=&quot;Opaque&quot; &#125;</span><br><span class=\"line\">        LOD 100</span><br><span class=\"line\">        Blend SrcAlpha OneMinusSrcAlpha</span><br><span class=\"line\"></span><br><span class=\"line\">        Pass</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            CGPROGRAM</span><br><span class=\"line\">            #pragma vertex vert</span><br><span class=\"line\">            #pragma fragment frag</span><br><span class=\"line\"></span><br><span class=\"line\">            #include &quot;UnityCG.cginc&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">            struct appdata</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                float4 vertex : POSITION;</span><br><span class=\"line\">                float2 uv : TEXCOORD0;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            struct v2f</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                float2 uv : TEXCOORD0;</span><br><span class=\"line\">                float4 vertex : SV_POSITION;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            sampler2D _MainTex;</span><br><span class=\"line\">            sampler2D _NoiseTex;</span><br><span class=\"line\">            float _DissolveFactor;</span><br><span class=\"line\">            float4 _MainTex_ST;</span><br><span class=\"line\"></span><br><span class=\"line\">            v2f vert (appdata v)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                v2f o;</span><br><span class=\"line\">                o.vertex = UnityObjectToClipPos(v.vertex);</span><br><span class=\"line\">                o.uv = TRANSFORM_TEX(v.uv, _MainTex);</span><br><span class=\"line\">                return o;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            fixed4 frag (v2f i) : SV_Target</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                fixed4 col = tex2D(_MainTex, i.uv);</span><br><span class=\"line\">                fixed4 noiseCol = tex2D(_NoiseTex, i.uv);</span><br><span class=\"line\">                // step(_DissolveFactor, noiseCol.x) 返回 _DissolveFactor &gt;= noiseCol.x ? 1 : 0</span><br><span class=\"line\">                return fixed4(col.x, col.y, col.z, step(_DissolveFactor, noiseCol.x));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            ENDCG</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["Unity"],"tags":["ShaderLab"]},{"title":"Unity实现物体靠近屏幕边缘时透明效果","url":"/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E7%89%A9%E4%BD%93%E9%9D%A0%E8%BF%91%E5%B1%8F%E5%B9%95%E8%BE%B9%E7%BC%98%E6%97%B6%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>应用场景和效果如下：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E7%89%A9%E4%BD%93%E9%9D%A0%E8%BF%91%E5%B1%8F%E5%B9%95%E8%BE%B9%E7%BC%98%E6%97%B6%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/%E7%89%A9%E4%BD%93%E9%9D%A0%E8%BF%91%E5%B1%8F%E5%B9%95%E8%BE%B9%E7%BC%98%E6%97%B6%E5%8F%98%E9%80%8F%E6%98%8E.gif\" alt=\"物体靠近屏幕边缘时变透明.gif\"></p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><p>在Shader中使用UnityCG.cginc的内置函数ComputeScreenPos，计算片元所在的屏幕坐标，再根据屏幕坐标设置片元的透明度。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Shader &quot;Custom/Game/TransparentEdge&quot;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tProperties</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t[PerRendererData] _MainTex (&quot;Sprite Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class=\"line\">\t\t[MaterialToggle] PixelSnap (&quot;Pixel snap&quot;, Float) = 0</span><br><span class=\"line\">\t\tWhereToFade (&quot;Where To Fade&quot;, Range(0, 0.5)) = 0.2</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tSubShader</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tTags</span><br><span class=\"line\">\t\t&#123; </span><br><span class=\"line\">\t\t\t&quot;Queue&quot;=&quot;Transparent&quot; </span><br><span class=\"line\">\t\t\t&quot;IgnoreProjector&quot;=&quot;True&quot; </span><br><span class=\"line\">\t\t\t&quot;RenderType&quot;=&quot;Transparent&quot; </span><br><span class=\"line\">\t\t\t&quot;PreviewType&quot;=&quot;Plane&quot;</span><br><span class=\"line\">\t\t\t&quot;CanUseSpriteAtlas&quot;=&quot;True&quot;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tCull Off</span><br><span class=\"line\">\t\tLighting Off</span><br><span class=\"line\">\t\tZWrite Off</span><br><span class=\"line\">\t\tFog &#123; Mode Off &#125;</span><br><span class=\"line\">\t\tBlend SrcAlpha OneMinusSrcAlpha</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tPass</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\tCGPROGRAM</span><br><span class=\"line\">\t\t\t#pragma vertex vert</span><br><span class=\"line\">\t\t\t#pragma fragment frag</span><br><span class=\"line\">\t\t\t#pragma multi_compile DUMMY PIXELSNAP_ON</span><br><span class=\"line\">\t\t\t#include &quot;UnityCG.cginc&quot;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\tstruct appdata &#123;</span><br><span class=\"line\">                float4 vertex : POSITION;</span><br><span class=\"line\">                float2 uv : TEXCOORD0;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            struct v2f &#123;</span><br><span class=\"line\">                float2 uv : TEXCOORD0;</span><br><span class=\"line\">                float4 vertex : SV_POSITION;</span><br><span class=\"line\">                float screenPosX : TEXCOORD1;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            sampler2D _MainTex;</span><br><span class=\"line\"></span><br><span class=\"line\">            v2f vert (appdata v) &#123;</span><br><span class=\"line\">                v2f o;</span><br><span class=\"line\">                o.vertex = UnityObjectToClipPos(v.vertex);</span><br><span class=\"line\">                o.uv = v.uv;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\tfloat4 screenPos = ComputeScreenPos(o.vertex);</span><br><span class=\"line\">                o.screenPosX = screenPos.x / screenPos.w;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t#ifdef PIXELSNAP_ON</span><br><span class=\"line\">\t\t\t\to.vertex = UnityPixelSnap (o.vertex);</span><br><span class=\"line\">\t\t\t\t#endif</span><br><span class=\"line\">                return o;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tfloat WhereToFade;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tfixed4 frag (v2f i) : SV_Target &#123;</span><br><span class=\"line\">\t\t\t\tfixed4 col = tex2D(_MainTex, i.uv);</span><br><span class=\"line\">\t\t\t\tfloat screenPosX = i.screenPosX;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\tfloat alp = 1;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\tif(screenPosX &lt; WhereToFade)&#123;</span><br><span class=\"line\">\t\t\t\t\talp = smoothstep(0, 1, screenPosX / WhereToFade);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\tif(screenPosX &gt; 1 - WhereToFade)&#123;</span><br><span class=\"line\">\t\t\t\t\talp = smoothstep(0, 1, (1 - screenPosX) / WhereToFade);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\tcol.a *= alp;</span><br><span class=\"line\">\t\t\t\treturn col;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\tENDCG</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["Unity"],"tags":["ShaderLab"]},{"title":"Unity实现飘带效果","url":"/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E9%A3%98%E5%B8%A6%E6%95%88%E6%9E%9C/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>Unity Shader实现的飘带效果，可用在一些UI动画中配合使用。实际效果如下：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E9%A3%98%E5%B8%A6%E6%95%88%E6%9E%9C/%E9%A3%98%E5%B8%A6%E6%95%88%E6%9E%9C.gif\" alt=\"飘带效果.gif\"></p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><h3 id=\"形状变换\"><a href=\"#形状变换\" class=\"headerlink\" title=\"形状变换\"></a>形状变换</h3><p>由于只能控制图片内的像素，所以需要先纵向压缩图片，为之后的弯曲留出空间。然后将图片沿着三角函数曲线弯曲。整个变换过程如下图所示：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E9%A3%98%E5%B8%A6%E6%95%88%E6%9E%9C/%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F.png\" alt=\"流程示意.png\"></p>\n<p>假设原图高度为1，纵向压缩图片后图片的高度为<code>_Thickness</code>(范围是(0, 1])。原图上一个坐标为<code>(u, v)</code>的像素，经过纵向压缩图片转换后的坐标就是<code>(u, _Thickness * v + (1 - _Thickness) / 2)</code></p>\n<p>弯曲形状的三角函数振幅是(1 - _Thickness) &#x2F; 2，假设其就是正弦<code>y = (1 - _Thickness) / 2 * sin(x)</code>，则纵向压缩后，图片上一个坐标为<code>(u&#39;, v&#39;)</code>的像素，经过曲线弯曲转换后的坐标就是<code>(u&#39;, v&#39; + (1 - _Thickness) / 2 * sin(u&#39;))</code></p>\n<p>结合两个过程，原图上一个坐标为<code>(u, v)</code>的像素，完整转换后的坐标就是<code>(u, _Thickness * v + (1 - _Thickness) / 2) * (1 + sin(u))</code></p>\n<p>实现Shader片元函数时，需要反向思考：转换后图片上坐标为<code>(x, y)</code>的点，是原图中哪个坐标的点转换而来的，即需要用哪个像素的颜色。像素转换前后横坐标不变，只需要考虑y。转换后值域最小值是<code>startV = (1 - _Thickness) / 2) * (1 + sin(u))</code>，值域最大值是<code>endV = startV + _Thickness</code>。y坐标不在此范围内的像素都是透明；y坐标在此范围内的像素，则使用原图上坐标为<code>(x, (y - startV) / _Thickness)</code>的像素点颜色。</p>\n<h3 id=\"动画\"><a href=\"#动画\" class=\"headerlink\" title=\"动画\"></a>动画</h3><p>要让变换后的曲线形状随时间波动，达到类似随风飘动的效果，需要引入时间变量，可直接使用系统提供的预定义变量_Time。这是个float4类型变量，值为 <code>float4(t / 20, t, t * 2, t * 3)</code>，t的含义是场景加载后经过的时间。</p>\n<p>再加上速度参数，可控制飘带飘动速度，加在横坐标上。</p>\n<p>加上频率参数，可控制飘带的弯曲程度，乘在横坐标上。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Shader &quot;Custom/Game/Wave&quot;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Properties</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        [PerRendererData] _MainTex (&quot;Sprite Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class=\"line\">        _Color(&quot;Tint&quot;, Color) = (1, 1, 1, 1)</span><br><span class=\"line\"></span><br><span class=\"line\">        _Thickness (&quot;Thickness&quot;, Range(0, 1)) = 0.8</span><br><span class=\"line\">        _Frequence (&quot;Frequence&quot;, Range(1, 10)) = 5</span><br><span class=\"line\">        _StartPos (&quot;StartPos&quot;, Float) = 0</span><br><span class=\"line\">        _Speed (&quot;Speed&quot;, Range(0, 5)) = 1</span><br><span class=\"line\"></span><br><span class=\"line\">        /*-------------------Template---------------------*/</span><br><span class=\"line\">        _StencilComp(&quot;Stencil Comparison&quot;, Float) = 8</span><br><span class=\"line\">        _Stencil(&quot;Stencil ID&quot;, Float) = 0</span><br><span class=\"line\">        _StencilOp(&quot;Stencil Operation&quot;, Float) = 0</span><br><span class=\"line\">        _StencilWriteMask(&quot;Stencil Write Mask&quot;, Float) = 255</span><br><span class=\"line\">        _StencilReadMask(&quot;Stencil Read Mask&quot;, Float) = 255</span><br><span class=\"line\"></span><br><span class=\"line\">        _ColorMask(&quot;Color Mask&quot;, Float) = 15 // Support Mask</span><br><span class=\"line\">        /*------------------------------------------------*/</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    SubShader</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Tags</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            &quot;Queue&quot; = &quot;Transparent&quot;</span><br><span class=\"line\">            &quot;IgnoreProjector&quot; = &quot;True&quot;</span><br><span class=\"line\">            &quot;RenderType&quot; = &quot;Transparent&quot;</span><br><span class=\"line\">            &quot;PreviewType&quot; = &quot;Plane&quot;</span><br><span class=\"line\">            &quot;CanUseSpriteAtlas&quot; = &quot;True&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">                </span><br><span class=\"line\">        /*-------------------Template---------------------*/</span><br><span class=\"line\">        Stencil</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Ref[_Stencil]</span><br><span class=\"line\">            Comp[_StencilComp]</span><br><span class=\"line\">            Pass[_StencilOp]</span><br><span class=\"line\">            ReadMask[_StencilReadMask]</span><br><span class=\"line\">            WriteMask[_StencilWriteMask]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">        Cull Off</span><br><span class=\"line\">        Lighting Off</span><br><span class=\"line\">        ZWrite Off</span><br><span class=\"line\">        ZTest[unity_GUIZTestMode]</span><br><span class=\"line\">        Blend SrcAlpha OneMinusSrcAlpha</span><br><span class=\"line\">        ColorMask[_ColorMask]</span><br><span class=\"line\">        /*------------------------------------------------*/</span><br><span class=\"line\">        Pass</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            CGPROGRAM</span><br><span class=\"line\">            #pragma vertex vert</span><br><span class=\"line\">            #pragma fragment frag</span><br><span class=\"line\">            </span><br><span class=\"line\">            #include &quot;UnityCG.cginc&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">            struct appdata</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                float4 vertex : POSITION;</span><br><span class=\"line\">                float4 color : COLOR;</span><br><span class=\"line\">                float2 texcoord : TEXCOORD0;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            struct v2f</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                float4 vertex : POSITION;</span><br><span class=\"line\">                float4 color : COLOR;</span><br><span class=\"line\">                float2 texcoord : TEXCOORD0;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            sampler2D _MainTex;</span><br><span class=\"line\">            fixed4 _Color;</span><br><span class=\"line\"></span><br><span class=\"line\">            v2f vert (appdata IN)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                v2f o;</span><br><span class=\"line\">                o.vertex = UnityObjectToClipPos(IN.vertex);</span><br><span class=\"line\">                o.texcoord = IN.texcoord;</span><br><span class=\"line\">                o.color = IN.color * _Color;</span><br><span class=\"line\">                return o;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            float _Thickness;</span><br><span class=\"line\">            float _Frequence;</span><br><span class=\"line\">            float _StartPos;</span><br><span class=\"line\">            float _Speed;</span><br><span class=\"line\">            </span><br><span class=\"line\">            fixed4 frag (v2f i) : SV_Target</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                float thick = _Thickness;</span><br><span class=\"line\"></span><br><span class=\"line\">                float startV = 0.5 * (1 - thick) * (1 + sin(_Frequence * (i.texcoord.x + _Speed * _Time.y) + _StartPos));</span><br><span class=\"line\">                float endV = startV + thick;</span><br><span class=\"line\"></span><br><span class=\"line\">                int isShow_1 = step(startV, i.texcoord.y);</span><br><span class=\"line\">                int isShow_2 = step(i.texcoord.y, endV);</span><br><span class=\"line\"></span><br><span class=\"line\">                fixed2 map_uv = fixed2(i.texcoord.x, ((i.texcoord.y - startV) / thick));</span><br><span class=\"line\">                fixed4 col = tex2D(_MainTex, map_uv) * i.color;</span><br><span class=\"line\"></span><br><span class=\"line\">                col = fixed4(col.x, col.y, col.z, col.a * isShow_1 * isShow_2);</span><br><span class=\"line\"></span><br><span class=\"line\">                return col;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            ENDCG</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>step(a, x)函数的效果是，当a &lt;&#x3D; x时返回1；当a &gt; x时返回0。<br>带入y坐标和值域最大值最小值，得出的结果用在输出颜色的透明度通道上，控制像素在给定范围内正常显示，在范围外透明。</p>\n<p><code>_StartPos</code>参数给飘带一个可调整的初始状态，如果同一个场景中出现了两个飘带，使用的是同一个材质，它们飘动的动画会完全相同，看上去可能会奇怪。类似下面这样：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%AE%9E%E7%8E%B0%E9%A3%98%E5%B8%A6%E6%95%88%E6%9E%9C/%E4%B8%A4%E6%9D%A1%E9%A3%98%E5%B8%A6%E5%9C%A8%E5%90%8C%E4%B8%80%E5%9C%BA%E6%99%AF.gif\" alt=\"两条飘带在同一场景.gif\"></p>\n<blockquote>\n<p>右侧的飘带做了镜像</p>\n</blockquote>\n","categories":["Unity"],"tags":["ShaderLab"]},{"title":"Unity平台跳跃控制器代码分解","url":"/%E7%AC%94%E8%AE%B0/Unity/Unity%E5%B9%B3%E5%8F%B0%E8%B7%B3%E8%B7%83%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BB%A3%E7%A0%81%E5%88%86%E8%A7%A3/","content":"<h2 id=\"代码来源\"><a href=\"#代码来源\" class=\"headerlink\" title=\"代码来源\"></a>代码来源</h2><blockquote>\n<p>Youtube视频：<a href=\"https://www.youtube.com/watch?v=3sWTzMsmdx8\">Ultimate 2D Platformer Controller in Unity (source code provided)</a></p>\n</blockquote>\n<blockquote>\n<p>B站视频：<a href=\"https://www.bilibili.com/video/BV14S4y1o79L\">【Unity】好手感从何而来？一款免费的2D角色控制器，附源码</a></p>\n</blockquote>\n<blockquote>\n<p>源码：<a href=\"https://github.com/Matthew-J-Spencer/Ultimate-2D-Controller\">Ultimate-2D-Controller</a></p>\n</blockquote>\n<h2 id=\"代码分解\"><a href=\"#代码分解\" class=\"headerlink\" title=\"代码分解\"></a>代码分解</h2><p>控制器逻辑在<code>PlayerController</code>类中。</p>\n<p>大致的思路是，获取当前帧的输入信息，结合状态信息，计算出当前帧的速度，直接赋值给<code>RigidBody</code>组件。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> Vector2 _frameVelocity;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">ApplyMovement</span>()</span> =&gt; _rb.velocity = _frameVelocity;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"基本的移动和跳跃\"><a href=\"#基本的移动和跳跃\" class=\"headerlink\" title=\"基本的移动和跳跃\"></a>基本的移动和跳跃</h3><p>在<code>Update</code>方法中，调用<code>GatherInput</code>方法获取输入信息，移动输入存储在<code>_frameInput.Move</code>，跳跃输入存储在<code>_jumpToConsume</code>。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">GatherInput</span>()</span> &#123;</span><br><span class=\"line\">    _frameInput = <span class=\"keyword\">new</span> FrameInput &#123;</span><br><span class=\"line\">        JumpDown = Input.GetButtonDown(<span class=\"string\">&quot;Jump&quot;</span>) || Input.GetKeyDown(KeyCode.C),</span><br><span class=\"line\">        JumpHeld = Input.GetButton(<span class=\"string\">&quot;Jump&quot;</span>) || Input.GetKey(KeyCode.C),</span><br><span class=\"line\">        Move = <span class=\"keyword\">new</span> Vector2(Input.GetAxisRaw(<span class=\"string\">&quot;Horizontal&quot;</span>), Input.GetAxisRaw(<span class=\"string\">&quot;Vertical&quot;</span>))</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_frameInput.JumpDown) &#123;</span><br><span class=\"line\">        _jumpToConsume = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在<code>FixedUpdate</code>方法中，首先调用<code>CheckCollisions</code>方法判断角色是否在地面上，存储于变量<code>_grounded</code>；然后分别计算水平（<code>HandleDirection</code>方法）和竖直方向（<code>HandleJump</code>方法和<code>ExecuteJump</code>方法）的速度。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> _grounded;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">CheckCollisions</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">bool</span> groundHit = Physics2D.CapsuleCast(_col.bounds.center, _col.size, _col.direction, <span class=\"number\">0</span>, Vector2.down, _stats.GrounderDistance, ~_stats.PlayerLayer);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Landed on the Ground</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!_grounded &amp;&amp; groundHit) &#123;</span><br><span class=\"line\">        _grounded = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// Left the Ground</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (_grounded &amp;&amp; !groundHit) &#123;</span><br><span class=\"line\">        _grounded = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果没有水平方向上的输入，则对当前水平速度进行衰减，在空中和地面上的衰减速度不同；如果有水平方向上的输入，则对当前水平速度进行增加。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">HandleDirection</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_frameInput.Move.x == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> deceleration = _grounded ? _stats.GroundDeceleration : _stats.AirDeceleration;</span><br><span class=\"line\">        _frameVelocity.x = Mathf.MoveTowards(_frameVelocity.x, <span class=\"number\">0</span>, deceleration * Time.fixedDeltaTime);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        _frameVelocity.x = Mathf.MoveTowards(_frameVelocity.x, _frameInput.Move.x * _stats.MaxSpeed, _stats.Acceleration * Time.fixedDeltaTime);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果跳跃输入无效，则什么也不做；如果跳跃输入有效，则判断是否处于地面，如果处于地面，则调用<code>ExecuteJump</code>方法。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">HandleJump</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!_jumpToConsume) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_grounded) ExecuteJump();</span><br><span class=\"line\"></span><br><span class=\"line\">    _jumpToConsume = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">ExecuteJump</span>()</span> &#123;</span><br><span class=\"line\">    _frameVelocity.y = _stats.JumpPower;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"针对手柄的输入适配\"><a href=\"#针对手柄的输入适配\" class=\"headerlink\" title=\"针对手柄的输入适配\"></a>针对手柄的输入适配</h3><p>键盘只有按下和松开两种状态，没有“轻推”选项，获取的移动输入是整数值；而手柄的摇杆获取的输入移动是浮点数，对于后续移动速度的计算有影响。推动摇杆的幅度越大，速度越快。</p>\n<p>是游戏本身情况而定，如果需要这个特性，则无需调整；如果不需要这个特定，则在获取移动输入时对其进行取整。</p>\n<p><code>_stats.SnapInput</code>是这个特性的开关。<code>_stats.HorizontalDeadZoneThreshold</code>和<code>_stats.VerticalDeadZoneThreshold</code>分别是摇杆在水平和竖直方向的死区阈值。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">HandleDirection</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_stats.SnapInput) &#123;</span><br><span class=\"line\">        _frameInput.Move.x = Mathf.Abs(_frameInput.Move.x) &lt; _stats.HorizontalDeadZoneThreshold ? <span class=\"number\">0</span> : Mathf.Sign(_frameInput.Move.x);</span><br><span class=\"line\">        _frameInput.Move.y = Mathf.Abs(_frameInput.Move.y) &lt; _stats.VerticalDeadZoneThreshold ? <span class=\"number\">0</span> : Mathf.Sign(_frameInput.Move.y);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">### 土狼时间</span></span><br><span class=\"line\"></span><br><span class=\"line\">角色在平台边缘浮空的一小段时间内仍可起跳。</span><br><span class=\"line\"></span><br><span class=\"line\">设置变量`_coyoteUsable`作为土狼时间可用的必要条件之一，其在角色降落到地面时被置为`<span class=\"literal\">true</span>`，在执行跳跃时被置为`<span class=\"literal\">false</span>`。</span><br><span class=\"line\"></span><br><span class=\"line\">同时设置变量`_frameLeftGrounded`记录玩家离开地面的时刻。</span><br><span class=\"line\"></span><br><span class=\"line\">```C<span class=\"meta\">#</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> _coyoteUsable;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"built_in\">float</span> _frameLeftGrounded = <span class=\"built_in\">float</span>.MinValue;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">CheckCollisions</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Landed on the Ground</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!_grounded &amp;&amp; groundHit) &#123;</span><br><span class=\"line\">        _coyoteUsable = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Left the Ground</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (_grounded &amp;&amp; !groundHit) &#123;</span><br><span class=\"line\">        _frameLeftGrounded = _time;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">ExecuteJump</span>()</span> &#123;</span><br><span class=\"line\">    _coyoteUsable = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 其中_time是脚本自身维护的一个时钟，每帧在Update()中更新。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">Update</span>()</span> &#123;</span><br><span class=\"line\">    _time += Time.deltaTime;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>判断土狼时间是否可用的充要条件是</p>\n<ul>\n<li><code>_coyoteUsable</code>为<code>true</code>。即角色的状态是降落在地面之后，执行跳跃之前。</li>\n<li><code>_grounded</code>为<code>false</code>。即角色当前不在地面上。</li>\n<li>当前时刻距离上次离开地面的时间，不超过预设的土狼时间值<code>CoyoteTime</code>。</li>\n</ul>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> CanUseCoyote =&gt; _coyoteUsable &amp;&amp; !_grounded &amp;&amp; _time &lt; _frameLeftGrounded + _stats.CoyoteTime;</span><br></pre></td></tr></table></figure>\n\n<p>最终在判断是否跳跃时，除了角色在地面的情况外，或上了土狼时间可用的情况。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">HandleJump</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_grounded || CanUseCoyote) &#123;</span><br><span class=\"line\">        ExecuteJump();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"跳跃输入缓存\"><a href=\"#跳跃输入缓存\" class=\"headerlink\" title=\"跳跃输入缓存\"></a>跳跃输入缓存</h3><p>角色在落地前如果被输入了跳跃指令，将这个跳跃指令缓存起来，落地后立即执行。</p>\n<p>设置变量<code>_bufferedJumpUsable</code>作为跳跃输入缓存可用的必要条件之一，其在角色降落到地面时被置为<code>true</code>，在执行跳跃时被置为<code>false</code>。</p>\n<p>同时设置变量<code>_frameLeftGrounded</code>记录玩家离开地面的时刻。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> _bufferedJumpUsable;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"built_in\">float</span> _timeJumpWasPressed;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">CheckCollisions</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Landed on the Ground</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!_grounded &amp;&amp; groundHit) &#123;</span><br><span class=\"line\">        _bufferedJumpUsable = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">ExecuteJump</span>()</span> &#123;</span><br><span class=\"line\">    _bufferedJumpUsable = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">GatherInput</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_frameInput.JumpDown) &#123;</span><br><span class=\"line\">        _timeJumpWasPressed = _time;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>判断跳跃输入缓存是否可用的充要条件是</p>\n<ul>\n<li><code>_bufferedJumpUsable</code>为<code>true</code>。即角色的状态是降落在地面之后，执行跳跃之前。</li>\n<li>当前时刻距离上次按下跳跃键的时间，不超过预设的跳跃输入缓存时间值<code>JumpBuffer</code>。</li>\n</ul>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"built_in\">bool</span> HasBufferedJump =&gt; _bufferedJumpUsable &amp;&amp; _time &lt; _timeJumpWasPressed + _stats.JumpBuffer;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"可变跳跃高度\"><a href=\"#可变跳跃高度\" class=\"headerlink\" title=\"可变跳跃高度\"></a>可变跳跃高度</h3><p>按住跳跃键时间越长，跳跃高度越高。</p>\n<p>所以在获取输入信息时，会检测当前是否正按住跳跃键。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">GatherInput</span>()</span> &#123;</span><br><span class=\"line\">    _frameInput = <span class=\"keyword\">new</span> FrameInput &#123;</span><br><span class=\"line\">        JumpHeld = Input.GetButton(<span class=\"string\">&quot;Jump&quot;</span>) || Input.GetKey(KeyCode.C),</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>设置变量<code>_endedJumpEarly</code>作为是否提前结束跳跃的条件。其在执行跳跃时被置为<code>false</code>。</p>\n<p>在处理跳跃指令时，判断提前结束跳跃的条件是：</p>\n<ul>\n<li><code>_endedJumpEarly</code>为<code>false</code></li>\n<li><code>_grounded</code>为<code>false</code>。即角色当前不在地面上。</li>\n<li><code>_frameInput.JumpHeld</code>为<code>false</code>。即当前没有按住跳跃键。</li>\n<li>角色当前的竖直速度大于0，即角色在跳跃的上升过程中。</li>\n</ul>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">HandleJump</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!_endedJumpEarly &amp;&amp; !_grounded &amp;&amp; !_frameInput.JumpHeld &amp;&amp; _rb.velocity.y &gt; <span class=\"number\">0</span>) _endedJumpEarly = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在处理完跳跃在竖直方向的速度后，增加了一个<code>HandleGravity</code>方法来调整速度</p>\n<p>如果最终确定提前结束跳跃，则下落的加速度会乘以一个预设的系数，也就是让角色下落得更快。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">HandleGravity</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 角色在地面上没有竖直方向的移动，或者正在下落，则直接赋值让这个速度恒定不变。</span></span><br><span class=\"line\">    <span class=\"comment\">// 可以理解为抓地力，也可以用于处理角色在斜坡向下滑的情况</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_grounded &amp;&amp; _frameVelocity.y &lt;= <span class=\"number\">0f</span>) &#123;</span><br><span class=\"line\">        _frameVelocity.y = _stats.GroundingForce;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> inAirGravity = _stats.FallAcceleration;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_endedJumpEarly &amp;&amp; _frameVelocity.y &gt; <span class=\"number\">0</span>) inAirGravity *= _stats.JumpEndEarlyGravityModifier;</span><br><span class=\"line\">        _frameVelocity.y = Mathf.MoveTowards(_frameVelocity.y, -_stats.MaxFallSpeed, inAirGravity * Time.fixedDeltaTime);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["Unity"],"tags":["C#"]},{"title":"Unity的RectTransform","url":"/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%9A%84RectTransform/","content":"<h2 id=\"RectTransform\"><a href=\"#RectTransform\" class=\"headerlink\" title=\"RectTransform\"></a>RectTransform</h2><p><a href=\"https://docs.unity3d.com/cn/2020.3/ScriptReference/RectTransform.html\">Unity API</a></p>\n<p>RectTransforms 用于 GUI，不过也可以用于其他情况。 它用于存储和操作矩形的位置、大小和锚定，并支持各种形式的缩放（基于父 RectTransform）。</p>\n<h2 id=\"Anchors\"><a href=\"#Anchors\" class=\"headerlink\" title=\"Anchors\"></a>Anchors</h2><p>长得像下面这样</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%9A%84RectTransform/Anchors%E5%BD%A2%E7%8A%B6.png\" alt=\"Anchors形状.png\"></p>\n<p>本质上也是一个矩形，使用anchorMin和anchorMax描述它的位置。这是两个Vector2变量，分别代表着Anchors矩形左下角的点，和右上角的点。</p>\n<p>Anchors的重要作用，就是无论父物体如何变化，子物体相对于父物体上Anchors的相对位置都不变。</p>\n<p><strong>描述anchorMin或anchorMax位置的x和y坐标</strong>，都在[0,1]范围内，含义是该点相对于父物体的位置比例。如果点在父物体的左下角，是(0,0)；在父物体的右上角，是(1,1)；在父物体的正中央，是(0.5,0.5)。</p>\n<p>例如父物体是一个宽200，高100的矩形，如果anchorMin的位置相对父物体左下角，宽方向距离为60，高方向距离为70，则此anchorMin的坐标应为(60&#x2F;200, 70&#x2F;100) &#x3D; (0.3, 0.7)。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%9A%84RectTransform/%E9%94%9A%E7%82%B9%E5%9D%90%E6%A0%87.png\" alt=\"锚点坐标.png\"></p>\n<p>Anchors矩形的左下角和右上角，即anchorMin和anchorMax坐标确定后，Anchors矩形也就确定了。</p>\n<p>在Inspector中，如果anchorMin和anchorMax相同，即Anchors矩形是一个点，则通过PosX&#x2F;Y和Hight&#x2F;Width描述物体位置大小，Pos是从Anchors点到Pivot点的矢量，Hight&#x2F;Width是物体的长宽。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%9A%84RectTransform/Anchors%E6%98%AF%E7%82%B9%E7%9A%84%E6%83%85%E5%86%B5.png\" alt=\"Anchors是点的情况.png\"></p>\n<p>如果Anchors矩形不是点了，则通过Top&#x2F;Bottom&#x2F;Left&#x2F;Right描述物体大小位置，分别表示从Anchor矩形的某条边到物体对应边的矢量距离，可正可负。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%9A%84RectTransform/Anchors%E4%B8%8D%E6%98%AF%E7%82%B9%E7%9A%84%E6%83%85%E5%86%B5.png\" alt=\"Anchors不是点的情况.png\"></p>\n<h2 id=\"Pivot\"><a href=\"#Pivot\" class=\"headerlink\" title=\"Pivot\"></a>Pivot</h2><p>可以理解为物体的重心，物体的旋转和缩放，都是以Pivot点为基准。在Anchors是点的情况下配合PosX&#x2F;Y描述物体位置。</p>\n<p>Pivot点的坐标也是描述的比例，但是相对当前物体的比例。</p>\n<h2 id=\"offset\"><a href=\"#offset\" class=\"headerlink\" title=\"offset\"></a>offset</h2><p>物体实际位置到Anchors位置的偏移</p>\n<p>描述offset时，也需要两个Vector2变量offsetMin和offsetMax，但它们代表的不是点，而是一个二维距离。</p>\n<p>offsetMin表示游戏物体左下角到Anchor左下角的矢量，offsetMax表示游戏物体右上角到Anchor右上角的矢量。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%9A%84RectTransform/offset%E5%9D%90%E6%A0%87.png\" alt=\"offset坐标.png\"></p>\n<h2 id=\"anchoredPosition\"><a href=\"#anchoredPosition\" class=\"headerlink\" title=\"anchoredPosition\"></a>anchoredPosition</h2><p>可以大致理解为从Anchors矩形重心到物体重心的矢量。</p>\n<p>首先要算出从Anchors矩形重心的位置，就是将物体Pivot比例坐标的值，带入到Anchors矩形中，算出来的坐标点。</p>\n<p>然后从算出来的坐标点出发，到物体重心连成的矢量，就是anchoredPosition。</p>\n<p>例如下图，Pivot &#x3D; (0.2, 0.4)，Anchors矩形重心的位置离左下角的坐标就是(20, 40)。到物体重心连成的矢量，就是anchoredPosition，其余计算见图，最终anchoredPosition &#x3D; (32, -8)</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%9A%84RectTransform/anchoredPosition%E8%AE%A1%E7%AE%97%E6%96%B9%E5%BC%8F.png\" alt=\"anchoredPosition计算方式.png\"></p>\n<p>看上去还是当Anchors矩形是一个点的场景下比较好用，anchoredPosition就是Anchors点到物体Pivot点的矢量。</p>\n<h2 id=\"sizeDelta\"><a href=\"#sizeDelta\" class=\"headerlink\" title=\"sizeDelta\"></a>sizeDelta</h2><p>表示物体矩形与其Anchors矩形相比更大或更小的程度。这个值和物体矩形的位置没有关系。</p>\n<p>sizeDelta.x就是物体矩形的宽度，减去其Anchors矩形的宽度;sizeDelta.y就是物体矩形的高度，减去其Anchors矩形的高度。</p>\n<p>例如下面的粉方框，Anchors矩形的宽高都是100，物体矩形宽60，高40，那它的sizeDelta &#x3D; (60-100, 40-100) &#x3D; (-60, -40)</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%9A%84RectTransform/sizeDelta%E8%AE%A1%E7%AE%97%E6%96%B9%E5%BC%8F.png\" alt=\"sizeDelta计算方式.png\"></p>\n<p>所以，如果Anchors矩形是一个点，那Anchors矩形的长宽都是0，sizeDelta就能直接表示物体矩形的宽高了。</p>\n<h2 id=\"rect\"><a href=\"#rect\" class=\"headerlink\" title=\"rect\"></a>rect</h2><p>Rect类用来描述一个矩形，RectTransform.rect描述的就是此RectTransform物体的矩形。</p>\n<p>Rect没有外部参考系，里面的变量只和矩形自己有关，各个变量含义如下</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%9A%84RectTransform/Rect%E5%90%84%E5%8F%98%E9%87%8F%E5%90%AB%E4%B9%89.png\" alt=\"Rect各变量含义.png\"></p>\n<h2 id=\"SetSizeWithCurrentAnchors\"><a href=\"#SetSizeWithCurrentAnchors\" class=\"headerlink\" title=\"SetSizeWithCurrentAnchors\"></a>SetSizeWithCurrentAnchors</h2><p>以Pivot为基准，直接设置物体矩形的宽或高，Anchors不会受到影响。</p>\n<p>比如原先物体的宽是100，Pivot的x为0.1，当执行<code>SetSizeWithCurrentAnchors(RectTransform.Axis.Horizontal, 200)</code>的时候，物体会向左伸长10，向右伸长90</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%9A%84RectTransform/SetSizeWithCurrentAnchors%E7%A4%BA%E4%BE%8B.png\" alt=\"SetSizeWithCurrentAnchors示例.png\"></p>\n<h2 id=\"SetInsetAndSizeFromParentEdge\"><a href=\"#SetInsetAndSizeFromParentEdge\" class=\"headerlink\" title=\"SetInsetAndSizeFromParentEdge\"></a>SetInsetAndSizeFromParentEdge</h2><p>直接设置物体矩形的大小，和相对于父物体的位置。和物体的Anchors和Pivot没有关系。</p>\n<p>三个参数 (RectTransform.Edge edge, float inset, float size)</p>\n<p>会对Anchors产生影响。执行之后，可以看到Anchors发生相应的变化，根据参数 RectTransform.Edge 相当于点击了Inspector中Anchor Presets中的Left、Right、Top或Bottom</p>\n<p>例如，原先的物体设置是这样</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%9A%84RectTransform/SetInsetAndSizeFromParentEdge%E6%89%A7%E8%A1%8C%E5%89%8D.png\" alt=\"SetInsetAndSizeFromParentEdge执行前.png\"></p>\n<p>执行完<code>GetComponent&lt;RectTransform&gt;().SetInsetAndSizeFromParentEdge(RectTransform.Edge.Left, 10, 40);</code>之后是这样</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%9A%84RectTransform/SetInsetAndSizeFromParentEdge%E6%89%A7%E8%A1%8C%E5%90%8E.png\" alt=\"SetInsetAndSizeFromParentEdge执行后.png\"></p>\n<h2 id=\"GetLocalCorners\"><a href=\"#GetLocalCorners\" class=\"headerlink\" title=\"GetLocalCorners\"></a>GetLocalCorners</h2><p>获取物体矩形左下、左上、右上、右下角<strong>相对于Pivot点</strong>的位置坐标。</p>\n","categories":["Unity"],"tags":["C#"]},{"title":"Unity移动端异形屏相关","url":"/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%82%E5%BD%A2%E5%B1%8F%E7%9B%B8%E5%85%B3/","content":"<h2 id=\"异形屏\"><a href=\"#异形屏\" class=\"headerlink\" title=\"异形屏\"></a>异形屏</h2><p>异形屏指非传统矩形的屏幕。一些常见屏幕异形的原因：</p>\n<ul>\n<li>刘海屏，多是屏幕上方增加凹槽或打孔放置前置摄像头；</li>\n<li>曲面屏，多是屏幕沿左右两边弯曲。</li>\n<li>iPhone的虚拟Home Indicator，屏幕下方的小横线按钮。</li>\n</ul>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%82%E5%BD%A2%E5%B1%8F%E7%9B%B8%E5%85%B3/%E5%88%98%E6%B5%B7%E5%B1%8F%E6%89%8B%E6%9C%BA.jpg\" alt=\"刘海屏手机.jpg\"><br><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%82%E5%BD%A2%E5%B1%8F%E7%9B%B8%E5%85%B3/%E6%9B%B2%E9%9D%A2%E5%B1%8F%E6%89%8B%E6%9C%BA.jpg\" alt=\"曲面屏手机.jpg\"><br><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%82%E5%BD%A2%E5%B1%8F%E7%9B%B8%E5%85%B3/IPhone%E7%9A%84Home%20Indicator.jpg\" alt=\"IPhone的Home Indicator.jpg\"></p>\n<p>Unity做移动端开发时，UI画布、各种元素都是基于矩形的，默认不考虑异形屏，直接铺满屏幕，但某些情况下，屏幕的“异形”部分会挡住应用内的关键显示，需要做相应处理。</p>\n<h2 id=\"SafeArea\"><a href=\"#SafeArea\" class=\"headerlink\" title=\"SafeArea\"></a>SafeArea</h2><p>顾名思义，屏幕渲染的安全区，在这个区域内渲染的内容肯定不会被遮挡。</p>\n<p>可用UnityEngine.Screen.safeArea获取屏幕的安全区信息。附上<a href=\"https://docs.unity3d.com/cn/2020.3/ScriptReference/Screen-safeArea.html\">官方文档</a>的描述。</p>\n<h3 id=\"Screen-safeArea内的数据含义\"><a href=\"#Screen-safeArea内的数据含义\" class=\"headerlink\" title=\"Screen.safeArea内的数据含义\"></a>Screen.safeArea内的数据含义</h3><p>Screen.safeArea返回了一个Rect对象 (x, y, width, height)。</p>\n<p>width和height指安全区矩形的宽高。<br>x和y指屏幕左下角到安全区矩形左下角的水平和竖直距离。</p>\n<p>再结合Screen.width和Screen.height获取屏幕宽高，能方便地算出安全区四条边分别距屏幕对应边缘有多大的缝隙。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%82%E5%BD%A2%E5%B1%8F%E7%9B%B8%E5%85%B3/%E5%AE%89%E5%85%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E5%90%AB%E4%B9%89.png\" alt=\"安全区数据含义.png\"></p>\n<h3 id=\"Android中的简易处理\"><a href=\"#Android中的简易处理\" class=\"headerlink\" title=\"Android中的简易处理\"></a>Android中的简易处理</h3><p>在Unity的 Project Setting -&gt; Player -&gt; Android平台 -&gt; Resolution and Presentation 设置中，可取消勾选 Render outside safe area。届时应用将仅在安全区中显示内容，安全区之外的屏幕区域将显示黑色。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/Unity%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%82%E5%BD%A2%E5%B1%8F%E7%9B%B8%E5%85%B3/Render_outside_safe_area%E9%80%89%E9%A1%B9.png\" alt=\"Render_outside_safe_area选项.png\"></p>\n","categories":["Unity"],"tags":["C#"]},{"title":"一些Unity-Android打包的常见报错","url":"/%E7%AC%94%E8%AE%B0/Unity/%E4%B8%80%E4%BA%9BUnity-Android%E6%89%93%E5%8C%85%E7%9A%84%E5%B8%B8%E8%A7%81%E6%8A%A5%E9%94%99/","content":"<h2 id=\"NoClassDefFoundError-Vendor\"><a href=\"#NoClassDefFoundError-Vendor\" class=\"headerlink\" title=\"NoClassDefFoundError: Vendor\"></a>NoClassDefFoundError: Vendor</h2><p>报错详情：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">Could not load custom lint check jar file C:\\Users\\&#123;username&#125;\\.gradle\\caches\\transforms-3\\&#123;hash&#125;\\transformed\\jetified-startup-runtime-1.1.1\\jars\\lint.jar</span><br><span class=\"line\">java.lang.NoClassDefFoundError: com/android/tools/lint/client/api/Vendor</span><br></pre></td></tr></table></figure>\n\n<p>可参考StackOverflow上的这篇讨论 <a href=\"https://stackoverflow.com/questions/24098494/applintvitalrelease-error-when-generating-signed-apk\">applintvitalrelease-error-when-generating-signed-apk</a></p>\n<p>少了代码分析工具lint的依赖，不是很关键，当时选择了不是最合适但最快捷的解决方式，在<code>launcherTemplate.gradle</code>加上</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"code\"><pre><span class=\"line\">lintOptions &#123;</span><br><span class=\"line\">    checkReleaseBuilds <span class=\"keyword\">false</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>加完之后可能需要<strong>重启项目</strong>。</p>\n<h2 id=\"Multidex\"><a href=\"#Multidex\" class=\"headerlink\" title=\"Multidex\"></a>Multidex</h2><p>报错详情：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">ERROR:: D8: Cannot fit requested classes in a single dex file (# methods: 85734 &gt; 65536)</span><br><span class=\"line\">com.android.builder.dexing.DexArchiveMergerException: Error while merging dex archives: </span><br><span class=\"line\">The number of method references in a .dex file cannot exceed 64K.</span><br></pre></td></tr></table></figure>\n\n<p>代码中的方法数量（包含引入的第三方依赖中的方法）超过限制</p>\n<p>在<code>launcherTemplate.gradle</code>里加上</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"code\"><pre><span class=\"line\">android &#123;</span><br><span class=\"line\">    defaultConfig &#123;</span><br><span class=\"line\">        multiDexEnabled <span class=\"keyword\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>之前有项目是加在<code>mainTemplate.gradle</code>里也能生效，实在不行两个文件里都加上。</p>\n<p>实际情况中是不用另外加<code>androidx.multidex:multidex</code>依赖的，若有相关报错可以加上试试。</p>\n<h2 id=\"DuplicateClasses-UnityAds\"><a href=\"#DuplicateClasses-UnityAds\" class=\"headerlink\" title=\"DuplicateClasses: UnityAds\"></a>DuplicateClasses: UnityAds</h2><figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">Execution failed for task &#x27;:launcher:checkReleaseDuplicateClasses&#x27;.</span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">A failure occurred <span class=\"keyword\">while</span> executing com.android.build.gradle.internal.tasks.CheckDuplicatesRunnable</span></span><br><span class=\"line\"><span class=\"meta prompt_\">   &gt; </span><span class=\"language-bash\">Duplicate class com.unity3d.ads.BuildConfig found <span class=\"keyword\">in</span> modules jetified-UnityAds-runtime (:UnityAds:) and jetified-unity-ads-4.9.3-runtime (com.unity3d.ads:unity-ads:4.9.3)</span></span><br></pre></td></tr></table></figure>\n\n<p>原因是使用的聚合广告库（Max Applovin）中加了 UnityAds 的依赖，但同时Unity的Package Manager 中也引入了 UnityAds 包。</p>\n<p>直接在Package Manager中删除UnityAds即可。</p>\n","categories":["Unity"]},{"title":"一种文本本地化的实现思路","url":"/%E7%AC%94%E8%AE%B0/Unity/%E4%B8%80%E7%A7%8D%E6%96%87%E6%9C%AC%E6%9C%AC%E5%9C%B0%E5%8C%96%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>本地化，就是工程中的文本能支持多种语言，能根据系统信息或手动设置自动变成不同语言。</p>\n<p>在网上找了好些方案，找到了一种感觉最简单的，但又觉得有点憨，维护成本有点高的。但总之还能用，就简单做下记录，高级方案以后再看看吧。</p>\n<p>游戏引擎使用Unity，语言使用C#</p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><p>本地化文件用json格式保存，不同语言使用各自的json文件，数据格式就是一个列表，每个元素包含一个键值对。</p>\n<p>对于同一个Text文本，不同json文件中的键是相同的，值就是各个语言的本地化文本。</p>\n<p>几个核心的部件如下：</p>\n<p>pojo类</p>\n<ul>\n<li>本地化文件用json格式保存，用UnityEngine自带的JsonUtility做序列化，所以要有一个pojo类存数据。</li>\n</ul>\n<p>本地化器：</p>\n<ul>\n<li>每个需要本地化Text的组件，其所在物体都添加一个本地化器组件</li>\n<li>组件主要记录当前Text文本对应的键</li>\n<li>订阅了本地化管理器的语言改变事件，事件触发时控制刷新Text实际显示的文本。</li>\n</ul>\n<p>本地化管理器：</p>\n<ul>\n<li>包含一个语言枚举类</li>\n<li>记录当前使用的语言</li>\n<li>维护了一个字典，键是Text文本键，值为当前语言的本地化文本，字典的数据从pojo类加载</li>\n<li>提供本地化方法，传入Text文本键，返回本地化后的文本</li>\n<li>提供一个语言变更事件，供本地化器订阅，语言变更时触发</li>\n</ul>\n<p>只是描述文字的话太抽象了，直接贴一下代码</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><h3 id=\"json文件示例\"><a href=\"#json文件示例\" class=\"headerlink\" title=\"json文件示例\"></a>json文件示例</h3><p>json文件要放在Unity工程的Resources文件夹中，本地化管理器设置的本地化文件前缀，也是Resources文件夹的相对路径。</p>\n<p>English.json</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;Datas&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;_btn_change_lang&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Change Language&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果支持中文的话，则添加ChineseSimplified.json文件，其他同理</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;Datas&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;_btn_change_lang&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;变更语言&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"pojo类\"><a href=\"#pojo类\" class=\"headerlink\" title=\"pojo类\"></a>pojo类</h3><figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Collections.Generic;</span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"meta\">Serializable</span>]</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">LanguageData</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;LanguageDataItem&gt; Datas = <span class=\"keyword\">new</span> List&lt;LanguageDataItem&gt;();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"meta\">Serializable</span>]</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">LanguageDataItem</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">string</span> key;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">string</span> <span class=\"keyword\">value</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>既然存储键值对，为什么不直接用字典。</p>\n<p>因为Unity的序列化不支持字典，用Dictionary的话在Unity界面上看不到对应变量，没法直接编辑。</p>\n<p>然后LanguageData这里感觉可以加点meta信息之类的，但暂时没用到。</p>\n<h3 id=\"本地化器\"><a href=\"#本地化器\" class=\"headerlink\" title=\"本地化器\"></a>本地化器</h3><figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> UnityEngine;</span><br><span class=\"line\"><span class=\"keyword\">using</span> UnityEngine.UI;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">TextLocalizationer</span> : <span class=\"title\">MonoBehaviour</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    LocalizationManager localizationManager;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"meta\">SerializeField</span>] <span class=\"keyword\">private</span> <span class=\"built_in\">string</span> textKey;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Text text;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Use this for initialization</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Start</span>()</span> &#123;</span><br><span class=\"line\">        localizationManager = LocalizationManager.Instance;</span><br><span class=\"line\">        text = GetComponent&lt;Text&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        LocalizationManager.OnLanguageChanged += LocalizeText;</span><br><span class=\"line\"></span><br><span class=\"line\">        LocalizeText();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">LocalizeText</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == text) &#123;</span><br><span class=\"line\">            Debug.LogWarning(<span class=\"string\">&quot;未在游戏物体 &lt;&quot;</span> + name + <span class=\"string\">&quot;&gt; 中找到Text组件&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        text.text = localizationManager.GetString(textKey);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">OnDestroy</span>()</span> &#123;</span><br><span class=\"line\">        LocalizationManager.OnLanguageChanged -= LocalizeText;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>localizationManager成员。此本地化器所属的本地化管理器。</li>\n<li>text成员。需要本地化器管理的Text组件，需要和本地化器在同一个游戏物体上。</li>\n<li>Start初始化方法<ul>\n<li>成员赋值</li>\n<li>订阅本地化管理器的语言变更事件</li>\n<li>触发一次本地化方法。</li>\n</ul>\n</li>\n<li>LocalizeText。本地化方法。根据text文本键，从本地化管理器拿到对应本地化文本，给Text组件的文本赋值。</li>\n<li>OnDestroy。取消订阅语言变更事件。</li>\n</ul>\n<h3 id=\"本地化管理器\"><a href=\"#本地化管理器\" class=\"headerlink\" title=\"本地化管理器\"></a>本地化管理器</h3><figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Collections.Generic;</span><br><span class=\"line\"><span class=\"keyword\">using</span> UnityEngine;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">LocalizationManager</span> : <span class=\"title\">MonoBehaviour</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> LocalizationManager Instance &#123; <span class=\"keyword\">get</span> &#123; <span class=\"keyword\">return</span> _instance; &#125; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">event</span> Action OnLanguageChanged; <span class=\"comment\">// 语言改变事件</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LanguageEnum _currentLanguage; <span class=\"comment\">// 当前语言</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt; _localizationDict; <span class=\"comment\">// 键：文本标识，值：本地化文本</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> AndroidJavaClass _locale; <span class=\"comment\">// 获取Java中的Locale类</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">readonly</span> <span class=\"built_in\">string</span> LOCALIZATION_FILE_PATH = <span class=\"string\">&quot;Localization/&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">readonly</span> LanguageEnum INSURANCE_LANG = LanguageEnum.English; <span class=\"comment\">// 保底语言</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt; INSURANCE_DICT;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> LocalizationManager _instance;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">Awake</span>()</span> &#123;</span><br><span class=\"line\">        _instance = <span class=\"keyword\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        INSURANCE_DICT = LoadDictionary(INSURANCE_LANG); <span class=\"comment\">// 加载保底字典</span></span><br><span class=\"line\"></span><br><span class=\"line\">        _locale = <span class=\"keyword\">new</span> AndroidJavaClass(<span class=\"string\">&quot;java.util.Locale&quot;</span>);</span><br><span class=\"line\">        _currentLanguage = MySystemLanguage;</span><br><span class=\"line\">        _localizationDict = LoadDictionary(_currentLanguage); <span class=\"comment\">// 加载字典</span></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 改变当前语言</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">ChangeLanguage</span>(<span class=\"params\">LanguageEnum language</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (language.Equals(_currentLanguage)) &#123; <span class=\"comment\">// 此处不刷新，也可以强制刷新，也可以另写一个强制刷新的方法</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        _currentLanguage = language;</span><br><span class=\"line\">        _localizationDict = LoadDictionary(language);</span><br><span class=\"line\"></span><br><span class=\"line\">        OnLanguageChanged?.Invoke();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 加载语言的映射字典</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\">Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt; <span class=\"title\">LoadDictionary</span>(<span class=\"params\">LanguageEnum language</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">string</span> path = LOCALIZATION_FILE_PATH + language.ToString();</span><br><span class=\"line\">        LanguageData data;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            data = JsonUtil.LoadJsonFromResources&lt;LanguageData&gt;(path);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123; <span class=\"comment\">// 如果失败则加载保险语言</span></span><br><span class=\"line\">            Debug.LogWarning(<span class=\"string\">$&quot;<span class=\"subst\">&#123;ex.Message&#125;</span>, now using insurance language [<span class=\"subst\">&#123;INSURANCE_LANG&#125;</span>].&quot;</span>);</span><br><span class=\"line\">            data = JsonUtil.LoadJsonFromResources&lt;LanguageData&gt;(LOCALIZATION_FILE_PATH + INSURANCE_LANG.ToString());</span><br><span class=\"line\">            _currentLanguage = INSURANCE_LANG;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> GenerateDict(data);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 将JSON文件中的List数据转化成字典，因为此版本Unity不支持序列化字典</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt; <span class=\"title\">GenerateDict</span>(<span class=\"params\">LanguageData languageData</span>)</span> &#123;</span><br><span class=\"line\">        Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt; dict = <span class=\"keyword\">new</span> Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (LanguageDataItem item <span class=\"keyword\">in</span> languageData.Datas) &#123;</span><br><span class=\"line\">            dict.Add(item.key, item.<span class=\"keyword\">value</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dict;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 获取本地化后的文本</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;key&quot;&gt;</span>文本标识<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"built_in\">string</span> <span class=\"title\">GetString</span>(<span class=\"params\"><span class=\"built_in\">string</span> key</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == key || <span class=\"number\">0</span> == key.Length) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_localizationDict.ContainsKey(key)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> _localizationDict[key];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (INSURANCE_DICT.ContainsKey(key)) &#123;</span><br><span class=\"line\">            Debug.LogWarning(<span class=\"string\">$&quot;Cannot find key [<span class=\"subst\">&#123;key&#125;</span>] in localizaitoin dictionary, now using insurance dictionary.&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> INSURANCE_DICT[key];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;<span class=\"comment\">// 如果保底字典中也没有这个key，返回原值</span></span><br><span class=\"line\">            Debug.LogWarning(<span class=\"string\">$&quot;Cannot find key [<span class=\"subst\">&#123;key&#125;</span>] in every dictionary, now just return key itseft.&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> key;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 获取系统语言</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"built_in\">string</span> <span class=\"title\">GetLanguage</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> _locale.CallStatic&lt;AndroidJavaObject&gt;(<span class=\"string\">&quot;getDefault&quot;</span>).Call&lt;<span class=\"built_in\">string</span>&gt;(<span class=\"string\">&quot;getLanguage&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 获取系统国家</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"built_in\">string</span> <span class=\"title\">GetCountry</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> _locale.CallStatic&lt;AndroidJavaObject&gt;(<span class=\"string\">&quot;getDefault&quot;</span>).Call&lt;<span class=\"built_in\">string</span>&gt;(<span class=\"string\">&quot;getCountry&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    LanguageEnum MySystemLanguage &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span> &#123;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> UNITY_EDITOR</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> (LanguageEnum)Application.systemLanguage;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> <span class=\"keyword\">warning</span> disable CS0162 // Unreachable code detected</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> UNITY_ANDROID</span></span><br><span class=\"line\">            LanguageEnum sysLang = LanguageEnum.Unknown;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Application.platform == RuntimePlatform.Android) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">string</span> lang = GetLanguage();</span><br><span class=\"line\">                <span class=\"keyword\">switch</span> (lang) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">case</span> <span class=\"string\">&quot;af&quot;</span>:</span><br><span class=\"line\">                        sysLang = LanguageEnum.Afrikaans;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    <span class=\"comment\">// 此处省略...</span></span><br><span class=\"line\">                    <span class=\"keyword\">case</span> <span class=\"string\">&quot;zh&quot;</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">switch</span> (GetCountry()) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">case</span> <span class=\"string\">&quot;TW&quot;</span>:</span><br><span class=\"line\">                                sysLang = LanguageEnum.ChineseTW;</span><br><span class=\"line\">                                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                            <span class=\"keyword\">case</span> <span class=\"string\">&quot;HK&quot;</span>:</span><br><span class=\"line\">                                sysLang = LanguageEnum.ChineseHK;</span><br><span class=\"line\">                                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                            <span class=\"literal\">default</span>:</span><br><span class=\"line\">                                sysLang = LanguageEnum.ChineseSimplified;</span><br><span class=\"line\">                                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">case</span> <span class=\"string\">&quot;de&quot;</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (GetCountry() == <span class=\"string\">&quot;LU&quot;</span>)</span><br><span class=\"line\">                            sysLang = LanguageEnum.Luxembourgish;</span><br><span class=\"line\">                        <span class=\"keyword\">else</span></span><br><span class=\"line\">                            sysLang = LanguageEnum.German;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> sysLang;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> <span class=\"keyword\">warning</span> restore CS0162</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">enum</span> LanguageEnum &#123; <span class=\"comment\">// 来自 UnityEngine.SystemLanguage</span></span><br><span class=\"line\">        Afrikaans = <span class=\"number\">0</span>,</span><br><span class=\"line\">        Arabic = <span class=\"number\">1</span>,</span><br><span class=\"line\">        Basque = <span class=\"number\">2</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 此处省略...</span></span><br><span class=\"line\">        Luxembourgish = <span class=\"number\">48</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>（这一大段你就直接放这里了？）</p>\n<p>懒且菜…以后要是我懂的多了，就能轻松洞察本质提取重点了，现在就暂时先当一个代码备份吧…</p>\n<h4 id=\"成员\"><a href=\"#成员\" class=\"headerlink\" title=\"成员\"></a>成员</h4><ul>\n<li>_instance，Instance：单例对象。</li>\n<li>_currentLanguage：记录当前使用的语言</li>\n<li>_localizationDict：存储本地化文本的键值对；键：文本标识，值：本地化文本</li>\n<li>_locale：获取Java中的Locale类，用于获取安卓系统中的语言和地区</li>\n<li>INSURANCE_LANG：保底语言，当系统语言不被支持或_currentLanguage被赋予异常值无法正常加载时，使用此语言。稍微增加那么一点鲁棒性。</li>\n<li>INSURANCE_DICT：保底语言对应的本地化文本键值对</li>\n<li>LOCALIZATION_FILE_PATH：存储本地化文件的路径前缀</li>\n<li>OnLanguageChanged：语言改变事件。供本地化器订阅，当前语言改变时触发。</li>\n<li>LanguageEnum：语言枚举类。这段LanguageEnum和MySystemLanguage是直接拿别人的。查了下基本上全部来自UnityEngine.SystemLanguage，不直接引用而自己另写一个，应该是便于修改，使用上更灵活吧。</li>\n<li>MySystemLanguage：当前系统语言。<ul>\n<li>如果是在Unity Editor中运行的话，直接从Application中获取系统语言。</li>\n<li>如果在Android系统中，则使用_locale获取系统语言编号，通过switch语句返回对应的枚举类。</li>\n<li>switch写起来感觉有点麻烦，本质就是需要建立一个string到Enum的键值映射，有想过通过Enum.Parse来做，但Enum那边改动有点大，暂时没试。不过反正不是我写的，switch本质上也是O(1)的Hash，就先这样吧。</li>\n<li>这里的语言缩写，查了下应该使用的是ISO 639-1 Code 规范，可参考：<a href=\"http://www.loc.gov/standards/iso639-2/php/code_list.php\">ISO 639-1 Code</a>。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a>方法</h4><ul>\n<li>Awake：实例化时触发一次。<ul>\n<li>单例赋值</li>\n<li>获取当前系统语言</li>\n<li>填充系统语言和保底语言的字典。先于各本地化器Start中的调用。</li>\n</ul>\n</li>\n<li>ChangeLanguage：更改语言方法。<ul>\n<li>维护_currentLanguage变量</li>\n<li>重新加载当前语言字典</li>\n<li>触发语言改变事件。</li>\n<li>这里先判断了下当前语言和更改的目标语言是否是同一种，是的话就不做操作了；本意是提高效率，不加也行，考虑可能有强制reload的需求；同时考虑这两种场景的话，可以重载一下，在参数列表里加个bool变量来控制是否判断。</li>\n</ul>\n</li>\n<li>LoadDictionary：加载系统语言字典方法。<ul>\n<li>如果途中除了什么问题的话，比如本地化文件找不到或格式有误，则加载保底语言的字典。</li>\n<li>如果保底字典也加载失败的话，就没什么办法了。</li>\n<li>加载json实际使用的是 UnityEngine.JsonUtility.FromJson<T>(string json)</li>\n</ul>\n</li>\n<li>GenerateDict：字典转换方法。将pojo转Dictionary</li>\n<li>GetString：获取本地化文本方法。<ul>\n<li>首先在当前语言字典中寻找键对应的本地化文本，找到则返回</li>\n<li>如果没找到，则在保底语言字典中寻找</li>\n<li>如果在保底语言字典中也没有此键，则记录异常，直接返回键本身</li>\n</ul>\n</li>\n<li>GetLanguage和GetCountry：通过Java中的Locale类，获取当前系统语言和地区</li>\n</ul>\n<h2 id=\"使用例\"><a href=\"#使用例\" class=\"headerlink\" title=\"使用例\"></a>使用例</h2><p>在场景中添加两个空物体，分别添加LocalizationManager脚本和LocalizationTest脚本。</p>\n<p>新建画布，添加一个Text控件和Component控件。</p>\n<p>层次结构如下</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/%E4%B8%80%E7%A7%8D%E6%96%87%E6%9C%AC%E6%9C%AC%E5%9C%B0%E5%8C%96%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF/%E7%89%A9%E4%BD%93%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84.png\" alt=\"物体层次结构.png\"></p>\n<p>LocalizationTest脚本如下</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> UnityEngine;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">LocalizationTest</span> : <span class=\"title\">MonoBehaviour</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LocalizationManager _localMgr;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> LocalizationManager.LanguageEnum en;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> LocalizationManager.LanguageEnum zh;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Start</span>()</span> &#123;</span><br><span class=\"line\">        _localMgr = LocalizationManager.Instance;</span><br><span class=\"line\">        en = LocalizationManager.LanguageEnum.English;</span><br><span class=\"line\">        zh = LocalizationManager.LanguageEnum.ChineseSimplified;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">ChangeLang</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_localMgr.CurrentLanguage.Equals(en)) &#123;</span><br><span class=\"line\">            _localMgr.ChangeLanguage(zh);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            _localMgr.ChangeLanguage(en);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>为按钮绑定ChangeLang方法。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/%E4%B8%80%E7%A7%8D%E6%96%87%E6%9C%AC%E6%9C%AC%E5%9C%B0%E5%8C%96%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF/%E7%BB%91%E5%AE%9AChangeLang%E6%96%B9%E6%B3%95.png\" alt=\"绑定ChangeLang方法.png\"></p>\n<p>为Text控件和Button下的Text控件添加TextLocalizationer组件，并填写Text文本键</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/%E4%B8%80%E7%A7%8D%E6%96%87%E6%9C%AC%E6%9C%AC%E5%9C%B0%E5%8C%96%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF/%E6%B7%BB%E5%8A%A0TextLocalizationer%E7%BB%84%E4%BB%B61.png\" alt=\"添加TextLocalizationer组件1.png\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/%E4%B8%80%E7%A7%8D%E6%96%87%E6%9C%AC%E6%9C%AC%E5%9C%B0%E5%8C%96%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF/%E6%B7%BB%E5%8A%A0TextLocalizationer%E7%BB%84%E4%BB%B62.png\" alt=\"添加TextLocalizationer组件2.png\"></p>\n<p>在Resources文件夹中新建Localization路径，放入English.json和ChineseSimplified.json</p>\n<p>English.json</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;Datas&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;_btn_change_lang&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Change Language&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;_text_test&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Test&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>ChineseSimplified.json</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;Datas&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;_btn_change_lang&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;变更语言&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;_text_test&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;测试&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>运行效果如下</p>\n<p>运行后读电脑的系统语言，加载中文</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/%E4%B8%80%E7%A7%8D%E6%96%87%E6%9C%AC%E6%9C%AC%E5%9C%B0%E5%8C%96%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF/%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C1.png\" alt=\"运行效果1.png\"></p>\n<p>点击按钮可在两种语言间轮流切换</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/%E4%B8%80%E7%A7%8D%E6%96%87%E6%9C%AC%E6%9C%AC%E5%9C%B0%E5%8C%96%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF/%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C2.png\" alt=\"运行效果2.png\"></p>\n","categories":["Unity"],"tags":["C#"]},{"title":"一种有限状态机的简单实现","url":"/%E7%AC%94%E8%AE%B0/Unity/%E4%B8%80%E7%A7%8D%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>有限状态机的<a href=\"https://baike.baidu.com/item/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E8%87%AA%E5%8A%A8%E6%9C%BA/2850046?fromtitle=%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA\">百度百科链接</a>。</p>\n<p>实际没有太深入地研究，接触到这个的原因，是项目里需要将游戏的不同阶段分隔，方便流程控制。在此基本只是记录一种有限状态机的简单实现，游戏引擎使用Unity，语言使用C#。原代码来自同事，做了一点修改。</p>\n<p>感觉这个实现太朴实无华了，用的就是方法间调用，只是加了一个类统一管理。想象当中可能不适合状态复杂的场景，但当前只是用在了小型棋牌类游戏的流程控制，暂时没感受到明显的局限性。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><h3 id=\"IState-状态接口\"><a href=\"#IState-状态接口\" class=\"headerlink\" title=\"IState 状态接口\"></a>IState 状态接口</h3><p>状态的接口</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title\">IState</span> &#123;</span><br><span class=\"line\">    StateMachine StateMachine &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">OnEnter</span>(<span class=\"params\"><span class=\"keyword\">params</span> <span class=\"built_in\">object</span>[] objects</span>)</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">OnExit</span>()</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">OnUpdate</span>()</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">OnFixedUpdate</span>()</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">OnLateUpdate</span>()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>StateMachine：此状态所属的状态机</li>\n<li>OnEnter：进入此状态时执行的操作，可视情况传一个参数列表</li>\n<li>OnExit：离开此状态是执行的操作</li>\n<li>OnUpdate、OnFixedUpdate、OnLateUpdate：处于此状态时的Update方法，对应着MonoBehaviour中的几个Update方法。</li>\n</ul>\n<h3 id=\"StateBase-状态基类\"><a href=\"#StateBase-状态基类\" class=\"headerlink\" title=\"StateBase 状态基类\"></a>StateBase 状态基类</h3><p>就是用虚函数实现接口，之后具体的状态类有些方法是用不上的，就不用全部实现了。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">StateBase</span> : <span class=\"title\">IState</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> StateMachine StateMachine &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">OnEnter</span>(<span class=\"params\"><span class=\"keyword\">params</span> <span class=\"built_in\">object</span>[] objects</span>)</span> &#123; _OnEnter(objects); &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">OnExit</span>()</span> &#123; _OnExit(); &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">OnUpdate</span>()</span> &#123; _OnUpdate(); &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">OnFixedUpdate</span>()</span> &#123; _OnFixedUpdate(); &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">OnLateUpdate</span>()</span> &#123; _OnLateUpdate(); &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> _OnEnter(<span class=\"keyword\">params</span> <span class=\"built_in\">object</span>[] objects) &#123; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> _OnExit() &#123; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> _OnUpdate() &#123; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> _OnFixedUpdate() &#123; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> _OnLateUpdate() &#123; &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>状态类需要以单例形式使用，故没有设置ID标识之类的成员；相反如果设置了ID，还需要另外维护ID和状态之间的对应关系，我觉得这种维护既麻烦，又没什么价值。</p>\n<h3 id=\"StateMachine-状态机\"><a href=\"#StateMachine-状态机\" class=\"headerlink\" title=\"StateMachine 状态机\"></a>StateMachine 状态机</h3><figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> System.Collections.Generic;</span><br><span class=\"line\"><span class=\"keyword\">using</span> UnityEngine;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">StateMachine</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> IState currentState; <span class=\"comment\">// 当前状态</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">readonly</span> HashSet&lt;IState&gt; stateSet; <span class=\"comment\">// 状态机已注册的状态集合</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">StateMachine</span>()</span> &#123;</span><br><span class=\"line\">        stateSet = <span class=\"keyword\">new</span> HashSet&lt;IState&gt;();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 注册状态</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;state&quot;&gt;</span>需要注册的状态<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">RegisterState</span>(<span class=\"params\">IState state</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (stateSet.Contains(state)) &#123;</span><br><span class=\"line\">            Debug.LogError(<span class=\"string\">&quot;The state is registered&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            state.StateMachine = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">            stateSet.Add(state);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 初始化状态</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;state&quot;&gt;</span>需要初始化的状态<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;objects&quot;&gt;</span><span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">InitState</span>(<span class=\"params\">IState state, <span class=\"keyword\">params</span> <span class=\"built_in\">object</span>[] objects</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (stateSet.Contains(state)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (currentState != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                Debug.LogWarning(<span class=\"string\">&quot;The state machine&#x27;s currentState is not null, change or init?&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            currentState = state;</span><br><span class=\"line\">            currentState.OnEnter(objects);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            Debug.LogError(<span class=\"string\">&quot;The state is not find&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 变更状态</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;state&quot;&gt;</span>变更的目标状态<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;objects&quot;&gt;</span><span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">ChangeState</span>(<span class=\"params\">IState state, <span class=\"keyword\">params</span> <span class=\"built_in\">object</span>[] objects</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == state) &#123;</span><br><span class=\"line\">            Debug.LogError(<span class=\"string\">&quot;The state is null, check if registered&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (stateSet.Contains(state)) &#123;</span><br><span class=\"line\">            currentState.OnExit();</span><br><span class=\"line\">            currentState = state;</span><br><span class=\"line\">            currentState.OnEnter(objects);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            Debug.LogError(<span class=\"string\">&quot;The state is not find, check if registered&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 判断当前是否为此状态</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;state&quot;&gt;</span><span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span><span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"built_in\">bool</span> <span class=\"title\">IsState</span>(<span class=\"params\">IState state</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> state == currentState;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> 获取当前状态</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>当前状态<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IState <span class=\"title\">GetCurrentState</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> currentState;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">OnUpdate</span>()</span> &#123;</span><br><span class=\"line\">        currentState?.OnUpdate();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">OnFixedUpdate</span>()</span> &#123;</span><br><span class=\"line\">        currentState?.OnFixedUpdate();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">OnLateUpdate</span>()</span> &#123;</span><br><span class=\"line\">        currentState?.OnLateUpdate();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>有两个成员：currentState记录当前所处状态；stateSet维护当前已注册的所有状态。</li>\n<li>RegisterState。注册状态，即将状态对象放入stateSet集合中。</li>\n<li>InitState。初始化状态，因为刚开始状态机不处于任何状态。</li>\n<li>ChangeState。转换状态，先执行前一个状态的OnExit方法，维护currentState，执行后一个状态的OnEnter方法。</li>\n<li>IsState。判断当前是否为某状态。</li>\n<li>GetCurrentState。获取当前状态。</li>\n<li>状态的变更，需要每个状态主动调用，在自己的OnUpdate或OnEnter方法中做逻辑判断，调用状态机的ChangeState方法。</li>\n</ul>\n<h2 id=\"使用例\"><a href=\"#使用例\" class=\"headerlink\" title=\"使用例\"></a>使用例</h2><p>创建两个状态A和B，进入状态时，将UI中的Text组件显示内容改为当前状态名。运行过程中按P在控制台打印当前状态，按C转换状态。</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> UnityEngine;</span><br><span class=\"line\"><span class=\"keyword\">using</span> UnityEngine.UI;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">StateMachineTest</span> : <span class=\"title\">MonoBehaviour</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> StateMachine stateMachine;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Start</span>()</span> &#123;</span><br><span class=\"line\">        stateMachine = <span class=\"keyword\">new</span> StateMachine();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 注册状态</span></span><br><span class=\"line\">        stateMachine.RegisterState(<span class=\"keyword\">new</span> StateA());</span><br><span class=\"line\">        stateMachine.RegisterState(<span class=\"keyword\">new</span> StateB());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 初始化状态</span></span><br><span class=\"line\">        stateMachine.InitState(StateA.Instance);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Update</span>()</span> &#123;</span><br><span class=\"line\">        stateMachine.OnUpdate();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">class</span> <span class=\"title\">StateA</span> : <span class=\"title\">StateBase</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Text StateShower;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> StateA _instance;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> StateA Instance &#123; <span class=\"keyword\">get</span> &#123; <span class=\"keyword\">return</span> _instance; &#125; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">StateA</span>()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == _instance) &#123;</span><br><span class=\"line\">                _instance = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            StateShower = GameObject.Find(<span class=\"string\">&quot;StateShower&quot;</span>).GetComponent&lt;Text&gt;();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 进入状态时更改Text显示</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"keyword\">override</span> <span class=\"keyword\">void</span> _OnEnter(<span class=\"keyword\">params</span> <span class=\"built_in\">object</span>[] objects) &#123;</span><br><span class=\"line\">            StateShower.text = <span class=\"string\">&quot;StateA&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 按P在控制台打印当前状态，按C转换状态</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"keyword\">override</span> <span class=\"keyword\">void</span> _OnUpdate() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Input.GetKeyDown(KeyCode.P)) &#123;</span><br><span class=\"line\">                Debug.Log(<span class=\"string\">&quot;Now in state A.&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (Input.GetKeyDown(KeyCode.C)) &#123;</span><br><span class=\"line\">                StateMachine.ChangeState(StateB.Instance);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">class</span> <span class=\"title\">StateB</span> : <span class=\"title\">StateBase</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Text StateShower;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> StateB _instance;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> StateB Instance &#123; <span class=\"keyword\">get</span> &#123; <span class=\"keyword\">return</span> _instance; &#125; &#125;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">StateB</span>()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == _instance) &#123;</span><br><span class=\"line\">                _instance = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            StateShower = GameObject.Find(<span class=\"string\">&quot;StateShower&quot;</span>).GetComponent&lt;Text&gt;();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 进入状态时更改Text显示</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"keyword\">override</span> <span class=\"keyword\">void</span> _OnEnter(<span class=\"keyword\">params</span> <span class=\"built_in\">object</span>[] objects) &#123;</span><br><span class=\"line\">            StateShower.text = <span class=\"string\">&quot;StateB&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 按P在控制台打印当前状态，按C转换状态</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"keyword\">override</span> <span class=\"keyword\">void</span> _OnUpdate() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Input.GetKeyDown(KeyCode.P)) &#123;</span><br><span class=\"line\">                Debug.Log(<span class=\"string\">&quot;Now in state B.&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (Input.GetKeyDown(KeyCode.C)) &#123;</span><br><span class=\"line\">                StateMachine.ChangeState(StateA.Instance);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在游戏场景中添加一个空游戏物体，添加StateMachineTest脚本组件。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/%E4%B8%80%E7%A7%8D%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/StateMachineTest%E7%89%A9%E4%BD%93%E9%85%8D%E7%BD%AE.png\" alt=\"StateMachineTest物体配置.png\"></p>\n<p>再新建画布，在其中添加一个Text控件，命名为StateShower。主要用于当前状态的显示。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/%E4%B8%80%E7%A7%8D%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/StateShower%E7%89%A9%E4%BD%93%E9%85%8D%E7%BD%AE.png\" alt=\"StateShower物体配置.png\"></p>\n<p>运行，按C键即可在A和B状态间切换，按P键在控制台打印当前状态。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/Unity/%E4%B8%80%E7%A7%8D%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C.png\" alt=\"运行效果.png\"></p>\n","categories":["Unity"],"tags":["C#"]},{"title":"Docker基础","url":"/%E7%AC%94%E8%AE%B0/%E5%85%B6%E4%BB%96/Docker%E5%9F%BA%E7%A1%80/","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>Docker产生背景：</p>\n<ul>\n<li>不同开发角色因软件运行环境（操作系统、软件环境或引用配置等）不同而导致的矛盾。</li>\n<li>集群环境下每个节点都需要配置相同的环境。</li>\n</ul>\n<p>Docker是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可以只的容器中，然后发布到任何流行的Linux机器上，也可以实现虚拟化。</p>\n<p>相对于虚拟机模拟一个完成的操作系统，Docker并非模拟一个完整操作系统，没有硬件的虚拟，而是<strong>对进程进行隔离</strong>，从而更轻便高效。</p>\n<p>容器使用的是沙箱机制，互相隔离，独立安全</p>\n<p>可将容器看做是一个简易版的Linux环境，包括用户权限、文件系统和隐形的应用等。</p>\n<p><a href=\"https://www.docker.com/\">Docker官网</a></p>\n<p>利用Docker，可以做到：</p>\n<ul>\n<li>将软件及其运行环境打包成一个镜像Image并发布（到Docker仓库）</li>\n<li>从Docker仓库下载获取镜像，运行后即可获取同样的环境（容器）。</li>\n</ul>\n<h3 id=\"基本术语\"><a href=\"#基本术语\" class=\"headerlink\" title=\"基本术语\"></a>基本术语</h3><ul>\n<li>Docker主机（Host）。安装了Docker程序的主机，运行Docker守护进程。</li>\n<li>Docker镜像（Image）。将软件及其运行环境打包好的模板，用于创建容器，一个镜像可创建多个容器。</li>\n<li>Docker容器（Container）。运行镜像后生成的实例。每运行一次镜像就会产生一个容器，容器可以启动、停止或删除。</li>\n<li>Docker仓库（Repository）。用于保存镜像，其中包含了许多镜像，每个镜像都有不同的标签Tag，一般就是表示不同的软件版本。<a href=\"https://hub.docker.com/\">Docker官方仓库</a></li>\n</ul>\n<h2 id=\"Hello-World\"><a href=\"#Hello-World\" class=\"headerlink\" title=\"Hello World\"></a>Hello World</h2><p>有两种方式安装Docker</p>\n<p>一个是使用官方脚本自动安装</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br></pre></td></tr></table></figure>\n\n<p>也可以使用国内 daocloud 一键安装命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl -sSL https://get.daocloud.io/docker | sh</span><br></pre></td></tr></table></figure>\n\n<p>另一个是手动安装</p>\n<p>较旧的 Docker 版本称为 docker 或 docker-engine 。如果已安装这些程序，需要卸载它们以及相关的依赖项。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum remove docker \\</span><br><span class=\"line\">    docker-client \\</span><br><span class=\"line\">    docker-client-latest \\</span><br><span class=\"line\">    docker-common \\</span><br><span class=\"line\">    docker-latest \\</span><br><span class=\"line\">    docker-latest-logrotate \\</span><br><span class=\"line\">    docker-logrotate \\</span><br><span class=\"line\">    docker-engine</span><br></pre></td></tr></table></figure>\n\n<p>在新主机上首次安装 Docker Engine-Community 之前，需要设置 Docker 仓库。之后可以从仓库安装和更新 Docker。</p>\n<p>安装所需的软件包。yum-utils 提供了 yum-config-manager ，并且 device mapper 存储驱动程序需要 device-mapper-persistent-data 和 lvm2</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y yum-utils \\</span><br><span class=\"line\">    device-mapper-persistent-data \\</span><br><span class=\"line\">    lvm2</span><br></pre></td></tr></table></figure>\n\n<p>使用以下命令来设置稳定的仓库</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 官方源地址</span></span><br><span class=\"line\">yum-config-manager \\</span><br><span class=\"line\">    --add-repo \\</span><br><span class=\"line\">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>\n\n<p>可以选择国内的一些源地址</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 阿里云</span></span><br><span class=\"line\">yum-config-manager \\</span><br><span class=\"line\">    --add-repo \\</span><br><span class=\"line\">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class=\"line\"><span class=\"comment\"># 清华大学源</span></span><br><span class=\"line\">yum-config-manager \\</span><br><span class=\"line\">    --add-repo \\</span><br><span class=\"line\">    https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>\n\n<p>安装 Docker Engine-Community</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install docker-ce docker-ce-cli containerd.io</span><br><span class=\"line\"><span class=\"comment\"># 需要接受GPG秘钥</span></span><br></pre></td></tr></table></figure>\n\n<p>一些命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker version <span class=\"comment\"># 查看Docker版本</span></span><br><span class=\"line\">systemctl start docker <span class=\"comment\"># 启动Docker</span></span><br><span class=\"line\">systemctl stop docker <span class=\"comment\"># 停止Docker</span></span><br><span class=\"line\">systemctl status docker <span class=\"comment\"># 查看Docker状态</span></span><br><span class=\"line\">systemctl restart docker <span class=\"comment\"># 重启Docker</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> docker <span class=\"comment\"># 设置开机自动启动</span></span><br></pre></td></tr></table></figure>\n\n<p>运行命令，验证安装成功</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run hello-world</span><br></pre></td></tr></table></figure>\n\n<p>默认镜像仓库在国外，可能会比较慢，可设置镜像仓库</p>\n<p>修改daemon配置文件&#x2F;etc&#x2F;docker&#x2F;daemon.json</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;registry-mirrors&quot;: [&quot;https://g45y6ux6.mirror.aliyuncs.com&quot;]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>之后，重启守护进程和docker</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<p>另外几个常用的镜像</p>\n<ul>\n<li>科大镜像：<a href=\"https://docker.mirrors.ustc.edu.cn/\">https://docker.mirrors.ustc.edu.cn/</a></li>\n<li>网易：<a href=\"https://hub-mirror.c.163.com/\">https://hub-mirror.c.163.com/</a></li>\n<li>七牛云加速器：<a href=\"https://reg-mirror.qiniu.com/\">https://reg-mirror.qiniu.com</a></li>\n</ul>\n<h2 id=\"操作\"><a href=\"#操作\" class=\"headerlink\" title=\"操作\"></a>操作</h2><p>常用的几个镜像操作</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">命令</th>\n<th align=\"left\">作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">docker search 关键字</td>\n<td align=\"left\">查找镜像，默认从Docker Hub里找信息</td>\n</tr>\n<tr>\n<td align=\"left\">docker pull 镜像名:tag</td>\n<td align=\"left\">拉取下载镜像，tag表示软件版本，不指定则为latest</td>\n</tr>\n<tr>\n<td align=\"left\">docker images</td>\n<td align=\"left\">查看所有本地镜像</td>\n</tr>\n<tr>\n<td align=\"left\">docker inspect 镜像ID</td>\n<td align=\"left\">获取镜像的元信息，详细信息</td>\n</tr>\n<tr>\n<td align=\"left\">docker rmi 镜像ID或镜像名:tag</td>\n<td align=\"left\">删除指定镜像</td>\n</tr>\n<tr>\n<td align=\"left\">docker history 镜像ID或镜像名:tag</td>\n<td align=\"left\">查看镜像的变更历史</td>\n</tr>\n</tbody></table>\n<p>常用的几个容器操作</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">命令</th>\n<th align=\"left\">作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">docker run 镜像ID或镜像名:tag</td>\n<td align=\"left\">创建并启动容器。参数太多了，下面单开一个表说明</td>\n</tr>\n<tr>\n<td align=\"left\">docker ps -a -q</td>\n<td align=\"left\">查看正在运行的容器，-a 查看所有容器，包括未运行的，-q 只显示容器ID</td>\n</tr>\n<tr>\n<td align=\"left\">docker start 容器ID或容器名称</td>\n<td align=\"left\">启动容器</td>\n</tr>\n<tr>\n<td align=\"left\">docker stop 容器ID或容器名称</td>\n<td align=\"left\">停止正在运行的容器</td>\n</tr>\n<tr>\n<td align=\"left\">docker rm -f 容器ID或容器名称</td>\n<td align=\"left\">删除容器，-f强制删除</td>\n</tr>\n<tr>\n<td align=\"left\">docker logs 容器ID或容器名称</td>\n<td align=\"left\">查看容器的日志</td>\n</tr>\n<tr>\n<td align=\"left\">docker exec -it 容器ID或容器名称 &#x2F;bin&#x2F;bash</td>\n<td align=\"left\">进入正在运行的容器中并开启一个交互模式的终端，可在容器中执行操作</td>\n</tr>\n<tr>\n<td align=\"left\">docker cp 主机中的文件路径 容器ID或容器名称:容器路径</td>\n<td align=\"left\">将主机中文件拷贝到容器中。反过来的话，将路径对调就行</td>\n</tr>\n<tr>\n<td align=\"left\">docker inspect 容器ID或容器名称</td>\n<td align=\"left\">查看容器的元信息</td>\n</tr>\n</tbody></table>\n<p>docker run 常用参数含义</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">–name 容器名</td>\n<td align=\"left\">指定容器名，不指定则自动命名</td>\n</tr>\n<tr>\n<td align=\"left\">-i</td>\n<td align=\"left\">以交互模式运行容器</td>\n</tr>\n<tr>\n<td align=\"left\">-t</td>\n<td align=\"left\">分配一个伪终端，即命令行，通常组合使用 -it</td>\n</tr>\n<tr>\n<td align=\"left\">-d</td>\n<td align=\"left\">以守护进程方式运行</td>\n</tr>\n<tr>\n<td align=\"left\">-p 主机端口:容器端口</td>\n<td align=\"left\">指定端口映射，将主机端口映射到容器内的端口</td>\n</tr>\n<tr>\n<td align=\"left\">-v 主机文件路径:容器文件路径(:ro)</td>\n<td align=\"left\">设置文件挂载，加ro表示容器内的文件设为只读模式</td>\n</tr>\n<tr>\n<td align=\"left\">-e ENV_VAR&#x3D;value</td>\n<td align=\"left\">设置环境变量</td>\n</tr>\n</tbody></table>\n<p><strong>docker容器相当一个轻量级的Linux运行环境</strong></p>\n<p>进程不是直接在host运行的，所以有几个问题</p>\n<h3 id=\"端口映射\"><a href=\"#端口映射\" class=\"headerlink\" title=\"端口映射\"></a>端口映射</h3><p>对于一些会提供web相关服务的进程，进程对外提供的端口是相对于容器，而非host主机，而在网络上则只能直接访问主机，所以端口需要映射，使用如下命令直接设置</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run --name 容器名 -p 主机端口:容器端口</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"文件拷贝和挂载目录\"><a href=\"#文件拷贝和挂载目录\" class=\"headerlink\" title=\"文件拷贝和挂载目录\"></a>文件拷贝和挂载目录</h3><p>容器内的Linux环境是没装vi编辑器的，想修改容器内文件的话，可以在主机中先编辑好文件，再用命令将文件复制到容器中。</p>\n<p>有些场景下，容器内进程的文件需要反复修改调试，总是拷贝会非常麻烦，可以设置挂载目录，将host主机中的目录挂载到容器，容器中进程可直接访问到主机目录。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">可以挂载文件或者文件目录</span></span><br><span class=\"line\">docker run --name 容器名 -v 主机文件路径:容器文件路径</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"镜像结构\"><a href=\"#镜像结构\" class=\"headerlink\" title=\"镜像结构\"></a>镜像结构</h2><p>镜像是一种轻量级、可执行的独立软件包，<strong>用来打包软件运行环境和基于运行环境的软件，包含运行某个软件多需要的所有内容</strong>。</p>\n<p>基于UnionFS联合文件系统，采用分层结构。例如对于Tomcat镜像，其的分层可以大致分为：Kernel-&gt;centOS-&gt;JDK-&gt;Tomcat</p>\n<p>使用分层结构的好处在于共享资源、便于复用（许多镜像都是从相同的Base基础镜像构建而来的，基础镜像只需要保存一份）</p>\n<p>镜像都是只读的，由镜像生成的容器是可修改的</p>\n<h2 id=\"创建镜像\"><a href=\"#创建镜像\" class=\"headerlink\" title=\"创建镜像\"></a>创建镜像</h2><p>有时从Docker镜像仓库中下载的镜像不能满足我们的要求，此时可以基于这个镜像（基础镜像）封装一个自己的镜像。有两种方式：</p>\n<ul>\n<li>更新镜像：使用docker commit 命令</li>\n<li>构建镜像：使用docker build 命令，需要创建DockerFile文件</li>\n</ul>\n<h3 id=\"更新镜像\"><a href=\"#更新镜像\" class=\"headerlink\" title=\"更新镜像\"></a>更新镜像</h3><p>先使用基础镜像创建一个容器，然后对容器进行修改，最后使用commit命令提交为一个新的镜像。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">Usage:  docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span><br><span class=\"line\"></span><br><span class=\"line\">Create a new image from a container&#x27;s changes. 从一个以改动的容器创建一个镜像。</span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\">  -a, --author string    Author (e.g., &quot;John Hannibal Smith &lt;hannibal@a-team.com&gt;&quot;) 作者信息。</span><br><span class=\"line\">  -c, --change list      Apply Dockerfile instruction to the created image 使用Dockerfile中的命令后生成镜像。</span><br><span class=\"line\">  -m, --message string   Commit message. 提交描述。</span><br><span class=\"line\">  -p, --pause            Pause container during commit (default true). 提交时将容器暂停，默认为真。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"构建镜像\"><a href=\"#构建镜像\" class=\"headerlink\" title=\"构建镜像\"></a>构建镜像</h3><p>根据Dockerfile文件来自动构建镜像。</p>\n<p>举例，将默认Tomcat镜像的主页更改，构建新镜像，编辑DockerFile如下</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">基础镜像</span></span><br><span class=\"line\">FROM tomcat</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">作者信息</span></span><br><span class=\"line\">MAINTAINER Adam</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">执行命令</span></span><br><span class=\"line\">RUN rm -f /usr/local.tomcat/webapps/ROOT/index.jsp</span><br><span class=\"line\">RUN echo &quot;welcome to tomcat!&quot; &gt; /usr/local/tomcat/webapps/ROOT/index.html</span><br></pre></td></tr></table></figure>\n\n<p>构建新镜像，命令如下</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">docker build -f Dockerfile文件 -t 镜像名:tag 命令执行的上下文</span></span><br><span class=\"line\">docker build -f ./Dockerfile -t Adam/tomcat:v2 .</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Dockerfile详解\"><a href=\"#Dockerfile详解\" class=\"headerlink\" title=\"Dockerfile详解\"></a>Dockerfile详解</h2><p>Dockerfile是用来构建Docker镜像的文件，由一系列命令和参数构成的脚本。</p>\n<h3 id=\"语法规则\"><a href=\"#语法规则\" class=\"headerlink\" title=\"语法规则\"></a>语法规则</h3><ul>\n<li>文件开头必须使用FROM指令，指定基础镜像</li>\n<li>指令大写，且每个指令都有参数，指令顺序执行</li>\n<li>每条指令都会创建一个新的镜像层并提交</li>\n<li><code>#</code>表示注释</li>\n</ul>\n<h3 id=\"常用指令\"><a href=\"#常用指令\" class=\"headerlink\" title=\"常用指令\"></a>常用指令</h3><table>\n<thead>\n<tr>\n<th align=\"left\">指令</th>\n<th align=\"left\">作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">FROM</td>\n<td align=\"left\">指定基础镜像</td>\n</tr>\n<tr>\n<td align=\"left\">MAINTAINER</td>\n<td align=\"left\">标明作者</td>\n</tr>\n<tr>\n<td align=\"left\">RUN</td>\n<td align=\"left\">构建过程中要运行的命令</td>\n</tr>\n<tr>\n<td align=\"left\">ENV</td>\n<td align=\"left\">设置环境变量</td>\n</tr>\n<tr>\n<td align=\"left\">WORKDIR</td>\n<td align=\"left\">指定默认的工作目录，即进入容器后默认进入的目录</td>\n</tr>\n<tr>\n<td align=\"left\">VOLUME</td>\n<td align=\"left\">创建挂载点，也称容器数据卷。但无法指定宿主机上对应的目录，其是自动生成的</td>\n</tr>\n<tr>\n<td align=\"left\">CMD</td>\n<td align=\"left\">指定容器启动时要运行的命令</td>\n</tr>\n<tr>\n<td align=\"left\">ENTRYPORT</td>\n<td align=\"left\">指定容器启动时要运行的命令</td>\n</tr>\n<tr>\n<td align=\"left\">COPY</td>\n<td align=\"left\">拷贝文件&#x2F;目录到镜像中</td>\n</tr>\n<tr>\n<td align=\"left\">ADD</td>\n<td align=\"left\">拷贝文件到镜像中，且会自动解压缩</td>\n</tr>\n<tr>\n<td align=\"left\">EXPOSE</td>\n<td align=\"left\">指定对外暴露的端口</td>\n</tr>\n</tbody></table>\n<p>CMD和ENTRYPOINT的区别：</p>\n<ul>\n<li>两个指定在Dockerfile中都是只有最后一条生效，之前的同类指令会被覆盖。</li>\n<li>CMD指令会被docker run 之后执行的参数覆盖。</li>\n<li>docker run之后的参数会被作为ENTRYPOINT的参数，组合成一个新的命令。</li>\n</ul>\n<p>例如Dockerfile中写了如下ENTRYPOINT指令</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">ENTRYPOINT [&quot;/bin/ls&quot;,&quot;/usr/local&quot;]</span><br></pre></td></tr></table></figure>\n\n<p>以数组的形式排列命令和参数</p>\n<p>在启动容器时添加了参数</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run -it imageName -l</span><br></pre></td></tr></table></figure>\n\n<p>最后在容器中实际执行的命令，就是</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">/bin/ls /usr/local -l</span><br></pre></td></tr></table></figure>\n\n<p>COPY和ADD</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">拷贝文件，文件必须在Dockerfile的同目录或子目录</span></span><br><span class=\"line\">COPY readme.txt /usr/local</span><br><span class=\"line\">ADD jdk-8u191-linux-x64.tar.gz /usr/local</span><br></pre></td></tr></table></figure>\n","categories":["Docker"]},{"title":"Git的一些回退操作","url":"/%E7%AC%94%E8%AE%B0/%E5%85%B6%E4%BB%96/Git%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9B%9E%E9%80%80%E6%93%8D%E4%BD%9C/","content":"<h2 id=\"Git的一些回退操作\"><a href=\"#Git的一些回退操作\" class=\"headerlink\" title=\"Git的一些回退操作\"></a>Git的一些回退操作</h2><h3 id=\"git-checkout\"><a href=\"#git-checkout\" class=\"headerlink\" title=\"git checkout\"></a>git checkout</h3><figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">git checkout [file]</span><br></pre></td></tr></table></figure>\n\n<p>如果文件修改后未存入暂存区，回退到最近一次commit的状态；如果之前存入过暂存区，之后又修改过，则回退到暂存区的状态。</p>\n<p>可用通配符<code>.</code>匹配所有文件</p>\n<h3 id=\"git-reset\"><a href=\"#git-reset\" class=\"headerlink\" title=\"git reset\"></a>git reset</h3><figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">git reset [file]</span><br></pre></td></tr></table></figure>\n\n<p>将暂存区中的内容回退到最近一次commit的状态</p>\n<p>同样地，也可用通配符<code>.</code>匹配所有文件</p>\n<p>如果加上指定的commitID</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">git reset commitID [file]</span><br></pre></td></tr></table></figure>\n\n<p>则除了将暂存区中的内容回退到此commitID的提交内容，库的HEAD也会指向此commitID的提交。</p>\n<p>实际上述命令省略了表明影响范围的参数mixed，参数可选hard、soft、mixed，不指定的话，默认用的是mixed。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">git reset --mixed commitID [file]</span><br></pre></td></tr></table></figure>\n\n<p>三种参数的区别是：</p>\n<ul>\n<li>soft：只改变库</li>\n<li>mixed：改变库和暂存区内容</li>\n<li>hard：库、暂存区、工作区的内容都会改变</li>\n</ul>\n<h3 id=\"HEAD\"><a href=\"#HEAD\" class=\"headerlink\" title=\"HEAD\"></a>HEAD</h3><p>HEAD类似于一个指针，多数时候可以理解为最近一次提交，但前文提到的git reset命令就可以更改此HEAD所指向的提交。</p>\n<p><code>HEAD^</code>或<code>HEAD~</code>表示HEAD的上次提交，<code>HEAD^^</code>表示HEAD的上上次提交，以此类推可在HEAD后继续加<code>^</code>符号。也可以用数字表示，例如<code>HEAD^3</code>和<code>HEAD^^^</code>等价。</p>\n<p>所以，如果对文件做了一些不想要的修改，并且已经提交了，就可使用</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">git reset HEAD^ .</span><br></pre></td></tr></table></figure>\n\n<p>来回到上次提交的状态。</p>\n<h3 id=\"git-revert\"><a href=\"#git-revert\" class=\"headerlink\" title=\"git revert\"></a>git revert</h3><p>如果已将改动push到了远程，但想抛弃这次改动。</p>\n<p>有一种方式是，先在本地库使用<code>git reset</code>回退内容。然后使用</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">git push origin HEAD --force</span><br></pre></td></tr></table></figure>\n\n<p>强制将改动推送到远程。</p>\n<p>但这种方式会<strong>清空远程提交历史</strong>，非常不推荐。</p>\n<p>另一种方式是使用</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">git revert commitID</span><br></pre></td></tr></table></figure>\n\n<p>将撤销作为了一次提交进行保存，再push到远程。</p>\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><p>有时会看到这种命令</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">git checkout -- . </span><br></pre></td></tr></table></figure>\n\n<p>貌似和<code>git checkout .</code>没有任何区别。中间的<code>--</code>是什么作用？</p>\n<p><code>--</code>是一个常见的命令行参数分隔符，其作用在于明确指示命令行解析器，在<code>--</code>后的所有内容都应被视为参数或路径名，而不是可能的命令选项（即不会被解释为命令的标志或选项）。</p>\n<p>例如，有一个名为<code>-b</code>的文件，如果想检出这个文件，直接运行<code>git checkout -b</code>可能会被Git解释为尝试创建一个新分支而非检出文件，因为<code>-b</code>是用于创建新分支的选项。在此情况下，可使用<code>git checkout -- -b</code>来明确指出<code>-b</code>是文件名而不是选项。</p>\n","categories":["Git"]},{"title":"Git笔记","url":"/%E7%AC%94%E8%AE%B0/%E5%85%B6%E4%BB%96/Git%E7%AC%94%E8%AE%B0/","content":"<h2 id=\"版本控制系统\"><a href=\"#版本控制系统\" class=\"headerlink\" title=\"版本控制系统\"></a>版本控制系统</h2><p>Version Control System，简称为VCS，版本控制系统是一种记录一个或多个文件的内容变化，以便将来查阅特定版本内容变化情况的系统</p>\n<p>简单来说，就是用来保存文件变更记录的系统，可以将文件回退到过去某个时间点的状态</p>\n<h3 id=\"作用\"><a href=\"#作用\" class=\"headerlink\" title=\"作用\"></a>作用</h3><ul>\n<li>查阅文件的修改记录，如：修改者、修改时间、修改的文件内容等</li>\n<li>对比不同版本中文件的变化细节</li>\n<li>将文件回溯到之前的某个状态</li>\n</ul>\n<h3 id=\"种类\"><a href=\"#种类\" class=\"headerlink\" title=\"种类\"></a>种类</h3><ul>\n<li>本地版本控制系统<ul>\n<li>版本库存放在本地磁盘上</li>\n<li>缺点：无法协同开发</li>\n</ul>\n</li>\n<li>集中化版本控制系统<ul>\n<li>版本库集中存放在中央副武器上，所有参与人员都连接到该服务器，实现协同开发</li>\n<li>缺点：自己电脑上没有版本库，本地无法进行版本管理，必须连接中央副武器才能进行版本控制，如果中央服务器宕机，则无法工作</li>\n<li>代表应用：SubVersion（SVN）</li>\n</ul>\n</li>\n<li>分布式版本控制系统<ul>\n<li>每个人的电脑上都是一个完整的版本库，在本地上就可以进行版本管理，无需联网，但一般都会通过远程仓库来交换版本的修改</li>\n<li>代表应用：Git</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Git简介\"><a href=\"#Git简介\" class=\"headerlink\" title=\"Git简介\"></a>Git简介</h2><p>Git就是一个开源的分布式版本控制系统，用来进行项目版本管理</p>\n<p>即由一组命令组成，能够对项目代码进行版本控制的一个软件</p>\n<h3 id=\"工作流程\"><a href=\"#工作流程\" class=\"headerlink\" title=\"工作流程\"></a>工作流程</h3><p>基本流程：</p>\n<ol>\n<li>使用git命令将远程仓库上的文件克隆到本地仓库中</li>\n<li>从本地仓库中检出文件到工作区（一般都自动完成）</li>\n<li>将新创建的文件添加到暂存区</li>\n<li>将暂存区中的内容提交到本地仓库</li>\n<li>将本地仓库中的内容推送到远程仓库上</li>\n</ol>\n<h3 id=\"安装Git\"><a href=\"#安装Git\" class=\"headerlink\" title=\"安装Git\"></a>安装Git</h3><p>官网：<a href=\"https://git-scm.com/\">Git</a></p>\n<p>Linux 和 MacOS一般自带git</p>\n<h3 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h3><p>对Git进行初始化配置</p>\n<p>定义当前系统git使用者的名称额邮箱，提交代码时显示名字和邮箱</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">git config --global user.name &quot;MPasser&quot;</span><br><span class=\"line\">git config --global user.email &quot;ressap2018@163.com&quot;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Git使用\"><a href=\"#Git使用\" class=\"headerlink\" title=\"Git使用\"></a>Git使用</h2><h3 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h3><table>\n<thead>\n<tr>\n<th align=\"center\">命令</th>\n<th align=\"center\">作用</th>\n<th align=\"left\">备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">git init</td>\n<td align=\"center\">初始化本地Git仓库（项目）</td>\n<td align=\"left\">会在当前目录中创建一个.git目录，用于记录所有版本变更信息</td>\n</tr>\n<tr>\n<td align=\"center\">git status</td>\n<td align=\"center\">查看本地仓库的文件状态</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"center\">git add 文件路径</td>\n<td align=\"center\">将文件添加到跟踪列表（暂存区），交由git托管</td>\n<td align=\"left\">-A 或 –all 或 . 表示添加所有文件，也可以使用 * 进行匹配</td>\n</tr>\n<tr>\n<td align=\"center\">git commit</td>\n<td align=\"center\">将跟踪列表中的文件提交到本地仓库</td>\n<td align=\"left\">-m 指定提交日志</td>\n</tr>\n<tr>\n<td align=\"center\">git log</td>\n<td align=\"center\">查看提交日志</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"center\">git reset –hard 版本id</td>\n<td align=\"center\">回退到指定版本</td>\n<td align=\"left\">用git log查看版本id，HEAD表示当前的版本。–hard表示工作区、暂存区和本地仓库版本全部回退</td>\n</tr>\n</tbody></table>\n<h3 id=\"文件状态\"><a href=\"#文件状态\" class=\"headerlink\" title=\"文件状态\"></a>文件状态</h3><p>Git 文件的四种状态：</p>\n<ul>\n<li>untracked，未跟踪，表示文件不受git管理，一般新建的文件出于该状态 Untracked files</li>\n<li>staged，已暂存，表示对修改的文件做了标记，使之包含在下次要提交的文件跟踪列表中 Changes to be committed</li>\n<li>modified，已修改，表示文件内容已被修改，但没有做标记 Changes not staged for commit</li>\n<li>committed，已提交，表示文件已经被提交到本地仓库</li>\n</ul>\n<h3 id=\"忽略文件\"><a href=\"#忽略文件\" class=\"headerlink\" title=\"忽略文件\"></a>忽略文件</h3><p>可以在git仓库的根目录下添加一个名为.gitignore的文件，用于指定需要被git忽略的文件或文件夹</p>\n<ul>\n<li>文件名必须是 .gitignore</li>\n<li>文件必须在项目的根目录下</li>\n<li>每行指定一个文件忽略规则</li>\n<li>以#开头的表示注释</li>\n</ul>\n<h2 id=\"远程仓库\"><a href=\"#远程仓库\" class=\"headerlink\" title=\"远程仓库\"></a>远程仓库</h2><h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>基于Git的代码托管平台，常用的Git仓库：</p>\n<ul>\n<li><a href=\"https://github.com/\">GitHub</a></li>\n<li><a href=\"https://gitee.com/\">码云</a></li>\n</ul>\n<h3 id=\"操作\"><a href=\"#操作\" class=\"headerlink\" title=\"操作\"></a>操作</h3><p>步骤：</p>\n<ul>\n<li>注册账号、创建仓库</li>\n<li>添加远程仓库的地址</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">git remote add origin https://github.com/MPasser/Testing.git</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>将本地仓库的提交记录推送到远程仓库的master分支</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">git push origin master</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>拉取远端master分支的更新记录到本地</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">git pull origin master</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th align=\"center\">命令</th>\n<th align=\"center\">作用</th>\n<th align=\"left\">备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">git remote add 仓库别名 远程仓库地址</td>\n<td align=\"center\">添加远程仓库地址</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"center\">git remote -v</td>\n<td align=\"center\">查看远程仓库信息</td>\n<td align=\"left\">fetch抓取、push推送</td>\n</tr>\n<tr>\n<td align=\"center\">git remote rm 名称</td>\n<td align=\"center\">删除远程仓库信息</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"center\">git push 名称 分支</td>\n<td align=\"center\">将本地仓库指定分支推送到远程仓库</td>\n<td align=\"left\">一般为master主分支，默认推送到远程仓库的同名分支，没有则新建</td>\n</tr>\n<tr>\n<td align=\"center\">git pull 名称 分支</td>\n<td align=\"center\">拉取远程仓库指定分支中新的数据到本地</td>\n<td align=\"left\">会与本地进行merge合并</td>\n</tr>\n<tr>\n<td align=\"center\">git clone 远程仓库地址</td>\n<td align=\"center\">克隆远程仓库的项目到本地</td>\n<td align=\"left\">用于从远端第一次下载git项目</td>\n</tr>\n</tbody></table>\n<p>git clone 和 git pull区别：</p>\n<ul>\n<li>clone是没有本地仓库时，将远端的整个项目下载过来</li>\n<li>pull是有本地仓库时，将远端仓库里新的数据更新过来，并且与本地代码进行merge合并操作</li>\n</ul>\n<h2 id=\"分支Branch\"><a href=\"#分支Branch\" class=\"headerlink\" title=\"分支Branch\"></a>分支Branch</h2><p>分支就是版本上的更新迭代，初始默认只有master主分支</p>\n<p>可以从主分支上分离出其他的分支，各分支之间互不干扰</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">命令</th>\n<th align=\"center\">作用</th>\n<th align=\"left\">备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">git branch</td>\n<td align=\"center\">显示所有分支</td>\n<td align=\"left\">初始默认只有master分支</td>\n</tr>\n<tr>\n<td align=\"center\">git branch 分支名</td>\n<td align=\"center\">创建分支</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"center\">git checkout 分支名</td>\n<td align=\"center\">切换分支</td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<h2 id=\"静态页面托管\"><a href=\"#静态页面托管\" class=\"headerlink\" title=\"静态页面托管\"></a>静态页面托管</h2><p>GitHub和码云提供了免费的静态网页托管服务，可以托管个人的静态网页。提供了两种方式，一种带二级目录；另一种不带二级目录</p>\n<ul>\n<li>带二级目录，步骤：<ul>\n<li>创建仓库</li>\n<li>本地静态资源推送到远程仓库，必须提供index.html页面</li>\n<li>选择pages服务</li>\n<li>访问生成地址</li>\n</ul>\n</li>\n<li>不带二级目录<ul>\n<li>创建一个与个人空间地址同名的仓库</li>\n</ul>\n</li>\n</ul>\n","categories":["Git"]},{"title":"Markdown基础语法","url":"/%E7%AC%94%E8%AE%B0/%E5%85%B6%E4%BB%96/Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/","content":"<h2 id=\"关于标题\"><a href=\"#关于标题\" class=\"headerlink\" title=\"关于标题\"></a>关于标题</h2><figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># 一级标题</span></span><br><span class=\"line\"><span class=\"section\">## 二级标题</span></span><br><span class=\"line\"><span class=\"section\">### 三级标题</span></span><br><span class=\"line\"><span class=\"section\">#### 四级标题</span></span><br><span class=\"line\"><span class=\"section\">##### 五级标题</span></span><br><span class=\"line\"><span class=\"section\">###### 六级标题</span></span><br><span class=\"line\"><span class=\"section\">####### 七级标题</span></span><br></pre></td></tr></table></figure>\n\n<p>效果如下：</p>\n<h1 id=\"一级标题\"><a href=\"#一级标题\" class=\"headerlink\" title=\"一级标题\"></a>一级标题</h1><h2 id=\"二级标题\"><a href=\"#二级标题\" class=\"headerlink\" title=\"二级标题\"></a>二级标题</h2><h3 id=\"三级标题\"><a href=\"#三级标题\" class=\"headerlink\" title=\"三级标题\"></a>三级标题</h3><h4 id=\"四级标题\"><a href=\"#四级标题\" class=\"headerlink\" title=\"四级标题\"></a>四级标题</h4><h5 id=\"五级标题\"><a href=\"#五级标题\" class=\"headerlink\" title=\"五级标题\"></a>五级标题</h5><h6 id=\"六级标题\"><a href=\"#六级标题\" class=\"headerlink\" title=\"六级标题\"></a>六级标题</h6><p>####### 七级标题</p>\n<p>所以最多支持六级标题。</p>\n<h2 id=\"插入列表\"><a href=\"#插入列表\" class=\"headerlink\" title=\"插入列表\"></a>插入列表</h2><figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">-</span> 生物</span><br><span class=\"line\"><span class=\"bullet\">  -</span> 植物</span><br><span class=\"line\"><span class=\"bullet\">    -</span> 白菜</span><br><span class=\"line\"><span class=\"bullet\">      -</span> 毛白菜</span><br><span class=\"line\"><span class=\"bullet\">      -</span> 圆白菜</span><br><span class=\"line\"><span class=\"bullet\">  -</span> 动物</span><br><span class=\"line\"><span class=\"bullet\">    -</span> 哺乳类</span><br><span class=\"line\"><span class=\"bullet\">    -</span> 灵长类</span><br><span class=\"line\"><span class=\"bullet\">  -</span> 微生物</span><br><span class=\"line\"><span class=\"bullet\">    -</span> 细菌</span><br><span class=\"line\"><span class=\"bullet\">    -</span> 真菌</span><br><span class=\"line\"><span class=\"bullet\">-</span> 静物</span><br></pre></td></tr></table></figure>\n\n<p>效果如下：</p>\n<ul>\n<li>生物<ul>\n<li>植物<ul>\n<li>白菜<ul>\n<li>毛白菜</li>\n<li>圆白菜</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>动物<ul>\n<li>哺乳类</li>\n<li>灵长类</li>\n</ul>\n</li>\n<li>微生物<ul>\n<li>细菌</li>\n<li>真菌</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>静物</li>\n</ul>\n<h2 id=\"插入超链接\"><a href=\"#插入超链接\" class=\"headerlink\" title=\"插入超链接\"></a>插入超链接</h2><figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">百度 (https://www.baidu.com)</span>](<span class=\"link\">https://www.baidu.com</span>)</span><br></pre></td></tr></table></figure>\n\n<p>效果如下：</p>\n<p><a href=\"https://www.baidu.com/\">百度 (https://www.baidu.com)</a></p>\n<h2 id=\"插入图片\"><a href=\"#插入图片\" class=\"headerlink\" title=\"插入图片\"></a>插入图片</h2><figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\">![<span class=\"string\">百度LOGO.gif</span>](<span class=\"link\">https://www.baidu.com/img/baidu_jgylogo3.gif</span>)</span><br></pre></td></tr></table></figure>\n\n<p>效果如下：</p>\n<p><img src=\"https://www.baidu.com/img/baidu_jgylogo3.gif\" alt=\"百度LOGO.gif\"></p>\n<h2 id=\"如何引用文字\"><a href=\"#如何引用文字\" class=\"headerlink\" title=\"如何引用文字\"></a>如何引用文字</h2><figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"quote\">&gt; 苟利国家生死以，岂因福祸避趋之。--林则徐</span></span><br></pre></td></tr></table></figure>\n\n<p>效果如下：</p>\n<blockquote>\n<p>苟利国家生死以，岂因福祸避趋之。–林则徐</p>\n</blockquote>\n<h2 id=\"行内修饰文字\"><a href=\"#行内修饰文字\" class=\"headerlink\" title=\"行内修饰文字\"></a>行内修饰文字</h2><figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\">普通文字，<span class=\"strong\">**强调文字**</span> ，<span class=\"emphasis\">*斜体文字*</span> ，~~删除的文字~~ ，<span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">&#x27;color : yellow&#x27;</span> &gt;</span></span>style加持的文字<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p>效果如下：</p>\n<p>普通文字，<strong>强调文字</strong> ，<em>斜体文字</em> ，<del>删除的文字</del> ，<span style='color : yellow' >style加持的文字</span></p>\n<h2 id=\"插入代码\"><a href=\"#插入代码\" class=\"headerlink\" title=\"插入代码\"></a>插入代码</h2><pre>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Hello World&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</pre>\n\n<p>效果如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Hello World&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"插入公式\"><a href=\"#插入公式\" class=\"headerlink\" title=\"插入公式\"></a>插入公式</h2><pre>\n$E = mc^2$\n</pre>\n\n<p>效果如下：</p>\n<p>$E &#x3D; mc^2$</p>\n<h2 id=\"分割线\"><a href=\"#分割线\" class=\"headerlink\" title=\"分割线\"></a>分割线</h2><pre>\nno\n\n---\n一般是紧接着在标题后使用。\n</pre>\n\n<p>效果如下：</p>\n<p>no</p>\n<hr>\n<p>一般是紧接着在标题后使用。</p>\n<h2 id=\"预定义\"><a href=\"#预定义\" class=\"headerlink\" title=\"预定义\"></a>预定义</h2><pre>\n&lt;pre&gt;\n这句话\n是预定义格式的效果\n&lt;/pre&gt;\n</pre>\n\n<p>效果如下：</p>\n<pre>\n这句话\n是预定义格式的效果\n</pre>\n\n<h2 id=\"有序列表\"><a href=\"#有序列表\" class=\"headerlink\" title=\"有序列表\"></a>有序列表</h2><pre>\n1. one\n2. e\n3. r\n</pre>\n\n<p>效果如下：</p>\n<ol>\n<li>one</li>\n<li>e</li>\n<li>r</li>\n</ol>\n<h2 id=\"表格\"><a href=\"#表格\" class=\"headerlink\" title=\"表格\"></a>表格</h2><pre>\n|name|价格|数量|\n|-|-|-|\n|香蕉|$1|5|\n|苹果|$1|6|\n|草莓|$1|7|\n\n|name|价格|数量|\n|:-:|:-|-:|\n|香蕉|$1|5|\n|苹果|$1|6|\n|草莓|$1|7|\n\n</pre>\n\n<p>效果如下：</p>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>价格</th>\n<th>数量</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>香蕉</td>\n<td>$1</td>\n<td>5</td>\n</tr>\n<tr>\n<td>苹果</td>\n<td>$1</td>\n<td>6</td>\n</tr>\n<tr>\n<td>草莓</td>\n<td>$1</td>\n<td>7</td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th align=\"center\">name</th>\n<th align=\"left\">价格</th>\n<th align=\"right\">数量</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">香蕉</td>\n<td align=\"left\">$1</td>\n<td align=\"right\">5</td>\n</tr>\n<tr>\n<td align=\"center\">苹果</td>\n<td align=\"left\">$1</td>\n<td align=\"right\">6</td>\n</tr>\n<tr>\n<td align=\"center\">草莓</td>\n<td align=\"left\">$1</td>\n<td align=\"right\">7</td>\n</tr>\n</tbody></table>\n<h2 id=\"折叠\"><a href=\"#折叠\" class=\"headerlink\" title=\"折叠\"></a>折叠</h2><p>网上查到的一个写法，但纯粹用的是HTML，用起来会很不安</p>\n<pre>\n&lt;details&gt;\n  &lt;summary&gt;点击查看详细内容&lt;/summary&gt;\n  &lt;h3&gt;标题&lt;/h3&gt;\n  &lt;p&gt;正文&lt;/p&gt;\n  \n### 标题\n\n正文\n\n- 11\n- 22\n\n&lt;/details&gt;\n</pre>\n\n<p>效果如下：</p>\n<details>\n  <summary>点击查看详细内容</summary>\n  <h3>标题</h3>\n  <p>正文</p>\n  \n<h3 id=\"标题\"><a href=\"#标题\" class=\"headerlink\" title=\"标题\"></a>标题</h3><p>正文</p>\n<ul>\n<li>11</li>\n<li>22</li>\n</ul>\n</details>\n","categories":["Markdown"]},{"title":"Markdown表达图片的几个方案","url":"/%E7%AC%94%E8%AE%B0/%E5%85%B6%E4%BB%96/Markdown%E8%A1%A8%E8%BE%BE%E5%9B%BE%E7%89%87%E7%9A%84%E5%87%A0%E4%B8%AA%E6%96%B9%E6%A1%88/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>作为纯文本文件，Markdown的通用性很强，但代价就是没法像Word那样让图片变成文档的一部分。图片只能游离于文档之外进行管理。</p>\n<p>不过Markdown的各种渲染器发展到现在，能展现的效果已经很丰富了，总是有一些替代方案。</p>\n<p>在此记录一下本人使用过的几种方案。</p>\n<h2 id=\"PlantUML\"><a href=\"#PlantUML\" class=\"headerlink\" title=\"PlantUML\"></a>PlantUML</h2><p><a href=\"https://plantuml.com/zh/\">PlantUML</a> 能用纯本文生成UML图表。例如文本如下：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">Alice -&gt; Bob: Authentication Request</span><br><span class=\"line\">Bob --&gt; Alice: Authentication Response</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob: Another authentication Request</span><br><span class=\"line\">Alice &lt;-- Bob: Another authentication Response</span><br></pre></td></tr></table></figure>\n\n<img src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjIwOHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6Mjk2cHg7aGVpZ2h0OjIwOHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI5NiAyMDgiIHdpZHRoPSIyOTZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxnPjx0aXRsZT5BbGljZTwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9IjEzNi41MzEzIiB3aWR0aD0iOCIgeD0iMjQuODMzNSIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjI4IiB4Mj0iMjgiIHkxPSIzNi4yOTY5IiB5Mj0iMTcyLjgyODEiLz48L2c+PGc+PHRpdGxlPkJvYjwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9IjEzNi41MzEzIiB3aWR0aD0iOCIgeD0iMjY2LjM4NjciIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSIyNjkuODU4NCIgeDI9IjI2OS44NTg0IiB5MT0iMzYuMjk2OSIgeTI9IjE3Mi44MjgxIi8+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJBbGljZSI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0Ny42NjciIHg9IjUiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMy42NjciIHg9IjEyIiB5PSIyNC45OTUxIj5BbGljZTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9IkFsaWNlIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQ3LjY2NyIgeD0iNSIgeT0iMTcxLjgyODEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMy42NjciIHg9IjEyIiB5PSIxOTEuODIzMiI+QWxpY2U8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJCb2IiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNDEuMDU2NiIgeD0iMjQ5Ljg1ODQiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNy4wNTY2IiB4PSIyNTYuODU4NCIgeT0iMjQuOTk1MSI+Qm9iPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1wYXJ0aWNpcGFudD0iQm9iIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQxLjA1NjYiIHg9IjI0OS44NTg0IiB5PSIxNzEuODI4MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI3LjA1NjYiIHg9IjI1Ni44NTg0IiB5PSIxOTEuODIzMiI+Qm9iPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBbGljZSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJCb2IiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjU4LjM4NjcsNjMuNDI5NywyNjguMzg2Nyw2Ny40Mjk3LDI1OC4zODY3LDcxLjQyOTcsMjYyLjM4NjcsNjcuNDI5NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyOC44MzM1IiB4Mj0iMjY0LjM4NjciIHkxPSI2Ny40Mjk3IiB5Mj0iNjcuNDI5NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1Mi45NTMxIiB4PSIzNS44MzM1IiB5PSI2Mi4zNjM4Ij5BdXRoZW50aWNhdGlvbiBSZXF1ZXN0PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJCb2IiIGRhdGEtcGFydGljaXBhbnQtMj0iQWxpY2UiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzkuODMzNSw5Mi41NjI1LDI5LjgzMzUsOTYuNTYyNSwzOS44MzM1LDEwMC41NjI1LDM1LjgzMzUsOTYuNTYyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjIsMjsiIHgxPSIzMy44MzM1IiB4Mj0iMjY5LjM4NjciIHkxPSI5Ni41NjI1IiB5Mj0iOTYuNTYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2Mi41ODI1IiB4PSI0NS44MzM1IiB5PSI5MS40OTY2Ij5BdXRoZW50aWNhdGlvbiBSZXNwb25zZTwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQWxpY2UiIGRhdGEtcGFydGljaXBhbnQtMj0iQm9iIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI1OC4zODY3LDEyMS42OTUzLDI2OC4zODY3LDEyNS42OTUzLDI1OC4zODY3LDEyOS42OTUzLDI2Mi4zODY3LDEyNS42OTUzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI4LjgzMzUiIHgyPSIyNjQuMzg2NyIgeTE9IjEyNS42OTUzIiB5Mj0iMTI1LjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMDcuOTIzOCIgeD0iMzUuODMzNSIgeT0iMTIwLjYyOTQiPkFub3RoZXIgYXV0aGVudGljYXRpb24gUmVxdWVzdDwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQm9iIiBkYXRhLXBhcnRpY2lwYW50LTI9IkFsaWNlIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM5LjgzMzUsMTUwLjgyODEsMjkuODMzNSwxNTQuODI4MSwzOS44MzM1LDE1OC44MjgxLDM1LjgzMzUsMTU0LjgyODEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iMzMuODMzNSIgeDI9IjI2OS4zODY3IiB5MT0iMTU0LjgyODEiIHkyPSIxNTQuODI4MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxNy41NTMyIiB4PSI0NS44MzM1IiB5PSIxNDkuNzYyMiI+QW5vdGhlciBhdXRoZW50aWNhdGlvbiBSZXNwb25zZTwvdGV4dD48L2c+PCEtLVNSQz1bU3lwOUo0dkxxQkxKU0NmRmliOW1CMnQ5SUNxaG9LbkVCQ2RDcHJDOElZcWlKSXFrdUdCQUFVVzJySlkyNTZESExMb0dkclVTb2lOYlk2Zk9OWnZHTlA1MjhkUDM4T2ZqVDdLOWc4T08zVzAwXS0tPjwvZz48L3N2Zz4='>\n\n<h3 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h3><ul>\n<li>纯文本。我觉得是很大的优点。</li>\n<li>支持的图表类型很多，甚至mindmap这种非UML图表。</li>\n</ul>\n<h3 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h3><ul>\n<li>每种图表基本上都有自己的一套语法，有一定的学习成本。</li>\n<li>PlantUML类似于插件性质，可能并不是所有渲染器都能支持安装。甚至有点破坏Markdown最初的设计理念。</li>\n<li>毕竟不是真图片，总有一些内容是UML图表无法表达的。</li>\n</ul>\n<h2 id=\"ASCII字符画\"><a href=\"#ASCII字符画\" class=\"headerlink\" title=\"ASCII字符画\"></a>ASCII字符画</h2><p>这里不是指图片转字符画，而是类似<a href=\"https://asciiflow.com/\">ASCIIFlow</a>这种纯手工画的。足够灵活，适合画一些简单的示意图，放在代码块里显示。类似于</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">                         ┌───────────┐</span><br><span class=\"line\">                         │Tomcat Main│</span><br><span class=\"line\">                         │ThreadPool │</span><br><span class=\"line\">┌───────┐    Request     ├───────────┤</span><br><span class=\"line\">│  APP/ ├───────────────►│  Thread1  │</span><br><span class=\"line\">│Browser│◄───────────────┤  Thread2  │</span><br><span class=\"line\">└───────┘ Return directly│  Thread3  │</span><br><span class=\"line\">    ▲     Release Conn   │  ...      │</span><br><span class=\"line\">    │                    │  ThreadN  │</span><br><span class=\"line\">    │                    └─────┬─────┘</span><br><span class=\"line\">    │                          │</span><br><span class=\"line\">    │                          │</span><br><span class=\"line\">    │                          │Asynchronized</span><br><span class=\"line\">    │Response                  │  Request</span><br><span class=\"line\">    │                          │</span><br><span class=\"line\">    │                          ▼</span><br><span class=\"line\">    │                   ┌─────────────┐</span><br><span class=\"line\">    │                   │Asynchronized│</span><br><span class=\"line\">    │                   │ ThreadPool  │</span><br><span class=\"line\">    │                   ├─────────────┤</span><br><span class=\"line\">    │                   │  Thread1    │</span><br><span class=\"line\">    └───────────────────┤  Thread2    │</span><br><span class=\"line\">                        │  Thread3    │</span><br><span class=\"line\">                        │  ...        │</span><br><span class=\"line\">                        │  ThreadN    │</span><br><span class=\"line\">                        └─────────────┘</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"优点-1\"><a href=\"#优点-1\" class=\"headerlink\" title=\"优点\"></a>优点</h3><ul>\n<li>通用性强，只是ASCII字符，无论放在哪里，只要是等宽字体，都能很好地显示。</li>\n<li>ASCII字符画有种特别的美感。</li>\n</ul>\n<h3 id=\"缺点-1\"><a href=\"#缺点-1\" class=\"headerlink\" title=\"缺点\"></a>缺点</h3><ul>\n<li>太麻烦了，真就拿鼠标画画，而且ASCIIFlow页面上的许多操作方式设计仍有提升空间。</li>\n<li>在某些地方，如果遭遇了意外换行，整幅图都不能看了。</li>\n<li>毕竟不是真图片，总有一些内容是画功没法表达的。</li>\n</ul>\n<h2 id=\"github图床\"><a href=\"#github图床\" class=\"headerlink\" title=\"github图床\"></a>github图床</h2><p>图床直接使用Github Repository存储，也方便管理。</p>\n<p>Github图片地址格式一般是 <code>https://raw.githubusercontent.com/$&#123;userName&#125;/$&#123;repoName&#125;/$&#123;branchName&#125;/$&#123;path&#125;/$&#123;imgFilename&#125;</code></p>\n<p>国内一般无法直接访问，需要用CDN加速，这里用的是staticaly</p>\n<p>直接替换域名即可，将<code>raw.githubusercontent.com</code>替换为<code>cdn.staticaly.com/gh</code></p>\n<blockquote>\n<p>例如原图的格式为 <code>https://raw.githubusercontent.com/MPasser/ImgStorage/master/NoteBackup/笔记/Unity/screenshots2002-12-02.png</code> 替换成 <code>https://cdn.staticaly.com/gh/MPasser/ImgStorage/master/NoteBackup/笔记/Unity/screenshots2002-12-02.png</code> 即可。</p>\n</blockquote>\n<p>当然，要是有长期的域名和服务器，自己搭个图床更好。</p>\n<blockquote>\n<p>[20231008更新] cdn.staticaly.com 果然挂掉了，换用 cdn.jsdelivr.net。CDN格式为<code>https://cdn.jsdelivr.net/gh/&#123;userName&#125;/&#123;repoName&#125;@&#123;branchName&#125;/&#123;path&#125;/&#123;imgFilename&#125;</code></p>\n</blockquote>\n<blockquote>\n<p>cdn节点的数据更新有延迟，可手动刷新，将图片链接中的<code>cdn.jsdelivr.net</code>替换为<code>purge.jsdelivr.net</code>之后进行访问，返回的JSON中status为finished即为刷新成功。</p>\n</blockquote>\n<p>还尝试过PicGo+各种图床的方案。没使用的原因是这些图床都不能创建文件夹管理已上传的图片，PicGo也不提供这种功能，上传的所有图片就全部摊在根目录，不太喜欢这种方式。</p>\n<h3 id=\"优点-2\"><a href=\"#优点-2\" class=\"headerlink\" title=\"优点\"></a>优点</h3><ul>\n<li>显示的是真正的图片，限制更少了。</li>\n<li>图片的文件结构能够和文档结构相对应，便于管理。</li>\n</ul>\n<h3 id=\"缺点-2\"><a href=\"#缺点-2\" class=\"headerlink\" title=\"缺点\"></a>缺点</h3><ul>\n<li>图片要游离于文档之外管理，就觉得没纯文本编辑那么舒服了。</li>\n<li>gitee原来也能作图床的，但后来官方加了防盗链，导致所有外部引用图片失效。github在未来也不是没可能加防盗链。真这样的话就太惨了。但至少图片文件结构还在。</li>\n<li>除了依赖github外，还需要依赖CDN，这个在未来也不是没可能失效。不过运气好的话还能找到其他的CDN，届时项目内全局替换CDN地址就可以了。</li>\n</ul>\n<h2 id=\"本地引用\"><a href=\"#本地引用\" class=\"headerlink\" title=\"本地引用\"></a>本地引用</h2><p>试过一回，不作考虑。</p>\n<p>图片设置相对路径，随便换个环境就失效了。</p>\n","categories":["Markdown"]},{"title":"Redis基础","url":"/%E7%AC%94%E8%AE%B0/%E5%85%B6%E4%BB%96/Redis%E5%9F%BA%E7%A1%80/","content":"<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>Redis是一个键值数据库。没有表、库或约束，是一种 NoSQL 数据库（非关系型的数据库）。</p>\n<h3 id=\"NoSQL相对于SQL\"><a href=\"#NoSQL相对于SQL\" class=\"headerlink\" title=\"NoSQL相对于SQL\"></a>NoSQL相对于SQL</h3><table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\">SQL</th>\n<th align=\"center\">NoSQL</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">数据结构</td>\n<td align=\"center\">结构化</td>\n<td align=\"center\">非结构化</td>\n</tr>\n<tr>\n<td align=\"center\">数据关联</td>\n<td align=\"center\">关联的</td>\n<td align=\"center\">无关联的</td>\n</tr>\n<tr>\n<td align=\"center\">查询方式</td>\n<td align=\"center\">SQL查询</td>\n<td align=\"center\">非SQL</td>\n</tr>\n<tr>\n<td align=\"center\">事务特性</td>\n<td align=\"center\">ACID</td>\n<td align=\"center\">BASE</td>\n</tr>\n<tr>\n<td align=\"center\">存储方式</td>\n<td align=\"center\">磁盘</td>\n<td align=\"center\">内存</td>\n</tr>\n<tr>\n<td align=\"center\">扩展性</td>\n<td align=\"center\">垂直</td>\n<td align=\"center\">水平</td>\n</tr>\n<tr>\n<td align=\"center\">适用场景</td>\n<td align=\"center\">数据结构固定、数据安全性、一致性要求较高</td>\n<td align=\"center\">数据结构不固定、性能要求高</td>\n</tr>\n</tbody></table>\n<ul>\n<li>结构化。SQL数据库（关系型数据库）的数据是结构化的，有主键约束、唯一性类型的约束等；NoSQL是非结构化的，约束相对不严格，数据大致有键值类型（Redis）、文档类型（MongoDB）、列类型（HBase）、Graph类型（Neo4j）几种组织形式。</li>\n<li>关联性。SQL数据库的表之间可能通过外键相关联；NoSQL想做到同效果只能另外编写业务逻辑实现，数据库不负责维护。</li>\n<li>SQL查询。SQL数据库使用SQL语言查询；NoSQL没有统一标准，例如Redis 用命令 <code>get user:1</code>，MongoDB 用函数 <code>db.user.find(&#123;_id:1&#125;)</code>，elasticsearch 用请求 <code>GET http://localhost:9200/users/1</code></li>\n<li>事务。SQL有事务属性；NoSQL无事务，牺牲强一致性，来获得可用性。</li>\n<li>扩展性。NoSQL利用哈希将数据拆分到不同节点，在分布式系统扩展节点会很方便。</li>\n</ul>\n<h3 id=\"Redis简述\"><a href=\"#Redis简述\" class=\"headerlink\" title=\"Redis简述\"></a>Redis简述</h3><p>始于2009，Redis（Remote Dictionary Server）远程词典服务器，是一个基于内存的键值型NoSQL数据库。</p>\n<p>有这些特征：</p>\n<ul>\n<li>键值（key-value）型，value支持多种数据结构，功能丰富。</li>\n<li>单线程，每个命令具备原子性。</li>\n<li>低延迟，速度快（基于内存、IO多路复用、良好的编码）。</li>\n<li>支持数据持久化。</li>\n<li>支持主从集群、分片集群。</li>\n</ul>\n<h2 id=\"Hello-World\"><a href=\"#Hello-World\" class=\"headerlink\" title=\"Hello World\"></a>Hello World</h2><p>直接yum安装。</p>\n<p>或下载redis源码包后，使用 <code>make &amp; make install</code> 命令进行编译安装。注意，需要前置环境gcc 和 tcl</p>\n<p>安装完毕后，直接执行命令</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">redis-server</span><br></pre></td></tr></table></figure>\n\n<p>前台启动redis服务器，看到控制台有以下输出说明安装成功</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">[DATETIME] # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class=\"line\">......</span><br><span class=\"line\">                _._                                                  </span><br><span class=\"line\">           _.-``__ &#x27;&#x27;-._                                             </span><br><span class=\"line\">      _.-``    `.  `_.  &#x27;&#x27;-._           Redis 5.0.3 (00000000/0) 64 bit</span><br><span class=\"line\">  .-`` .-```.  ```\\/    _.,_ &#x27;&#x27;-._                                   </span><br><span class=\"line\"> (    &#x27;      ,       .-`  | `,    )     Running in standalone mode</span><br><span class=\"line\"> |`-._`-...-` __...-.``-._|&#x27;` _.-&#x27;|     Port: 6379</span><br><span class=\"line\"> |    `-._   `._    /     _.-&#x27;    |     PID: 280354</span><br><span class=\"line\">  `-._    `-._  `-./  _.-&#x27;    _.-&#x27;                                   </span><br><span class=\"line\"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|                                  </span><br><span class=\"line\"> |    `-._`-._        _.-&#x27;_.-&#x27;    |           http://redis.io        </span><br><span class=\"line\">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;                                   </span><br><span class=\"line\"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|                                  </span><br><span class=\"line\"> |    `-._`-._        _.-&#x27;_.-&#x27;    |                                  </span><br><span class=\"line\">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;                                   </span><br><span class=\"line\">      `-._    `-.__.-&#x27;    _.-&#x27;                                       </span><br><span class=\"line\">          `-._        _.-&#x27;                                           </span><br><span class=\"line\">              `-.__.-&#x27;                                               </span><br><span class=\"line\"></span><br><span class=\"line\">[DATETIME] # Server initialized</span><br><span class=\"line\">......</span><br><span class=\"line\">[DATETIME] * Ready to accept connections</span><br></pre></td></tr></table></figure>\n\n<p>配置文件默认在&#x2F;etc&#x2F;redis.conf，一些常用配置如下：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">配置项</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">bind</td>\n<td align=\"left\">监听地址，默认只监听本机；设为0.0.0.0，则可在任意IP访问服务</td>\n</tr>\n<tr>\n<td align=\"left\">port</td>\n<td align=\"left\">监听端口。默认6379</td>\n</tr>\n<tr>\n<td align=\"left\">daemonize</td>\n<td align=\"left\">yes或no。设置服务是否为守护进程</td>\n</tr>\n<tr>\n<td align=\"left\">requirepass</td>\n<td align=\"left\">若设置，则访问Redis服务必须输入密码</td>\n</tr>\n<tr>\n<td align=\"left\">dir</td>\n<td align=\"left\">工作目录，运行时的日志、持久化文件存储的位置。默认为 <code>.</code> ，即当前目录</td>\n</tr>\n<tr>\n<td align=\"left\">database</td>\n<td align=\"left\">数据库数量。默认有16个库，编号0~15</td>\n</tr>\n<tr>\n<td align=\"left\">maxmemory</td>\n<td align=\"left\">设置Redis能够使用的最大内存</td>\n</tr>\n<tr>\n<td align=\"left\">logfile</td>\n<td align=\"left\">日志文件</td>\n</tr>\n</tbody></table>\n<p>使用 redis-cli 命令连接Redis服务器</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">redis-cli [options] [commands]</span><br></pre></td></tr></table></figure>\n\n<p>一些常用options如下：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">option</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">-h</td>\n<td align=\"left\">指定要连接的redis节点IP，默认127.0.0.1</td>\n</tr>\n<tr>\n<td align=\"left\">-p</td>\n<td align=\"left\">指定要连接的redis节点端口，默认6379</td>\n</tr>\n<tr>\n<td align=\"left\">-a</td>\n<td align=\"left\">指定要连接的redis节点密码</td>\n</tr>\n</tbody></table>\n<p>不指定command时，会进入redis的交互界面</p>\n<p>一些常用commands如下：</p>\n<p>|command|含义|<br>|AUTH|后接参数 密码，进行登录。比-a输入密码的方式更安全|<br>|PING|与服务器做心跳测试，正常会返回PONG|<br>|SELECT|后接参数 库编号，选择使用哪一个数据库|<br>|SET|后接参数 键 值，存入键值对|<br>|GET|后接参数 键，根据键获取对应值|</p>\n<h2 id=\"Redis命令\"><a href=\"#Redis命令\" class=\"headerlink\" title=\"Redis命令\"></a>Redis命令</h2><p>Redis是一个键值数据库，key一般是String类型，但value有多种类型</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">类型</th>\n<th align=\"left\">含义</th>\n<th align=\"left\">举例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">String</td>\n<td align=\"left\">字符串</td>\n<td align=\"left\">Hello World</td>\n</tr>\n<tr>\n<td align=\"left\">Hash</td>\n<td align=\"left\">哈希表</td>\n<td align=\"left\">{name:”Adam”,age:16}</td>\n</tr>\n<tr>\n<td align=\"left\">List</td>\n<td align=\"left\">链表</td>\n<td align=\"left\">[A-&gt;B-&gt;C-&gt;C]</td>\n</tr>\n<tr>\n<td align=\"left\">Set</td>\n<td align=\"left\">集合</td>\n<td align=\"left\">{A,B,C}</td>\n</tr>\n<tr>\n<td align=\"left\">SortedSet</td>\n<td align=\"left\">有序集合</td>\n<td align=\"left\">{A:1,B:2,C:3}</td>\n</tr>\n</tbody></table>\n<p>以上是value的基本类型，以下是一些特殊类型</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">类型</th>\n<th align=\"left\">含义</th>\n<th align=\"left\">举例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">GEO</td>\n<td align=\"left\">地理坐标</td>\n<td align=\"left\">{A:(120.3,30.5)}</td>\n</tr>\n<tr>\n<td align=\"left\">BitMap</td>\n<td align=\"left\">位图</td>\n<td align=\"left\">0110110101110101011</td>\n</tr>\n<tr>\n<td align=\"left\">HyperLog</td>\n<td align=\"left\">去重统计算法</td>\n<td align=\"left\">0110110101110101011</td>\n</tr>\n</tbody></table>\n<p>操作每种数据类型使用的命令是不同的。</p>\n<h3 id=\"通用命令\"><a href=\"#通用命令\" class=\"headerlink\" title=\"通用命令\"></a>通用命令</h3><table>\n<thead>\n<tr>\n<th align=\"left\">命令</th>\n<th align=\"left\">参数</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">KEYS</td>\n<td align=\"left\">pattern</td>\n<td align=\"left\">返回匹配模式的所有key名称，pattern中使用的通配符见表下说明</td>\n</tr>\n<tr>\n<td align=\"left\">DEL</td>\n<td align=\"left\">key …</td>\n<td align=\"left\">删除指定key</td>\n</tr>\n<tr>\n<td align=\"left\">DEL</td>\n<td align=\"left\">key …</td>\n<td align=\"left\">判断key是否存在，存在返回1.反之返回0</td>\n</tr>\n<tr>\n<td align=\"left\">EXPIRE</td>\n<td align=\"left\">key seconds</td>\n<td align=\"left\">给一个key设置有效期，过了有效期时间后，key被自动删除</td>\n</tr>\n<tr>\n<td align=\"left\">TTL</td>\n<td align=\"left\">key</td>\n<td align=\"left\">查询一个key剩余的有效期，永久有效key的值为-1，已过期（不存在）的key值为-2</td>\n</tr>\n</tbody></table>\n<p>KEYS命令有使用模糊查询，数据量大时会很慢，阻塞服务，不建议在生产环境下使用。</p>\n<p>向redis中存入key时建议都设置一个有效期。</p>\n<p>Redis 使用的通配符如下：</p>\n<ul>\n<li>?表示单个任意字符。h?llo matches hello, hallo and hxllo</li>\n<li>*表示任意个任意字符。h*llo matches hllo and heeeello</li>\n<li>[]表示在匹配括号中的一个字符。h[ae]llo matches hello and hallo, but not hillo</li>\n<li>^表示非。h[^e]llo matches hallo, hbllo, … but not hello</li>\n<li>-表示字符范围。h[a-b]llo matches hallo and hbllo</li>\n</ul>\n<h3 id=\"String类型命令\"><a href=\"#String类型命令\" class=\"headerlink\" title=\"String类型命令\"></a>String类型命令</h3><p>根据字符串格式不同，String类型数据又可以分成3类：</p>\n<ul>\n<li>String：普通字符串。如 Hello World</li>\n<li>int：整型。如 10</li>\n<li>float：浮点型。如 92.5</li>\n</ul>\n<p>其中数字类型可做自增自减操作。</p>\n<p>无论哪种格式，底层都是字节数组形式存储，只是编码方式不同，字符串类型的最大空间不能超过512M。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">命令</th>\n<th align=\"left\">参数</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">SET</td>\n<td align=\"left\">key value</td>\n<td align=\"left\">新增或修改键值对</td>\n</tr>\n<tr>\n<td align=\"left\">GET</td>\n<td align=\"left\">key</td>\n<td align=\"left\">获取key对应的value</td>\n</tr>\n<tr>\n<td align=\"left\">MSET</td>\n<td align=\"left\">key value …</td>\n<td align=\"left\">批量设置键值对</td>\n</tr>\n<tr>\n<td align=\"left\">MGET</td>\n<td align=\"left\">key …</td>\n<td align=\"left\">批量获取value</td>\n</tr>\n<tr>\n<td align=\"left\">INCR</td>\n<td align=\"left\">key</td>\n<td align=\"left\">让一个整型数据自增1</td>\n</tr>\n<tr>\n<td align=\"left\">INCRBY</td>\n<td align=\"left\">key increment</td>\n<td align=\"left\">让一个整型数据自增，自定义步长</td>\n</tr>\n<tr>\n<td align=\"left\">INCRBYFLOAT</td>\n<td align=\"left\">key increment</td>\n<td align=\"left\">让一个浮点型数据自增，自定义步长</td>\n</tr>\n<tr>\n<td align=\"left\">SETNX</td>\n<td align=\"left\">key value</td>\n<td align=\"left\">新增键值对，若键值对存在则不执行</td>\n</tr>\n<tr>\n<td align=\"left\">SETEX</td>\n<td align=\"left\">key seconds value</td>\n<td align=\"left\">设置一个键值对并设置有效期</td>\n</tr>\n</tbody></table>\n<h3 id=\"Hash类型命令\"><a href=\"#Hash类型命令\" class=\"headerlink\" title=\"Hash类型命令\"></a>Hash类型命令</h3><p>Hash类型，也叫散列，其value是一个无序字典，类似于Java中HashMap结构。</p>\n<p>String结构是将对象序列化为JSON字符串后存储，当需要修改对象某个字段时很不方便；Hash结构可以将对象中的每个字段独立存储，可以针对单个字段做CURD。</p>\n<p>常用命令有：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">命令</th>\n<th align=\"left\">参数</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">HSET</td>\n<td align=\"left\">key field value</td>\n<td align=\"left\">添加或修改hash类型key的field的值</td>\n</tr>\n<tr>\n<td align=\"left\">HGET</td>\n<td align=\"left\">key field</td>\n<td align=\"left\">获取指定key的field的值</td>\n</tr>\n<tr>\n<td align=\"left\">HMSET</td>\n<td align=\"left\">key field value [field value …]</td>\n<td align=\"left\">批量添加field的值</td>\n</tr>\n<tr>\n<td align=\"left\">HMGET</td>\n<td align=\"left\">key field</td>\n<td align=\"left\">批量获取多个field值</td>\n</tr>\n<tr>\n<td align=\"left\">HGETALL</td>\n<td align=\"left\">key</td>\n<td align=\"left\">获取所有的field和value</td>\n</tr>\n<tr>\n<td align=\"left\">HKEYS</td>\n<td align=\"left\">key</td>\n<td align=\"left\">获取所有的field</td>\n</tr>\n<tr>\n<td align=\"left\">HVALS</td>\n<td align=\"left\">key</td>\n<td align=\"left\">获取所有的value</td>\n</tr>\n<tr>\n<td align=\"left\">HINCRBY</td>\n<td align=\"left\">key field increment</td>\n<td align=\"left\">让一个hash类型key的字段值自增，自定义步长</td>\n</tr>\n<tr>\n<td align=\"left\">HSETNX</td>\n<td align=\"left\">key field value</td>\n<td align=\"left\">添加一个field的值，如果field已存在则不执行</td>\n</tr>\n</tbody></table>\n<h3 id=\"List类型命令\"><a href=\"#List类型命令\" class=\"headerlink\" title=\"List类型命令\"></a>List类型命令</h3><p>Redis中的List类型与Java中的LinkedList类似，可看做一个双向链表结构，支持双向检索。有这些特征：</p>\n<ul>\n<li>有序</li>\n<li>元素可重复</li>\n<li>插入和删除快</li>\n<li>查询速度不快</li>\n</ul>\n<p>常用命令有：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">命令</th>\n<th align=\"left\">参数</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">LPUSH</td>\n<td align=\"left\">key value [value …]</td>\n<td align=\"left\">向List左侧插入一个或多个元素</td>\n</tr>\n<tr>\n<td align=\"left\">LPOP</td>\n<td align=\"left\">key</td>\n<td align=\"left\">移除并返回List左侧的第一个元素，List为空则返回nil</td>\n</tr>\n<tr>\n<td align=\"left\">RPUSH</td>\n<td align=\"left\">key value</td>\n<td align=\"left\">向List右侧插入一个或多个元素</td>\n</tr>\n<tr>\n<td align=\"left\">RPOP</td>\n<td align=\"left\">key</td>\n<td align=\"left\">移除并返回List右侧的第一个元素</td>\n</tr>\n<tr>\n<td align=\"left\">LRANGE</td>\n<td align=\"left\">key start stop</td>\n<td align=\"left\">返回一段索引范围内的所有元素</td>\n</tr>\n<tr>\n<td align=\"left\">BLPOP</td>\n<td align=\"left\">key … timeout</td>\n<td align=\"left\">执行LPOP，如果List为空则等待指定时间，并不直接返回nil</td>\n</tr>\n<tr>\n<td align=\"left\">BRPOP</td>\n<td align=\"left\">key … timeout</td>\n<td align=\"left\">执行RPOP，如果List为空则等待指定时间，并不直接返回nil</td>\n</tr>\n</tbody></table>\n<p>List的索引从0开始，从左到右；</p>\n<p>BLPOP&#x2F;BRPOP效果类似于阻塞队列。</p>\n<h3 id=\"Set类型命令\"><a href=\"#Set类型命令\" class=\"headerlink\" title=\"Set类型命令\"></a>Set类型命令</h3><p>Redis的Set结构与Java中的HashSet类似，因为也是一个Hash表，因此具备与HashSet类似的特征：</p>\n<ul>\n<li>无序</li>\n<li>元素不可重复</li>\n<li>查询速度快</li>\n<li>支持交集、并集和差集等功能</li>\n</ul>\n<p>常用命令有：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">命令</th>\n<th align=\"left\">参数</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">SADD</td>\n<td align=\"left\">key member …</td>\n<td align=\"left\">添加一个或多个元素</td>\n</tr>\n<tr>\n<td align=\"left\">SREM</td>\n<td align=\"left\">key member …</td>\n<td align=\"left\">删除指定元素</td>\n</tr>\n<tr>\n<td align=\"left\">SCARD</td>\n<td align=\"left\">key</td>\n<td align=\"left\">返回元素的个数</td>\n</tr>\n<tr>\n<td align=\"left\">SISMEMBER</td>\n<td align=\"left\">key member</td>\n<td align=\"left\">判断member元素是否在Set中存在</td>\n</tr>\n<tr>\n<td align=\"left\">SMEMBERS</td>\n<td align=\"left\">key</td>\n<td align=\"left\">获取所有元素</td>\n</tr>\n<tr>\n<td align=\"left\">SINTER</td>\n<td align=\"left\">key …</td>\n<td align=\"left\">取指定Set的交集</td>\n</tr>\n<tr>\n<td align=\"left\">SDIFF</td>\n<td align=\"left\">key …</td>\n<td align=\"left\">取指定Set的差集</td>\n</tr>\n<tr>\n<td align=\"left\">SUNION</td>\n<td align=\"left\">key …</td>\n<td align=\"left\">取指定Set的并集</td>\n</tr>\n</tbody></table>\n<h3 id=\"SortedSet类型命令\"><a href=\"#SortedSet类型命令\" class=\"headerlink\" title=\"SortedSet类型命令\"></a>SortedSet类型命令</h3><p>Redis的SortedSet是一个有序Set集合。其中每个元素都有一个score属性，可基于score属性对元素排序，底层的实现是一个跳表（SkipList）加Hash表。有以下特征：</p>\n<ul>\n<li>可排序</li>\n<li>元素不可重复</li>\n<li>查询速度快</li>\n</ul>\n<p>因为SortedSet的可排序特性，常被用来实现排行榜这样的功能。</p>\n<p>常用命令有：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">命令</th>\n<th align=\"left\">参数</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">ZADD</td>\n<td align=\"left\">key score member [score member …]</td>\n<td align=\"left\">添加一个或多个元素</td>\n</tr>\n<tr>\n<td align=\"left\">ZREM</td>\n<td align=\"left\">key member …</td>\n<td align=\"left\">删除指定元素</td>\n</tr>\n<tr>\n<td align=\"left\">ZCARD</td>\n<td align=\"left\">key</td>\n<td align=\"left\">返回元素的个数</td>\n</tr>\n<tr>\n<td align=\"left\">ZSCORE</td>\n<td align=\"left\">key member</td>\n<td align=\"left\">获取指定元素的score值</td>\n</tr>\n<tr>\n<td align=\"left\">ZRANK</td>\n<td align=\"left\">key member</td>\n<td align=\"left\">获取指定元素的排名</td>\n</tr>\n<tr>\n<td align=\"left\">ZCOUNT</td>\n<td align=\"left\">key</td>\n<td align=\"left\">获取元素个数</td>\n</tr>\n<tr>\n<td align=\"left\">ZINCRBY</td>\n<td align=\"left\">key increment member</td>\n<td align=\"left\">让指定元素自增，自定义步长</td>\n</tr>\n<tr>\n<td align=\"left\">ZRANGE</td>\n<td align=\"left\">key start stop</td>\n<td align=\"left\">按score排序后，获取指定排名范围内的元素</td>\n</tr>\n<tr>\n<td align=\"left\">ZRANGEBYSCORE</td>\n<td align=\"left\">key start stop</td>\n<td align=\"left\">按score排序后，获取指定排score值范围内的元素</td>\n</tr>\n<tr>\n<td align=\"left\">ZINTER&#x2F;ZDIFF&#x2F;ZUNION</td>\n<td align=\"left\">key …</td>\n<td align=\"left\">取指定Set的交集&#x2F;差集&#x2F;并集</td>\n</tr>\n</tbody></table>\n<p>所有的排序默认都是升序，如果需要降序，则在命令中的Z后添加REV即可，例如ZREVRANK、ZREVRANGE。</p>\n<h2 id=\"key的结构\"><a href=\"#key的结构\" class=\"headerlink\" title=\"key的结构\"></a>key的结构</h2><p>Redis的key允许有多个单词形成层级结构，多个单词之间用 : 隔开，例如</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">项目名:业务名:类型:ID</span><br><span class=\"line\">example:user:1</span><br><span class=\"line\">example:product:1</span><br></pre></td></tr></table></figure>\n\n<p>如果value是Java对象，则可将对象序列化为JSON字符串后存储，例如：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;Adam&quot;,&quot;age&quot;:16&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Java客户端\"><a href=\"#Java客户端\" class=\"headerlink\" title=\"Java客户端\"></a>Java客户端</h2><ul>\n<li>Jedis。以Redis命令作为方法名称，学习成本低，简单实用。但Jedis实例是线程不安全的，多线程环境下需要基于连接池来使用。</li>\n<li>Lettuce。基于Netty实现，支持同步、异步和响应式编程，且线程安全。支持Redis的哨兵模式、集群模式和管道模式。</li>\n<li>Redissio是一个基于Redis实现的分布式、可伸缩的Java数据结构集合。包含了诸如Map、Queue、Lock、Semaphore和AtomicLong等强大功能。</li>\n<li>Spring Data Redis，底层实现的API兼容Jedis和Lettuce。</li>\n</ul>\n<h3 id=\"Hello-World-1\"><a href=\"#Hello-World-1\" class=\"headerlink\" title=\"Hello World\"></a>Hello World</h3><p>使用Jedis作为Redis客户端</p>\n<p>创建工程，引入依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>redis.clients<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jedis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.2.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>建立连接</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> Jedis jedis;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Before</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">setUp</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 建立连接</span></span><br><span class=\"line\">    jedis = <span class=\"keyword\">new</span> <span class=\"title class_\">Jedis</span>(<span class=\"string\">&quot;127.0.0.1&quot;</span>,<span class=\"number\">6379</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 设置密码</span></span><br><span class=\"line\">    jedis.auth(<span class=\"string\">&quot;123456&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 选择库</span></span><br><span class=\"line\">    jedis.select(<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>插入和获取数据</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 插入数据方法名称就是redis命令名</span></span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> jedis.set(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;Adam&quot;</span>);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;result = &quot;</span> + result);</span><br><span class=\"line\">    <span class=\"comment\">// 获取数据</span></span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">name</span> <span class=\"operator\">=</span> jedis.get(<span class=\"string\">&quot;name&quot;</span>);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;name = &quot;</span> + name);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>释放资源</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@After</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">tearDown</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 释放资源</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (jedis != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        jedis.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>执行测试</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">result = OK</span><br><span class=\"line\">name = Adam</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Jedis连接池\"><a href=\"#Jedis连接池\" class=\"headerlink\" title=\"Jedis连接池\"></a>Jedis连接池</h2><p>Jedis本身是线程不安全的，并且频繁地创建和销毁连接会有性能损耗，因此推荐使用Jedis连接池。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JedisConnectionFactory</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> JedisPool JEDIS_POOL;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">JedisPoolConfig</span> <span class=\"variable\">config</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JedisPoolConfig</span>();</span><br><span class=\"line\">        <span class=\"comment\">// 最大连接数</span></span><br><span class=\"line\">        config.setMaxTotal(<span class=\"number\">8</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 最大空闲连接</span></span><br><span class=\"line\">        config.setMaxIdle(<span class=\"number\">8</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 最小空闲连接</span></span><br><span class=\"line\">        config.setMinIdle(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 设置超时时长</span></span><br><span class=\"line\">        config.setMaxWait(Duration.ofMillis(<span class=\"number\">200</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        JEDIS_POOL = <span class=\"keyword\">new</span> <span class=\"title class_\">JedisPool</span>(config, <span class=\"string\">&quot;139.159.146.213&quot;</span>, <span class=\"number\">6379</span>, <span class=\"number\">1000</span>, <span class=\"string\">&quot;810975a&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Jedis <span class=\"title function_\">getJedis</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JEDIS_POOL.getResource();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"SpringDataRedis\"><a href=\"#SpringDataRedis\" class=\"headerlink\" title=\"SpringDataRedis\"></a>SpringDataRedis</h2><p>SpringData是Spring中数据操作的模块，包括对各种数据库的集成，其中对Redis的集成模块就叫做SpringDataRedis。</p>\n<ul>\n<li>提供了对不同Redis客户端的整合（Jedis和Lettuce）</li>\n<li>提供了RedisTemplate统一API来操作Redis</li>\n<li>支持Redis的发布订阅模型</li>\n<li>支持Redis哨兵和Redis集群</li>\n<li>支持Lettuce的响应式编程</li>\n<li>支持基于JDK、JSON、字符串和Spring对象数据的序列化及反序列化</li>\n<li>支持基于Redis的JDKCollection实现</li>\n</ul>\n<p>SpringData中提供了RedisTemplate工具类，封装了各种对Redis的操作。并将不同数据类型的操作API封装到了不同的类型中：</p>\n<table>\n<thead>\n<tr>\n<th align=\"right\">API</th>\n<th align=\"right\">返回值类型</th>\n<th align=\"right\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">redisTemplate.opForValue</td>\n<td align=\"right\">ValueOperations</td>\n<td align=\"right\">操作String类型数据</td>\n</tr>\n<tr>\n<td align=\"right\">redisTemplate.opForHash</td>\n<td align=\"right\">HashOperations</td>\n<td align=\"right\">操作Hash类型数据</td>\n</tr>\n<tr>\n<td align=\"right\">redisTemplate.opForList</td>\n<td align=\"right\">ListOperations</td>\n<td align=\"right\">操作List类型数据</td>\n</tr>\n<tr>\n<td align=\"right\">redisTemplate.opForSet</td>\n<td align=\"right\">SetOperations</td>\n<td align=\"right\">操作Set类型数据</td>\n</tr>\n<tr>\n<td align=\"right\">redisTemplate.opForZSet</td>\n<td align=\"right\">ZSetOperations</td>\n<td align=\"right\">操作SortedSet类型数据</td>\n</tr>\n<tr>\n<td align=\"right\">redisTemplate</td>\n<td align=\"right\"></td>\n<td align=\"right\">通用命令</td>\n</tr>\n</tbody></table>\n<h3 id=\"Hello-World-2\"><a href=\"#Hello-World-2\" class=\"headerlink\" title=\"Hello World\"></a>Hello World</h3><p>创建Springboot工程引入redis相关依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.7.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.commons<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-pool2<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.11.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>commons-pool2用于支持连接池</p>\n<p>配置</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  redis:</span><br><span class=\"line\">    host: 139.159.146.213</span><br><span class=\"line\">    port: 6379</span><br><span class=\"line\">    password: 810975a</span><br><span class=\"line\">    lettuce:</span><br><span class=\"line\">      pool:</span><br><span class=\"line\">        max-active: 8</span><br><span class=\"line\">        max-idle: 8</span><br><span class=\"line\">        max-wait: 100</span><br></pre></td></tr></table></figure>\n\n<p>注入并使用</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootTest</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisTest</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 插入一条String数据</span></span><br><span class=\"line\">        redisTemplate.opsForValue().set(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;Bob&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 读取一条String数据</span></span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">name</span> <span class=\"operator\">=</span> redisTemplate.opsForValue().get(<span class=\"string\">&quot;name&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;name = &quot;</span> + name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>执行</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">name = Bob</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"序列化\"><a href=\"#序列化\" class=\"headerlink\" title=\"序列化\"></a>序列化</h3><p>RedisTemplate可接收任意Object作为值写入Redis，但写入前会把Object序列化为字节形式，默认采用JDK序列化</p>\n<p>设置key使用字符串序列化，value使用json序列化</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory connectionFactory)</span> &#123;</span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; template = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        template.setConnectionFactory(connectionFactory);</span><br><span class=\"line\">        <span class=\"type\">GenericJackson2JsonRedisSerializer</span> <span class=\"variable\">jsonRedisSerializer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">GenericJackson2JsonRedisSerializer</span>();</span><br><span class=\"line\">        <span class=\"comment\">// 设置key的序列化</span></span><br><span class=\"line\">        template.setKeySerializer(RedisSerializer.string());</span><br><span class=\"line\">        template.setHashKeySerializer(RedisSerializer.string());</span><br><span class=\"line\">        <span class=\"comment\">// 设置value的序列化</span></span><br><span class=\"line\">        template.setValueSerializer(jsonRedisSerializer);</span><br><span class=\"line\">        template.setHashValueSerializer(jsonRedisSerializer);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> template;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testUser</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;Cindy&quot;</span>, <span class=\"number\">21</span>);</span><br><span class=\"line\">    redisTemplate.opsForValue().set(<span class=\"string\">&quot;user:1&quot;</span>, user);</span><br><span class=\"line\">    <span class=\"type\">User</span> <span class=\"variable\">u</span> <span class=\"operator\">=</span> (User) redisTemplate.opsForValue().get(<span class=\"string\">&quot;user:1&quot;</span>);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;u = &quot;</span> + u);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当对象以json形式序列化后，会自动将类的全类名也存储起来，用于自动反序列化。如下</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;@class&quot;:&quot;com.example.redisdemo.pojo.User&quot;,</span><br><span class=\"line\">    &quot;name&quot;:&quot;Cindy&quot;,</span><br><span class=\"line\">    &quot;age&quot;:21</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>会带来额外的内存开销。所以为了节省空间，一般不会使用json序列化器来处理value，而是统一使用String序列化器。当需要存储Java对象时，手动完成对象的序列化和反序列化。</p>\n<p>Spring默认提供了一个StringRedisTemplate类，其key和value的序列化方式默认就是String方式，省去了自定义RedisTemplate的过程。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testUser</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;Cindy&quot;</span>, <span class=\"number\">21</span>);</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">jsonString</span> <span class=\"operator\">=</span> JSON.toJSONString(user); <span class=\"comment\">// 用fastjson手动序列化和反序列化</span></span><br><span class=\"line\">    stringRedisTemplate.opsForValue().set(<span class=\"string\">&quot;user:1&quot;</span>, jsonString);</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> stringRedisTemplate.opsForValue().get(<span class=\"string\">&quot;user:1&quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">User</span> <span class=\"variable\">u</span> <span class=\"operator\">=</span> JSON.parseObject(str, com.example.redisdemo.pojo.User.class);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;u = &quot;</span> + u);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在redis中存储的value则没有多余的信息</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;age&quot;:21,</span><br><span class=\"line\">    &quot;name&quot;:&quot;Cindy&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["Database","Redis"]},{"title":"YAML简介","url":"/%E7%AC%94%E8%AE%B0/%E5%85%B6%E4%BB%96/YAML%E7%AE%80%E4%BB%8B/","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>YAML全称是 YAML Ain’t Markup Language 。YAML是一种直观能够被电脑识别的数据序列化格式，且容易被人类阅读，容易和脚本语言交互。支持导入YAML的编程语言有：C&#x2F;C++、Ruby、Python、Java、Perl、C#和PHP等。</p>\n<p>YAML文件是<strong>以数据为核心</strong>的，比传统的XML方式更加简洁。</p>\n<p>YAML文件的扩展名可以使用 .yml 或 .yaml</p>\n<h2 id=\"对比\"><a href=\"#对比\" class=\"headerlink\" title=\"对比\"></a>对比</h2><ul>\n<li>properties</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">server.port=8080</span><br><span class=\"line\">server.ip=127.0.0.1</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>XML</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">port</span>&gt;</span>8080<span class=\"tag\">&lt;/<span class=\"name\">port</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ip</span>&gt;</span>127.0.0.1<span class=\"tag\">&lt;/<span class=\"name\">ip</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">server</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>YAML</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">server:</span><br><span class=\"line\">  port: 8080</span><br><span class=\"line\">  ip: 127.0.0.1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"基本语法\"><a href=\"#基本语法\" class=\"headerlink\" title=\"基本语法\"></a>基本语法</h2><ul>\n<li>大小写敏感</li>\n<li>数据值前必须有空格作为分隔符</li>\n<li>使用缩进表示层级关系</li>\n<li>缩进使用空格且不能使用Tab代替，缩进空格数目不做要求，相同层级元素左侧对齐即可</li>\n<li>使用<code>#</code>表示注释，当前行此字符后的内容会被解析器忽略</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">server:</span><br><span class=\"line\">  port: 8080</span><br><span class=\"line\">  ip: 127.0.0.1</span><br><span class=\"line\">name: adam</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"对象\"><a href=\"#对象\" class=\"headerlink\" title=\"对象\"></a>对象</h3><p>键值对的集合</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">person:</span><br><span class=\"line\">  name: adam</span><br><span class=\"line\">  age: 18</span><br><span class=\"line\">address: beijing</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">行内写法</span></span><br><span class=\"line\">&#123;person: &#123;name: adam, age: 18&#125;, address: beijing&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"数组\"><a href=\"#数组\" class=\"headerlink\" title=\"数组\"></a>数组</h3><p>一组按次序排列的值</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">address:</span><br><span class=\"line\">  - beijing</span><br><span class=\"line\">  - shanghai</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">行内写法</span></span><br><span class=\"line\">address: [beijing, shanghai]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"纯量\"><a href=\"#纯量\" class=\"headerlink\" title=\"纯量\"></a>纯量</h3><p>单个的、不可再分的值</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">text1: &#x27;Hello \\n World&#x27; # 单引号不识别转义字符，原样输出</span><br><span class=\"line\">text2: &quot;Hello \\n World&quot; # 双引号识别转义字符</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"保留空格和换行\"><a href=\"#保留空格和换行\" class=\"headerlink\" title=\"保留空格和换行\"></a>保留空格和换行</h3><ul>\n<li>数据以空格开头，将数据用引号括起来即可</li>\n<li>保留换行</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使用竖线符`|`来表示该语法，行尾空白会被去掉，额外的缩进会被保留</span></span><br><span class=\"line\">lines: |</span><br><span class=\"line\">  我是第一行</span><br><span class=\"line\">  我是第二行</span><br><span class=\"line\">    我是吴彦祖</span><br><span class=\"line\">      我是第四行</span><br><span class=\"line\">  我是第五行</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">相当于</span></span><br><span class=\"line\">lines: &quot;我是第一行\\n我是第二行\\n  我是吴彦祖\\n     我是第四行\\n我是第五行&quot;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>折叠换行</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使用右尖括号`&gt;`来表示该语法，只有空白行才会被识别为换行，原来的换行符都会被转换成空格</span></span><br><span class=\"line\">lines: &gt;</span><br><span class=\"line\">  我是第一行</span><br><span class=\"line\">  我也是第一行</span><br><span class=\"line\">  我仍是第一行</span><br><span class=\"line\">  我依旧是第一行</span><br><span class=\"line\"></span><br><span class=\"line\">  我是第二行</span><br><span class=\"line\">  这么巧我也是第二行</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">相当于</span></span><br><span class=\"line\">lines: &quot;我是第一行 我也是第一行 我仍是第一行 我依旧是第一行\\n我是第二行 这么巧我也是第二行&quot;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>参数引用</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">name: adam</span><br><span class=\"line\">person:</span><br><span class=\"line\">  name: $&#123;name&#125; # adam</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"多文件\"><a href=\"#多文件\" class=\"headerlink\" title=\"多文件\"></a>多文件</h3><p>可以将多个YAML文件合并为一个文件。在使用 profile 配置时就无需创建多个文件了。</p>\n<p>不同文件之间，使用 <code>---</code>进行分隔。</p>\n","categories":["YAML"]},{"title":"Ajax笔记","url":"/%E7%AC%94%E8%AE%B0/%E5%89%8D%E7%AB%AF/Ajax%E7%AC%94%E8%AE%B0/","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>Asynchronous Javascript And XML (异步 JavaScript 和 XML)，只刷新局部页面的技术</p>\n<p>Ajax引擎：即XMLHTTPRequest对象，以异步方式在客户端和服务器之间传递数据</p>\n<p>为什么使用Ajax</p>\n<ul>\n<li>无刷新：不刷新整个页面，只刷新局部</li>\n<li>只更新部分页面，有效利用带宽</li>\n<li>提供连续的用户体验</li>\n<li>提供类似于C&#x2F;S的交互效果，操作更方便</li>\n</ul>\n<p>传统Web与Ajax的差异</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">差异</th>\n<th align=\"left\">方式</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">发送请求不同</td>\n<td align=\"left\">传统web</br>Ajax</td>\n<td align=\"left\">提交表单方式发送请求</br>异步引擎对象发送请求</td>\n</tr>\n<tr>\n<td align=\"left\">服务器响应不同</td>\n<td align=\"left\">传统web</br>Ajax</td>\n<td align=\"left\">响应内容是一个完整页面</br>响应内容只是需要的页面</td>\n</tr>\n<tr>\n<td align=\"left\">客户端处理方式不同</td>\n<td align=\"left\">传统web</br>Ajax</td>\n<td align=\"left\">需等待服务器响应完成并重新加载整个页面后用户才能进行操作</br>可以动态更新页面中的部分内容，用户不需要等待请求的响应</td>\n</tr>\n</tbody></table>\n<h3 id=\"Ajax工作流程\"><a href=\"#Ajax工作流程\" class=\"headerlink\" title=\"Ajax工作流程\"></a>Ajax工作流程</h3><p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/%E5%89%8D%E7%AB%AF/Ajax%E7%AC%94%E8%AE%B0/Ajax%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png\" alt=\"Ajax工作流程.png\"></p>\n<p>XMLHttpRequest对象是整个Ajax技术的核心，它提供了异步发送请求的能力</p>\n<h3 id=\"常用方法\"><a href=\"#常用方法\" class=\"headerlink\" title=\"常用方法\"></a>常用方法</h3><ul>\n<li>open(method, URL, async)<ul>\n<li>建立与服务器的连接</li>\n<li>method参数：请求方式，可选值是GET（默认）或 POST</li>\n<li>URL：请求地址</li>\n<li>async参数：是否使用异步请求，可选值是true（默认）或 false</li>\n</ul>\n</li>\n<li>send(content)<ul>\n<li>发送请求</li>\n<li>content：请求参数，只有post请求才能通过send()方法发送参数</li>\n</ul>\n</li>\n<li>setRequestHeader(header, value)<ul>\n<li>设置请求头信息</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"常用事件\"><a href=\"#常用事件\" class=\"headerlink\" title=\"常用事件\"></a>常用事件</h3><p>onreadystatechange：事件属性，指定回调函数，当readyState属性改变时触发执行</p>\n<h3 id=\"常用属性\"><a href=\"#常用属性\" class=\"headerlink\" title=\"常用属性\"></a>常用属性</h3><p>readyState：表示XMLHttpRequest对象的状态</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">就绪状态码</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">0</td>\n<td align=\"left\">XMLHttpRequest对象已创建，尚未初始化</td>\n</tr>\n<tr>\n<td align=\"center\">1</td>\n<td align=\"left\">对象开始发送请求</td>\n</tr>\n<tr>\n<td align=\"center\">2</td>\n<td align=\"left\">对象请求发送完成</td>\n</tr>\n<tr>\n<td align=\"center\">3</td>\n<td align=\"left\">对象开始读取响应，尚未读取完成</td>\n</tr>\n<tr>\n<td align=\"center\">4</td>\n<td align=\"left\">对象读取响应结束</td>\n</tr>\n</tbody></table>\n<p>status：表示HTTP请求响应的状态</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">状态码</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">200</td>\n<td align=\"left\">服务器响应正常</td>\n</tr>\n<tr>\n<td align=\"center\">400</td>\n<td align=\"left\">无法找到请求的资源</td>\n</tr>\n<tr>\n<td align=\"center\">403</td>\n<td align=\"left\">没有访问权限</td>\n</tr>\n<tr>\n<td align=\"center\">404</td>\n<td align=\"left\">访问的资源不存在</td>\n</tr>\n<tr>\n<td align=\"center\">500</td>\n<td align=\"left\">服务器内部错误</td>\n</tr>\n</tbody></table>\n<p>responseText：获得响应的文本内容</p>\n<p>responseXML：获得响应的XML文档对象Document</p>\n<h2 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h2><h3 id=\"同步和异步请求方法对比\"><a href=\"#同步和异步请求方法对比\" class=\"headerlink\" title=\"同步和异步请求方法对比\"></a>同步和异步请求方法对比</h3><p>JavaScript为两个按钮分别绑定一个同步请求方法和异步请求方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">sendSync</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 1.创建XMLHttpRequest对象</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\">    <span class=\"comment\">// 2.初始化连接，以get方式与服务器simple建立同步连接</span></span><br><span class=\"line\">    xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;simple&quot;</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 3.发送请求</span></span><br><span class=\"line\">    xhr.<span class=\"title function_\">send</span>(<span class=\"literal\">null</span>); <span class=\"comment\">// 客户端处于阻塞状态</span></span><br><span class=\"line\">    <span class=\"comment\">// 4.获取响应的数据</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> data = xhr.<span class=\"property\">responseText</span>;</span><br><span class=\"line\">    <span class=\"title function_\">alert</span>(data);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">sendAsync</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 指定事件回调函数，当状态发生改变时触发执行</span></span><br><span class=\"line\">    xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"number\">4</span> == xhr.<span class=\"property\">readyState</span> &amp;&amp; <span class=\"number\">200</span> == xhr.<span class=\"property\">status</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> data = xhr.<span class=\"property\">responseText</span>; <span class=\"comment\">// 无法获取响应数据</span></span><br><span class=\"line\">            <span class=\"title function_\">alert</span>(data);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;simple&quot;</span>, <span class=\"literal\">true</span>); <span class=\"comment\">// 建立异步请求</span></span><br><span class=\"line\">    xhr.<span class=\"title function_\">send</span>(<span class=\"literal\">null</span>); <span class=\"comment\">// 客户端可以继续执行操作</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 补充：定义工厂函数，用于创建XMLHttpRequest对象，兼容不同浏览器</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">createXHR</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable language_\">window</span>.<span class=\"property\">XMLHttpRequest</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ActiveXObject</span>(<span class=\"string\">&quot;Microsoft XMLHttp&quot;</span>); <span class=\"comment\">// IE老版本浏览器</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>SimpleServlet.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SimpleServlet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HttpServlet</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doGet</span><span class=\"params\">(HttpServletRequest req, HttpServletResponse resp)</span> <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">3000</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        resp.setContentType(<span class=\"string\">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">PrintWriter</span> <span class=\"variable\">out</span> <span class=\"operator\">=</span> resp.getWriter();</span><br><span class=\"line\">        out.print(<span class=\"string\">&quot;Fuck you!&quot;</span>);</span><br><span class=\"line\">        out.flush();</span><br><span class=\"line\">        out.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"验证用户名是否符合要求\"><a href=\"#验证用户名是否符合要求\" class=\"headerlink\" title=\"验证用户名是否符合要求\"></a>验证用户名是否符合要求</h4><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* </span></span><br><span class=\"line\"><span class=\"comment\">    使用get方式发送请求</span></span><br><span class=\"line\"><span class=\"comment\">    1.通过queryString形式发送请求参数，即附加在url之后，send方法参数设置为null</span></span><br><span class=\"line\"><span class=\"comment\">    2.不能将数据作为content参数，使用send方法发送数据，此时发送是无效的</span></span><br><span class=\"line\"><span class=\"comment\">    3.解决乱码：1）服务器解码 2）使用过滤器 3）直接修改tomcat的server.xml</span></span><br><span class=\"line\"><span class=\"comment\">    </span></span><br><span class=\"line\"><span class=\"comment\">    使用post方式发送请求</span></span><br><span class=\"line\"><span class=\"comment\">    1.将数据作为content参数，使用send方法发送数据</span></span><br><span class=\"line\"><span class=\"comment\">    2.虽然也可以通过queryString形式发送请求参数，但就会相当于使用get方式，不推荐</span></span><br><span class=\"line\"><span class=\"comment\">    3.解决乱码：1）服务器设置字符集 2）使用过滤器（推荐方式 3）客户端设置请求头</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">checkExists</span>(<span class=\"params\">username</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\">    xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(xhr.<span class=\"property\">readyState</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"number\">4</span> === xhr.<span class=\"property\">readyState</span> &amp;&amp; <span class=\"number\">200</span> === xhr.<span class=\"property\">status</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> data = xhr.<span class=\"property\">responseText</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"string\">&quot;true&quot;</span> === data) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;info&quot;</span>).<span class=\"property\">innerHTML</span> = <span class=\"string\">&quot;用户名可以使用&quot;</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"string\">&quot;false&quot;</span> === data) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;info&quot;</span>).<span class=\"property\">innerHTML</span> = <span class=\"string\">&quot;用户名已经存在&quot;</span>;</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;username&quot;</span>).<span class=\"title function_\">select</span>();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"title function_\">alert</span>(data);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;checkUsername?username=&quot;</span> + username, <span class=\"literal\">true</span>);</span><br><span class=\"line\">    xhr.<span class=\"title function_\">send</span>(<span class=\"literal\">null</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// xhr.open(&quot;post&quot;, &quot;checkUsername&quot;, true);</span></span><br><span class=\"line\">    <span class=\"comment\">// 设置请求头，可以指定字符集解决乱码问题，必须在xhr开启之后设置</span></span><br><span class=\"line\">    <span class=\"comment\">// xhr.setRequestHeader(&quot;Context-Type&quot;,&quot;application/x-www-form-urlencoded;charset=utf-8&quot;);</span></span><br><span class=\"line\">    <span class=\"comment\">// xhr.send(&quot;username=&quot;+username);</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CheckUsernameServlet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HttpServlet</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">service</span><span class=\"params\">(HttpServletRequest req, HttpServletResponse resp)</span> <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        resp.setContentType(<span class=\"string\">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">username</span> <span class=\"operator\">=</span> req.getParameter(<span class=\"string\">&quot;username&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">PrintWriter</span> <span class=\"variable\">writer</span> <span class=\"operator\">=</span> resp.getWriter();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">&quot;tom&quot;</span>.equals(username) || <span class=\"string\">&quot;cindy&quot;</span>.equals(username)) &#123;</span><br><span class=\"line\">            writer.print(<span class=\"string\">&quot;false&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            writer.print(<span class=\"string\">&quot;true&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        writer.flush();</span><br><span class=\"line\">        writer.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"jQuery实现Ajax\"><a href=\"#jQuery实现Ajax\" class=\"headerlink\" title=\"jQuery实现Ajax\"></a>jQuery实现Ajax</h2><p>传统方式实现Ajax的不足</p>\n<ul>\n<li>方法、属性、常用值较多，不好记忆</li>\n<li>步骤繁琐</li>\n<li>浏览器兼容性问题</li>\n</ul>\n<h3 id=\"jQuery常用Ajax方法\"><a href=\"#jQuery常用Ajax方法\" class=\"headerlink\" title=\"jQuery常用Ajax方法\"></a>jQuery常用Ajax方法</h3><table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">$.ajax()</td>\n<td align=\"left\">发送HTTP请求加载远程数据，最底层的Ajax实现</td>\n</tr>\n<tr>\n<td align=\"left\">$.get()</td>\n<td align=\"left\">发送HTTP GET请求加载数据</td>\n</tr>\n<tr>\n<td align=\"left\">$.post()</td>\n<td align=\"left\">发送HTTP POST请求加载数据</td>\n</tr>\n<tr>\n<td align=\"left\">$.getJSON()</td>\n<td align=\"left\">发送HTTP请求从服务器加载JSON数据</td>\n</tr>\n<tr>\n<td align=\"left\">load()</td>\n<td align=\"left\">发送Ajax请求从服务器加载数据，并把返回的数据放置到指定的元素中，最简单的方法</td>\n</tr>\n</tbody></table>\n<h3 id=\"ajax-settings-的参数属性说明\"><a href=\"#ajax-settings-的参数属性说明\" class=\"headerlink\" title=\"$.ajax([settings])的参数属性说明\"></a>$.ajax([settings])的参数属性说明</h3><table>\n<thead>\n<tr>\n<th align=\"left\">属性类型和名称</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">String type</td>\n<td align=\"left\">请求方式（POST或GET，默认为GET）</td>\n</tr>\n<tr>\n<td align=\"left\">String url</td>\n<td align=\"left\">发送请求的地址，默认为当前页地址</td>\n</tr>\n<tr>\n<td align=\"left\">boolean async</td>\n<td align=\"left\">true为同步，false为异步，默认为异步</td>\n</tr>\n<tr>\n<td align=\"left\">Object data 或 String data</td>\n<td align=\"left\">发送的数据类型，包括：XML、HTML、Script、JSON、JSONP、text（默认）</td>\n</tr>\n<tr>\n<td align=\"left\">Number timeout</td>\n<td align=\"left\">设置请求超时时间</td>\n</tr>\n<tr>\n<td align=\"left\">boolean global</td>\n<td align=\"left\">表示是否触发全局Ajax事件，默认为true</td>\n</tr>\n<tr>\n<td align=\"left\">processData</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">contentType</td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<h3 id=\"常用函数参数\"><a href=\"#常用函数参数\" class=\"headerlink\" title=\"常用函数参数\"></a>常用函数参数</h3><table>\n<thead>\n<tr>\n<th align=\"left\">函数</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">function success(Object result, String ts)</td>\n<td align=\"left\">请求成功后调用的函数</br>result：可选，由服务器返回的数据</br>ts：可选，type stirng ,描述请求类型的字符串</td>\n</tr>\n<tr>\n<td align=\"left\">function error(XMLHttpRequest xhr, String em,Exception e)</td>\n<td align=\"left\">请求失败时调用的函数</br>xhr：可选，请求失败的xhr对象</br>em：可选，error message ，错误信息</br>e：可选，捕获的异常对象</td>\n</tr>\n<tr>\n<td align=\"left\">function beforeSend(XMLHttpRequest xhr)</td>\n<td align=\"left\">发送请求前调用的函数</br>xhr：可选，发送请求的xhr对象</td>\n</tr>\n<tr>\n<td align=\"left\">function complete(XMLHttpRequest xhr, String ts)</td>\n<td align=\"left\">请求完成后调用的函数，不论成功与否</br>xhr：可选，发送请求的xhr对象</br>ts：可选，type stirng ,描述请求类型的字符串</td>\n</tr>\n</tbody></table>\n<h4 id=\"使用示例\"><a href=\"#使用示例\" class=\"headerlink\" title=\"使用示例\"></a>使用示例</h4><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> username = $(<span class=\"string\">&quot;#username&quot;</span>).<span class=\"title function_\">val</span>();</span><br><span class=\"line\"><span class=\"keyword\">var</span> pwd = $(<span class=\"string\">&quot;#pwd&quot;</span>).<span class=\"title function_\">val</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用$.ajax()发送ajax请求</span></span><br><span class=\"line\">$.<span class=\"title function_\">ajax</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&quot;post&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">url</span>: <span class=\"string\">&quot;login&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">async</span>: <span class=\"string\">&quot;true&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">data</span>: <span class=\"string\">&quot;username=&quot;</span> + username + <span class=\"string\">&quot;&amp;pwd=&quot;</span> + pwd,</span><br><span class=\"line\">    <span class=\"attr\">dataType</span>: <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">success</span>: <span class=\"keyword\">function</span> (<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">&quot;true&quot;</span> == data) &#123;</span><br><span class=\"line\">            $(<span class=\"string\">&quot;#login&quot;</span>).<span class=\"title function_\">text</span>(<span class=\"string\">&quot;OK&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            $(<span class=\"string\">&quot;#loginInfo&quot;</span>).<span class=\"title function_\">text</span>(<span class=\"string\">&quot;用户名或密码不正确&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">error</span>: <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        $(<span class=\"string\">&quot;#loginInfo&quot;</span>).<span class=\"title function_\">text</span>(<span class=\"string\">&quot;发送Ajax请求失败&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"get-x2F-post-url-data-success-resp-status-xhr-dataType\"><a href=\"#get-x2F-post-url-data-success-resp-status-xhr-dataType\" class=\"headerlink\" title=\"$.get&#x2F;post(url,data,success(resp,status,xhr),dataType)\"></a>$.get&#x2F;post(url,data,success(resp,status,xhr),dataType)</h3><p>常用参数</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">参数类型和名称</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">String url</td>\n<td align=\"left\">必选，请求的目的地址</td>\n</tr>\n<tr>\n<td align=\"left\">Object data 或 String data</td>\n<td align=\"left\">可选，发送到服务器端的数据</td>\n</tr>\n<tr>\n<td align=\"left\">fucntion success(Object result, String status, XMLHttpRequest xhr)</td>\n<td align=\"left\">可选，请求成功后调用的函数</br>result：可选，服务器返回的结果数据</br>status：可选，请求的状态</br>xhr：可选，发送请求的xhr对象</td>\n</tr>\n<tr>\n<td align=\"left\">String dataType</td>\n<td align=\"left\">可选，预期服务器返回的数据类型，包括：XML、HTML、Script、JSON、JSONP、text</td>\n</tr>\n</tbody></table>\n<h4 id=\"使用示例-1\"><a href=\"#使用示例-1\" class=\"headerlink\" title=\"使用示例\"></a>使用示例</h4><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用$.post()发送ajax请求</span></span><br><span class=\"line\">$.<span class=\"title function_\">post</span>(</span><br><span class=\"line\">    <span class=\"string\">&quot;login&quot;</span>, &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;username&quot;</span>: $(<span class=\"string\">&quot;#username&quot;</span>).<span class=\"title function_\">val</span>(),</span><br><span class=\"line\">        <span class=\"string\">&quot;pwd&quot;</span>: $(<span class=\"string\">&quot;#pwd&quot;</span>).<span class=\"title function_\">val</span>()</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"keyword\">function</span> (<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">&quot;true&quot;</span> == data) &#123;</span><br><span class=\"line\">            $(<span class=\"string\">&quot;#login&quot;</span>).<span class=\"title function_\">text</span>(<span class=\"string\">&quot;OK&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            $(<span class=\"string\">&quot;#loginInfo&quot;</span>).<span class=\"title function_\">text</span>(<span class=\"string\">&quot;用户名或密码不正确&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"getJSON-url-data-success-result-status-xhr\"><a href=\"#getJSON-url-data-success-result-status-xhr\" class=\"headerlink\" title=\"$.getJSON(url, data, success(result, status, xhr))\"></a>$.getJSON(url, data, success(result, status, xhr))</h3><table>\n<thead>\n<tr>\n<th align=\"left\">参数类型和名称</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">String url</td>\n<td align=\"left\">必选，请求的目的地址</td>\n</tr>\n<tr>\n<td align=\"left\">Object data 或 String data</td>\n<td align=\"left\">可选，发送到服务器端的数据</td>\n</tr>\n<tr>\n<td align=\"left\">fucntion success(Object result, String status, XMLHttpRequest xhr)</td>\n<td align=\"left\">可选，请求成功后调用的函数</br>result：可选，服务器返回的结果数据</br>status：可选，请求的状态</br>xhr：可选，发送请求的xhr对象</td>\n</tr>\n</tbody></table>\n<h4 id=\"使用示例-2\"><a href=\"#使用示例-2\" class=\"headerlink\" title=\"使用示例\"></a>使用示例</h4><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$.<span class=\"title function_\">getJSON</span>(<span class=\"string\">&quot;course.json&quot;</span>, <span class=\"literal\">null</span>, <span class=\"keyword\">function</span> (<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 循环返回的json数组</span></span><br><span class=\"line\">    $.<span class=\"title function_\">each</span>(data,<span class=\"keyword\">function</span> (<span class=\"params\">index,course</span>) &#123;</span><br><span class=\"line\">        $(<span class=\"string\">&quot;&lt;p&gt;&quot;</span>).<span class=\"title function_\">html</span>(course.<span class=\"property\">id</span> + <span class=\"string\">&quot;&amp;nbsp;&amp;nbsp;&quot;</span> + course.<span class=\"property\">name</span> + <span class=\"string\">&quot;&amp;nbsp;&amp;nbsp;&quot;</span> + course.<span class=\"property\">period</span> + <span class=\"string\">&quot;&amp;nbsp;&amp;nbsp;&quot;</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">appendTo</span>($(<span class=\"string\">&quot;#info&quot;</span>));</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"selector-load-url-data-function-result-status-xhr\"><a href=\"#selector-load-url-data-function-result-status-xhr\" class=\"headerlink\" title=\"$(selector).load(url,data,function(result,status,xhr))\"></a>$(selector).load(url,data,function(result,status,xhr))</h3><table>\n<thead>\n<tr>\n<th align=\"left\">参数类型和名称</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">String url</td>\n<td align=\"left\">必选，请求的目的地址</td>\n</tr>\n<tr>\n<td align=\"left\">Object data 或 String data</td>\n<td align=\"left\">可选，发送到服务器端的数据</td>\n</tr>\n<tr>\n<td align=\"left\">fucntion callback(Object result, String status, XMLHttpRequest xhr)</td>\n<td align=\"left\">可选，请求成功后调用的函数</br>result：可选，服务器返回的结果数据</br>status：可选，请求的状态</br>xhr：可选，发送请求的xhr对象</td>\n</tr>\n</tbody></table>\n<h4 id=\"使用示例-3\"><a href=\"#使用示例-3\" class=\"headerlink\" title=\"使用示例\"></a>使用示例</h4><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">doLoad</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    $(<span class=\"string\">&quot;#info&quot;</span>).<span class=\"title function_\">load</span>(<span class=\"string\">&quot;course.html&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"表单的序列化\"><a href=\"#表单的序列化\" class=\"headerlink\" title=\"表单的序列化\"></a>表单的序列化</h3><p>对表单元素使用serialize()方法，能够自动将表单中有name属性的输入元素序列化</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> params = $(<span class=\"string\">&quot;#login&quot;</span>).<span class=\"title function_\">serialize</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(params);</span><br><span class=\"line\"><span class=\"comment\">//username=user&amp;password=pwd</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;login&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;username&quot;</span>&gt;</span>用户名：<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span>/&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;pwd&quot;</span>&gt;</span>密码：<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;pwd&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;pwd&quot;</span>/&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;登录&quot;</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&quot;doLogin()&quot;</span>/&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;loginInfo&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用Ajax返回纯文本\"><a href=\"#使用Ajax返回纯文本\" class=\"headerlink\" title=\"使用Ajax返回纯文本\"></a>使用Ajax返回纯文本</h3><p>优点：可读性好，数据量小，效率高<br>缺点：若需要通过Ajax更新文档的多个部分，纯文本不合适；不适合复杂数据</p>\n<h3 id=\"使用Ajax返回XML\"><a href=\"#使用Ajax返回XML\" class=\"headerlink\" title=\"使用Ajax返回XML\"></a>使用Ajax返回XML</h3><h3 id=\"使用Ajax返回JSON\"><a href=\"#使用Ajax返回JSON\" class=\"headerlink\" title=\"使用Ajax返回JSON\"></a>使用Ajax返回JSON</h3><h2 id=\"Ajax跨域请求\"><a href=\"#Ajax跨域请求\" class=\"headerlink\" title=\"Ajax跨域请求\"></a>Ajax跨域请求</h2><p>一个完整的URL包括8个部分（protocol、host、port、path、resource、query、string、anchor、auth），以上部分若protocol、host和port中有任何一个不同就是跨域<br>浏览器的同源策略限制XMLHttpRequest向另外一个网站发送请求，即Ajax是无法直接跨域的<br>跨域的解决方式：</p>\n<ul>\n<li>JSONP</li>\n<li>CORS</li>\n<li>iframe</li>\n</ul>\n<h3 id=\"JSONP（JSON-with-Padding）\"><a href=\"#JSONP（JSON-with-Padding）\" class=\"headerlink\" title=\"JSONP（JSON with Padding）\"></a>JSONP（JSON with Padding）</h3><p>JSONP(JSON with Padding) 是 json 的一种”使用模式”，可以让网页从别的域名（网站）那获取资料，即跨域读取数据</p>\n<p>JSONP只支持GET请求方式，即使使用POST方式，也会自动被转换为GET方式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">callbackFunction</span>(<span class=\"params\">result, methodName</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> html = <span class=\"string\">&#x27;&lt;ul&gt;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; result.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">            html += <span class=\"string\">&#x27;&lt;li&gt;&#x27;</span> + result[i] + <span class=\"string\">&#x27;&lt;/li&gt;&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        html += <span class=\"string\">&#x27;&lt;/ul&gt;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;info&#x27;</span>).<span class=\"property\">innerHTML</span> = html;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">doSend</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> script = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;script&quot;</span>);</span><br><span class=\"line\">        script.<span class=\"property\">src</span> = <span class=\"string\">&quot;https://www.runoob.com/try/ajax/jsonp.php?jsoncallback=callbackFunction&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">appendChild</span>(script);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;发送跨域请求&quot;</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&quot;doSend()&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;info&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p>数据源从jsonp.php之中来</p>\n<p>一般的数据api都会支持jsonp的调用方式，此时需要在请求参数中指定返回数据格式为jsonp，并指定回调callback的名字</p>\n<p>jQuery对于JSONP的封装</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$.<span class=\"title function_\">ajax</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&quot;post&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">url</span>: <span class=\"string\">&#x27;url&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">async</span>: <span class=\"string\">&quot;true&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">dataType</span>: <span class=\"string\">&quot;jsonp&quot;</span>, <span class=\"comment\">// 会自动生成回调函数名称，指向success对应的函数</span></span><br><span class=\"line\">    <span class=\"attr\">jsonp</span>:<span class=\"string\">&quot;callback&quot;</span>, <span class=\"comment\">// 指定JSONP使用的回调函数变量名称，默认值为callback</span></span><br><span class=\"line\">    <span class=\"attr\">success</span>: <span class=\"keyword\">function</span> (<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">error</span>: <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        $(<span class=\"string\">&quot;#loginInfo&quot;</span>).<span class=\"title function_\">text</span>(<span class=\"string\">&quot;发送Ajax请求失败&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;url&#x27;</span>,<span class=\"literal\">null</span>,<span class=\"keyword\">function</span>(<span class=\"params\">data</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data);</span><br><span class=\"line\">&#125;,<span class=\"string\">&quot;jsonp&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"CORS（Cross-Origin-Resource-Sharing）\"><a href=\"#CORS（Cross-Origin-Resource-Sharing）\" class=\"headerlink\" title=\"CORS（Cross-Origin Resource Sharing）\"></a>CORS（Cross-Origin Resource Sharing）</h3><p>CORS是一种允许当前域（domain）的资源（比如html&#x2F;js&#x2F;web service）被其他域（domain）的脚本请求访问的机制</p>\n<p>在服务器算允许跨域请求</p>\n<p>定义在servlet中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">res.<span class=\"title function_\">setHeader</span>(<span class=\"string\">&quot;Access-Control-Allow-Origin&quot;</span>, <span class=\"string\">&quot;*&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>在客户端中需在请求头中添加Origin字段表示请求源地址（一般会自动添加）</p>\n<h2 id=\"前端模板引擎\"><a href=\"#前端模板引擎\" class=\"headerlink\" title=\"前端模板引擎\"></a>前端模板引擎</h2><h3 id=\"artTemplate\"><a href=\"#artTemplate\" class=\"headerlink\" title=\"artTemplate\"></a>artTemplate</h3><figure class=\"highlight jsp\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!-- 引入模板引擎 --&gt;</span><br><span class=\"line\">&lt;script src=<span class=\"string\">&quot;template-web.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;!-- 定义模板，使用简洁语法 --&gt;</span><br><span class=\"line\">&lt;script id=<span class=\"string\">&quot;myTemplate&quot;</span> type=<span class=\"string\">&quot;text/html&quot;</span>&gt;</span><br><span class=\"line\">&lt;h2&gt;班级名称：&#123;&#123;className&#125;&#125;&lt;/h2&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;ul&gt;</span><br><span class=\"line\">    &#123;&#123;each student as student i&#125;&#125;</span><br><span class=\"line\">        &lt;li&gt;序号：&#123;&#123;i+<span class=\"number\">1</span>&#125;&#125;，学号：&#123;&#123;student.id&#125;&#125;，姓名：&#123;&#123;student.name&#125;&#125;&lt;/li&gt;</span><br><span class=\"line\">    &#123;&#123;/each&#125;&#125;</span><br><span class=\"line\">&lt;/ul&gt;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- 定义模板，使用原生语法 --&gt;</span><br><span class=\"line\">&lt;script id=<span class=\"string\">&quot;mTemplate&quot;</span> type=<span class=\"string\">&quot;text/html&quot;</span>&gt;</span><br><span class=\"line\">    &lt;h2&gt;班级名称：&lt;%=className %&gt;&lt;/h2&gt;</span><br><span class=\"line\">    &lt;ul&gt;</span><br><span class=\"line\">        &lt;% <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>;i&lt;students.length;i++)&#123;%&gt;</span><br><span class=\"line\">        &lt;li&gt;序号：&lt;%=i+<span class=\"number\">1</span>%&gt;，学号：&lt;%=students[i].id%&gt;，姓名：&lt;%=students[i].name%&gt;&lt;/li&gt;</span><br><span class=\"line\">        &lt;% &#125; %&gt;</span><br><span class=\"line\">    &lt;/ul&gt;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">var</span> data = &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"attr\">className</span>: <span class=\"string\">&quot;javaClass&quot;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"attr\">student</span>: [</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"attr\">id</span>: <span class=\"number\">1001</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"attr\">name</span>: <span class=\"string\">&quot;adam&quot;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"attr\">id</span>: <span class=\"number\">1002</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"attr\">name</span>: <span class=\"string\">&quot;bob&quot;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"attr\">id</span>: <span class=\"number\">1003</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"attr\">name</span>: <span class=\"string\">&quot;cindy&quot;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"attr\">id</span>: <span class=\"number\">1004</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"attr\">name</span>: <span class=\"string\">&quot;duke&quot;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        ]</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &lt;!-- 渲染引擎 --&gt;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    $(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> result = <span class=\"title function_\">template</span>(<span class=\"string\">&quot;myTemplate&quot;</span>, data);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        $(<span class=\"string\">&quot;#info&quot;</span>).<span class=\"title function_\">html</span>(result);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","categories":["Web"]},{"title":"CSS笔记","url":"/%E7%AC%94%E8%AE%B0/%E5%89%8D%E7%AB%AF/CSS%E7%AC%94%E8%AE%B0/","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>CSS：Cascading Style Sheet 层叠样式表</p>\n<p>是一组样式设置规则，用于控制页面的外观样式</p>\n<ul>\n<li>页面外观美化</li>\n<li>布局和定位</li>\n</ul>\n<h2 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h2><h3 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h3><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span>\t</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/css&quot;</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        选择器&#123;</span></span><br><span class=\"line\"><span class=\"language-css\">\t\t属性名:属性值;</span></span><br><span class=\"line\"><span class=\"language-css\">\t\t属性名:属性值;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>选择器：要修饰的对象（东西）</li>\n<li>属性名：修饰对象的哪个属性（样式）</li>\n<li>属性值：属性的取值</li>\n</ul>\n<h3 id=\"引用方式\"><a href=\"#引用方式\" class=\"headerlink\" title=\"引用方式\"></a>引用方式</h3><p>内部样式、行内样式、外部样式</p>\n<h4 id=\"内部样式\"><a href=\"#内部样式\" class=\"headerlink\" title=\"内部样式\"></a>内部样式</h4><p>也称为内嵌样式，在页面头部通过style标签定义</p>\n<p>对当前页面所有符合样式选择器的标签都有效</p>\n<h4 id=\"行内样式\"><a href=\"#行内样式\" class=\"headerlink\" title=\"行内样式\"></a>行内样式</h4><p>也称为嵌入样式，使用HTML标签的style属性定义</p>\n<p>只对设置了style属性的标签有效</p>\n<h4 id=\"外部样式\"><a href=\"#外部样式\" class=\"headerlink\" title=\"外部样式\"></a>外部样式</h4><p>使用单独的 .css 文件定义，然后在页面中使用link标签引入外部样式表</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;link rel=<span class=\"string\">&quot;stylesheet&quot;</span> href=<span class=\"string\">&quot;css样式文件的路径&quot;</span> type=<span class=\"string\">&quot;text/css&quot;</span>&gt;</span><br></pre></td></tr></table></figure>\n\n<p>所有引入样式表文件的页面都有效</p>\n<h2 id=\"选择器\"><a href=\"#选择器\" class=\"headerlink\" title=\"选择器\"></a>选择器</h2><h3 id=\"基础选择器\"><a href=\"#基础选择器\" class=\"headerlink\" title=\"基础选择器\"></a>基础选择器</h3><h4 id=\"标签选择器\"><a href=\"#标签选择器\" class=\"headerlink\" title=\"标签选择器\"></a>标签选择器</h4><p>也称为元素选择器，使用HTML标签作为选择器名称</p>\n<p>以标签名作为样式应用依据</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"类选择器\"><a href=\"#类选择器\" class=\"headerlink\" title=\"类选择器\"></a>类选择器</h4><p>使用自定义名称，以 . 作为前缀，然后通过HTML标签的class属性调用类选择器</p>\n<p>以标签的class属性值作为样式的应用依据</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.sidebar-span</span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>调用时不能添加 <code>.</code> 号</li>\n<li>同时调用多个类选择器时以空格隔开</li>\n<li>类选择器名称不能以数字开头</li>\n</ul>\n<h4 id=\"ID选择器\"><a href=\"#ID选择器\" class=\"headerlink\" title=\"ID选择器\"></a>ID选择器</h4><p>使用自定义名称，以#作为前缀，然后通过HTML标签的id属性进行名称自动匹配</p>\n<p>以标签的id属性值作为样式应用依据，一对一的关系</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-id\">#id01</span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"复杂选择器\"><a href=\"#复杂选择器\" class=\"headerlink\" title=\"复杂选择器\"></a>复杂选择器</h3><h4 id=\"复合选择器\"><a href=\"#复合选择器\" class=\"headerlink\" title=\"复合选择器\"></a>复合选择器</h4><p>标签选择器和类选择器、标签选择器和ID选择器，一起使用</p>\n<p>必须同时满足两个条件才能应用样式</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span><span class=\"selector-class\">.classA</span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">div</span><span class=\"selector-id\">#id01</span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"组合选择器\"><a href=\"#组合选择器\" class=\"headerlink\" title=\"组合选择器\"></a>组合选择器</h4><p>也称为集体声明</p>\n<p>将多个具有相同样式的选择器放在一起声明，使用逗号,隔开</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.classA</span>,<span class=\"selector-class\">.hello</span>,<span class=\"selector-tag\">div</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"嵌套选择器\"><a href=\"#嵌套选择器\" class=\"headerlink\" title=\"嵌套选择器\"></a>嵌套选择器</h4><p>在某个选择器内再设置选择器，通过空格隔开，表示只有满足层次关系最里层的选择器所对应的的标签才会应用样式</p>\n<p>使用空格时不区分父子还是后代，使用 &gt; 时必须是父子关系才行</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span> <span class=\"selector-tag\">span</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-style</span>: italic;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">div</span> &gt; <span class=\"selector-tag\">p</span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"伪类选择器\"><a href=\"#伪类选择器\" class=\"headerlink\" title=\"伪类选择器\"></a>伪类选择器</h4><p>根据不同的状态显示不同的样式，比如a标签的四种状态：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">:link</span><br><span class=\"line\">:visited</span><br><span class=\"line\">:hover</span><br><span class=\"line\">:active</span><br></pre></td></tr></table></figure>\n\n<p>要注意四种状态的书写顺序：link -&gt; visited -&gt; hover -&gt; active</p>\n<h3 id=\"选择器优先级\"><a href=\"#选择器优先级\" class=\"headerlink\" title=\"选择器优先级\"></a>选择器优先级</h3><h4 id=\"优先级\"><a href=\"#优先级\" class=\"headerlink\" title=\"优先级\"></a>优先级</h4><p>行内样式 &gt; ID选择器 &gt; 类选择器 &gt; 标签选择器</p>\n<p>首先加载标签选择器，再加载类选择器，然后加载ID选择器，最后加载行内样式<br>后加载的会覆盖先加载的同名样式</p>\n<h4 id=\"内外部样式加载顺序\"><a href=\"#内外部样式加载顺序\" class=\"headerlink\" title=\"内外部样式加载顺序\"></a>内外部样式加载顺序</h4><p>就近原则：按照书写顺序依次加载，在同优先级的情况下，后加载的会覆盖先加载的同名样式，所以离得越近越优先</p>\n<h4 id=\"important\"><a href=\"#important\" class=\"headerlink\" title=\"!important\"></a>!important</h4><p>可以使用!important使某个样式属性具有最高的优先级</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">color</span>：red!important;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"常用CSS属性\"><a href=\"#常用CSS属性\" class=\"headerlink\" title=\"常用CSS属性\"></a>常用CSS属性</h2><h3 id=\"字体属性\"><a href=\"#字体属性\" class=\"headerlink\" title=\"字体属性\"></a>字体属性</h3><table>\n<thead>\n<tr>\n<th align=\"left\">属性</th>\n<th align=\"left\">含义</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">font-size</td>\n<td align=\"left\">大小、尺寸</td>\n<td align=\"left\">所有CSS属性的默认值都为inherit</td>\n</tr>\n<tr>\n<td align=\"left\">font-weight</td>\n<td align=\"left\">粗细</td>\n<td align=\"left\">取值：normal、bold</td>\n</tr>\n<tr>\n<td align=\"left\">font-family</td>\n<td align=\"left\">字体</td>\n<td align=\"left\">取值：黑体楷体等</td>\n</tr>\n<tr>\n<td align=\"left\">font-style</td>\n<td align=\"left\">样式</td>\n<td align=\"left\">取值：normal、italic</td>\n</tr>\n</tbody></table>\n<h3 id=\"文本属性\"><a href=\"#文本属性\" class=\"headerlink\" title=\"文本属性\"></a>文本属性</h3><table>\n<thead>\n<tr>\n<th align=\"left\">属性</th>\n<th align=\"left\">含义</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">color</td>\n<td align=\"left\">颜色</td>\n<td align=\"left\">使用英文单词，十六进制的RGB值，特定情况下可以缩写，如#FFFFFF -&gt; #FFF</td>\n</tr>\n<tr>\n<td align=\"left\">line-height</td>\n<td align=\"left\">行高</td>\n<td align=\"left\">行内容的高度，也可以简单的理解为行之间的距离</td>\n</tr>\n<tr>\n<td align=\"left\">text-align</td>\n<td align=\"left\">水平对齐方式</td>\n<td align=\"left\">取值：left、center、right</td>\n</tr>\n<tr>\n<td align=\"left\">vertical-align</td>\n<td align=\"left\">垂直对齐方式</td>\n<td align=\"left\">取值：top、middle、bottom，可用于图片和文字的对齐方式</td>\n</tr>\n<tr>\n<td align=\"left\">text-decoration</td>\n<td align=\"left\">文本修饰</td>\n<td align=\"left\">取值：underline、overline、line-through</td>\n</tr>\n</tbody></table>\n<h3 id=\"背景属性\"><a href=\"#背景属性\" class=\"headerlink\" title=\"背景属性\"></a>背景属性</h3><table>\n<thead>\n<tr>\n<th align=\"left\">属性</th>\n<th align=\"left\">含义</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">background-color</td>\n<td align=\"left\">背景颜色</td>\n<td align=\"left\">背景颜色</td>\n</tr>\n<tr>\n<td align=\"left\">background-image</td>\n<td align=\"left\">背景图片</td>\n<td align=\"left\">必须使用url</td>\n</tr>\n<tr>\n<td align=\"left\">background-repeat</td>\n<td align=\"left\">背景图片的重复方式</td>\n<td align=\"left\">取值：repeat（默认）、repeat-x、repeat-y、no-repeat</td>\n</tr>\n<tr>\n<td align=\"left\">background-position</td>\n<td align=\"left\">背景图片的显示位置</td>\n<td align=\"left\">取值：关键字（top、bottom、left、right、center）、坐标</td>\n</tr>\n<tr>\n<td align=\"left\">background</td>\n<td align=\"left\">上面几项的合并写法</td>\n<td align=\"left\">一般顺序：颜色|图片|重复方式|显示位置</td>\n</tr>\n</tbody></table>\n<h3 id=\"列表属性\"><a href=\"#列表属性\" class=\"headerlink\" title=\"列表属性\"></a>列表属性</h3><p>使用list-style属性设置列表项前的标记</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">ul</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">list-style</span>:decimal;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"浮动元素\"><a href=\"#浮动元素\" class=\"headerlink\" title=\"浮动元素\"></a>浮动元素</h3><p>通过float属性实现元素的浮动</p>\n<ul>\n<li>left 左浮动</li>\n<li>right 右浮动</li>\n<li>none 不浮动，默认值</li>\n</ul>\n<h3 id=\"元素的显示和隐藏\"><a href=\"#元素的显示和隐藏\" class=\"headerlink\" title=\"元素的显示和隐藏\"></a>元素的显示和隐藏</h3><p>通过display属性设置元素是否显示，以及是否独占一行</p>\n<p>常用取值：</p>\n<ul>\n<li>none 不显示</li>\n<li>inline 将块级元素变为行级元素，不再独占一行</li>\n<li>block 将行级元素变为块级元素，独占一行</li>\n<li>inline-block 在inline的基础上允许设置宽和高</li>\n</ul>\n<p>行级元素默认无法设置宽和高，可以为行级元素设置display：inline-block，然后再设置宽和高</p>\n<h2 id=\"盒子模型\"><a href=\"#盒子模型\" class=\"headerlink\" title=\"盒子模型\"></a>盒子模型</h2><p>盒子模型是网页布局的基础，将页面中所有的元素都看作成一个盒子，盒子都包含以下几个属性：</p>\n<ul>\n<li>width 宽度</li>\n<li>height 高度</li>\n<li>border 边框</li>\n<li>padding 内边距</li>\n<li>margin 外边距</li>\n</ul>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/%E5%89%8D%E7%AB%AF/CSS%E7%AC%94%E8%AE%B0/%E7%9B%92%E5%AD%90%E6%A8%A1%E5%9E%8B.png\" alt=\"盒子模型.png\"></p>\n<h3 id=\"border\"><a href=\"#border\" class=\"headerlink\" title=\"border\"></a>border</h3><ul>\n<li>表示盒子的边框</li>\n<li>分为四个方向：上top、右right、下bottom、左left</li>\n<li>每个边都包含三种样式：颜色color、粗细width、样式style</li>\n<li>border-style的取值：solid实线、dashed虚线、dotted点状线、double双线等</li>\n</ul>\n<p>简写，三种方式：</p>\n<ul>\n<li>按方向简写：<ul>\n<li>border-top、border-right、border-bottom、border-left</li>\n<li>书写顺序，border-方向 width style color</li>\n</ul>\n</li>\n<li>按样式简写：<ul>\n<li>border-color、border-with、border-style、bor-radius圆角</li>\n<li>书写顺序，border-样式：top right bottom left</li>\n<li>必须按顺时针方向书写，即：上、右、下、左的顺序，同时可以缩写</li>\n<li>如果省略，则认为上下一样、左右一样<ul>\n<li>border-with：2px\t四个边的宽度都为2px</li>\n<li>border-width：2px 4px\t上下边为2px、左右边为4px</li>\n<li>border-width：2px 3px 4px\t上边2px、右边3px、下边4px、左边跟随右边为3px</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>终极简写：<ul>\n<li>如果四个边都一样，border：width style color</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"padding\"><a href=\"#padding\" class=\"headerlink\" title=\"padding\"></a>padding</h3><p>表示盒子的内边距，即内容与边框之间的距离</p>\n<p>同样也分为四个方向，也可以简写（按顺时针方向，默认上下一样，左右一样）</p>\n<h3 id=\"元素所占空间\"><a href=\"#元素所占空间\" class=\"headerlink\" title=\"元素所占空间\"></a>元素所占空间</h3><p>页面中的元素实际所占空间：</p>\n<ul>\n<li>宽&#x3D;width+左右padding+左右border+左右margin</li>\n<li>高&#x3D;height+上下padding+上下border+上下margin</li>\n</ul>\n<h2 id=\"定位方式\"><a href=\"#定位方式\" class=\"headerlink\" title=\"定位方式\"></a>定位方式</h2><p>通过position属性实现对元素的定位，有四种定位方式</p>\n<p>常用取值：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">取值</th>\n<th align=\"left\">含义</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">static</td>\n<td align=\"left\">默认值</td>\n<td align=\"left\">按照常规文档流进行显示</td>\n</tr>\n<tr>\n<td align=\"left\">relative</td>\n<td align=\"left\">相对定位</td>\n<td align=\"left\">相对于标签原来位置进行的定位</td>\n</tr>\n<tr>\n<td align=\"left\">absolute</td>\n<td align=\"left\">绝对定位</td>\n<td align=\"left\">相对于第一个非static定位的父标签的定位</td>\n</tr>\n<tr>\n<td align=\"left\">fixed</td>\n<td align=\"left\">固定定位</td>\n<td align=\"left\">相对于浏览器窗口进行定位</td>\n</tr>\n</tbody></table>\n<p>设置定位方式后，还需要设置定位属性（偏移量）：top、bottom、left、right</p>\n<h3 id=\"相对定位\"><a href=\"#相对定位\" class=\"headerlink\" title=\"相对定位\"></a>相对定位</h3><p>先设置元素的position属性为relative，然后再设置偏移量</p>\n<h3 id=\"绝对定位\"><a href=\"#绝对定位\" class=\"headerlink\" title=\"绝对定位\"></a>绝对定位</h3><p>先设置父标签为非static定位，然后设置元素的position属性为absolute，最后再设置偏移量</p>\n<p>注意事项：</p>\n<ul>\n<li>一般来说都会设置父标签为非static定位</li>\n<li>如果父标签不是非static定位，则会相对于浏览器窗口进行定位</li>\n<li>设置元素为且对定位后，元素会浮在页面上方</li>\n<li>z-index属性可以设置覆盖的优先级，只能用于非static定位的属性</li>\n</ul>\n<h3 id=\"固定定位\"><a href=\"#固定定位\" class=\"headerlink\" title=\"固定定位\"></a>固定定位</h3><p>先设置元素的position属性为fixed，然后再设置偏移量</p>\n<p>注意事项：</p>\n<ul>\n<li>固定定位相当于没有找到非static定位的父标签的绝对定位</li>\n<li>设置元素为固定定位后，元素会浮在页面上方</li>\n</ul>\n","categories":["Web"]},{"title":"HTML笔记","url":"/%E7%AC%94%E8%AE%B0/%E5%89%8D%E7%AB%AF/HTML%E7%AC%94%E8%AE%B0/","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><ul>\n<li>HTML是什么<ul>\n<li>HTML：Hyper Text Markup Language ，超文本标签语言</li>\n<li>由各种标签组成，用来只做网页，告诉浏览器该如何显示页面</li>\n</ul>\n</li>\n<li>版本<ul>\n<li>W3C：World Wide Web Consortium 万维网联盟，制定Web技术相关标准和规范的组织，HTML就是W3C制定的标准</li>\n<li>两个版本：HTML4.01、HTML5</li>\n<li>官网：<a href=\"https://www.w3school.com.cn/\">w3school</a></li>\n</ul>\n</li>\n<li>后缀名<ul>\n<li>HTML文件以 .html 或 .htm 为后缀</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"HTML文档结构\"><a href=\"#HTML文档结构\" class=\"headerlink\" title=\"HTML文档结构\"></a>HTML文档结构</h2><h3 id=\"基本结构\"><a href=\"#基本结构\" class=\"headerlink\" title=\"基本结构\"></a>基本结构</h3><ul>\n<li>HTML标签是由尖括号包围的关键词，如<code>&lt;html&gt;</code>，通常都是成对出现，如<code>&lt;html&gt;&lt;/html&gt;</code></li>\n<li>以<html>标签为根标签，包含<code>&lt;head&gt;</code>头部和<code>&lt;body&gt;</code>主体部分</li>\n<li>头部提供关于网页的相关信息，如标题、字符编码、关键字等摘要信息</li>\n<li>主体部分提供网页的具体内容，真正显示在页面中</li>\n<li>可以在网页文件的第一行使用<code>&lt;!DOCTYPE html&gt;</code>声明文档的类型，表示使用HTML5版本规范</li>\n<li>合理的进行缩进；标签名不区分大小写，但一般都习惯全小写</li>\n</ul>\n<h3 id=\"标签\"><a href=\"#标签\" class=\"headerlink\" title=\"标签\"></a>标签</h3><h4 id=\"组成\"><a href=\"#组成\" class=\"headerlink\" title=\"组成\"></a>组成</h4><p>一个完整的HTML标签的组成：<code>&lt;标签名 属性名=&quot;属性值&quot;&gt;内容&lt;/标签名&gt;</code></p>\n<p>属性值要用引号引起来，一般使用双引号，多个属性用空格分开</p>\n<h4 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h4><p>根据标签是否关闭，可以分为：关闭型和非关闭型</p>\n<ul>\n<li>关闭型：html head body h1</li>\n<li>非关闭型： br hr meta</li>\n</ul>\n<p>根据标签是否独占一行，可以分为块级元素和行级元素</p>\n<ul>\n<li>块级元素 div h1</li>\n<li>行级元素 span</li>\n</ul>\n<h3 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h3><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- --&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"实体字符\"><a href=\"#实体字符\" class=\"headerlink\" title=\"实体字符\"></a>实体字符</h3><p>也称为特殊字符，用于显示一些特殊符号，如：<code>&lt;</code>、<code>&gt;</code>、<code>&amp;</code>、空格等。</p>\n<p>常用实体字符：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">实体字符</th>\n<th align=\"center\">显示符号</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><code>&amp;lt;</code></td>\n<td align=\"center\">&lt;</td>\n</tr>\n<tr>\n<td align=\"center\"><code>&amp;gt;</code></td>\n<td align=\"center\">&gt;</td>\n</tr>\n<tr>\n<td align=\"center\"><code>&amp;amp;</code></td>\n<td align=\"center\">&amp;</td>\n</tr>\n<tr>\n<td align=\"center\"><code>&amp;nbsp;</code></td>\n<td align=\"center\">空格（对于连续的空白字符，在浏览器中显示时只会显示一个空格）</td>\n</tr>\n<tr>\n<td align=\"center\"><code>&amp;copy;</code></td>\n<td align=\"center\">© 版权符号</td>\n</tr>\n<tr>\n<td align=\"center\"><code>&amp;reg;</code></td>\n<td align=\"center\">® 注册符号</td>\n</tr>\n</tbody></table>\n<p><strong>实体字符名大小写敏感</strong></p>\n<h2 id=\"常用标签\"><a href=\"#常用标签\" class=\"headerlink\" title=\"常用标签\"></a>常用标签</h2><h3 id=\"基本标签\"><a href=\"#基本标签\" class=\"headerlink\" title=\"基本标签\"></a>基本标签</h3><table>\n<thead>\n<tr>\n<th align=\"center\">标签</th>\n<th align=\"center\">含义</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">br</td>\n<td align=\"center\">换行标签</td>\n<td align=\"left\">非关闭型</td>\n</tr>\n<tr>\n<td align=\"center\">p</td>\n<td align=\"center\">段落标签</td>\n<td align=\"left\">关闭型，块级元素，上下游明显的间隔</td>\n</tr>\n<tr>\n<td align=\"center\">h1、h2…h6</td>\n<td align=\"center\">标题标签</td>\n<td align=\"left\">按照h1到h6逐渐变小，块级元素，加粗显示</td>\n</tr>\n<tr>\n<td align=\"center\">div</td>\n<td align=\"center\">分区标签</td>\n<td align=\"left\">常作为容器来使用，一般用在页面布局中，块级元素</td>\n</tr>\n<tr>\n<td align=\"center\">span</td>\n<td align=\"center\">范围标签</td>\n<td align=\"left\">默认没有任何效果，一般用来设置行内的特殊样式</td>\n</tr>\n<tr>\n<td align=\"center\">ol、li</td>\n<td align=\"center\">有序列表</td>\n<td align=\"left\">有顺序的项目列表</td>\n</tr>\n<tr>\n<td align=\"center\">ul、li</td>\n<td align=\"center\">无序列表</td>\n<td align=\"left\">无顺序的项目列表</td>\n</tr>\n<tr>\n<td align=\"center\">hr</td>\n<td align=\"center\">水平线标签</td>\n<td align=\"left\">非关闭型，块级元素</td>\n</tr>\n<tr>\n<td align=\"center\">img</td>\n<td align=\"center\">图像标签</td>\n<td align=\"left\">非关闭型，行级元素</td>\n</tr>\n</tbody></table>\n<p>hr标签的常用属性：</p>\n<ul>\n<li>color颜色<ul>\n<li>两种写法：<ul>\n<li>颜色名称，如red、green、blue…</li>\n<li>十六进制的RBG，用法：#RRBBGG，每个颜色的范围是0-255，转换为十六进制是00-FF<ul>\n<li>如#FF0000 红色、#00FF00 绿色、#FFFFFF白色等</li>\n<li>简写的要求：三种颜色各自颜色的两位值必须都相同。如：#f00、#ccc</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>size 粗细</li>\n<li>width 宽度<ul>\n<li>两种写法：<ul>\n<li>像素，绝对值（固定值）</li>\n<li>百分比，相对值，相对于父容器的宽度百分比</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>align 对齐<ul>\n<li>取值：center（默认值）、left、right</li>\n</ul>\n</li>\n</ul>\n<p>img标签的常用属性：</p>\n<ul>\n<li>src 源，source，指定图片的路径，必须要有<ul>\n<li>指定的图片默认以html文件所在文件夹为根</li>\n</ul>\n</li>\n<li>alt 当图片无法显示时的提示信息</li>\n<li>title 当鼠标停留在图片上时显示的提示信息</li>\n<li>width&#x2F;height 设置图片的宽和高<ul>\n<li>默认按图片原尺寸显示</li>\n<li>如果只设置其中一个，则另一个按比例缩放</li>\n<li>如果同时设置宽和高，可能会导致图片变形</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"标签嵌套\"><a href=\"#标签嵌套\" class=\"headerlink\" title=\"标签嵌套\"></a>标签嵌套</h3><p>标签嵌套有自己的规则，不能随意嵌套</p>\n<p>浏览器渲染后显示的页面与编码时可能会有所不同</p>\n<h3 id=\"开发者工具\"><a href=\"#开发者工具\" class=\"headerlink\" title=\"开发者工具\"></a>开发者工具</h3><p>用来帮助开发人员查看和调试页面，浏览器基本上都提供了类似的工具。在页面中右击 -&gt; 检查&#x2F;查看&#x2F;审查元素 -&gt; 按F12</p>\n<p>常用工具：</p>\n<ul>\n<li>Console：控制台，显示各种警告和错误信息</li>\n<li>Elements：从浏览器的角度查看页面，浏览器渲染页面时的HTML、CSS、DOM等</li>\n<li>Network：查看网络请求信息，浏览器向服务器请求了哪些资源、资源的大小以及加载资源花费的时间</li>\n</ul>\n<h3 id=\"超链接\"><a href=\"#超链接\" class=\"headerlink\" title=\"超链接\"></a>超链接</h3><p>使用超链接可以从一个页面跳转到另一个页面，实现页面间的导航。一般地，当把鼠标移动到超链接上时，鼠标样式会改变</p>\n<p>使用<code>&lt;a&gt;</code>标签来创建超链接</p>\n<h4 id=\"超链接的种类\"><a href=\"#超链接的种类\" class=\"headerlink\" title=\"超链接的种类\"></a>超链接的种类</h4><ul>\n<li>普通链接，跳转到另一个页面</li>\n<li>锚链接，跳转到锚点</li>\n<li>功能新链接，实现特殊功能</li>\n</ul>\n<h5 id=\"普通链接\"><a href=\"#普通链接\" class=\"headerlink\" title=\"普通链接\"></a>普通链接</h5><p>语法：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;链接地址&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;链接打开位置&quot;</span>&gt;</span>链接文本或图像<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>常用属性：<ul>\n<li>href 链接地址&#x2F;路径，必须要有</li>\n<li>target 链接打开的位置，常用取值： _self（在当前页面打开，默认值）、_blank（在新页面打开）</li>\n</ul>\n</li>\n<li>路径分类：<ul>\n<li>相对路径<ul>\n<li>相对于当前文件的路径</li>\n</ul>\n</li>\n<li>绝对路径</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"锚链接\"><a href=\"#锚链接\" class=\"headerlink\" title=\"锚链接\"></a>锚链接</h5><p>点击链接后跳转到指定的位置（锚点anchor）</p>\n<p>使用步骤：</p>\n<p>1.定义锚点（标记）</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;锚点名称&quot;</span>&gt;</span>目标位置<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>2.链接锚点</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;#锚点名称&quot;</span>&gt;</span>当前位置<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"功能性链接\"><a href=\"#功能性链接\" class=\"headerlink\" title=\"功能性链接\"></a>功能性链接</h5><p>下载或执行JavaScript脚本之类的</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;images/pic.gif&quot;</span>&gt;</span>点击此处下载图片<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;clicked!&#x27;)&quot;</span>&gt;</span> 点我试试<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"表格\"><a href=\"#表格\" class=\"headerlink\" title=\"表格\"></a>表格</h2><p>表格是一个规则的行列结构，每个表格由若干行组成，每行由若干单元格组成</p>\n<p>table、row、column</p>\n<h3 id=\"基本结构-1\"><a href=\"#基本结构-1\" class=\"headerlink\" title=\"基本结构\"></a>基本结构</h3><h4 id=\"table标签\"><a href=\"#table标签\" class=\"headerlink\" title=\"table标签\"></a>table标签</h4><p>用来定义表格</p>\n<p>常用属性：</p>\n<ul>\n<li>border 边框，默认为0</li>\n<li>width&#x2F;height 宽度&#x2F;高度</li>\n<li>align 水平对齐，取值：left、center、right</li>\n<li>bordercolor 边框颜色</li>\n<li>bgcolor 背景颜色</li>\n<li>background 背景图片</li>\n<li>cellspacing 间距，单元格与单元格之间的距离</li>\n<li>cellpadding 边距，单元格内容与边界之间的距离</li>\n</ul>\n<h4 id=\"tr标签\"><a href=\"#tr标签\" class=\"headerlink\" title=\"tr标签\"></a>tr标签</h4><p>用来定义行，table row</p>\n<p>常用属性：</p>\n<ul>\n<li>align 水平对齐，取值：left、center、right</li>\n<li>valign 垂直对齐，取值：top、middle、bottom</li>\n<li>bgcolor 背景颜色</li>\n<li>background 背景图片</li>\n</ul>\n<h4 id=\"td标签\"><a href=\"#td标签\" class=\"headerlink\" title=\"td标签\"></a>td标签</h4><p>用来定义单元格，table data</p>\n<p>常用属性：align、valign、bgcolor、background</p>\n<p><strong>表格必须由行组成，行必须由单元格组成，数据必须放到单元格中</strong></p>\n<h3 id=\"合并单元格\"><a href=\"#合并单元格\" class=\"headerlink\" title=\"合并单元格\"></a>合并单元格</h3><p>也称为表格的跨行跨列</p>\n<p>两个属性：</p>\n<ul>\n<li>rowspan，设置单元格所跨的行数，如rowspan&#x3D;2，表示跨越2行</li>\n<li>colspan，是指单元格所跨的列数，如colspan&#x3D;4，表示跨越4列</li>\n</ul>\n<ol>\n<li>在跨越的单元格中设置rowspan&#x2F;colspan属性</li>\n<li>将被跨越的单元格删除</li>\n</ol>\n<p><strong>必须要保证每行的实际列数是相同的，否则可能会出现错乱</strong></p>\n<h3 id=\"高级标签\"><a href=\"#高级标签\" class=\"headerlink\" title=\"高级标签\"></a>高级标签</h3><ul>\n<li>caption标签，表格的标题</li>\n<li>thread标签，表格的头部 table head</li>\n<li>th标签，表格的头部标题 table head title，效果：居中、加粗</li>\n<li>tbody标签，表格的主题 table body（浏览器会自动为表格添加tbody）</li>\n<li>tfoot标签，表格的脚部 table foot</li>\n</ul>\n<p>一般用在thread中，设置头部的标题，替代td标签，与td的区别在于：加粗和居中对齐</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">table&gt;</span><span class=\"language-bash\">(<span class=\"built_in\">tr</span>&gt;td&#123;td$&#125;*5&#125;*7)  &lt;!-- IDEA中快捷方式，建立7行5列的表格--&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"表单\"><a href=\"#表单\" class=\"headerlink\" title=\"表单\"></a>表单</h2><p>表单是一个包含若干元素的区域，用于获取不同类型的用户信息</p>\n<p>表单元素允许用户在表单中输入信息的元素，如文本框、密码框、单选按钮、复选框、下拉列表、按钮等</p>\n<h3 id=\"基本结构-2\"><a href=\"#基本结构-2\" class=\"headerlink\" title=\"基本结构\"></a>基本结构</h3><h4 id=\"表单语法\"><a href=\"#表单语法\" class=\"headerlink\" title=\"表单语法\"></a>表单语法</h4><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;表单提交的地址&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;表单提交的方式&quot;</span> <span class=\"attr\">enctype</span>=<span class=\"string\">&quot;数据传输的方式&quot;</span>&gt;</span></span><br><span class=\"line\">    多个表单元素</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"form标签\"><a href=\"#form标签\" class=\"headerlink\" title=\"form标签\"></a>form标签</h4><p>用来定义表单，可以包含多个表单元素</p>\n<p>常用属性：</p>\n<ul>\n<li>action 提交数据给谁处理，默认为当前页面</li>\n<li>method 提交数据的方式，取值：get（默认值）、post</li>\n<li>get 和 post 的区别：</li>\n<li>get：以查询字符串形式提交、地址栏能看到、长度有限制、不安全</li>\n<li>post：以表单数组形式提交、地址栏中看不到、长度无限制、安全（较常用）</li>\n<li>enctype 数据传输的方式，默认为application&#x2F;x-www-form-uriencoded，上传文件时要改为multipart&#x2F;form-data</li>\n</ul>\n<h3 id=\"普通表单元素\"><a href=\"#普通表单元素\" class=\"headerlink\" title=\"普通表单元素\"></a>普通表单元素</h3><p>大多数表单元素都是使用<code>&lt;input&gt;</code>标签定义，通过type属性设置表单元素的类型</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th align=\"center\">表单元素类型</th>\n<th align=\"center\">含义</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">text</td>\n<td align=\"center\">单行文本框</td>\n<td align=\"left\">省略不写时默认就是text</td>\n</tr>\n<tr>\n<td align=\"center\">password</td>\n<td align=\"center\">密码框</td>\n<td align=\"left\">输入时不会明文显示，安全</td>\n</tr>\n<tr>\n<td align=\"center\">radio</td>\n<td align=\"center\">单选按钮</td>\n<td align=\"left\">只能选择其中的一个</td>\n</tr>\n<tr>\n<td align=\"center\">checkbox</td>\n<td align=\"center\">复选框</td>\n<td align=\"left\">可以同时选择多个</td>\n</tr>\n<tr>\n<td align=\"center\">submit</td>\n<td align=\"center\">提交按钮</td>\n<td align=\"left\">提交表单数据</td>\n</tr>\n<tr>\n<td align=\"center\">reset</td>\n<td align=\"center\">重置按钮</td>\n<td align=\"left\">重置表单元素的初始值</td>\n</tr>\n<tr>\n<td align=\"center\">image</td>\n<td align=\"center\">图像按钮</td>\n<td align=\"left\">可以使用图片作为按钮，也具有提交的功能</td>\n</tr>\n<tr>\n<td align=\"center\">button</td>\n<td align=\"center\">普通按钮</td>\n<td align=\"left\">默认无功能</td>\n</tr>\n<tr>\n<td align=\"center\">file</td>\n<td align=\"center\">文件选择器</td>\n<td align=\"left\">选择要上传的文件</td>\n</tr>\n<tr>\n<td align=\"center\">hidden</td>\n<td align=\"center\">隐藏域</td>\n<td align=\"left\">在页面上不显示，但会提交，可以用来存储数据</td>\n</tr>\n</tbody></table>\n<h4 id=\"单行文本框\"><a href=\"#单行文本框\" class=\"headerlink\" title=\"单行文本框\"></a>单行文本框</h4><p>常用属性：</p>\n<ul>\n<li>name 名称，很重要，如果没有name，则该表单元素的数据不会被提交</li>\n<li>value 初始值</li>\n<li>placeholder h5特性，文本框提示</li>\n<li>size 宽度</li>\n<li>maxlength 最大字符数，默认没有限制</li>\n<li>readonly 只读，readonly&#x3D;”readonly” ，可简写为readonly，即只写属性名</li>\n<li>disabled 禁用<ul>\n<li>readonly和disabled区别：readonly的数据会提交，而disabled的数据不会提交</li>\n</ul>\n</li>\n</ul>\n<p><strong>表单元素被提交的两个条件：1.有name属性 2.非disabled</strong></p>\n<h4 id=\"单选按钮\"><a href=\"#单选按钮\" class=\"headerlink\" title=\"单选按钮\"></a>单选按钮</h4><p>常用属性：</p>\n<ul>\n<li>name 名称，多个radio的name属性值必须相同，才能实现单选（互斥）</li>\n<li>value 值</li>\n<li>checked 是否选中，两种状态：选中、未选中</li>\n</ul>\n<h4 id=\"复选框\"><a href=\"#复选框\" class=\"headerlink\" title=\"复选框\"></a>复选框</h4><p>常用属性和radio基本一致</p>\n<h4 id=\"文件选择器\"><a href=\"#文件选择器\" class=\"headerlink\" title=\"文件选择器\"></a>文件选择器</h4><p>常用属性：</p>\n<ul>\n<li>name 名称</li>\n<li>accept 设置可选的文件类型，用来限制上传的文件类型</li>\n</ul>\n<p>使用MIME格式字符串对资源类型进行限制</p>\n<p>常用MIME类型：</p>\n<ul>\n<li>纯文本：text&#x2F;html、text&#x2F;css、text&#x2F;javascript、text&#x2F;xml、text&#x2F;plain</li>\n<li>图像：image&#x2F;jpeg、image&#x2F;png、image&#x2F;gif</li>\n</ul>\n<p><em><em>可以通过类似 image&#x2F;</em> 来匹配所有图像文件</em>*</p>\n<h3 id=\"特殊表单元素\"><a href=\"#特殊表单元素\" class=\"headerlink\" title=\"特殊表单元素\"></a>特殊表单元素</h3><table>\n<thead>\n<tr>\n<th align=\"center\">表单元素</th>\n<th align=\"center\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">select</td>\n<td align=\"center\">下拉列表</td>\n</tr>\n<tr>\n<td align=\"center\">option</td>\n<td align=\"center\">下拉列表的选项</td>\n</tr>\n<tr>\n<td align=\"center\">textarea</td>\n<td align=\"center\">文本域&#x2F;多行文本框</td>\n</tr>\n</tbody></table>\n<h4 id=\"下拉列表\"><a href=\"#下拉列表\" class=\"headerlink\" title=\"下拉列表\"></a>下拉列表</h4><p>select常用属性：</p>\n<ul>\n<li>name 名称</li>\n</ul>\n<p>option常用属性：</p>\n<ul>\n<li>value 选项值</li>\n<li>selected 设置默认选中项</li>\n</ul>\n<h4 id=\"文本域\"><a href=\"#文本域\" class=\"headerlink\" title=\"文本域\"></a>文本域</h4><p>常用属性：</p>\n<ul>\n<li>name 形成</li>\n<li>rows 行数</li>\n<li>cols 宽度</li>\n</ul>\n<h2 id=\"内嵌框架\"><a href=\"#内嵌框架\" class=\"headerlink\" title=\"内嵌框架\"></a>内嵌框架</h2><p>使用iframe可以在一个页面中引用另一个页面，实现复用，灵活</p>\n<h3 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h3><p>语法：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>常用属性：</p>\n<ul>\n<li>src 引用的页面</li>\n<li>width&#x2F;height 宽度&#x2F;高度，像素或百分比</li>\n<li>frameborder 是否显示边框，取值：0、1（默认）</li>\n<li>scrolling 是否显示滚动条，取值：yes、no、auto（默认）</li>\n<li>name 为框架定义名称</li>\n</ul>\n<h3 id=\"在框架中打开链接\"><a href=\"#在框架中打开链接\" class=\"headerlink\" title=\"在框架中打开链接\"></a>在框架中打开链接</h3><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;content&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">iframe</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;content&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"多媒体标签\"><a href=\"#多媒体标签\" class=\"headerlink\" title=\"多媒体标签\"></a>多媒体标签</h2><h3 id=\"audio标签\"><a href=\"#audio标签\" class=\"headerlink\" title=\"audio标签\"></a>audio标签</h3><p>在页面中插入音频、不同浏览器对音频格式的支持不一样</p>\n<p>audio属性常用标签：</p>\n<ul>\n<li>src 音频文件的来源</li>\n<li>autoplay 是否自动播放，默认不自动播放</li>\n<li>controls 是否显示控制面板，默认不显示</li>\n<li>loop 是否循环播放</li>\n</ul>\n<h3 id=\"video标签\"><a href=\"#video标签\" class=\"headerlink\" title=\"video标签\"></a>video标签</h3><p>在页面中插入视频，不同浏览器对视频格式的支持不一样</p>\n<p>用法与audio标签基本相同，除此之外其他的属性：</p>\n<ul>\n<li>width&#x2F;height 视频播放器的尺寸</li>\n<li>poster 在视频加载前显示的图片</li>\n</ul>\n<p>查看 某一个标签在不同浏览器上的支持情况，可以访问网站<a href=\"https://www.caniuse.com/\">caniuse</a> 进行查询</p>\n","categories":["Web"],"tags":["HTML"]},{"title":"Hexo项目搭建","url":"/%E7%AC%94%E8%AE%B0/%E5%89%8D%E7%AB%AF/Hexo%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>记录搭建Hexo时的大体步骤及遇到的一些问题，留给自己作参考。</p>\n<p>Hexo是一个博客框架，<a href=\"https://hexo.io/zh-cn/\">点击此处</a>访问官网。文章的未覆盖、过时或错误内容，可尝试从官方文档找答案。</p>\n<h2 id=\"环境准备\"><a href=\"#环境准备\" class=\"headerlink\" title=\"环境准备\"></a>环境准备</h2><h3 id=\"Git\"><a href=\"#Git\" class=\"headerlink\" title=\"Git\"></a>Git</h3><p><a href=\"https://git-scm.com/\">Git</a>，开源的分布式版本管理工具。</p>\n<p>Hexo自身需要版本管理，有些软件内容也是通过git分发的。</p>\n<p>直接yum安装。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install git.x86_64</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Nginx\"><a href=\"#Nginx\" class=\"headerlink\" title=\"Nginx\"></a>Nginx</h3><p><a href=\"http://nginx.org/\">Nginx</a>，(engine x) 是一个高性能的HTTP和反向代理Web服务器。</p>\n<h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><p>直接yum安装。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install nginx.x86_64</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h4><p>默认配置文件位置在 <code>$NGINX_HOME/nginx.conf</code> 。而 <code>$NGINX_HOME</code> 在Linux用yum安装后，默认值为 &#x2F;etc&#x2F;nginx</p>\n<p>配置文件的结构可参考<a href=\"http://nginx.org/en/docs/beginners_guide.html\">官方教程</a>或<a href=\"https://docs.nginx.com/nginx/admin-guide/web-server/web-server/#virtual-server\">官方文档</a>。</p>\n<p>主要需要修改的配置就一个，服务器根目录的位置；因为Hexo生成静态页面的主页路径为 <code>$HEXO_HOME/public/index.html</code>，所以根目录位置改为 <code>$HEXO_HOME/public</code> 就行。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\"><span class=\"meta prompt_\">\t# </span><span class=\"language-bash\">服务器监听的端口</span></span><br><span class=\"line\">\tlisten       80 default_server;</span><br><span class=\"line\">\tlisten       [::]:80 default_server;</span><br><span class=\"line\"><span class=\"meta prompt_\">\t# </span><span class=\"language-bash\">服务器名称</span></span><br><span class=\"line\">\tserver_name  _;</span><br><span class=\"line\"><span class=\"meta prompt_\">\t# </span><span class=\"language-bash\">设置服务器根目录的位置</span></span><br><span class=\"line\">\troot         /data/www/hexo_site/public;</span><br><span class=\"line\"><span class=\"meta prompt_\">\t# </span><span class=\"language-bash\">Load configuration files <span class=\"keyword\">for</span> the default server block.</span></span><br><span class=\"line\">\tinclude /etc/nginx/default.d/*.conf;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">\t# </span><span class=\"language-bash\">NGINX Plus can send traffic to different proxies or serve different files based on the request URIs by using location block。</span></span><br><span class=\"line\">\tlocation / &#123;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"><span class=\"meta prompt_\">\t</span></span><br><span class=\"line\"><span class=\"meta prompt_\">\t# </span><span class=\"language-bash\">服务器错误的跳转页面</span></span><br><span class=\"line\">\terror_page 404 /404.html;</span><br><span class=\"line\">\t\tlocation = /40x.html &#123;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\terror_page 500 502 503 504 /50x.html;</span><br><span class=\"line\">\t\tlocation = /50x.html &#123;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"启动与关闭\"><a href=\"#启动与关闭\" class=\"headerlink\" title=\"启动与关闭\"></a>启动与关闭</h4><p>使用 <code>nginx</code> 命令启动服务器，启动后，可以通过使用-s参数调用可执行文件来控制</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nginx -s [signal]</span><br></pre></td></tr></table></figure>\n\n<p>signal可取：</p>\n<ul>\n<li><code>stop</code> — fast shutdown</li>\n<li><code>quit</code> — graceful shutdown</li>\n<li><code>reload</code> — reloading the configuration file</li>\n<li><code>reopen</code> — reopening the log files</li>\n</ul>\n<h3 id=\"NVM\"><a href=\"#NVM\" class=\"headerlink\" title=\"NVM\"></a>NVM</h3><h4 id=\"NodeJS\"><a href=\"#NodeJS\" class=\"headerlink\" title=\"NodeJS\"></a>NodeJS</h4><p><a href=\"http://nodejs.cn/\">NodeJS</a> 是一个基于Chrome V8引擎的JavaScript运行时。简单来说，服务器安装了NodeJS之后，能够让在网页上运行的JavaScript也能在服务器端运行。即安装完NodeJS后就能在服务器使用JavaScript写脚本了。</p>\n<p>而hexo是依赖于NodeJS的，所以需要安装NodeJS。</p>\n<h4 id=\"NVM-1\"><a href=\"#NVM-1\" class=\"headerlink\" title=\"NVM\"></a>NVM</h4><p>如果说手上有好几个项目，每个项目的需求不同，进而不同项目必须依赖不同版的NodeJS运行环境。如果没有一个合适的工具，这个问题将非常棘手。</p>\n<p><a href=\"https://github.com/nvm-sh/nvm\">NVM</a> （Node Version Manager）是一个独立于NodeJS的外部shell脚本，能够帮助管理NodeJS的版本。项目使用git下载，随便找个位置装一下。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/nvm-sh/nvm</span><br></pre></td></tr></table></figure>\n\n<p>来拷贝它。</p>\n<p>之后需要执行<code>nvm</code>文件夹下的<code>nvm.sh</code>脚本：<code>source nvm.sh</code>来初始化，之后便可使用nvm或npm相关命令了。</p>\n<p>建议把此初始化命令<code>source nvm.sh</code>加到<code>~/.bashrc</code>文件里，这样每次登录后就能自动初始化了。</p>\n<p>使用<code>nvm ls</code>查看已安装的NodeJS版本，使用<code>nvm install [node_version]</code>来安装版本号为[node_version]的NodeJS。具体安装什么版本可查看Hexo文档中写的<a href=\"https://hexo.io/zh-cn/docs/#%E5%AE%89%E8%A3%85%E5%89%8D%E6%8F%90\">安装前提</a>，或直接 <code>nvm install latest</code>安装最新版本。</p>\n<h4 id=\"NPM\"><a href=\"#NPM\" class=\"headerlink\" title=\"NPM\"></a>NPM</h4><p>NPM（Node Package Management）是随同NodeJS一起安装的包管理工具，能解决NodeJS代码部署上的很多问题，常见的使用场景有以下几种：</p>\n<ul>\n<li>允许用户从NPM服务器下载别人编写的第三方包到本地使用，hexo就是这样一个第三方包。</li>\n<li>允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用。</li>\n<li>允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用。</li>\n</ul>\n<p>详细介绍可见：<a href=\"https://www.runoob.com/nodejs/nodejs-npm.html\">NPM 使用介绍</a></p>\n<h3 id=\"Hexo\"><a href=\"#Hexo\" class=\"headerlink\" title=\"Hexo\"></a>Hexo</h3><p><a href=\"https://hexo.io/zh-cn/\">Hexo</a>是一个快速、简洁且高效的前端博客框架，用于生成静态页面。对markdown的支持还不错。</p>\n<p>使用 <code>npm install hexo-cli -g</code> 安装。</p>\n<p>如果用默认的npm源，安装依赖超时的话，可换用国内<a href=\"https://www.npmmirror.com/\">阿里巴巴的npm源</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看本地源</span></span><br><span class=\"line\">npm config get registry   <span class=\"comment\"># 默认是：https://registry.npmjs.org/</span></span><br><span class=\"line\"><span class=\"comment\"># 改成阿里巴巴的</span></span><br><span class=\"line\">npm config <span class=\"built_in\">set</span> registry  https://registry.npmmirror.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h2><ol>\n<li><p>创建一个文件夹作hexo项目的根目录，如 <code>hexo_site</code>，进入文件夹，使用命令 <code>hexo init</code> 来初始化一个hexo项目。</p>\n</li>\n<li><p>使用 <code>hexo generate</code> 命令生成静态页面，位置在该项目的<code>.../hexo_site/public</code>文件夹中。</p>\n</li>\n<li><p>如前述，将Nginx配置文件中的<code>root</code>变量配置为上述的<code>.../hexo_site/public</code>文件夹位置。</p>\n</li>\n<li><p>博文位置在hexo项目的<code>.../hexo_site/source/_post</code>文件夹。</p>\n</li>\n</ol>\n<h2 id=\"配置与问题\"><a href=\"#配置与问题\" class=\"headerlink\" title=\"配置与问题\"></a>配置与问题</h2><h3 id=\"站点基本信息配置\"><a href=\"#站点基本信息配置\" class=\"headerlink\" title=\"站点基本信息配置\"></a>站点基本信息配置</h3><p>hexo项目的配置文件在项目根目录的 <code>.../hexo_site/_config.yml</code> 文件中，具体配置可参考<a href=\"https://hexo.io/zh-cn/docs/index.html\">官方文档</a>。</p>\n<h3 id=\"语言\"><a href=\"#语言\" class=\"headerlink\" title=\"语言\"></a>语言</h3><p>语言在项目根目录的配置文件 _config.yml 设置 language 项。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Site</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">...</span></span><br><span class=\"line\">language: zh-Hans</span><br></pre></td></tr></table></figure>\n\n<p>使用不同的主题可能需要设置成不同的值，需参考主题的文档相应设置，对于NexT主题，虽然文档中写的中文需要设置成zh-Hans，但实际需要设置值为zh-CN。之后不知道官方文档会不会更新，可以直接用下面的方法找正确的配置值。</p>\n<p>站点使用的语言，实际使用的是主题文件夹中的language文件夹<code>.../hexo_site/theme/language</code> 。里面有什么yml文件就说明支持哪些语言，配置的值对应文件名。配置成不支持的语言，一般就使用此文件夹中的第一个文件。</p>\n<h3 id=\"图标\"><a href=\"#图标\" class=\"headerlink\" title=\"图标\"></a>图标</h3><p>网站图标在主题设置中，对于NexT主题，配置文件在<code>.../hexo_site/theme/next/_config.yml</code> ，配置的条目为favicon，默认图片资源的路径在<code>.../hexo_site/theme/next/source/image/</code>中，如果需要自定义图标，建议图片也放在这里。</p>\n<p>如在配置文件中编辑</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">favicon: /images/XXX.png</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"标签或分类页面无法访问\"><a href=\"#标签或分类页面无法访问\" class=\"headerlink\" title=\"标签或分类页面无法访问\"></a>标签或分类页面无法访问</h3><p>这两个页面需要手动创建。在项目根目录下使用 <code>hexo new page tags</code> 命令创建标签页面。页面生成在项目的 <code>.../hexo_site/source/tags/index.md</code> 。</p>\n<p>编辑此文件头，title的值即为访问标签时的页面标题。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: 标签</span><br><span class=\"line\">type: tags</span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n\n<p>分类同理，用的命令是 <code>hexo new page categories</code>。</p>\n<h3 id=\"使用其他主题\"><a href=\"#使用其他主题\" class=\"headerlink\" title=\"使用其他主题\"></a>使用其他主题</h3><p>以使用NexT主题为例：</p>\n<p>定位到项目的<code>.../hexo_site/theme</code>文件夹下，使用</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/theme-next/hexo-theme-next</span><br></pre></td></tr></table></figure>\n\n<p>来拷贝主题，并在hexo项目配置文件<code>.../hexo_site/_config.yml</code>文件中设置<code>theme</code>字段的值为要使用的主题文件夹名称，如<code>theme: next</code>。</p>\n<p>通过 git 拷贝的主题中会存在属于主题的.git文件夹，如果hexo项目用git管理了，两个.git会冲突，需要将主题的.git文件夹删除。</p>\n<p>每个主题都有属于自己的主题配置文件，NexT主题的配置文件在<code>.../hexo_site/theme/next/_config.yml</code>，具体配置可参考<a href=\"http://theme-next.iissnan.com/\">官方文档</a>。</p>\n<h3 id=\"修改全局字体大小\"><a href=\"#修改全局字体大小\" class=\"headerlink\" title=\"修改全局字体大小\"></a>修改全局字体大小</h3><p>详见 <a href=\"http://theme-next.iissnan.com/theme-settings.html#fonts-customization\">设置字体</a></p>\n<p>对于NexT主题，另外一种设置字体大小的方式：找到主题文件夹 <code>/source/css/_variables</code> 下的 <code>base.styl</code> 文件，修改其中的 <code>$font-size-base</code> 字段</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$</span><span class=\"language-bash\">font-size-base = (hexo-config(<span class=\"string\">&#x27;font.enable&#x27;</span>) and hexo-config(<span class=\"string\">&#x27;font.global.size&#x27;</span>) is a <span class=\"string\">&#x27;unit&#x27;</span>) ? unit(hexo-config(<span class=\"string\">&#x27;font.global.size&#x27;</span>), em) : 1em;</span></span><br></pre></td></tr></table></figure>\n\n<p>对最后的1em进行调整。</p>\n<p>不同版本的文件位置可能不同，但基本朝这个文件名的方向去找。另外建议修改前将原配置做一下备份。</p>\n<h3 id=\"本地搜索\"><a href=\"#本地搜索\" class=\"headerlink\" title=\"本地搜索\"></a>本地搜索</h3><p>首先需要安装生成搜索数据的插件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>\n\n<p>在主题配置文件中，找到 <code>local_search:</code> 项，将其设置为 true</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">local_search:</span><br><span class=\"line\">  enable: true</span><br></pre></td></tr></table></figure>\n\n<p>在项目根目录的配置文件，新增搜索设置</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">hexo-generator-searchdb plugin configuration</span></span><br><span class=\"line\">search:</span><br><span class=\"line\">  path: search.json</span><br><span class=\"line\">  field: post</span><br><span class=\"line\">  format: html</span><br><span class=\"line\">  limit: 10000</span><br></pre></td></tr></table></figure>\n\n<p>重新生成站点，即可在导航栏看到新增的搜索图标。</p>\n<p>其中path项广为流传的一种配置是 <code>search.xml</code> ，是应用于旧版本的。具体可以访问项目的 <code>项目地址/search.json</code> 和 <code>项目地址/search.xml</code> 看是否有内容，来决定如何设置。</p>\n<h3 id=\"文章摘要和截断\"><a href=\"#文章摘要和截断\" class=\"headerlink\" title=\"文章摘要和截断\"></a>文章摘要和截断</h3><p>也就是点击阅读全文的功能。</p>\n<p>hexo官方推荐的方法是，在博文的markdown文件中添加<code>&lt;!--more--&gt;</code>标签来标识。不优雅。</p>\n<p>找了一下，可使用 <code>hexo-excerpt</code> 插件实现自动摘要。</p>\n<p>进入hexo项目根目录，使用npm安装插件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-excerpt --save</span><br></pre></td></tr></table></figure>\n\n<p>在项目根目录配置文件中进行配置</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">hexo-excerpt plugin configuration</span></span><br><span class=\"line\">excerpt:</span><br><span class=\"line\">  depth: 5</span><br><span class=\"line\">  excerpt_excludes: []</span><br><span class=\"line\">  more_excludes: []</span><br><span class=\"line\">  hideWholePostExcerpts: true</span><br></pre></td></tr></table></figure>\n\n<p>这个depth与截取的字数成正相关，但也不是正比，具体对应关系不明，但只能取整数。</p>\n<h3 id=\"文章中使用UML图表\"><a href=\"#文章中使用UML图表\" class=\"headerlink\" title=\"文章中使用UML图表\"></a>文章中使用UML图表</h3><p>找到了现成的插件<a href=\"https://github.com/miao1007/hexo-filter-plantuml\">hexo-filter-plantuml</a></p>\n<p>进入hexo项目根目录，使用npm安装插件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-filter-plantuml --save</span><br></pre></td></tr></table></figure>\n\n<p>不需要配置，默认使用<a href=\"http://www.plantuml.com/plantuml\">PlantUML官网</a>进行解析。</p>\n<p>但装完后可能会不生效，需要如下配置：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">hexo-filter-plantuml plugin configuration</span></span><br><span class=\"line\">tag_plantuml:</span><br><span class=\"line\">  type: static</span><br></pre></td></tr></table></figure>\n\n<p>官方git页面没提到此配置项，也不清楚具体是啥。</p>\n","categories":["Web","Hexo"]},{"title":"JavaScript笔记","url":"/%E7%AC%94%E8%AE%B0/%E5%89%8D%E7%AB%AF/JavaScript%E7%AC%94%E8%AE%B0/","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>JavaScript简称JS，由网景公司（Netscape）开发的客户端脚本语言，不需要编译，可以直接运行</p>\n<p>Web前端三层：</p>\n<ul>\n<li>结构层 HTML 定义页面的结构</li>\n<li>样式层 CSS 定义页面的样式</li>\n<li>行为层 JavaScript 用来实现交互，提升用户体验</li>\n</ul>\n<p>基本应用：</p>\n<ul>\n<li>在客户端动态的操作页面</li>\n<li>在客户端做数据的校验</li>\n<li>在客户端发送异步请求</li>\n</ul>\n<h2 id=\"引用方式\"><a href=\"#引用方式\" class=\"headerlink\" title=\"引用方式\"></a>引用方式</h2><h3 id=\"内联方式\"><a href=\"#内联方式\" class=\"headerlink\" title=\"内联方式\"></a>内联方式</h3><p>在页面中使用script标签，在script标间中编写js代码。script标签可以放在页面的任意位置，一般放在head中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;scipt type=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><br><span class=\"line\">    javascript code</span><br><span class=\"line\">&lt;/script&gt; </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"行内方式\"><a href=\"#行内方式\" class=\"headerlink\" title=\"行内方式\"></a>行内方式</h3><p>在普通标签中编写js代码，一般需要结合事件属性，如onclick、onmouseover等。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;input type=<span class=\"string\">&quot;button&quot;</span> value=<span class=\"string\">&quot;click me&quot;</span> onclick=<span class=\"string\">&quot;alert(&#x27;Hello&#x27;)&quot;</span> /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- 使用超链接的href属性执行js时，必须添加javascript前缀 --&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;World!&#x27;)&quot;</span>&gt;</span>I am a super connection.<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"外部方式\"><a href=\"#外部方式\" class=\"headerlink\" title=\"外部方式\"></a>外部方式</h3><p>使用单独的 .js 文件定义，然后在页面中使用script标签引入外部脚本文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span> src=<span class=\"string\">&quot;javascript filepath&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>如果某个script标签用于引入外部js文件，则该script标签的标签体中不能再写js代码</p>\n<h2 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h2><h3 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h3><p>javascript是一门弱类型的语言，声明变量时使用var关键字，不需要指定变量的类型。</p>\n<p>语法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> 变量名=变量值;</span><br></pre></td></tr></table></figure>\n\n<p>在ECMAScript 6规范中新增let关键字，也用于声明变量</p>\n<p>使用let声明的变量支持块级作用域，而使用var声明的变量不支持块级作用域</p>\n<h3 id=\"常用输入输出方式\"><a href=\"#常用输入输出方式\" class=\"headerlink\" title=\"常用输入输出方式\"></a>常用输入输出方式</h3><ul>\n<li>输出：<ul>\n<li>console.log(); 输出到浏览器的控制台</li>\n<li>alert(); 弹出警告窗</li>\n<li>document.write(); 输出到页面</li>\n</ul>\n</li>\n<li>输入：<ul>\n<li>prompt() 弹出输入框，获取用户输入的数据</li>\n<li>使用 Number（变量）将字符串转换为数值</li>\n<li>使用 typeof 变量 判断变量的类型</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"常用转义符\"><a href=\"#常用转义符\" class=\"headerlink\" title=\"常用转义符\"></a>常用转义符</h3><p>常用转义符：</p>\n<ul>\n<li>\\n 换行</li>\n<li>\\t 缩进</li>\n<li>&quot; 双引号</li>\n<li>&#39; 单引号</li>\n</ul>\n<h3 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h3><ul>\n<li>单行注释：&#x2F;&#x2F;</li>\n<li>多行注释：&#x2F;* *&#x2F;</li>\n</ul>\n<h2 id=\"核心语法\"><a href=\"#核心语法\" class=\"headerlink\" title=\"核心语法\"></a>核心语法</h2><h3 id=\"数据类型\"><a href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"></a>数据类型</h3><p>基础数据类型：</p>\n<ul>\n<li>string 字符串</li>\n<li>number 数值（NaN表示非数字 Not a Number，其自身是number类型，表示数值的不正常状态）</li>\n<li>boolean 布尔</li>\n<li>null 空类型</li>\n<li>undefined 未定义类型</li>\n</ul>\n<h3 id=\"运算符\"><a href=\"#运算符\" class=\"headerlink\" title=\"运算符\"></a>运算符</h3><ul>\n<li>算数运算符：+、-、*、&#x2F;、%、**、++、– 。a**b 表示 a^b ，即 a的b次方，例如 5**3&#x3D;125</li>\n<li>比较运算符：&lt;、&gt;、&gt;&#x3D;、&lt;&#x3D;、&#x3D;&#x3D;、&#x3D;&#x3D;&#x3D;、!&#x3D; 。&#x3D;&#x3D;&#x3D; 表示全等于，既要判断变量内容相等，又要判断变量类型相等</li>\n<li>赋值运算符：&#x3D;、+&#x3D;、-&#x3D;、*&#x3D;、&#x2F;&#x3D;、%&#x3D;</li>\n<li>逻辑运算符：&amp;&amp;、||、!</li>\n<li>条件运算符：条件?表达式1:表达式2</li>\n<li>位运算符：&amp;、|、~、^、&lt;&lt;、&gt;&gt; 。与、或、非、异或、左移、右移</li>\n</ul>\n<p>重要的Math类</p>\n<ul>\n<li>Math.abs(); 绝对值</li>\n<li>Math.pow(); 指数运算</li>\n<li>Math.round();Math.cell();Math.floor();取整</li>\n<li>Math.random(); 生成一个范围在[0,1) 的随机浮点数</li>\n<li>Math.min();Math.max(); 取最小最大值</li>\n<li>Math.PI; 圆周率π</li>\n</ul>\n<h3 id=\"流程控制\"><a href=\"#流程控制\" class=\"headerlink\" title=\"流程控制\"></a>流程控制</h3><p>选择</p>\n<p>if…else、switch</p>\n<p>循环</p>\n<p>while、do…while、for、for…in<br>break、continue</p>\n<h3 id=\"数组\"><a href=\"#数组\" class=\"headerlink\" title=\"数组\"></a>数组</h3><h4 id=\"定义方式\"><a href=\"#定义方式\" class=\"headerlink\" title=\"定义方式\"></a>定义方式</h4><p>语法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr1 = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>();</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(value1, value2, ...);</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr3 = [value1, value2, ...];</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>数组中长度会自动扩展</li>\n<li>数组中元素的默认值为undefined</li>\n<li>使用length属性来获取数组的长度</li>\n</ul>\n<h4 id=\"常用方法\"><a href=\"#常用方法\" class=\"headerlink\" title=\"常用方法\"></a>常用方法</h4><table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">sort()</td>\n<td align=\"left\">排序，默认按字编码的顺序排列，非string类型会自动转换为string，可自定义比较规则</td>\n</tr>\n<tr>\n<td align=\"left\">reverse()</td>\n<td align=\"left\">反转，将数组元素倒序排列</td>\n</tr>\n<tr>\n<td align=\"left\">join(separator)</td>\n<td align=\"left\">将数组中元素使用指定的分隔符连接成字符串，默认通过逗号进行连接</td>\n</tr>\n<tr>\n<td align=\"left\">indexOf()</td>\n<td align=\"left\">返回指定元素在数组中首次出现的位置</td>\n</tr>\n<tr>\n<td align=\"left\">slice(begin,end)</td>\n<td align=\"left\">截取数组中索引从begin到end的元素，左闭右开，如果省略第二个参数，则表示截取到末尾</td>\n</tr>\n<tr>\n<td align=\"left\">toString()</td>\n<td align=\"left\">将数组转换为字符串</td>\n</tr>\n</tbody></table>\n<h4 id=\"二维数组\"><a href=\"#二维数组\" class=\"headerlink\" title=\"二维数组\"></a>二维数组</h4><p>二维数组可以认为是特殊的一位数组，即一维数组中的每个元素又是一个一维数组</p>\n<p>语法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>();</span><br><span class=\"line\">arr[<span class=\"number\">0</span>] = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>();</span><br><span class=\"line\">arr[<span class=\"number\">1</span>] = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>();</span><br><span class=\"line\">a[][] = value;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [</span><br><span class=\"line\">    [value1, value2, ...],</span><br><span class=\"line\">    [value3, value4, ...],</span><br><span class=\"line\">    [value5, value6, ...]</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h3><h4 id=\"自定义函数\"><a href=\"#自定义函数\" class=\"headerlink\" title=\"自定义函数\"></a>自定义函数</h4><p>语法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">foo</span>(<span class=\"params\">arg1, arg2, ...</span>)&#123;</span><br><span class=\"line\">    bar;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>定义函数时不需要指定参数的类型</li>\n<li>实参个数和形参个数可以不同，未指定的参数其默认值为undefined</li>\n<li>不需要指定返回值的类型，如果有返回值，直接使用return即可</li>\n<li>如果函数中没有使用return返回值，则默认返回undefined</li>\n</ul>\n<p>变量的作用域：</p>\n<ul>\n<li>局部作用域</li>\n<li>全局作用域</li>\n</ul>\n<h4 id=\"回调函数\"><a href=\"#回调函数\" class=\"headerlink\" title=\"回调函数\"></a>回调函数</h4><p>不立即执行的函数调用，满足一定条件时才会执行或者由别的代码调用执行 callback<br>调用时只写函数名，没有小括号()和参数</p>\n<p>应用：</p>\n<ul>\n<li>作为事件绑定的函数</li>\n<li>作为另一个函数的参数</li>\n</ul>\n<h4 id=\"匿名函数\"><a href=\"#匿名函数\" class=\"headerlink\" title=\"匿名函数\"></a>匿名函数</h4><p>没有名字的函数，称为匿名函数，一般用于回调</p>\n<p>应用场景：</p>\n<ul>\n<li>用于函数的回调</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">windows.<span class=\"property\">onclick</span>=<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;click!&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>用于一次性执行的函数，会自动执行，称为自执行函数</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;only run once!&quot;</span>);</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n\n<p>ES6中允许使用“箭头” &#x3D;&gt; 定义函数，称为箭头函数，也叫lambda表达式，是一种特殊的匿名函数</p>\n<p>语法：</p>\n<p>参数 &#x3D;&gt; 返回值<br>(参数 ) &#x3D;&gt; {返回值}</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">function</span>(<span class=\"params\">x</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x*<span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title function_\">a</span> = x =&gt; x*<span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">function</span>(<span class=\"params\">x,y</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> sum = x+y;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sum;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title function_\">b</span> = (<span class=\"params\">x,y</span>) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> sum = x+y;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sum;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"复合类型\"><a href=\"#复合类型\" class=\"headerlink\" title=\"复合类型\"></a>复合类型</h2><h3 id=\"String\"><a href=\"#String\" class=\"headerlink\" title=\"String\"></a>String</h3><p>常用方法</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">length()</td>\n<td align=\"left\">获取字符串的长度</td>\n</tr>\n<tr>\n<td align=\"left\">charAt(index)</td>\n<td align=\"left\">返回在指定索引位置的字符</td>\n</tr>\n<tr>\n<td align=\"left\">replace(oldStr,newStr)</td>\n<td align=\"left\">将指定的字符串替换为指定的新的字符串</td>\n</tr>\n<tr>\n<td align=\"left\">indexOf(str)</td>\n<td align=\"left\">返回某个指定字符串值在字符串中首次出现的位置</td>\n</tr>\n<tr>\n<td align=\"left\">lastIndexOf(str)</td>\n<td align=\"left\">返回某个指定字符串值在字符串中最后出现的位置</td>\n</tr>\n<tr>\n<td align=\"left\">toLowerCase()&#x2F;toUpperCase()</td>\n<td align=\"left\">将字符串转化为小写&#x2F;大写</td>\n</tr>\n<tr>\n<td align=\"left\">subString(start,end)</td>\n<td align=\"left\">提取字符串中两个指定的索引号（前闭后开）之间的字符</td>\n</tr>\n<tr>\n<td align=\"left\">split(separator,howmany)</td>\n<td align=\"left\">把字符串分割为字符串数组</td>\n</tr>\n<tr>\n<td align=\"left\">trim()</td>\n<td align=\"left\">去除字符串前后两端的空格</td>\n</tr>\n</tbody></table>\n<h3 id=\"Date\"><a href=\"#Date\" class=\"headerlink\" title=\"Date\"></a>Date</h3><p>定义方式：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(); <span class=\"comment\">// 定义一个日期对象，表示当前时间</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(year, month, day, hour, minute, second); <span class=\"comment\">// 参数指定的年、月、日、时、分、秒</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(millSeconds); <span class=\"comment\">// 参数为与1970-1-1相差的毫秒数</span></span><br></pre></td></tr></table></figure>\n\n<p>常用方法</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">getFullYear()</td>\n<td align=\"left\">以四位数字返回年份</td>\n</tr>\n<tr>\n<td align=\"left\">getMonth()</td>\n<td align=\"left\">返回月份(0~11)，0表示1月</td>\n</tr>\n<tr>\n<td align=\"left\">getDate()</td>\n<td align=\"left\">返回一个月中的某一天(1~31)</td>\n</tr>\n<tr>\n<td align=\"left\">getHours()</td>\n<td align=\"left\">返回小时(0~23)</td>\n</tr>\n<tr>\n<td align=\"left\">getMinutes()</td>\n<td align=\"left\">返回分钟(0~59)</td>\n</tr>\n<tr>\n<td align=\"left\">getSeconds()</td>\n<td align=\"left\">返回秒(0~59)</td>\n</tr>\n<tr>\n<td align=\"left\">getMilliseconds()</td>\n<td align=\"left\">返回毫秒(0~999)</td>\n</tr>\n<tr>\n<td align=\"left\">getDay()</td>\n<td align=\"left\">返回一周中的某一天(0~6)，0表示周日</td>\n</tr>\n<tr>\n<td align=\"left\">getTime()</td>\n<td align=\"left\">返回从1970-1-1 0:0:0:0至今的毫秒数</td>\n</tr>\n</tbody></table>\n<h3 id=\"JSON\"><a href=\"#JSON\" class=\"headerlink\" title=\"JSON\"></a>JSON</h3><p>JavaScript Object Notation 是一种轻量级的数据交换格式，用于表示JavaScript对象的一种方式</p>\n<p>采用与编程语言无关的文本格式，易于阅读和编写，同时也易于解析和生成</p>\n<p>语法：{“属性名”:属性值, “属性名”:属性值, …}</p>\n<ul>\n<li>JSON结构是由一系列的键值对所组成，称为JSON对象</li>\n<li>属性名必须使用双引号引起来</li>\n</ul>\n<h4 id=\"使用方式\"><a href=\"#使用方式\" class=\"headerlink\" title=\"使用方式\"></a>使用方式</h4><ul>\n<li>访问方式：对象名.属性名</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> user=&#123;</span><br><span class=\"line\">\t<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;adam&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;password&quot;</span>:<span class=\"string\">&quot;123&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;age&quot;</span>:<span class=\"number\">24</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;isMarried&quot;</span>:<span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(user);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(user.<span class=\"property\">name</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>JSON 对象与字符串的相互转换</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(user);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(str);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"对象类型\"><a href=\"#对象类型\" class=\"headerlink\" title=\"对象类型\"></a>对象类型</h3><p>对象类型可以理解为java中的引用数据类型</p>\n<p>JavaScript是面向对象的语言，但并不是人们常说的纯粹的面向对象的语言，因为它不支持某些特征</p>\n<h4 id=\"创建对象\"><a href=\"#创建对象\" class=\"headerlink\" title=\"创建对象\"></a>创建对象</h4><p>三种方式：</p>\n<ul>\n<li>使用Object</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 对象的定义</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> 对象名 = <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>();</span><br><span class=\"line\">对象名.属性名 = 属性值;</span><br><span class=\"line\">对象名.方法名 = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">\t方法体</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对象的调用</span></span><br><span class=\"line\">对象名.属性名</span><br><span class=\"line\">对象名.方法名();</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用构造函数，模拟类的定义，相当于自定义了一个类型</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> 构造函数名(形参<span class=\"number\">1</span>,形参<span class=\"number\">2</span>,...)&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">this</span>.属性名<span class=\"number\">1</span> = 形参<span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"variable language_\">this</span>.属性名<span class=\"number\">2</span> = 形参<span class=\"number\">2</span>;</span><br><span class=\"line\">\t<span class=\"variable language_\">this</span>.方法名 = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">\t\t方法体</span><br><span class=\"line\">\t&#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> 对象名 = <span class=\"keyword\">new</span> 构造函数名(实参<span class=\"number\">1</span>,实参<span class=\"number\">2</span>,...)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用JSON格式对象，一般只在JSON对象中定义属性</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">JSON</span>对象 = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;属性名&quot;</span>:属性值，</span><br><span class=\"line\">    <span class=\"string\">&quot;属性名&quot;</span>:<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"DOM操作\"><a href=\"#DOM操作\" class=\"headerlink\" title=\"DOM操作\"></a>DOM操作</h2><h3 id=\"DOM简介\"><a href=\"#DOM简介\" class=\"headerlink\" title=\"DOM简介\"></a>DOM简介</h3><ul>\n<li>Document Object Model 文档对象模型</li>\n<li>浏览器加载HTML文档时，会将HTML文档解析为一个树形结构，称为DOM树</li>\n<li>HTML文档和DOM树是一一对应的关系</li>\n<li>当DOM树被改变时，与之对应的HTML文档也会随之改变</li>\n<li>当需要对HTML中的内容进行动态改变时，可以使用DOM来进行操作</li>\n<li>DOM提供了一组用来操作HTML文档的API，即提供一套属性、方法和时间</li>\n<li>树上的每一个节点都是一个DOM对象，树的顶层为document对象，表示整个文档</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>HTML DOM<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>DOM结构<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;href&quot;</span>&gt;</span>链接<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/%E5%89%8D%E7%AB%AF/JavaScript%E7%AC%94%E8%AE%B0/DOM%E7%BB%93%E6%9E%84.png\" alt=\"DOM结构.png\"></p>\n<h3 id=\"查询操作\"><a href=\"#查询操作\" class=\"headerlink\" title=\"查询操作\"></a>查询操作</h3><p>即获取DOM对象</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">方法或属性</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">document.getElementById(id)</td>\n<td align=\"left\">根据id属性来查询节点，返回匹配的第一个节点</td>\n</tr>\n<tr>\n<td align=\"left\">document.getElementByName(name)</td>\n<td align=\"left\">根据name属性来查询，返回所有匹配的节点集合</td>\n</tr>\n<tr>\n<td align=\"left\">document.getElementsByTagName(tagName)</td>\n<td align=\"left\">根据标签名来查询，返回所有匹配的节点集合</td>\n</tr>\n<tr>\n<td align=\"left\">document.querySelector(selector)</td>\n<td align=\"left\">根据css选择器来查询，返回匹配的第一个节点</td>\n</tr>\n<tr>\n<td align=\"left\">document.querySelectorAll(selector)</td>\n<td align=\"left\">根据css选择器来查询，返回所有匹配的节点集合</td>\n</tr>\n<tr>\n<td align=\"left\">parentNode属性</td>\n<td align=\"left\">查询当前节点的父节点</td>\n</tr>\n<tr>\n<td align=\"left\">previousSibling属性</td>\n<td align=\"left\">查询当前节点的上一个节点</td>\n</tr>\n<tr>\n<td align=\"left\">nextSibling属性</td>\n<td align=\"left\">查询当前节点的下一个节点</td>\n</tr>\n<tr>\n<td align=\"left\">firstChild属性</td>\n<td align=\"left\">查询当前节点的第一个子节点</td>\n</tr>\n<tr>\n<td align=\"left\">lastChild属性</td>\n<td align=\"left\">查询当前节点的最后一个子节点</td>\n</tr>\n<tr>\n<td align=\"left\">firstElementChild属性</td>\n<td align=\"left\">查询当前节点的第一个元素子节点</td>\n</tr>\n<tr>\n<td align=\"left\">lastElementChild属性</td>\n<td align=\"left\">查询当前节点的最后一个元素子节点</td>\n</tr>\n</tbody></table>\n<p>注意标签下的空文本标签，如：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;ul&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span></span><br><span class=\"line\">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>\n\n<p>ul标签的第一个子元素实际上是由换行符与空格组成的空文本标签</p>\n<h3 id=\"访问操作\"><a href=\"#访问操作\" class=\"headerlink\" title=\"访问操作\"></a>访问操作</h3><h4 id=\"访问属性\"><a href=\"#访问属性\" class=\"headerlink\" title=\"访问属性\"></a>访问属性</h4><p>即获取&#x2F;设置DOM对象的属性</p>\n<p>DOM对象的属性和HTML标签的属性几乎是一样的，一般情况下DOM对象都会存在一个与之对应HTML标签同名的属性</p>\n<p>用法：DOM对象.属性</p>\n<h4 id=\"访问内容\"><a href=\"#访问内容\" class=\"headerlink\" title=\"访问内容\"></a>访问内容</h4><p>即获取.设置标签中的内容</p>\n<p>两种方式：</p>\n<ul>\n<li>使用innerHTML 。用法：DOM对象.innerHTML 会将内容解析为HTML</li>\n<li>使用innerText 。用法：DOM对象.innerText 会将内容作为纯文本</li>\n</ul>\n<h4 id=\"访问CSS\"><a href=\"#访问CSS\" class=\"headerlink\" title=\"访问CSS\"></a>访问CSS</h4><p>即获取&#x2F;设置CSS样式</p>\n<p>两种方式：</p>\n<ul>\n<li>使用style属性 。用法：node.style.样式属性。如果CSS属性中有短横线-，需要去掉短横线，然后将其后的单词首字母改成大写</li>\n<li>使用className属性 。用法：node.className</li>\n</ul>\n<h3 id=\"添加操作\"><a href=\"#添加操作\" class=\"headerlink\" title=\"添加操作\"></a>添加操作</h3><table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">document.createElement(tagName)</td>\n<td align=\"left\">创建一个元素节点，即标签</td>\n</tr>\n<tr>\n<td align=\"left\">document.createTextNode(text)</td>\n<td align=\"left\">创建一个文本节点，即标签中的文本内容</td>\n</tr>\n<tr>\n<td align=\"left\">node.appendChild(newNode)</td>\n<td align=\"left\">将一个新节点newNode添加到指定节点node中子节点的末尾</td>\n</tr>\n<tr>\n<td align=\"left\">node.insertBefore(newNode,refNode)</td>\n<td align=\"left\">将一个新节点newNode插入到node节点的子节点refNode之前</td>\n</tr>\n<tr>\n<td align=\"left\">node.replaceChild(newNode,refNode)</td>\n<td align=\"left\">用一个新节点newNode替换原有的node节点中的子节点refNode</td>\n</tr>\n</tbody></table>\n<h3 id=\"删除操作\"><a href=\"#删除操作\" class=\"headerlink\" title=\"删除操作\"></a>删除操作</h3><table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">node.remove()</td>\n<td align=\"left\">删除当前节点</td>\n</tr>\n<tr>\n<td align=\"left\">node.removeChild(refNode)</td>\n<td align=\"left\">删除当前节点中指定的子节点</td>\n</tr>\n</tbody></table>\n<h2 id=\"事件处理\"><a href=\"#事件处理\" class=\"headerlink\" title=\"事件处理\"></a>事件处理</h2><h3 id=\"简介-1\"><a href=\"#简介-1\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>事件：发生在HTML元素上的事情，可以是用户的行为，也可以是浏览器的行为，如：</p>\n<ul>\n<li><p>用户点击了某个HTML元素</p>\n</li>\n<li><p>用户将鼠标移动到某个HTML元素上</p>\n</li>\n<li><p>用户输入数据时光标离开</p>\n</li>\n<li><p>页面加载完成</p>\n</li>\n<li><p>事件源：时间出发的源头，即触发事件的元素，如按钮、输入框、超链接等</p>\n</li>\n<li><p>事件对象：当一个事情发生时，这个事件相关的详细信息会被保存到一个对象中，称为event对象</p>\n</li>\n<li><p>事件监听：监听事件的发生，绑定事件函数，当事件被触发后执行该事件函数，即回调函数</p>\n</li>\n</ul>\n<h3 id=\"绑定事件\"><a href=\"#绑定事件\" class=\"headerlink\" title=\"绑定事件\"></a>绑定事件</h3><p>两种方式：</p>\n<ul>\n<li>静态绑定，通过标签的事件属性绑定</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;input type=<span class=\"string\">&quot;button&quot;</span> value=<span class=\"string\">&quot;按钮&quot;</span> onclick=<span class=\"string\">&quot;func()&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>动态绑定，通过js代码</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> btn = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;btn&quot;</span>);</span><br><span class=\"line\">btn.<span class=\"property\">onclick</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">\t<span class=\"title function_\">alert</span>(<span class=\"string\">&quot;dynamic&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以通过事件回调函数的第一个参数获取事件对象event</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">btn.<span class=\"property\">onclick</span> = <span class=\"keyword\">function</span>(<span class=\"params\">event</span>)&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(event);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在事件回调函数中，this表示事件源，即发生事件的元素</p>\n<h3 id=\"常用事件\"><a href=\"#常用事件\" class=\"headerlink\" title=\"常用事件\"></a>常用事件</h3><h4 id=\"鼠标事件\"><a href=\"#鼠标事件\" class=\"headerlink\" title=\"鼠标事件\"></a>鼠标事件</h4><table>\n<thead>\n<tr>\n<th align=\"left\">事件名</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">onclick</td>\n<td align=\"left\">鼠标单击</td>\n</tr>\n<tr>\n<td align=\"left\">ondbclick</td>\n<td align=\"left\">鼠标双击</td>\n</tr>\n<tr>\n<td align=\"left\">onmouseover</td>\n<td align=\"left\">鼠标移到元素之上</td>\n</tr>\n<tr>\n<td align=\"left\">onmouseout</td>\n<td align=\"left\">鼠标从元素上移开</td>\n</tr>\n<tr>\n<td align=\"left\">onmousedown</td>\n<td align=\"left\">鼠标按键按下</td>\n</tr>\n<tr>\n<td align=\"left\">onmouseup</td>\n<td align=\"left\">鼠标按键松开</td>\n</tr>\n<tr>\n<td align=\"left\">onmousemove</td>\n<td align=\"left\">鼠标移动</td>\n</tr>\n</tbody></table>\n<h4 id=\"键盘事件\"><a href=\"#键盘事件\" class=\"headerlink\" title=\"键盘事件\"></a>键盘事件</h4><table>\n<thead>\n<tr>\n<th align=\"left\">事件名</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">onkeydown</td>\n<td align=\"left\">某按键按下</td>\n</tr>\n<tr>\n<td align=\"left\">onkeyup</td>\n<td align=\"left\">某按键松开</td>\n</tr>\n<tr>\n<td align=\"left\">onkeypress</td>\n<td align=\"left\">某按键按下并松开</td>\n</tr>\n</tbody></table>\n<h4 id=\"表单事件\"><a href=\"#表单事件\" class=\"headerlink\" title=\"表单事件\"></a>表单事件</h4><table>\n<thead>\n<tr>\n<th align=\"left\">事件名</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">onfocus</td>\n<td align=\"left\">元素获得焦点</td>\n</tr>\n<tr>\n<td align=\"left\">onblur</td>\n<td align=\"left\">元素失去焦点</td>\n</tr>\n<tr>\n<td align=\"left\">onchange</td>\n<td align=\"left\">域的内容发生改变</td>\n</tr>\n<tr>\n<td align=\"left\">onselect</td>\n<td align=\"left\">文本内容被选中</td>\n</tr>\n<tr>\n<td align=\"left\">onsubmit</td>\n<td align=\"left\">表单提交前触发，回调函数返回true表示允许表单提交，返回false表示阻止表单提交</td>\n</tr>\n</tbody></table>\n<h3 id=\"事件操作\"><a href=\"#事件操作\" class=\"headerlink\" title=\"事件操作\"></a>事件操作</h3><h4 id=\"事件冒泡\"><a href=\"#事件冒泡\" class=\"headerlink\" title=\"事件冒泡\"></a>事件冒泡</h4><p>概念：当一个HTML元素产生事件时，该事件会从当前元素（事件源）开始，向父元素传递直到页面的根元素，所有经过的节点都会收到该事件并执行</p>\n<p>特点：先触发子级元素的事件，再触发父级元素的事件</p>\n<p>阻止事件冒泡：<code>event.stopPropagation(); //符合W3C标准</code> 或 <code>event.cancelBubble=true;</code></p>\n<h4 id=\"事件默认行为\"><a href=\"#事件默认行为\" class=\"headerlink\" title=\"事件默认行为\"></a>事件默认行为</h4><p>概念：当一个事件发生时浏览器自己默认会做的事情，如：点击链接时默认会跳转，右键点击时默认会弹出菜单</p>\n<p>阻止事件的默认行为：<code>e.preventDefault();</code></p>\n<h2 id=\"BOM操作\"><a href=\"#BOM操作\" class=\"headerlink\" title=\"BOM操作\"></a>BOM操作</h2><h3 id=\"BOM简介\"><a href=\"#BOM简介\" class=\"headerlink\" title=\"BOM简介\"></a>BOM简介</h3><p>JavaScript由三部分组成：</p>\n<ul>\n<li>ECMAScript 核心语法</li>\n<li>DOM 文档对象模型</li>\n<li>BOM 浏览器对象模型</li>\n</ul>\n<p><img src=\"https://cdn.jsdelivr.net/gh/MPasser/ImgStorage@master/NoteBackup/%E7%AC%94%E8%AE%B0/%E5%89%8D%E7%AB%AF/JavaScript%E7%AC%94%E8%AE%B0/BOM%E7%BB%93%E6%9E%84.png\" alt=\"BOM结构.png\"></p>\n<h3 id=\"windows对象\"><a href=\"#windows对象\" class=\"headerlink\" title=\"windows对象\"></a>windows对象</h3><p>常用属性：document、location、history等，都是子级对象</p>\n<p>常用方法：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">alert()</td>\n<td align=\"left\">显示一个带有提示信息和确定按钮的警告框</td>\n</tr>\n<tr>\n<td align=\"left\">prompt(text)</td>\n<td align=\"left\">显示一个带有提示信息、文本输入框、确定和取消按钮的输入框，返回值为输入的数据</td>\n</tr>\n<tr>\n<td align=\"left\">confirm(text)</td>\n<td align=\"left\">显示一个带有提示信息、确定和取消按钮的确认框，确定返回true，取消返回false</td>\n</tr>\n<tr>\n<td align=\"left\">open(url, name, options)</td>\n<td align=\"left\">打开具有指定名称的新窗口，并加载给定url所指定的文档</td>\n</tr>\n<tr>\n<td align=\"left\">setTimeout(func,delay)</td>\n<td align=\"left\">设置一次性定时器，在指定毫秒值后执行某个函数</td>\n</tr>\n<tr>\n<td align=\"left\">setInterval(func,delay)</td>\n<td align=\"left\">设置周期性定时器，周期性循环执行某个函数</td>\n</tr>\n<tr>\n<td align=\"left\">clearTimeout(timer)</td>\n<td align=\"left\">清除一次性定时器</td>\n</tr>\n<tr>\n<td align=\"left\">clearInterval(timer)</td>\n<td align=\"left\">清除周期性定时器</td>\n</tr>\n</tbody></table>\n<p>常用事件：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">事件名</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">onload</td>\n<td align=\"left\">页面加载完成</td>\n</tr>\n<tr>\n<td align=\"left\">onscroll</td>\n<td align=\"left\">窗口滚动条滑动</td>\n</tr>\n<tr>\n<td align=\"left\">onclick</td>\n<td align=\"left\">鼠标点击</td>\n</tr>\n</tbody></table>\n<p>由于window对象是BOM结构的顶层对象，所以在调用window的属性和方法可以省略window.</p>\n<h3 id=\"location对象\"><a href=\"#location对象\" class=\"headerlink\" title=\"location对象\"></a>location对象</h3><ul>\n<li>常用属性：href 设置或返回地址栏中的url</li>\n<li>常用方法：reload() 重新加载当前页面</li>\n</ul>\n<h3 id=\"history对象\"><a href=\"#history对象\" class=\"headerlink\" title=\"history对象\"></a>history对象</h3><p>常用方法：</p>\n<ul>\n<li>back(); 后退，加载History列表中的上一个url</li>\n<li>forward(); 前进，加载History列表中的下一个url</li>\n</ul>\n<h2 id=\"数据校验\"><a href=\"#数据校验\" class=\"headerlink\" title=\"数据校验\"></a>数据校验</h2><h3 id=\"正则表达式\"><a href=\"#正则表达式\" class=\"headerlink\" title=\"正则表达式\"></a>正则表达式</h3><p>正则表达式是一门独立的语言，有自己的语法，用于检测指定字符串是否符合特定规则</p>\n<p>正则表达式就是用来定义规则的，称为Regular Expression</p>\n<p>在JavaScript中提供了RegExp对象，表示正则表达式</p>\n<h4 id=\"定义方式-1\"><a href=\"#定义方式-1\" class=\"headerlink\" title=\"定义方式\"></a>定义方式</h4><p>创建正则表达式对象，两种方式：</p>\n<ul>\n<li>使用字面量</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> reg = <span class=\"regexp\">/pattern/</span>attribute;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用构造函数</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> reg = <span class=\"keyword\">new</span> <span class=\"title class_\">RegExp</span>(pattern, attribute);</span><br></pre></td></tr></table></figure>\n\n<p>说明：</p>\n<ul>\n<li>pattern 表示匹配模式，用于指定匹配规则，由元字符、两次、特殊符号组成</li>\n<li>attribute 表示匹配特征，取值：i 忽略大小写、g 全局匹配（能够匹配多个符合的值）、m 多行匹配（^ 和 $ 锚除了匹配字符串的开头和结尾外还匹配每行的开头和结尾）</li>\n</ul>\n<h4 id=\"匹配规则\"><a href=\"#匹配规则\" class=\"headerlink\" title=\"匹配规则\"></a>匹配规则</h4><p>元字符：具有特殊含义的字符</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">符号</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">\\s</td>\n<td align=\"left\">空白字符</td>\n</tr>\n<tr>\n<td align=\"center\">\\S</td>\n<td align=\"left\">非空白字符</td>\n</tr>\n<tr>\n<td align=\"center\">\\d</td>\n<td align=\"left\">数字字符，等价于[0-9]</td>\n</tr>\n<tr>\n<td align=\"center\">\\D</td>\n<td align=\"left\">非数字字符</td>\n</tr>\n<tr>\n<td align=\"center\">\\w</td>\n<td align=\"left\">数字、字母或下划线字符</td>\n</tr>\n<tr>\n<td align=\"center\">\\W</td>\n<td align=\"left\">非数字、非字母或非下划线字符</td>\n</tr>\n<tr>\n<td align=\"center\">.</td>\n<td align=\"left\">除换行符之外的任意字符</td>\n</tr>\n</tbody></table>\n<p>量词：指字符出现的次数</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">符号</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">{n}</td>\n<td align=\"left\">匹配前一项n次</td>\n</tr>\n<tr>\n<td align=\"center\">{n,}</td>\n<td align=\"left\">匹配前一项至少n次</td>\n</tr>\n<tr>\n<td align=\"center\">{n,m}</td>\n<td align=\"left\">匹配前一项至少n次，最多m次</td>\n</tr>\n<tr>\n<td align=\"center\">*</td>\n<td align=\"left\">匹配前一项0次或多次，等价于{0,}</td>\n</tr>\n<tr>\n<td align=\"center\">+</td>\n<td align=\"left\">匹配前一项1次或多次，等价于{1,}</td>\n</tr>\n<tr>\n<td align=\"center\">?</td>\n<td align=\"left\">匹配前一项0次或1次，等价于{0,1}</td>\n</tr>\n</tbody></table>\n<p>特殊符号：具有特殊含义的符号</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">符号</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">&#x2F;…&#x2F;</td>\n<td align=\"left\">代表一个模式的开始和结束</td>\n</tr>\n<tr>\n<td align=\"center\">^</td>\n<td align=\"left\">匹配字符串的开始</td>\n</tr>\n<tr>\n<td align=\"center\">$</td>\n<td align=\"left\">匹配字符串的结束</td>\n</tr>\n<tr>\n<td align=\"center\">[ ]</td>\n<td align=\"left\">表示可匹配的列表</td>\n</tr>\n<tr>\n<td align=\"center\">( )</td>\n<td align=\"left\">用于分组</td>\n</tr>\n<tr>\n<td align=\"center\">|</td>\n<td align=\"left\">表示或者</td>\n</tr>\n<tr>\n<td align=\"center\">[^ ]</td>\n<td align=\"left\">在[ ]中的尖括号表示非</td>\n</tr>\n</tbody></table>\n<p>[\\u4E00-\\u9FA5] 用来匹配中文字符</p>\n<h4 id=\"基本用法-1\"><a href=\"#基本用法-1\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h4><p>使用正则表达式对象的test方法</p>\n<p>语法：<code>var flag = reg.test(字符串);</code></p>\n<p>判断字符串是否符合正则表达式所指定的模式规则，返回true或false</p>\n<h3 id=\"表单校验\"><a href=\"#表单校验\" class=\"headerlink\" title=\"表单校验\"></a>表单校验</h3><p>客户端表单校验的目的：</p>\n<ul>\n<li>保证输入的数据符合要求</li>\n<li>减轻服务器的压力</li>\n</ul>\n<p>通过onsubmit事件绑定回调函数，判断表单数据是否符合要求，符合返回true，不符合返回false</p>\n","categories":["Web"],"tags":["JavaScript"]},{"title":"jQuery简介","url":"/%E7%AC%94%E8%AE%B0/%E5%89%8D%E7%AB%AF/jQuery%E7%AE%80%E4%BB%8B/","content":"<h2 id=\"jQuery简介\"><a href=\"#jQuery简介\" class=\"headerlink\" title=\"jQuery简介\"></a>jQuery简介</h2><h3 id=\"JavaScript库\"><a href=\"#JavaScript库\" class=\"headerlink\" title=\"JavaScript库\"></a>JavaScript库</h3><p>为了简化JavaScript的开发，一些JavaScript库诞生了，JavaScript库封装了很多预定义的对象和实用函数，且兼容性较好。当前流行的JavaScript库有：prototype、ext js、jQuery 等。</p>\n<p>jQuery的CDN引入（四种不同的CDN，选其中一个即可）：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://libs.baidu.com/jquery/2.0.0/jquery.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://code.jquery.com/jquery-2.1.1.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.1.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"jQuery简介-1\"><a href=\"#jQuery简介-1\" class=\"headerlink\" title=\"jQuery简介\"></a>jQuery简介</h3><h4 id=\"jQuery简介-2\"><a href=\"#jQuery简介-2\" class=\"headerlink\" title=\"jQuery简介\"></a>jQuery简介</h4><p>jQuery是目前最流行的JavaScript库，它的理念是：write less, do more，它有如下优势：</p>\n<ul>\n<li>轻量级</li>\n<li>强大的选择器</li>\n<li>出色的DOM操作封装</li>\n<li>可靠的事件处理机制</li>\n<li>出色的浏览器兼容性</li>\n<li>使用隐式迭代简化编程</li>\n<li>丰富的插件支持</li>\n</ul>\n<h4 id=\"jQuery功能\"><a href=\"#jQuery功能\" class=\"headerlink\" title=\"jQuery功能\"></a>jQuery功能</h4><ul>\n<li>访问和操作DOM元素</li>\n<li>控制页面样式</li>\n<li>对页面事件进行处理</li>\n<li>扩展新的jQuery插件</li>\n<li>与Ajax技术完美结合</li>\n</ul>\n<h4 id=\"jQuery版本\"><a href=\"#jQuery版本\" class=\"headerlink\" title=\"jQuery版本\"></a>jQuery版本</h4><table>\n<thead>\n<tr>\n<th align=\"center\">名称</th>\n<th align=\"center\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">jquery-1.版本号.js（开发版）</td>\n<td align=\"center\">完整无压缩版本，主要用于测试、学习和开发</td>\n</tr>\n<tr>\n<td align=\"center\">jquery-1.min.版本号.js（发布版）</td>\n<td align=\"center\">经过工具压缩或经过服务器开启Gzip压缩，主要应用于发布的产品和项目</td>\n</tr>\n</tbody></table>\n<h4 id=\"引用jQuery\"><a href=\"#引用jQuery\" class=\"headerlink\" title=\"引用jQuery\"></a>引用jQuery</h4><p>使用<code>&lt;script&gt;</code>标签引入jQuery,引入本地jQuery：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;js/jquery-1.10.2.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"jQuery基本语法\"><a href=\"#jQuery基本语法\" class=\"headerlink\" title=\"jQuery基本语法\"></a>jQuery基本语法</h3><p>语法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(selector).<span class=\"title function_\">action</span>();</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>$() 工厂函数：将DOM对象转化为jQuery对象，其中$实际上是“jQuery”的别名。当$出现冲突时，可使用 var jq &#x3D; jQuery.noConflict(); 更换别名。</li>\n<li>selector 选择器：获取需要操作的DOM元素.</li>\n<li>action() 方法：jQuery中提供的方法，其中包括绑定事件处理的方法。</li>\n<li>$(document).ready(callback)表示在页面加载完成后执行callback，可以简化为$(callback)。</li>\n</ul>\n<p>示例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    $(<span class=\"string\">&quot;h2&quot;</span>).<span class=\"title function_\">css</span>(<span class=\"string\">&quot;background-color&quot;</span>,<span class=\"string\">&quot;#CCFFFF&quot;</span>);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>$(document).ready(callback)与window.onload函数的区别：</p>\n<ul>\n<li>调函数使用方式不同：前者是作为参数，后者是直接赋值。</li>\n<li>执行回调函数时机不同：前者在所有DOM文档结构绘制完毕后即执行，后者是在网页中所有内容加载完毕（包括图片、flash、视频等）之后才执行。</li>\n</ul>\n<h3 id=\"jQuery对象\"><a href=\"#jQuery对象\" class=\"headerlink\" title=\"jQuery对象\"></a>jQuery对象</h3><h4 id=\"jQuery对象-1\"><a href=\"#jQuery对象-1\" class=\"headerlink\" title=\"jQuery对象\"></a>jQuery对象</h4><p>jQuery对象就是通过jQuery包装DOM对象后产生的对象，jQuery对象是jQuery独有的，可以使用jQuery对象的方法，无法使用DOM对象的方法</p>\n<p>若获取的是jQuery对象，那么建议在变量前加上$</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">jQuery</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    $(<span class=\"string\">&quot;#btn&quot;</span>).<span class=\"title function_\">click</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>); <span class=\"comment\">//调用DOM对象的属性获取value值</span></span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>($(<span class=\"string\">&quot;#btn&quot;</span>).<span class=\"title function_\">val</span>()); <span class=\"comment\">// 调用jQuery对象的val()方法获取value值</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"jQuery对象和DOM对象的转换\"><a href=\"#jQuery对象和DOM对象的转换\" class=\"headerlink\" title=\"jQuery对象和DOM对象的转换\"></a>jQuery对象和DOM对象的转换</h4><p>jQuery对象转换成DOM对象</p>\n<p>jQuery对象实际上就是装着<strong>DOM对象的数组</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 将DOM对象转换为jQuery对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> divjQuery = $(<span class=\"string\">&#x27;#mydiv&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> divDOM = divjQuery[<span class=\"number\">0</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> divDOM = divjQuery,<span class=\"title function_\">get</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;using DOM:&#x27;</span> + divDOM.<span class=\"property\">innerText</span>);</span><br></pre></td></tr></table></figure>\n\n<p>DOM对象转换成jQuery对象</p>\n<p>将DOM对象用 $() 括起来就转换成jQuery对象了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span>  divDOM = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;mydiv&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> divjQuery = $(divDOM);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;using jQuery:&#x27;</span> + divjQuery.<span class=\"title function_\">html</span>());</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"jQuery语法特点\"><a href=\"#jQuery语法特点\" class=\"headerlink\" title=\"jQuery语法特点\"></a>jQuery语法特点</h3><ul>\n<li>读取和设置使用同一个方法</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>($(<span class=\"string\">&#x27;#btn&#x27;</span>).<span class=\"title function_\">val</span>());</span><br><span class=\"line\">$(<span class=\"string\">&#x27;#btn&#x27;</span>).<span class=\"title function_\">val</span>(<span class=\"string\">&#x27;new value&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>链式操作元素</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">&#x27;#mydiv&#x27;</span>).<span class=\"title function_\">css</span>(<span class=\"string\">&#x27;color&#x27;</span>,<span class=\"string\">&#x27;blue&#x27;</span>).<span class=\"title function_\">css</span>(<span class=\"string\">&#x27;font-size&#x27;</span>,<span class=\"string\">&#x27;30px&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>传递JSON参数</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">&#x27;#mydiv&#x27;</span>).<span class=\"title function_\">css</span>(&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;color&quot;</span>:<span class=\"string\">&quot;blue&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;font-size&quot;</span>:<span class=\"string\">&quot;30px&quot;</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>隐式迭代</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">jQuery</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        $(<span class=\"string\">&quot;input&quot;</span>).<span class=\"title function_\">click</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123; <span class=\"comment\">// 直接为数组绑定事件</span></span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;input type=&quot;button&quot; value=&quot;Button1&quot;&gt;</span><br><span class=\"line\">    &lt;input type=&quot;button&quot; value=&quot;Button2&quot;&gt;</span><br><span class=\"line\">    &lt;input type=&quot;button&quot; value=&quot;Button3&quot;&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"jQuery选择器\"><a href=\"#jQuery选择器\" class=\"headerlink\" title=\"jQuery选择器\"></a>jQuery选择器</h2><h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>选择器是jQuery的根基，在jQuery中，对事件处理、遍历DOM和Ajax操作都依赖于选择器.</p>\n<p>jQuery选择器的优点：</p>\n<ul>\n<li>简洁的写法</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">&#x27;#id&#x27;</span>) 等价于 <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;id&#x27;</span>)</span><br><span class=\"line\">$(<span class=\"string\">&#x27;tagName&#x27;</span>) 等价于 <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&#x27;tagName&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>完善的事件处理机制</li>\n</ul>\n<p>选择器的分类：基本选择器和过滤选择器</p>\n<ul>\n<li>基本选择器是jQuery中最常用的选择器，也是最简单的选择器。</li>\n<li>过滤选择器主要是通过特定的过滤规则来筛选出所需的DOM元素，过滤选择器都以冒号开头</li>\n</ul>\n<p>按照不同的过滤规则，过滤选择器可以分为六种：</p>\n<ul>\n<li>基本过滤</li>\n<li>内容过滤</li>\n<li>可见性过滤</li>\n<li>属性过滤</li>\n<li>子元素过滤和表单对象属性过滤</li>\n</ul>\n<h3 id=\"基本选择器\"><a href=\"#基本选择器\" class=\"headerlink\" title=\"基本选择器\"></a>基本选择器</h3><h4 id=\"基本选择器-1\"><a href=\"#基本选择器-1\" class=\"headerlink\" title=\"基本选择器\"></a>基本选择器</h4><table>\n<thead>\n<tr>\n<th align=\"center\">选择器</th>\n<th>描述</th>\n<th>返回</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">#id</td>\n<td>根据指定的id匹配一个元素</td>\n<td>单个元素组成的集合</td>\n</tr>\n<tr>\n<td align=\"center\">.class</td>\n<td>根据给定的类名匹配元素</td>\n<td>集合元素</td>\n</tr>\n<tr>\n<td align=\"center\">element</td>\n<td>根据给定的元素名匹配元素</td>\n<td>集合元素</td>\n</tr>\n<tr>\n<td align=\"center\">*</td>\n<td>匹配所有元素</td>\n<td>集合元素</td>\n</tr>\n<tr>\n<td align=\"center\">selector1, selector2, … , selectorN</td>\n<td>将每一个选择器匹配到的元素合并后一起返回</td>\n<td>集合元素</td>\n</tr>\n</tbody></table>\n<h4 id=\"层次选择器\"><a href=\"#层次选择器\" class=\"headerlink\" title=\"层次选择器\"></a>层次选择器</h4><p>如果想通过DOM元素之间的层次关系来获取特定元素，例如后代元素、子元素、相邻元素、兄弟元素等，则需要使用层次选择器。</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">选择器</th>\n<th>描述</th>\n<th>返回</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">$(“ancestor descendant”)</td>\n<td>选取ancestor的所有descendant（后代）元素</td>\n<td>集合元素</td>\n</tr>\n<tr>\n<td align=\"center\">$(“parent &gt; child”)</td>\n<td>选取parent元素下的child（子）元素</td>\n<td>集合元素</td>\n</tr>\n<tr>\n<td align=\"center\">$(“prev+next”)</td>\n<td>选取紧接在prev元素后的下一个next元素</td>\n<td>集合元素</td>\n</tr>\n<tr>\n<td align=\"center\">$(“prev ~ siblings”)</td>\n<td>选取prev元素后的所有siblings元素</td>\n<td>集合元素</td>\n</tr>\n</tbody></table>\n<p>子元素仅包括下一级元素，后代元素则包括子元素和子元素的子元素。</p>\n<p>兄弟元素（sibling）与元素的排列顺序无关，只需要在同一级即可。</p>\n<h3 id=\"过滤选择器\"><a href=\"#过滤选择器\" class=\"headerlink\" title=\"过滤选择器\"></a>过滤选择器</h3><h4 id=\"基本过滤选择器\"><a href=\"#基本过滤选择器\" class=\"headerlink\" title=\"基本过滤选择器\"></a>基本过滤选择器</h4><table>\n<thead>\n<tr>\n<th align=\"center\">选择器</th>\n<th>描述</th>\n<th>返回</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">:first</td>\n<td>选取第一个元素</td>\n<td>单个元素组成的集合</td>\n</tr>\n<tr>\n<td align=\"center\">:last</td>\n<td>选取最后一个元素</td>\n<td>单个元素组成的集合</td>\n</tr>\n<tr>\n<td align=\"center\">:not(selector)</td>\n<td>去除所有与给定选择器匹配的 元素</td>\n<td>集合元素</td>\n</tr>\n<tr>\n<td align=\"center\">:even</td>\n<td>选取索引是偶数的所有元素，索引从0开始</td>\n<td>集合元素</td>\n</tr>\n<tr>\n<td align=\"center\">:odd</td>\n<td>选取索引是奇数的所有元素，索引从0开始</td>\n<td>集合元素</td>\n</tr>\n<tr>\n<td align=\"center\">:eq(index)</td>\n<td>选取索引等于index的元素，索引从0开始</td>\n<td>集合元素</td>\n</tr>\n<tr>\n<td align=\"center\">:gt(index)</td>\n<td>选取索引大于index的元素，索引从0开始</td>\n<td>集合元素</td>\n</tr>\n<tr>\n<td align=\"center\">:lt(index)</td>\n<td>选取索引小于index的元素，索引从0开始</td>\n<td>集合元素</td>\n</tr>\n<tr>\n<td align=\"center\">:header</td>\n<td>选取所有的标题元素（h1~h6）</td>\n<td>集合元素</td>\n</tr>\n<tr>\n<td align=\"center\">:animated</td>\n<td>选取当前正在执行动画的所有元素</td>\n<td>集合元素</td>\n</tr>\n</tbody></table>\n<h4 id=\"内容过滤选择器\"><a href=\"#内容过滤选择器\" class=\"headerlink\" title=\"内容过滤选择器\"></a>内容过滤选择器</h4><table>\n<thead>\n<tr>\n<th align=\"center\">选择器</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">:contains(text)</td>\n<td>选取含有文本内容为text的元素</td>\n</tr>\n<tr>\n<td align=\"center\">:empty</td>\n<td>选取不包含子元素或者文本的空元素</td>\n</tr>\n<tr>\n<td align=\"center\">:has(selector)</td>\n<td>选取含有选择器所匹配元素的元素</td>\n</tr>\n<tr>\n<td align=\"center\">:parent</td>\n<td>选取含有子元素或者文本的元素</td>\n</tr>\n</tbody></table>\n<h4 id=\"属性过滤选择器\"><a href=\"#属性过滤选择器\" class=\"headerlink\" title=\"属性过滤选择器\"></a>属性过滤选择器</h4><table>\n<thead>\n<tr>\n<th align=\"center\">选择器</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">[attribute]</td>\n<td>选取含有此attribute属性的元素</td>\n</tr>\n<tr>\n<td align=\"center\">[attribute &#x3D; value]</td>\n<td>选取属性的值为value的元素</td>\n</tr>\n<tr>\n<td align=\"center\">[attribute !&#x3D; value]</td>\n<td>选取属性的值不等于value的元素以及没有attribute属性的元素</td>\n</tr>\n<tr>\n<td align=\"center\">[attribute ^&#x3D; value]</td>\n<td>选取指定属性的值以value开始的元素，相当于模糊查询</td>\n</tr>\n<tr>\n<td align=\"center\">[attribute $&#x3D; value]</td>\n<td>选取指定属性的值以value结束的元素</td>\n</tr>\n<tr>\n<td align=\"center\">[attribute *&#x3D; value]</td>\n<td>选取指定属性的值包含value的元素</td>\n</tr>\n<tr>\n<td align=\"center\">[selector1][selector2]…[selectorN]</td>\n<td>用属性选择器合并成一个复合属性选择器，满足多个条件，每选择一次，范围缩小一次</td>\n</tr>\n</tbody></table>\n<h4 id=\"子元素过滤选择器\"><a href=\"#子元素过滤选择器\" class=\"headerlink\" title=\"子元素过滤选择器\"></a>子元素过滤选择器</h4><table>\n<thead>\n<tr>\n<th align=\"center\">选择器</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">:nth-child(index&#x2F;even&#x2F;odd&#x2F;equation)</td>\n<td>选取每个父元素下的第index个子元素或者奇偶元素（index从1算起）</td>\n</tr>\n<tr>\n<td align=\"center\">:first-child</td>\n<td>选取每个父元素的第一个元素</td>\n</tr>\n<tr>\n<td align=\"center\">:last-child</td>\n<td>选取每个父元素的最后一个元素</td>\n</tr>\n<tr>\n<td align=\"center\">:only-child</td>\n<td>如果某个元素是它父元素中唯一的子元素，那么将被匹配</td>\n</tr>\n</tbody></table>\n<h4 id=\"可见性过滤选择器\"><a href=\"#可见性过滤选择器\" class=\"headerlink\" title=\"可见性过滤选择器\"></a>可见性过滤选择器</h4><ul>\n<li>可见性过滤选择器是根据元素的可见性和不可见状态来选择相应的元素</li>\n<li>可见选择器：hidden不仅包括样式属性display为none的元素，也包含文本隐藏域（<code>&lt;input type=&quot;hidden&quot;&gt;</code>）之类的元素 ，但不包含（<code>&lt;span style=&quot;visibility:hidden&quot;&gt;&lt;/span&gt;</code>）之类的元素</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">选择器</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">:hidden</td>\n<td>选取所有不可见的元素</td>\n</tr>\n<tr>\n<td align=\"center\">:visible</td>\n<td>选取所有可见的元素</td>\n</tr>\n</tbody></table>\n<h4 id=\"表单选择器\"><a href=\"#表单选择器\" class=\"headerlink\" title=\"表单选择器\"></a>表单选择器</h4><table>\n<thead>\n<tr>\n<th align=\"center\">选择器</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">:input</td>\n<td>选取所有的<code>&lt;input&gt;</code>、<code>&lt;textarea&gt;</code>、<code>&lt;select&gt;</code>和<code>&lt;button&gt;</code>元素</td>\n</tr>\n<tr>\n<td align=\"center\">:text</td>\n<td>选取所有的单行文本框</td>\n</tr>\n<tr>\n<td align=\"center\">:password</td>\n<td>选取所有的密码框元素</td>\n</tr>\n<tr>\n<td align=\"center\">:radio</td>\n<td>选取所有的单选框</td>\n</tr>\n<tr>\n<td align=\"center\">:checkbox</td>\n<td>选取所有的多选框</td>\n</tr>\n<tr>\n<td align=\"center\">:submit</td>\n<td>选取所有的提交按钮</td>\n</tr>\n<tr>\n<td align=\"center\">:image</td>\n<td>选取所有的图像按钮</td>\n</tr>\n<tr>\n<td align=\"center\">:reset</td>\n<td>选取所有的重置按钮</td>\n</tr>\n<tr>\n<td align=\"center\">:button</td>\n<td>选取所有的按钮</td>\n</tr>\n<tr>\n<td align=\"center\">:file</td>\n<td>选取所有的上传域</td>\n</tr>\n</tbody></table>\n<h4 id=\"表单属性过滤选择器\"><a href=\"#表单属性过滤选择器\" class=\"headerlink\" title=\"表单属性过滤选择器\"></a>表单属性过滤选择器</h4><p>此选择器主要对所选择的表单元素进行过滤</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">选择器</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">:enabled</td>\n<td>选取所有可用的元素</td>\n</tr>\n<tr>\n<td align=\"center\">:disable</td>\n<td>选取所有不可用元素</td>\n</tr>\n<tr>\n<td align=\"center\">:checked</td>\n<td>选取所有被选中的元素（单选框、复选框）</td>\n</tr>\n<tr>\n<td align=\"center\">:selected</td>\n<td>选取所有被选中的选项元素（下拉列表）</td>\n</tr>\n</tbody></table>\n<h3 id=\"利用方法的筛选\"><a href=\"#利用方法的筛选\" class=\"headerlink\" title=\"利用方法的筛选\"></a>利用方法的筛选</h3><p>.eq()  .first()  .last()  .filter()  .children()  .find()  等方法。</p>\n<h2 id=\"jQuery中的事件\"><a href=\"#jQuery中的事件\" class=\"headerlink\" title=\"jQuery中的事件\"></a>jQuery中的事件</h2><h3 id=\"简介-1\"><a href=\"#简介-1\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>jQuery事件是对JavaScript事件的封装，常用事件分类如下：</p>\n<ul>\n<li>基础事件<ul>\n<li>windows事件</li>\n<li>鼠标事件</li>\n<li>键盘事件</li>\n<li>表单事件</li>\n</ul>\n</li>\n<li>复合事件是多个事件的组合<ul>\n<li>鼠标光标悬停</li>\n<li>鼠标连续点击</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"基础事件\"><a href=\"#基础事件\" class=\"headerlink\" title=\"基础事件\"></a>基础事件</h3><h4 id=\"鼠标事件\"><a href=\"#鼠标事件\" class=\"headerlink\" title=\"鼠标事件\"></a>鼠标事件</h4><p>鼠标事件是当用户在文档上移动或单击鼠标时产生的事件，常用鼠标事件有：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法</th>\n<th>执行时机</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">click()</td>\n<td>单机鼠标时</td>\n</tr>\n<tr>\n<td align=\"center\">mouseover()</td>\n<td>鼠标移过时</td>\n</tr>\n<tr>\n<td align=\"center\">mouseout()</td>\n<td>鼠标移出时</td>\n</tr>\n</tbody></table>\n<h4 id=\"键盘事件\"><a href=\"#键盘事件\" class=\"headerlink\" title=\"键盘事件\"></a>键盘事件</h4><p>用户每次按下或者释放键盘上的按键时都会产生事件，常用键盘事件有：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法</th>\n<th>执行时机</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">keydown()</td>\n<td>按下键盘时</td>\n</tr>\n<tr>\n<td align=\"center\">keyup()</td>\n<td>释放键盘时</td>\n</tr>\n<tr>\n<td align=\"center\">keypress()</td>\n<td>产生可打印的字符时</td>\n</tr>\n</tbody></table>\n<p>执行顺序 ：keydown &gt; keypress &gt; keyup</p>\n<h4 id=\"表单事件\"><a href=\"#表单事件\" class=\"headerlink\" title=\"表单事件\"></a>表单事件</h4><p>当元素获得焦点时，会触发focus事件，时区焦点时，会触发blur事件。</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法</th>\n<th>执行时机</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">focus()</td>\n<td>获得焦点</td>\n</tr>\n<tr>\n<td align=\"center\">blur()</td>\n<td>失去焦点</td>\n</tr>\n</tbody></table>\n<h3 id=\"绑定与移除事件的方式\"><a href=\"#绑定与移除事件的方式\" class=\"headerlink\" title=\"绑定与移除事件的方式\"></a>绑定与移除事件的方式</h3><h4 id=\"绑定事件\"><a href=\"#绑定事件\" class=\"headerlink\" title=\"绑定事件\"></a>绑定事件</h4><p>除了使用事件名绑定事件外，还可以使用bind()方法或on()</p>\n<ul>\n<li>bind()函数是jQuery1.7之前采用的绑定事件方式</li>\n<li>on()函数是jQuery1.7及之后提供，推荐的绑定事件方式</li>\n</ul>\n<p>语法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(element).<span class=\"title function_\">on</span>(events, <span class=\"keyword\">function</span>);</span><br></pre></td></tr></table></figure>\n\n<p>还能使用类似JSON的方式同时绑定多个事件。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(element).<span class=\"title function_\">on</span>(&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;mouseover&quot;</span>:<span class=\"title function_\">funciton</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;mouseout&quot;</span>:<span class=\"title function_\">funciton</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"移除事件\"><a href=\"#移除事件\" class=\"headerlink\" title=\"移除事件\"></a>移除事件</h4><p>移除事件使用 unbind() 方法，语法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(element).<span class=\"title function_\">unbind</span>(events, [<span class=\"keyword\">function</span>]);</span><br><span class=\"line\"><span class=\"comment\">//event 表示需要解绑的事件名</span></span><br><span class=\"line\"><span class=\"comment\">//function 表示事件绑定函数中，需要解绑的函数名</span></span><br><span class=\"line\"><span class=\"comment\">//无参数的unbind表示移除绑定的全部事件</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"复合事件\"><a href=\"#复合事件\" class=\"headerlink\" title=\"复合事件\"></a>复合事件</h3><ul>\n<li>hover()方法</li>\n</ul>\n<p>jQuery中有两个复合事件方法：hover() 和 toggle()。</p>\n<p>hover()方法有两个函数，相当于mouseover() 和 mouseout() 事件的组合。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">&quot;element&quot;</span>).<span class=\"title function_\">hover</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">// mouseover时触发</span></span><br><span class=\"line\">&#125;, <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">// mouseout时触发</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>toggle()方法</li>\n</ul>\n<p>toggle()方法用于模拟鼠标连续点击事件，是由多个鼠标点击事件组成</p>\n<p>此方法在jQuery1.9及之后版本中被删除</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">(<span class=\"string\">&quot;element&quot;</span>).<span class=\"title function_\">toggle</span>(<span class=\"title function_\">fucntion</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 第一次按键时触发</span></span><br><span class=\"line\">&#125;, <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 第二次按键时触发</span></span><br><span class=\"line\">&#125;, <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 第三次按键时触发</span></span><br><span class=\"line\">&#125;,...)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>submit()方法</li>\n</ul>\n<p>触发每一个匹配元素的submit事件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">&#x27;element&#x27;</span>).<span class=\"title function_\">submit</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 阻止表单提交</span></span><br><span class=\"line\">$(<span class=\"string\">&#x27;element&#x27;</span>).<span class=\"title function_\">submit</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"jQuery中的DOM操作\"><a href=\"#jQuery中的DOM操作\" class=\"headerlink\" title=\"jQuery中的DOM操作\"></a>jQuery中的DOM操作</h2><h3 id=\"简介-2\"><a href=\"#简介-2\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>DOM操作分为三类：</p>\n<ul>\n<li>DOM Core：任何一种支持DOM的编程语言都可以使用它，如getElementById() 。</li>\n<li>HTML-DOM：用于处理HTML文档，如document.forms 。</li>\n<li>CSS-DOM：用于操作CSS，如element.style.color&#x3D;”green” 。</li>\n</ul>\n<p>jQuery对JavaScript中的DOM操作进行了封装，使用起来也更简便，jQuery中的DOM操作可分为：</p>\n<ul>\n<li>样式操作</li>\n<li>内容及Value属性值操作</li>\n<li>节点（元素）操作</li>\n<li>节点属性操作</li>\n<li>节点遍历</li>\n<li>CSS-DOM操作</li>\n</ul>\n<h3 id=\"节点操作\"><a href=\"#节点操作\" class=\"headerlink\" title=\"节点操作\"></a>节点操作</h3><p>jQuery中节点操作主要分为：</p>\n<ul>\n<li>查找节点：通过jQuery选择器完成 。</li>\n<li>创建节点：使用jQuery工厂函数 $(tagName)，可以直接创建时添加属性和内容</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> newNode = $(<span class=\"string\">&quot;&lt;li title=&#x27;game&#x27;&gt;游戏&lt;/li&gt;&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>插入节点</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">方法</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">$(‘element’).append(node)</td>\n<td>向所有指定元素内部结尾处追加内容</td>\n</tr>\n<tr>\n<td align=\"center\">$(node).appendTo(element)</td>\n<td>将内容向指定元素内部结尾处追加</td>\n</tr>\n<tr>\n<td align=\"center\">$(‘element’).prepend(node)</td>\n<td>向所有指定元素内部开始处追加内容</td>\n</tr>\n<tr>\n<td align=\"center\">$(node).prependTo(element)</td>\n<td>将内容向指定元素内部开始处追加</td>\n</tr>\n<tr>\n<td align=\"center\">$(‘element’).after(node)</td>\n<td>向所有指定元素结尾处追加内容</td>\n</tr>\n<tr>\n<td align=\"center\">$(node).insertAfter(element)</td>\n<td>将内容向指定元素结尾处追加</td>\n</tr>\n<tr>\n<td align=\"center\">$(‘element’).before(node)</td>\n<td>向所有指定元素开始处追加内容</td>\n</tr>\n<tr>\n<td align=\"center\">$(node).insertBefore(element)</td>\n<td>将内容向指定元素开始处追加</td>\n</tr>\n</tbody></table>\n<ul>\n<li>删除节点：element.remove()方法表示从DOM中删除所有匹配的元素，empty()方法表示清空元素中所有后代节点（不包含属性节点）。</li>\n<li>复制节点：clone() 用于克隆匹配的DOM元素，默认不复制事件属性，传入参数true可复制事件属性。</li>\n<li>替换节点：old.replaceWith(new) 将所有匹配的元素都替换为指定的HTML或DOM元素，replaceAll()即颠倒的replaceWith()方法，替换不会保留原先元素的事件。</li>\n</ul>\n<h3 id=\"节点属性操作\"><a href=\"#节点属性操作\" class=\"headerlink\" title=\"节点属性操作\"></a>节点属性操作</h3><table>\n<thead>\n<tr>\n<th align=\"center\">方法</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">.css(“color”,”red”)</td>\n<td>查询或改变元素样式，若要同时添加多个，则使用类似JSON的格式传入参数</td>\n</tr>\n<tr>\n<td align=\"center\">.addClass(“navbar”)</td>\n<td>为元素添加类属性，若要同时添加多个，类名间用逗号隔开</td>\n</tr>\n<tr>\n<td align=\"center\">.removeClass(“navbar”)</td>\n<td>为元素移除类属性</td>\n</tr>\n<tr>\n<td align=\"center\">.val()</td>\n<td>获取元素的value属性值，若传入参数则表明修改value属性为参数值</td>\n</tr>\n<tr>\n<td align=\"center\">.attr(‘type’)</td>\n<td>返回指定属性的值，若传入第二个参数则表明修改属性值为参数值</td>\n</tr>\n<tr>\n<td align=\"center\">.removeAttr()</td>\n<td>删除指定元素的指定属性</td>\n</tr>\n</tbody></table>\n<h3 id=\"节点内容操作\"><a href=\"#节点内容操作\" class=\"headerlink\" title=\"节点内容操作\"></a>节点内容操作</h3><table>\n<thead>\n<tr>\n<th align=\"center\">语法</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">.html()</td>\n<td>用于获取指定元素的HTML内容或文本内容，若传入参数则表明修改内容为参数内容</td>\n</tr>\n<tr>\n<td align=\"center\">.text()</td>\n<td>用于获取指定元素的文本内容，若传入参数则表明修改内容为参数内容</td>\n</tr>\n</tbody></table>\n<h3 id=\"节点遍历操作\"><a href=\"#节点遍历操作\" class=\"headerlink\" title=\"节点遍历操作\"></a>节点遍历操作</h3><ul>\n<li>遍历子元素</li>\n</ul>\n<p>children()方法可以用来获取元素的所有子元素，只考虑子元素而不考虑任何后代元素。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">&quot;body&quot;</span>).<span class=\"title function_\">children</span>();</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>遍历前辈元素</li>\n</ul>\n<p>parent()方法获取元素的父级元素</p>\n<p>parents()方法获取元素的祖先元素，包括父元素，父元素的父元素，…</p>\n<ul>\n<li>兄弟元素<ul>\n<li>next() 下一个兄弟元素</li>\n<li>nextAll() 所有之后的兄弟元素</li>\n<li>prev() 上一个兄弟元素</li>\n<li>prevAll() 所有之前的兄弟元素</li>\n<li>siblings() 获取所有兄弟元素</li>\n</ul>\n</li>\n<li>使用工具函数</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$.<span class=\"title function_\">each</span>(lists,<span class=\"keyword\">function</span>(<span class=\"params\">index,item</span>)&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">lists.<span class=\"title function_\">each</span>(<span class=\"keyword\">function</span>(<span class=\"params\">index,item</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"jQuery动画\"><a href=\"#jQuery动画\" class=\"headerlink\" title=\"jQuery动画\"></a>jQuery动画</h2><h3 id=\"jQuery内置动画效果\"><a href=\"#jQuery内置动画效果\" class=\"headerlink\" title=\"jQuery内置动画效果\"></a>jQuery内置动画效果</h3><ul>\n<li>显示和隐藏<ul>\n<li>显示：show([speed],[callback]) 使元素集合的元素显示<ul>\n<li>speed：效果的持续时间，可取slow、normal、fast ，或数字表示毫秒数若省略则不产生动画</li>\n<li>callback：动画结束时的回调方法</li>\n</ul>\n</li>\n<li>隐藏：hide([speed],[callback]) 使元素集合的元素隐藏</li>\n</ul>\n</li>\n<li>淡入和淡出<ul>\n<li>淡入：fadeIn([speed],[callback]) 使元素集合的元素淡入显示</li>\n<li>淡出：fadeOut([speed],[callback]) 使元素集合的元素淡出显示</li>\n</ul>\n</li>\n<li>滑上和滑下<ul>\n<li>滑上：slideUp([speed],[callback]) 使元素集合的元素像上开窗帘一样隐藏</li>\n<li>滑下：slideDown([speed],[callback]) 使元素集合的元素像下拉窗帘一样显示</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"自定义动画效果\"><a href=\"#自定义动画效果\" class=\"headerlink\" title=\"自定义动画效果\"></a>自定义动画效果</h3><p>调用animate()方法可以创建自定义动画效果，它的调用格式为：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(selector).<span class=\"title function_\">animate</span>(&#123;params&#125;,[speed],[callback])</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>params ：CSS属性名与值，动画要达到的效果值，必选</li>\n<li>speed ：效果的持续时间，单位为毫秒</li>\n<li>callback：动画结束时的回调方法</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">&#x27;#mydiv&#x27;</span>).<span class=\"title function_\">animate</span>(</span><br><span class=\"line\">    &#123;<span class=\"string\">&quot;width&quot;</span>:<span class=\"string\">&quot;400px&quot;</span>&#125;,</span><br><span class=\"line\">    <span class=\"number\">1000</span>,</span><br><span class=\"line\">    <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;animation ends&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"jQuery插件\"><a href=\"#jQuery插件\" class=\"headerlink\" title=\"jQuery插件\"></a>jQuery插件</h2><h3 id=\"简介-3\"><a href=\"#简介-3\" class=\"headerlink\" title=\"简介\"></a>简介</h3><h3 id=\"简单插件示例\"><a href=\"#简单插件示例\" class=\"headerlink\" title=\"简单插件示例\"></a>简单插件示例</h3><h4 id=\"cookie插件\"><a href=\"#cookie插件\" class=\"headerlink\" title=\"cookie插件\"></a>cookie插件</h4><p>步骤：<br>1.添加jQuery库，添加jQuery.cookie.js库<br>2.类似工具函数式的调用</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$.<span class=\"title function_\">cookie</span>(<span class=\"string\">&#x27;name&#x27;</span>,<span class=\"string\">&#x27;value&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"iviewer插件\"><a href=\"#iviewer插件\" class=\"headerlink\" title=\"iviewer插件\"></a>iviewer插件</h4><p>图片查看器</p>\n<h3 id=\"自定义插件\"><a href=\"#自定义插件\" class=\"headerlink\" title=\"自定义插件\"></a>自定义插件</h3><ul>\n<li>命名规范：jquery.插件名-版本.js，结构如下：</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;<span class=\"comment\">/*TODO*/</span>&#125;)(); <span class=\"comment\">//执行匿名函数</span></span><br></pre></td></tr></table></figure>\n\n<p>在&#x2F;<em>TODO</em>&#x2F;中避免使用$，如果使用应将jQuery传递进去。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">(<span class=\"keyword\">function</span>(<span class=\"params\">$</span>)&#123;<span class=\"comment\">/*TODO*/</span>&#125;)(jQuery); <span class=\"comment\">//执行匿名函数</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>以工具（全局）函数形式加到jQuery中，类似于一个静态方法。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$.<span class=\"title function_\">extend</span>(&#123;</span><br><span class=\"line\">    函数名:<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">/*功能代码*/</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>以成员（局部）函数形式加到jQuery中，类似于一个对象方法。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$.fn.<span class=\"title function_\">extend</span>(&#123;</span><br><span class=\"line\">    函数名:<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>以成员形式返回jQuery对象，便于链式操作</li>\n</ul>\n","categories":["Web"],"tags":["JavaScript"]},{"title":"MVCC实现原理","url":"/%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E5%BA%93/MVCC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/","content":"<h2 id=\"简述\"><a href=\"#简述\" class=\"headerlink\" title=\"简述\"></a>简述</h2><p>Multi-Version Concurrency Control，多版本并发控制。一般是用在数据库管理系统中。</p>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><p>MVCC的实现主要依赖于记录中的三个隐藏字段、undolog和read view来实现的。</p>\n<h3 id=\"隐藏字段\"><a href=\"#隐藏字段\" class=\"headerlink\" title=\"隐藏字段\"></a>隐藏字段</h3><p>每条记录都有数据库隐式定义的字段</p>\n<ul>\n<li>DB_TRX_PTR，最新事务ID，记录最近修改该记录的事务ID</li>\n<li>DB_ROLL_PTR，回滚指针，指向该记录的上一个版本，配合undo log使用</li>\n<li>DB_ROW_ID，隐藏主键，数据表若为显式声明主键，实际使用此主键</li>\n</ul>\n<h3 id=\"undo-log\"><a href=\"#undo-log\" class=\"headerlink\" title=\"undo log\"></a>undo log</h3><p>回滚日志，在进行增删改操作是产生方便的回滚日志。</p>\n<p>insert操作产生的undo log只在事务回滚时需要，事务提交后可立刻丢弃；<br>update和delete操作产生的undo log不仅回滚时需要，快照读时也需要。</p>\n<p>只有在快照读或事务回滚不涉及该日志是，对应日志才会被purge线程清除（先标记，后统一清楚）</p>\n<h4 id=\"例\"><a href=\"#例\" class=\"headerlink\" title=\"例\"></a>例</h4><p>假设有编号为1的事务，向表中插入一条记录，那么插入后行数据状态为：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">name</th>\n<th align=\"center\">age</th>\n<th align=\"center\">DB_ROW_ID</th>\n<th align=\"center\">DB_TRX_ID</th>\n<th align=\"center\">DB_ROLL_PTR</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">Adam</td>\n<td align=\"center\">15</td>\n<td align=\"center\">1</td>\n<td align=\"center\">1</td>\n<td align=\"center\">null</td>\n</tr>\n</tbody></table>\n<p>若此时有编号为2的事务，对记录的name做出修改</p>\n<ul>\n<li>在事务2修改记录时，数据库对该行加排它锁</li>\n<li>把数据拷贝到undo log中，作为旧记录（副本）</li>\n<li>拷贝完成后，修改该行为新值，且修改隐藏事务ID字段，回滚指针指向拷贝到undo log的副本记录中</li>\n<li>事务提交后，释放锁</li>\n</ul>\n<p>事务2完成后：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">name</th>\n<th align=\"center\">age</th>\n<th align=\"center\">DB_ROW_ID</th>\n<th align=\"center\">DB_TRX_ID</th>\n<th align=\"center\">DB_ROLL_PTR</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">Bob</td>\n<td align=\"center\">7</td>\n<td align=\"center\">1</td>\n<td align=\"center\">2</td>\n<td align=\"center\">0x1145141919810</td>\n</tr>\n</tbody></table>\n<p>undo log的内容（0x1145141919810位置）：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">name</th>\n<th align=\"center\">age</th>\n<th align=\"center\">DB_ROW_ID</th>\n<th align=\"center\">DB_TRX_ID</th>\n<th align=\"center\">DB_ROLL_PTR</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">Adam</td>\n<td align=\"center\">15</td>\n<td align=\"center\">1</td>\n<td align=\"center\">1</td>\n<td align=\"center\">null</td>\n</tr>\n</tbody></table>\n<h3 id=\"Read-View\"><a href=\"#Read-View\" class=\"headerlink\" title=\"Read View\"></a>Read View</h3><p>Read View是事务进行快照读操作时生产的读视图，即在事务执行快照读时，生成一个数据系统当前的快照，记录并维护当前活跃事务的ID，事务ID值是递增的</p>\n<p>Read View的最大作用是做可见性判断，即当某个事务在执行快照读时，对该记录创建一个Read View视图，将其当做条件判断当前事务能够看到哪个版本的数据，可能最新，也可能是undo log中某个版本的数据</p>\n<p>算法的逻辑是将记录的最新事务ID（DB_TRX_PTR）取出，与当前其他活跃事务的ID对比，若不符合可见性，则通过DB_ROLL_PTR回滚指针取undo log中的上一个DB_TRX_PTR比较，直至符合可见性。最终拿到的记录就是<strong>当前事务能看到的最新版本数据</strong></p>\n<h4 id=\"可见性规则\"><a href=\"#可见性规则\" class=\"headerlink\" title=\"可见性规则\"></a>可见性规则</h4><p>首先需要了解Read View中的三个全局属性：</p>\n<ul>\n<li>trx_list：一个数值列表，用于维护Read View生成时刻系统正活跃的事务ID</li>\n<li>up_limit_id：记录trx_list列表中最小的事务ID</li>\n<li>low_limit_id：Read View生成时系统尚未分配的下一个事务ID</li>\n</ul>\n<p>具体比较规则如下：</p>\n<ol>\n<li>若DB_TRX_ID &lt; up_limit_id，则当前事务能看到DB_TRX_ID所在记录；否则下一步</li>\n<li>若DB_TRX_ID &gt;&#x3D; low_limit_id，代表DB_TRX_ID所在记录在Read View之后生成，那么对当前事务肯定不可见；否则下一步</li>\n<li>判断DB_TRX_ID是否在trx_list中，若在，则表示生成Read View时该事务还是活跃状态没有commit，当前事务看不到结果；若不在，则说明事务在Read View生成前就已commit，结果可见</li>\n</ol>\n<h4 id=\"例-1\"><a href=\"#例-1\" class=\"headerlink\" title=\"例\"></a>例</h4><p>假设有四个事务同事执行，如下图：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">事务1</th>\n<th align=\"left\">事务2</th>\n<th align=\"left\">事务3</th>\n<th align=\"left\">事务4</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">事务开始</td>\n<td align=\"left\">事务开始</td>\n<td align=\"left\">事务开始</td>\n<td align=\"left\">事务开始</td>\n</tr>\n<tr>\n<td align=\"left\">…</td>\n<td align=\"left\">…</td>\n<td align=\"left\">…</td>\n<td align=\"left\">修改且已提交</td>\n</tr>\n<tr>\n<td align=\"left\">进行中</td>\n<td align=\"left\">快照读</td>\n<td align=\"left\">进行中</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">…</td>\n<td align=\"left\">…</td>\n<td align=\"left\">…</td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>表中看到事务2进行了快照读，数据库为该行数据生成一个ReadView视图。</p>\n<p>事务1和3还在活跃状态，事务4在事务2快照读前已提交，故Read View属性：</p>\n<ul>\n<li>trx_list：1,2,3</li>\n<li>up_limit_id：1</li>\n<li>low_limit_id：5</li>\n</ul>\n<h2 id=\"与隔离级别的关系\"><a href=\"#与隔离级别的关系\" class=\"headerlink\" title=\"与隔离级别的关系\"></a>与隔离级别的关系</h2><p>因为Read View生成的时机不同，从而造成RC、RR级别下快照读的不同</p>\n<ul>\n<li>RR（Repeatable Read）级别下，事务对记录的第一次快照读，会创建一个Read View，此后再次调用快照读时，仍然使用第一次的Read View。  </li>\n<li>故当前事务中，若在其他事务commit前调用快照读，之后Read View就不变了，其他事务commit的结果在当前事务便不可见。因此可能出现幻读。反之，早于Read View生成时提交的事务，其作出的修改是可见的。</li>\n<li>RC（Read Commit）级别下，每次快照读都会新生成一个快照和Read View，故在同一事务中可看到其他事务提交所做的修改。</li>\n</ul>\n<blockquote>\n<p>若想在RR级别下完全避免幻读，需要配合使用next-key locks，它由record locks（索引加锁）和 gap locks组成。gap locks间隙锁，不仅锁住需要使用的数据，还会锁住数据之间的间隙，相当于范围查询时将整个区间锁住了。</p>\n</blockquote>\n","categories":["Database"]},{"title":"MySQL笔记","url":"/%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL%E7%AC%94%E8%AE%B0/","content":"<h2 id=\"MySQL简介\"><a href=\"#MySQL简介\" class=\"headerlink\" title=\"MySQL简介\"></a>MySQL简介</h2><ul>\n<li>什么是数据库？<ul>\n<li>数据库：Database，按照数据结构来组织、存储和管理数据的仓库，简单来说就是存储数据的仓库</li>\n<li>数据库管理系统：用来管理数据库的软件系统，常见：MySQL、Oracle、SQLServer、DB2、Sybase、Access等</li>\n</ul>\n</li>\n<li>什么是MySQL？<ul>\n<li>MySQL：是一个开源的关系型数据库管理系统，由瑞典MySQL AB公司开发，后来被Oracle收购，所以目前属于Oracle公司</li>\n<li>特点：体积小、速度快、成本低、开源，中小型网站都是用MySQL数据库</li>\n<li>版本：企业版、社区版</li>\n<li>DBA：Database Administrator 数据库管理员</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"基本操作\"><a href=\"#基本操作\" class=\"headerlink\" title=\"基本操作\"></a>基本操作</h2><h3 id=\"连接MySQL\"><a href=\"#连接MySQL\" class=\"headerlink\" title=\"连接MySQL\"></a>连接MySQL</h3><p>语法：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql -u 用户名 -p密码 -h 数据库服务器地址 -D 数据库名</span><br></pre></td></tr></table></figure>\n\n<p>安装MySQL之后，有一个默认管理员用户root，若安装时未设置，密码默认为空<br>未指定-h时，即连接本机的数据库。</p>\n<h3 id=\"查看数据库和表\"><a href=\"#查看数据库和表\" class=\"headerlink\" title=\"查看数据库和表\"></a>查看数据库和表</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> databases; <span class=\"comment\">-- 查看当前所有数据库</span></span><br><span class=\"line\">use 数据库名; <span class=\"comment\">--切换数据库</span></span><br><span class=\"line\"><span class=\"keyword\">show</span> tables; <span class=\"comment\">-- 查看当前数据库的所有表</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> database(); <span class=\"comment\">-- 显示当前操作的数据库</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">user</span>(); <span class=\"comment\">-- 显示当前登录的用户</span></span><br></pre></td></tr></table></figure>\n\n<p>mysql内置数据库</p>\n<ul>\n<li>mysql：系统内置数据库，包含MySQL相关的系统信息</li>\n<li>information_schema：保存关于MySQL服务器所维护的所有其他数据库的信息。如数据库名，数据库的表，表栏的数据类型与访问权限等。</li>\n<li>performance_schema：存储了健康监控相关表，记录了一些磁盘和内存等信息。</li>\n</ul>\n<h3 id=\"导入数据\"><a href=\"#导入数据\" class=\"headerlink\" title=\"导入数据\"></a>导入数据</h3><p>以.sql结尾的文件是数据库脚本文件。进入MySQL执行source命令执行脚本以导入数据。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">source 数据库脚本文件路径</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">show</span> tables;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> Tables_in_test <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> BONUS          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> DEPT           <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> EMP            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> SALGRADE       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----------------+</span></span><br><span class=\"line\"></span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">desc</span> BONUS;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+-------------+------+-----+---------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> Field <span class=\"operator\">|</span> Type        <span class=\"operator\">|</span> <span class=\"keyword\">Null</span> <span class=\"operator\">|</span> Key <span class=\"operator\">|</span> <span class=\"keyword\">Default</span> <span class=\"operator\">|</span> Extra <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+-------------+------+-----+---------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> ENAME <span class=\"operator\">|</span> <span class=\"type\">varchar</span>(<span class=\"number\">10</span>) <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> JOB   <span class=\"operator\">|</span> <span class=\"type\">varchar</span>(<span class=\"number\">9</span>)  <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> SAL   <span class=\"operator\">|</span> <span class=\"type\">int</span>(<span class=\"number\">11</span>)     <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> COMM  <span class=\"operator\">|</span> <span class=\"type\">int</span>(<span class=\"number\">11</span>)     <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+-------------+------+-----+---------+-------+</span></span><br><span class=\"line\"></span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">desc</span> DEPT;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+-------------+------+-----+---------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> Field  <span class=\"operator\">|</span> Type        <span class=\"operator\">|</span> <span class=\"keyword\">Null</span> <span class=\"operator\">|</span> Key <span class=\"operator\">|</span> <span class=\"keyword\">Default</span> <span class=\"operator\">|</span> Extra <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+-------------+------+-----+---------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> DEPTNO <span class=\"operator\">|</span> <span class=\"type\">int</span>(<span class=\"number\">2</span>)      <span class=\"operator\">|</span> <span class=\"keyword\">NO</span>   <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> DNAME  <span class=\"operator\">|</span> <span class=\"type\">varchar</span>(<span class=\"number\">14</span>) <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> LOC    <span class=\"operator\">|</span> <span class=\"type\">varchar</span>(<span class=\"number\">13</span>) <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+-------------+------+-----+---------+-------+</span></span><br><span class=\"line\"></span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">desc</span> EMP;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----------+-------------+------+-----+---------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> Field    <span class=\"operator\">|</span> Type        <span class=\"operator\">|</span> <span class=\"keyword\">Null</span> <span class=\"operator\">|</span> Key <span class=\"operator\">|</span> <span class=\"keyword\">Default</span> <span class=\"operator\">|</span> Extra <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----------+-------------+------+-----+---------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> EMPNO    <span class=\"operator\">|</span> <span class=\"type\">int</span>(<span class=\"number\">4</span>)      <span class=\"operator\">|</span> <span class=\"keyword\">NO</span>   <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> ENAME    <span class=\"operator\">|</span> <span class=\"type\">varchar</span>(<span class=\"number\">10</span>) <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> JOB      <span class=\"operator\">|</span> <span class=\"type\">varchar</span>(<span class=\"number\">9</span>)  <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> MGR      <span class=\"operator\">|</span> <span class=\"type\">int</span>(<span class=\"number\">4</span>)      <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> HIREDATE <span class=\"operator\">|</span> <span class=\"type\">date</span>        <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> SAL      <span class=\"operator\">|</span> <span class=\"keyword\">double</span>      <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> COMM     <span class=\"operator\">|</span> <span class=\"type\">int</span>(<span class=\"number\">7</span>)      <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> DEPTNO   <span class=\"operator\">|</span> <span class=\"type\">int</span>(<span class=\"number\">2</span>)      <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----------+-------------+------+-----+---------+-------+</span></span><br><span class=\"line\"></span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">desc</span> SALGRADE;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+---------+------+-----+---------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> Field <span class=\"operator\">|</span> Type    <span class=\"operator\">|</span> <span class=\"keyword\">Null</span> <span class=\"operator\">|</span> Key <span class=\"operator\">|</span> <span class=\"keyword\">Default</span> <span class=\"operator\">|</span> Extra <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+---------+------+-----+---------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> GRADE <span class=\"operator\">|</span> <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> LOSAL <span class=\"operator\">|</span> <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> HISAL <span class=\"operator\">|</span> <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+---------+------+-----+---------+-------+</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"SQL\"><a href=\"#SQL\" class=\"headerlink\" title=\"SQL\"></a>SQL</h2><p>SQL： Structured Query Language ，结构化查询语言。用来对数据库进行查询、更新和管理的一种特殊的语言。</p>\n<p>包含三个部分：</p>\n<ul>\n<li>DML：<ul>\n<li>Data Manipulation Language ，数据操作语言</li>\n<li>用于检索或更新数据库：insert delete update select ，增删改查</li>\n</ul>\n</li>\n<li>DDL：<ul>\n<li>Data Definition Language ，数据定义语言</li>\n<li>用于定义数据的结构：create alter drop</li>\n</ul>\n</li>\n<li>DCL：<ul>\n<li>Data Control Language ，数据控制语言</li>\n<li>用于定义数据库用户的权限</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"查找操作\"><a href=\"#查找操作\" class=\"headerlink\" title=\"查找操作\"></a>查找操作</h2><h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><h4 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h4><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> 列名<span class=\"number\">1</span> 别名，列名<span class=\"number\">2</span> 别名<span class=\"number\">2</span> ... <span class=\"keyword\">from</span> 表名;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> ENAME <span class=\"keyword\">from</span> EMP;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP;</span><br><span class=\"line\"><span class=\"keyword\">select</span> ENAME name,SAL &quot;your salary&quot; <span class=\"keyword\">from</span> EMP; <span class=\"comment\">-- 别名包含空格时，需要使用双引号</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"用法\"><a href=\"#用法\" class=\"headerlink\" title=\"用法\"></a>用法</h4><ul>\n<li>字符串连接concat()</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> concat(<span class=\"string\">&#x27;编号为&#x27;</span>,EMPNO,<span class=\"string\">&#x27;的雇员，姓名为&#x27;</span>,ENAME,<span class=\"string\">&#x27;职位为&#x27;</span>,JOB) <span class=\"keyword\">from</span> EMP;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">结果</span><br><span class=\"line\">| 编号为7369的雇员，姓名为SMITH职位为CLERK            |</span><br><span class=\"line\">| 编号为7499的雇员，姓名为ALLEN职位为SALESMAN         |</span><br><span class=\"line\">| 编号为7521的雇员，姓名为WARD职位为SALESMAN          |</span><br><span class=\"line\">| 编号为7566的雇员，姓名为JONES职位为MANAGER          |</span><br><span class=\"line\">| 编号为7654的雇员，姓名为MARTIN职位为SALESMAN        |</span><br><span class=\"line\">| 编号为7698的雇员，姓名为BLAKE职位为MANAGER          |</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>四则运算 + - * &#x2F;</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> ENAME 雇员姓名,SAL<span class=\"operator\">*</span><span class=\"number\">12</span> 年薪 <span class=\"keyword\">from</span> EMP; <span class=\"comment\">-- 没加奖金</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> ENAME 雇员姓名,(SAL<span class=\"operator\">+</span>COMM)<span class=\"operator\">*</span><span class=\"number\">12</span> 年薪 <span class=\"keyword\">from</span> EMP;  <span class=\"comment\">-- 加了奖金，但是有问题</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> ENAME 雇员姓名,(SAL<span class=\"operator\">+</span>ifnull(COMM,<span class=\"number\">0</span>))<span class=\"operator\">*</span><span class=\"number\">12</span> 年薪 <span class=\"keyword\">from</span> EMP; <span class=\"comment\">-- 使用ifnull()来将null装换为0</span></span><br></pre></td></tr></table></figure>\n\n<p>在MySQL中，NULL与任何值进行运算，结果都为NULL</p>\n<ul>\n<li>去除重复列 distinct</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> JOB <span class=\"keyword\">from</span> EMP; <span class=\"comment\">-- 存在重复的结果</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">distinct</span> JOB <span class=\"keyword\">from</span> EMP; <span class=\"comment\">-- 使用distinct去重</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">distinct</span> ENAME，JOB <span class=\"keyword\">from</span> EMP; <span class=\"comment\">-- 对多列查询使用distinct时，所有列都不同时才可去重</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"限定查询\"><a href=\"#限定查询\" class=\"headerlink\" title=\"限定查询\"></a>限定查询</h3><h4 id=\"语法-1\"><a href=\"#语法-1\" class=\"headerlink\" title=\"语法\"></a>语法</h4><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> 列名<span class=\"number\">1</span> 别名，列名<span class=\"number\">2</span> 别名<span class=\"number\">2</span> ... </span><br><span class=\"line\"><span class=\"keyword\">from</span> 表名 </span><br><span class=\"line\"><span class=\"keyword\">where</span> 条件;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"用法-1\"><a href=\"#用法-1\" class=\"headerlink\" title=\"用法\"></a>用法</h4><ul>\n<li>比较运算符</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">  &lt;   &gt;=   &lt;=   !=或&lt;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>例：查询工资大于1500的雇员信息</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> SAL<span class=\"operator\">&gt;</span><span class=\"number\">1500</span>;</span><br></pre></td></tr></table></figure>\n\n<p>例：查询雇员编号不是7369的雇员信息</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> ENO<span class=\"operator\">!=</span><span class=\"number\">7369</span></span><br></pre></td></tr></table></figure>\n\n<p>例：查询姓名是Smith的雇员编号、姓名、工资、入职时间</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> EMPNO,ENAME,SAL,HIREDATE <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> ENAME<span class=\"operator\">=</span><span class=\"string\">&#x27;Smith&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p><strong>注：字符串要使用引号，date类型数据的值使用时也需要加引号</strong></p>\n<p>不同版本默认列名和字符串数据大小写敏感可能不同。此设置可通过修改系统变量来变更，详情见<a href=\"https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_lower_case_table_names\">官网文档</a>。</p>\n<ul>\n<li>null 或 not null</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> COMM <span class=\"keyword\">is</span> <span class=\"keyword\">null</span>; <span class=\"comment\">-- 判断是否为null时使用的是is</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>and</li>\n</ul>\n<p>例：查询基本工资大于1000，并且可以获取奖金的雇员信息</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> SAL<span class=\"operator\">&gt;</span><span class=\"number\">1000</span> <span class=\"keyword\">and</span> COMM <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>or</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> JOB<span class=\"operator\">=</span><span class=\"string\">&#x27;salesman&#x27;</span> <span class=\"keyword\">or</span> SAL<span class=\"operator\">&gt;=</span><span class=\"number\">2000</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>not</li>\n</ul>\n<p>例：查询从事非销售工作，并且工资不小于1500的雇员信息</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> JOB<span class=\"operator\">!=</span><span class=\"string\">&#x27;salesman&#x27;</span> <span class=\"keyword\">and</span> SAL<span class=\"operator\">&gt;=</span><span class=\"number\">1500</span>;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> <span class=\"keyword\">not</span>(JOB<span class=\"operator\">=</span><span class=\"string\">&#x27;salesman&#x27;</span> <span class=\"keyword\">or</span> SAL<span class=\"operator\">&lt;</span><span class=\"number\">1500</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>between and</li>\n</ul>\n<p>例：查询基本工资大于1500且小于3000的雇员信息</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> SAL<span class=\"operator\">&gt;</span><span class=\"number\">1500</span> <span class=\"keyword\">and</span> SAL<span class=\"operator\">&lt;</span><span class=\"number\">3000</span>;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> SAL <span class=\"keyword\">between</span> <span class=\"number\">1500</span> <span class=\"keyword\">and</span> <span class=\"number\">3000</span>;</span><br></pre></td></tr></table></figure>\n\n<p><strong>between and 包含临界值；且小值在前，大值在后</strong></p>\n<ul>\n<li>in 或 not in</li>\n</ul>\n<p>例：查询编号为7369、7499、7788的雇员信息</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> EMPNO <span class=\"keyword\">in</span> (<span class=\"number\">7369</span>,<span class=\"number\">7499</span>,<span class=\"number\">7788</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>like</li>\n</ul>\n<p>用来进行模糊查询，需要结合通配符一起使用</p>\n<p>常用通配符：<br>% 可以匹配任意长度字符，包含0个字符<br>_ 只能匹配单个字符</p>\n<p>例：查询雇员姓名中包含M的雇员信息</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> ENAME <span class=\"keyword\">like</span> <span class=\"string\">&#x27;%M%&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"排序\"><a href=\"#排序\" class=\"headerlink\" title=\"排序\"></a>排序</h3><h4 id=\"语法-2\"><a href=\"#语法-2\" class=\"headerlink\" title=\"语法\"></a>语法</h4><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> 列名<span class=\"number\">1</span> 别名，列名<span class=\"number\">2</span> 别名<span class=\"number\">2</span> ... </span><br><span class=\"line\"><span class=\"keyword\">from</span> 表名 </span><br><span class=\"line\"><span class=\"keyword\">where</span> 条件</span><br><span class=\"line\"><span class=\"keyword\">order</span> <span class=\"keyword\">by</span> 排序列<span class=\"number\">1</span> <span class=\"keyword\">asc</span><span class=\"operator\">|</span><span class=\"keyword\">desc</span>,排序列<span class=\"number\">2</span> <span class=\"keyword\">asc</span><span class=\"operator\">|</span><span class=\"keyword\">desc</span> ...;</span><br></pre></td></tr></table></figure>\n\n<p><strong>asc表示升序，desc表示降序，省略则默认升序</strong></p>\n<h4 id=\"用法-2\"><a href=\"#用法-2\" class=\"headerlink\" title=\"用法\"></a>用法</h4><p>例：查询所有雇员信息，按工资由低到高排序</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> SAL;</span><br></pre></td></tr></table></figure>\n\n<p>例：查询雇员信息，按工资降序排序，若工资相同，则按入职时间由早到晚排序</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP </span><br><span class=\"line\"><span class=\"keyword\">order</span> <span class=\"keyword\">by</span> SAL <span class=\"keyword\">desc</span>,HIREDATE;</span><br></pre></td></tr></table></figure>\n\n<p>例：查询雇员年薪并按年薪降序排序</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> ENAME 雇员姓名,(SAL<span class=\"operator\">+</span>ifnull(COMM,<span class=\"number\">0</span>))<span class=\"operator\">*</span><span class=\"number\">12</span> 年薪 <span class=\"keyword\">from</span> EMP</span><br><span class=\"line\"><span class=\"keyword\">order</span> <span class=\"keyword\">by</span> 年薪;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"多表查询\"><a href=\"#多表查询\" class=\"headerlink\" title=\"多表查询\"></a>多表查询</h2><p>同时从多张表中查询数据，一般来说多张表之间都会存在某种关系。</p>\n<h3 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h3><h4 id=\"语法-3\"><a href=\"#语法-3\" class=\"headerlink\" title=\"语法\"></a>语法</h4><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> 列名<span class=\"number\">1</span> 别名，列名<span class=\"number\">2</span> 别名<span class=\"number\">2</span> ... </span><br><span class=\"line\"><span class=\"keyword\">from</span> 表名<span class=\"number\">1</span> 别名<span class=\"number\">1</span>,表名<span class=\"number\">2</span> 别名<span class=\"number\">2</span> ...</span><br><span class=\"line\"><span class=\"keyword\">where</span> 条件</span><br><span class=\"line\"><span class=\"keyword\">order</span> <span class=\"keyword\">by</span> 排序列<span class=\"number\">1</span> <span class=\"keyword\">asc</span><span class=\"operator\">|</span><span class=\"keyword\">desc</span>,排序列<span class=\"number\">2</span> <span class=\"keyword\">asc</span><span class=\"operator\">|</span><span class=\"keyword\">desc</span> ...;</span><br></pre></td></tr></table></figure>\n\n<p>例：将EMP表和DEPT表进行多表查询（笛卡尔积）</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP,DEPT;</span><br></pre></td></tr></table></figure>\n\n<p>通过将两张表的关联字段进行比较，去掉笛卡尔积，多表查询一般都会存在某种关系。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP,DEPT </span><br><span class=\"line\"><span class=\"keyword\">where</span> EMP.DEPTNO<span class=\"operator\">=</span>DEPT.DEPTNO;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h4><p>例：查询雇员编号、雇员姓名、工资、所在部门编号、名称及位置</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> EMPNO,ENAME,SAL,E.DEPTNO,DNAME,LOC</span><br><span class=\"line\"><span class=\"keyword\">from</span> EMP E,DEPT D </span><br><span class=\"line\"><span class=\"keyword\">where</span> E.DEPTNO<span class=\"operator\">=</span>D.DEPTNO; <span class=\"comment\">-- 如果多张表中出现同名的列，当查询时需要指定前缀</span></span><br></pre></td></tr></table></figure>\n\n<p>例：查询雇员姓名、雇员工资、雇员的领导姓名、领导工资（自身连接）</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> E.ENAME,E.SAL,M.ENAME,M.SAL <span class=\"keyword\">from</span> EMP E,EMP M</span><br><span class=\"line\"><span class=\"keyword\">where</span> E.MGR<span class=\"operator\">=</span>M.EMPNO;</span><br></pre></td></tr></table></figure>\n\n<p>例：查询雇员姓名、雇员工资、部门名称、工资所在等级（非等值连接）</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> E.ENAME 雇员姓名,E.SAL 雇员工资,D.DNAME 部门名称,S.GRADE 工资所在等级 <span class=\"keyword\">from</span> </span><br><span class=\"line\">EMP E,DEPT D,SALGRADE S </span><br><span class=\"line\"><span class=\"keyword\">where</span> E.DEPTNO<span class=\"operator\">=</span>D.DEPTNO <span class=\"keyword\">and</span> E.SAL <span class=\"keyword\">between</span> S.LOSAL <span class=\"keyword\">and</span> S.HISAL;</span><br></pre></td></tr></table></figure>\n\n<p>例：查询雇员姓名、雇员工资、部门名称、雇员工资等级、领导姓名、领导工资、领导工资等级</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> E.ENAME 雇员姓名,E.SAL 雇员工资,D.DNAME 部门名称,</span><br><span class=\"line\">    ES.GRADE 雇员工资等级,M.ENAME 领导姓名,M.SAL 领导工资,MS.GRADE 领导工资等级 </span><br><span class=\"line\"><span class=\"keyword\">from</span> EMP E,EMP M,DEPT D,SALGRADE ES,SALGRADE MS </span><br><span class=\"line\"><span class=\"keyword\">where</span> E.DEPTNO<span class=\"operator\">=</span>D.DEPTNO <span class=\"keyword\">and</span> </span><br><span class=\"line\">    E.MGR<span class=\"operator\">=</span>M.EMPNO <span class=\"keyword\">and</span> </span><br><span class=\"line\">    E.SAL <span class=\"keyword\">between</span> ES.LOSAL <span class=\"keyword\">and</span> ES.HISAL <span class=\"keyword\">and</span> </span><br><span class=\"line\">    M.SAL <span class=\"keyword\">between</span> MS.LOSAL <span class=\"keyword\">and</span> MS.HISAL;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"SQL99标准\"><a href=\"#SQL99标准\" class=\"headerlink\" title=\"SQL99标准\"></a>SQL99标准</h3><p>SQL99标准，也称为SQL1999标准，是1999年制定的<br>分类：内连接、外连接</p>\n<h4 id=\"内连接\"><a href=\"#内连接\" class=\"headerlink\" title=\"内连接\"></a>内连接</h4><p>使用inner join…on</p>\n<p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> 列名<span class=\"number\">1</span> 别名，列名<span class=\"number\">2</span> 别名<span class=\"number\">2</span> ... </span><br><span class=\"line\"><span class=\"keyword\">from</span> 表名<span class=\"number\">1</span> 别名<span class=\"number\">1</span> <span class=\"keyword\">inner</span> <span class=\"keyword\">join</span> 表名<span class=\"number\">2</span> 别名<span class=\"number\">2</span> <span class=\"keyword\">on</span> 多表间的关联关系</span><br><span class=\"line\"><span class=\"keyword\">where</span> 条件</span><br><span class=\"line\"><span class=\"keyword\">order</span> <span class=\"keyword\">by</span> 排序列<span class=\"number\">1</span> <span class=\"keyword\">asc</span><span class=\"operator\">|</span><span class=\"keyword\">desc</span>,排序列<span class=\"number\">2</span> <span class=\"keyword\">asc</span><span class=\"operator\">|</span><span class=\"keyword\">desc</span> ...;</span><br></pre></td></tr></table></figure>\n\n<p>例：查询雇员编号、雇员姓名、工资、所在部门名称、</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> E.EMPNO,E.ENAME,E.SAL,D.DNAME </span><br><span class=\"line\"><span class=\"keyword\">from</span> EMP E <span class=\"keyword\">inner</span> <span class=\"keyword\">join</span> DEPT D <span class=\"keyword\">on</span> E.DEPTNO<span class=\"operator\">=</span>D.DEPTNO; </span><br></pre></td></tr></table></figure>\n\n<p>例：查询工资大于1500的雇员姓名、雇员工资、部门名称、雇员的领导姓名</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> E.ENAME,E.SAL,D.DNAME,M.ENAME <span class=\"keyword\">from</span> </span><br><span class=\"line\">EMP E <span class=\"keyword\">inner</span> <span class=\"keyword\">join</span> DEPT D <span class=\"keyword\">on</span> E.DEPTNO<span class=\"operator\">=</span>D.DEPTNO </span><br><span class=\"line\">    <span class=\"keyword\">inner</span> <span class=\"keyword\">join</span> EMP M <span class=\"keyword\">on</span> E.MGR<span class=\"operator\">=</span>M.EMPNO </span><br><span class=\"line\"><span class=\"keyword\">where</span> E.SAL<span class=\"operator\">&gt;</span><span class=\"number\">1500</span>;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"外连接\"><a href=\"#外连接\" class=\"headerlink\" title=\"外连接\"></a>外连接</h4><p>分类：</p>\n<ul>\n<li>左外连接 left outer join … on ，也称为左连接left join … on<br>以左边的表为主表，无论如何都会显示主表中的所有数据</li>\n<li>右外连接 right outer join … on， 也称为右连接 right join … on<br>以右边的表为主表，无论如何都会显示主表中的所有数据</li>\n</ul>\n<p>二者可以相互转换</p>\n<p>例：查询雇员编号、工资、该雇员的领导姓名、领导工资</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> E.ENAME,E.SAL,M.ENAME,M.SAL </span><br><span class=\"line\"><span class=\"keyword\">from</span> EMP E,EMP M</span><br><span class=\"line\"><span class=\"keyword\">where</span> E.MGR<span class=\"operator\">=</span>M.EMPNO; <span class=\"comment\">-- 查询出的信息不完整，有的员工信息中MGR列值为空</span></span><br></pre></td></tr></table></figure>\n\n<p>应当使用外连接</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> E.ENAME,E.SAL,M.ENAME,M.SAL </span><br><span class=\"line\"><span class=\"keyword\">from</span> EMP E <span class=\"keyword\">left</span> <span class=\"keyword\">join</span> EMP M <span class=\"keyword\">on</span> E.MGR<span class=\"operator\">=</span>M.EMPNO;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"聚合函数和分组统计\"><a href=\"#聚合函数和分组统计\" class=\"headerlink\" title=\"聚合函数和分组统计\"></a>聚合函数和分组统计</h2><h3 id=\"聚合函数\"><a href=\"#聚合函数\" class=\"headerlink\" title=\"聚合函数\"></a>聚合函数</h3><p>聚合函数，也称为统计函数</p>\n<p>常用统计函数：</p>\n<ul>\n<li>count() 总数量</li>\n<li>max() 最大值</li>\n<li>min() 最小值</li>\n<li>sum() 和</li>\n<li>avg() 平均值</li>\n</ul>\n<p>例：查询部门30的总人数</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(EMPNO) EMPCNT <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> DEPTNO<span class=\"operator\">=</span><span class=\"number\">30</span>;</span><br></pre></td></tr></table></figure>\n\n<p><strong>会统计重复值，会忽略NULL值</strong></p>\n<p>例：查询部门30的最高工资、最低工资、平均工资</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">max</span>(SAL),<span class=\"built_in\">min</span>(SAL),round(<span class=\"built_in\">avg</span>(SAL),<span class=\"number\">2</span>) </span><br><span class=\"line\"><span class=\"keyword\">from</span> EMP </span><br><span class=\"line\"><span class=\"keyword\">where</span> DEPTNO<span class=\"operator\">=</span><span class=\"number\">30</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> ENAME,<span class=\"built_in\">count</span>(EMPNO) EMPCNT <span class=\"keyword\">from</span> EMP; <span class=\"comment\">-- 无实际意义也不合理，Oracle数据库会报错</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"分组统计\"><a href=\"#分组统计\" class=\"headerlink\" title=\"分组统计\"></a>分组统计</h3><h4 id=\"语法-4\"><a href=\"#语法-4\" class=\"headerlink\" title=\"语法\"></a>语法</h4><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> 列名<span class=\"number\">1</span> 别名，列名<span class=\"number\">2</span> 别名<span class=\"number\">2</span> ... </span><br><span class=\"line\"><span class=\"keyword\">from</span> 表名<span class=\"number\">1</span> 别名<span class=\"number\">1</span>,表名<span class=\"number\">2</span> 别名<span class=\"number\">2</span> ...</span><br><span class=\"line\"><span class=\"keyword\">where</span> 条件 </span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> 分组列 </span><br><span class=\"line\"><span class=\"keyword\">having</span> 分组后的条件 </span><br><span class=\"line\"><span class=\"keyword\">order</span> <span class=\"keyword\">by</span> 排序列<span class=\"number\">1</span> <span class=\"keyword\">asc</span><span class=\"operator\">|</span><span class=\"keyword\">desc</span>,排序列<span class=\"number\">2</span> <span class=\"keyword\">asc</span><span class=\"operator\">|</span><span class=\"keyword\">desc</span> ...;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"示例-1\"><a href=\"#示例-1\" class=\"headerlink\" title=\"示例\"></a>示例</h4><p>例：查询每个部门的平均工资</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> DEPTNO,<span class=\"built_in\">avg</span>(SAL) <span class=\"keyword\">from</span> EMP </span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> DEPTNO;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> D.DNAME,<span class=\"built_in\">avg</span>(E.SAL) </span><br><span class=\"line\"><span class=\"keyword\">from</span> EMP E,DEPT D </span><br><span class=\"line\"><span class=\"keyword\">where</span> E.DEPTNO<span class=\"operator\">=</span>D.DEPTNO </span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> D.DEPTNO;</span><br><span class=\"line\"><span class=\"comment\">-- 在MySQL中分组统计时可以查询出分组列以外的其他列，而在Oracle中不行</span></span><br><span class=\"line\"><span class=\"comment\">-- 建议将要查询出的列使用分组列</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> D.DNAME,<span class=\"built_in\">avg</span>(E.SAL) </span><br><span class=\"line\"><span class=\"keyword\">from</span> EMP E,DEPT D </span><br><span class=\"line\"><span class=\"keyword\">where</span> E.DEPTNO<span class=\"operator\">=</span>D.DEPTNO </span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> D.DNAME;</span><br></pre></td></tr></table></figure>\n\n<p>例：查询平均工资大于2000的部门的编号和平均工资</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> DEPTNO,<span class=\"built_in\">avg</span>(SAL) avg</span><br><span class=\"line\"><span class=\"keyword\">from</span> EMP </span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> DEPTNO </span><br><span class=\"line\"><span class=\"keyword\">having</span> avg<span class=\"operator\">&gt;</span><span class=\"number\">2000</span>; </span><br></pre></td></tr></table></figure>\n\n<p><strong>分组后的条件在group by之后使用having</strong></p>\n<p>例：查询部门平均工资的最大值</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">max</span>(<span class=\"built_in\">avg</span>(SAL)) <span class=\"keyword\">from</span> EMP <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> DEPTNO;</span><br></pre></td></tr></table></figure>\n\n<p><strong>至少在MySQL中聚合函数不能嵌套使用，需要使用子查询来实现</strong></p>\n<h2 id=\"子查询\"><a href=\"#子查询\" class=\"headerlink\" title=\"子查询\"></a>子查询</h2><p>一个查询中嵌套着另一个查询，称为子查询</p>\n<ul>\n<li>子查询必须放在小括号中</li>\n<li>子查询可以出现早任意位置，如select、from、where、having等</li>\n</ul>\n<h3 id=\"基本用法-1\"><a href=\"#基本用法-1\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h3><h4 id=\"语法-5\"><a href=\"#语法-5\" class=\"headerlink\" title=\"语法\"></a>语法</h4><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> (子查询) </span><br><span class=\"line\"><span class=\"keyword\">from</span> (子查询) </span><br><span class=\"line\"><span class=\"keyword\">where</span> (子查询) </span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> </span><br><span class=\"line\"><span class=\"keyword\">having</span> (子查询)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"示例-2\"><a href=\"#示例-2\" class=\"headerlink\" title=\"示例\"></a>示例</h4><p>例：查询工资比7566高的雇员信息</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP </span><br><span class=\"line\"><span class=\"keyword\">where</span> SAL<span class=\"operator\">&gt;</span>(</span><br><span class=\"line\">    <span class=\"keyword\">select</span> SAL <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> EMPNO<span class=\"operator\">=</span><span class=\"number\">7566</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p><strong>将自查询与比较运算符一起使用时，必须保证子查询返回的结果不能多余一个</strong></p>\n<p>例：查询雇员的编号、姓名、部门名称</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 使用多表连接</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> E.EMPNO,E.ENAME,D.DNAME </span><br><span class=\"line\"><span class=\"keyword\">from</span> EMP E,DEPT D </span><br><span class=\"line\"><span class=\"keyword\">where</span> E.DEPTNO<span class=\"operator\">=</span>D.DEPTNO;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 使用子查询</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> EMPNO,ENAME,(</span><br><span class=\"line\">    <span class=\"keyword\">select</span> DNAME <span class=\"keyword\">from</span> DEPT <span class=\"keyword\">where</span> DEPTNO<span class=\"operator\">=</span>E.DEPTNO</span><br><span class=\"line\">) </span><br><span class=\"line\"><span class=\"keyword\">from</span> EMP E;</span><br></pre></td></tr></table></figure>\n\n<p>总结：</p>\n<ul>\n<li>一般来说，多表连接查询都可以使用子查询替换</li>\n<li>子查询特点：灵活、方便，一般常作为增、删、改、查操作的条件，适合于操作一个表的数据</li>\n<li>多表连接查询更适合于查看多表中数据</li>\n</ul>\n<h3 id=\"子查询分类\"><a href=\"#子查询分类\" class=\"headerlink\" title=\"子查询分类\"></a>子查询分类</h3><ul>\n<li>单列子查询：返回单行单列，使用频率最高</li>\n<li>多行子查询：返回多行单列</li>\n<li>多列子查询：返回单行多列或多行多列，使用频率最低</li>\n</ul>\n<h4 id=\"单列子查询\"><a href=\"#单列子查询\" class=\"headerlink\" title=\"单列子查询\"></a>单列子查询</h4><p>例：查询工资高于平均工资的雇员信息</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP </span><br><span class=\"line\"><span class=\"keyword\">where</span> sal<span class=\"operator\">&gt;</span>(</span><br><span class=\"line\">    <span class=\"keyword\">select</span> <span class=\"built_in\">avg</span>(SAL) <span class=\"keyword\">from</span> EMP</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>例：查询部门名称、部门员工数、部门平均工资、部门工资最低雇员姓名</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> (<span class=\"keyword\">select</span> DNAME <span class=\"keyword\">from</span> DEPT <span class=\"keyword\">where</span> DEPTNO<span class=\"operator\">=</span>E.DEPTNO) DNAME,</span><br><span class=\"line\">    <span class=\"built_in\">count</span>(E.EMPNO) </span><br><span class=\"line\"><span class=\"keyword\">from</span> EMP E ;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> ED.DNAME,<span class=\"built_in\">count</span>(ED.EMPNO) EMPCNT,round(<span class=\"built_in\">avg</span>(SAL),<span class=\"number\">2</span>) AVGSAL,</span><br><span class=\"line\">    (<span class=\"keyword\">select</span> EMP.ENAME <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> EMP.SAL<span class=\"operator\">&gt;</span><span class=\"built_in\">min</span>(ED.SAL)) MINSALEMP</span><br><span class=\"line\"><span class=\"keyword\">from</span> (</span><br><span class=\"line\">    <span class=\"keyword\">select</span> E.EMPNO,E.SAL,D.DNAME </span><br><span class=\"line\">    <span class=\"keyword\">from</span> EMP E <span class=\"keyword\">right</span> <span class=\"keyword\">join</span> DEPT D </span><br><span class=\"line\">    <span class=\"keyword\">on</span> E.DEPTNO<span class=\"operator\">=</span>D.DEPTNO</span><br><span class=\"line\">)ED</span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> ED.DNAME; <span class=\"comment\">-- 当有多人拿最低工资时，子查询需要做进一步处理</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"多行子查询\"><a href=\"#多行子查询\" class=\"headerlink\" title=\"多行子查询\"></a>多行子查询</h4><p>多行子查询，即返回了一个数组，将子查询返回值当做正常数组处理即可</p>\n<p>对于多行子查询，可以使用如下三种操作符：</p>\n<ul>\n<li>in</li>\n</ul>\n<p>例：查询部门编号大于等于20的雇员信息</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP </span><br><span class=\"line\"><span class=\"keyword\">where</span> DEPTNO<span class=\"operator\">&gt;=</span><span class=\"number\">20</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP E  </span><br><span class=\"line\"><span class=\"keyword\">where</span> E.DEPTNO <span class=\"keyword\">in</span>(</span><br><span class=\"line\">       <span class=\"keyword\">select</span> DEPTNO <span class=\"keyword\">from</span> DEPT D </span><br><span class=\"line\">    <span class=\"keyword\">where</span> D.DEPTNO<span class=\"operator\">&gt;=</span><span class=\"number\">20</span> </span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>any</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">=any：与任意一个相同，此时与in操作符相同</span><br><span class=\"line\"><span class=\"meta prompt_\">&gt;</span><span class=\"language-bash\">any：只要比里面最小的值大即可</span></span><br><span class=\"line\">&lt;any：只要比里面最大的值小即可</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP E </span><br><span class=\"line\"><span class=\"keyword\">where</span> E.DEPTNO<span class=\"operator\">=</span><span class=\"keyword\">any</span>(</span><br><span class=\"line\">    <span class=\"keyword\">select</span> DEPTNO <span class=\"keyword\">from</span> DEPT D</span><br><span class=\"line\">    <span class=\"keyword\">where</span> D.DEPTNO<span class=\"operator\">&gt;=</span><span class=\"number\">20</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>all</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">&gt;</span><span class=\"language-bash\">all：大于返回数组中最大值</span></span><br><span class=\"line\">&lt;all：小于返回数组中最小值</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"多列子查询\"><a href=\"#多列子查询\" class=\"headerlink\" title=\"多列子查询\"></a>多列子查询</h4><p>多列子查询一般出现在from子句中，作为查询结果集</p>\n<p>例：在所有从事销售工作的雇员中找出大于1500的员工</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> </span><br><span class=\"line\"><span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> JOB<span class=\"operator\">=</span><span class=\"string\">&#x27;SALESMAN&#x27;</span>) ES </span><br><span class=\"line\"><span class=\"keyword\">where</span> ES.SAL<span class=\"operator\">&gt;</span><span class=\"number\">1500</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"分页查询\"><a href=\"#分页查询\" class=\"headerlink\" title=\"分页查询\"></a>分页查询</h2><h3 id=\"limit关键字\"><a href=\"#limit关键字\" class=\"headerlink\" title=\"limit关键字\"></a>limit关键字</h3><p>用来限制查询返回的记录数</p>\n<p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> 列名<span class=\"number\">1</span> 别名，列名<span class=\"number\">2</span> 别名<span class=\"number\">2</span> ... </span><br><span class=\"line\"><span class=\"keyword\">from</span> 表名<span class=\"number\">1</span> 别名<span class=\"number\">1</span>,表名<span class=\"number\">2</span> 别名<span class=\"number\">2</span> ...</span><br><span class=\"line\"><span class=\"keyword\">where</span> 条件 </span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> 分组列 </span><br><span class=\"line\"><span class=\"keyword\">having</span> 分组后的条件 </span><br><span class=\"line\"><span class=\"keyword\">order</span> <span class=\"keyword\">by</span> 排序列<span class=\"number\">1</span> <span class=\"keyword\">asc</span><span class=\"operator\">|</span><span class=\"keyword\">desc</span>,排序列<span class=\"number\">2</span> <span class=\"keyword\">asc</span><span class=\"operator\">|</span><span class=\"keyword\">desc</span> ...</span><br><span class=\"line\">limit [参数<span class=\"number\">1</span>],参数<span class=\"number\">2</span>;</span><br></pre></td></tr></table></figure>\n\n<p>可以接收一个或两个参数：</p>\n<ul>\n<li>参数1用来指定起始行的索引，索引从0开始计数</li>\n<li>参数2用来指定返回的记录数量</li>\n</ul>\n<p>例：查询工资前三名的雇员信息</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> SAL <span class=\"keyword\">desc</span> </span><br><span class=\"line\">limit <span class=\"number\">0</span>,<span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> SAL <span class=\"keyword\">desc</span> </span><br><span class=\"line\">limit <span class=\"number\">3</span>; <span class=\"comment\">--若只有一个参数，则指的是参数2</span></span><br></pre></td></tr></table></figure>\n\n<p>例：查询工资大于1000的第4-8的雇员</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP <span class=\"keyword\">where</span> SAL<span class=\"operator\">&gt;</span><span class=\"number\">1000</span></span><br><span class=\"line\">limit <span class=\"number\">3</span>,<span class=\"number\">5</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"分页\"><a href=\"#分页\" class=\"headerlink\" title=\"分页\"></a>分页</h3><p>例：每页显示pageSize，显示第pageIndex页的内容</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> EMP </span><br><span class=\"line\">limit (pageIndex<span class=\"number\">-1</span>)<span class=\"operator\">*</span>pageSize,pageSize <span class=\"comment\">-- 计算方式</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>在MySQL中limit后参数不能包含任何运算</strong></p>\n<h2 id=\"常用函数\"><a href=\"#常用函数\" class=\"headerlink\" title=\"常用函数\"></a>常用函数</h2><h3 id=\"字符串函数\"><a href=\"#字符串函数\" class=\"headerlink\" title=\"字符串函数\"></a>字符串函数</h3><ul>\n<li>concat(s1,s2,s3, …) 拼接字符串</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> concat(<span class=\"string\">&#x27;aa&#x27;</span>,<span class=\"string\">&#x27;bb&#x27;</span>,<span class=\"string\">&#x27;cc&#x27;</span>) <span class=\"keyword\">from</span> DUAL;</span><br><span class=\"line\"><span class=\"keyword\">select</span> concat(<span class=\"string\">&#x27;编号为&#x27;</span>,EMPNO,<span class=\"string\">&#x27;的员工，姓名为&#x27;</span>,ENAME) <span class=\"keyword\">from</span> EMP;</span><br></pre></td></tr></table></figure>\n\n<p><strong>dual表是MySQL提供的一张虚拟表，主要为满足select from语法习惯，一般测试时使用</strong></p>\n<ul>\n<li>lower(s) 将字符串变为小写</li>\n<li>upper(s) 将字符串变为大写</li>\n<li>length(s) 获取字符串的长度</li>\n<li>reverse(s) 将字符串反转</li>\n<li>trim(s) 去除字符串两边的空格 select trim(‘       helllo  ‘) from dual;<ul>\n<li>还有ltrim(s) , rtrim(s) ，分别用来去除字符串左边，右边的空格</li>\n</ul>\n</li>\n<li>replace(s,s1,s2)  -  将字符串s中的s1替换为s2</li>\n<li>repeat(s,n) 将字符串s重复n次</li>\n<li>lpad(s,len,s1) 在字符串s的左边使用s1进行填充，直至长度为len</li>\n<li>rpad(s,len,s1) 在字符串s的右边使用s1进行填充，直至长度为len</li>\n<li>substr(s,i,n) 截取字符串，从第i个字符开始，截取n个字符<ul>\n<li>left(s,n) 从左开始截取字符串，截取n个字符串</li>\n<li>right(s,n) 从右开始截取字符串，截取n个字符串</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"数值函数\"><a href=\"#数值函数\" class=\"headerlink\" title=\"数值函数\"></a>数值函数</h3><ul>\n<li>ceil(n) 向上取整，返回大于n的最小整数</li>\n<li>floor(n) 向下取整，返回小于n的最大整数</li>\n<li>round(n,x) 四舍五入，将n保留x位小数</li>\n<li>truncate(n,x) 向下取整，将n保留x位小数</li>\n<li>rand() 返回一个在(0,1)范围内的随机数</li>\n</ul>\n<h3 id=\"日期和时间函数\"><a href=\"#日期和时间函数\" class=\"headerlink\" title=\"日期和时间函数\"></a>日期和时间函数</h3><ul>\n<li>now() 返回当前日期时间，返回值类型与上下文有关</li>\n<li>currentdate() 返回当前日期</li>\n<li>currenttime() 返回当前时间</li>\n<li>year(date)，month(date), day(date) 返回日期中的年，月，日</li>\n<li>timestampdiff(interval,datetime1,datetime2) 返回两个日期时间之间相隔的整数，单位由interval定义 当datetime2&gt;datetime1（datetime2比datetime1晚）时，返回值为正</li>\n<li>date_format(datetime,pattern) 以pattern格式化日期datetime</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> date_format(now(),<span class=\"string\">&#x27;%Y年%m月%d日 %H:%i:%s&#x27;</span>) <span class=\"keyword\">from</span> dual;</span><br><span class=\"line\"><span class=\"operator\">%</span>Y表示四位数字的年</span><br><span class=\"line\"><span class=\"operator\">%</span>m表示两位数字的月</span><br><span class=\"line\"><span class=\"operator\">%</span>d表示两位数字的日</span><br><span class=\"line\"><span class=\"operator\">%</span>H表示两位数字的小时，<span class=\"number\">24</span>小时制</span><br><span class=\"line\"><span class=\"operator\">%</span>i表示两位数字的分钟</span><br><span class=\"line\"><span class=\"operator\">%</span>s表示两位数字的秒数</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"流程控制函数\"><a href=\"#流程控制函数\" class=\"headerlink\" title=\"流程控制函数\"></a>流程控制函数</h3><ul>\n<li>if(f,v1,v2) 如果f为帧，则返回v1，否则返回v2</li>\n<li>ifnull(v1,v2) 如果v1不为null，则返回v1，否则返回v2</li>\n<li>case函数</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">case</span> </span><br><span class=\"line\"><span class=\"keyword\">when</span> f1 <span class=\"keyword\">then</span> v1 </span><br><span class=\"line\"><span class=\"keyword\">when</span> f2 <span class=\"keyword\">then</span> v2 </span><br><span class=\"line\">... </span><br><span class=\"line\"><span class=\"keyword\">else</span> v </span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"comment\">-- 分支流程控制</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"系统信息函数\"><a href=\"#系统信息函数\" class=\"headerlink\" title=\"系统信息函数\"></a>系统信息函数</h3><ul>\n<li>database() 返回当前操作的数据库</li>\n<li>user() 返回当前登录的用户</li>\n<li>version() 返回当前数据库的版本</li>\n</ul>\n<h2 id=\"更新操作\"><a href=\"#更新操作\" class=\"headerlink\" title=\"更新操作\"></a>更新操作</h2><h3 id=\"insert\"><a href=\"#insert\" class=\"headerlink\" title=\"insert\"></a>insert</h3><p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> 表名(列名<span class=\"number\">1</span>,列名<span class=\"number\">2</span>, ...) <span class=\"keyword\">values</span>(值<span class=\"number\">1</span>,值<span class=\"number\">2</span>, ...);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 一次性插入多条数据</span></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> 表名(列名<span class=\"number\">1</span>,列名<span class=\"number\">2</span>, ...) <span class=\"keyword\">values</span></span><br><span class=\"line\">(值<span class=\"number\">1</span>,值<span class=\"number\">2</span>, ...)，</span><br><span class=\"line\">(值<span class=\"number\">1</span>,值<span class=\"number\">2</span>, ...),</span><br><span class=\"line\">(值<span class=\"number\">1</span>,值<span class=\"number\">2</span>, ...),</span><br><span class=\"line\">... </span><br><span class=\"line\">;</span><br></pre></td></tr></table></figure>\n\n<p>示例：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> DEPT(DEPTNO,LOC) </span><br><span class=\"line\"><span class=\"keyword\">values</span>(<span class=\"number\">50</span>,<span class=\"string\">&#x27;NanJing&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> DEPT </span><br><span class=\"line\"><span class=\"keyword\">values</span>(<span class=\"number\">60</span>,<span class=\"string\">&#x27;CLEANNING&#x27;</span>,<span class=\"string\">&#x27;BEIJING&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">-- 如果是一次插入表中所有的列，此时可以省略列名</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"delete\"><a href=\"#delete\" class=\"headerlink\" title=\"delete\"></a>delete</h3><p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> 表名 <span class=\"keyword\">where</span> 条件;</span><br></pre></td></tr></table></figure>\n\n<p>示例：删除SALES部门所有工资大于5000的员工</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> EMP E </span><br><span class=\"line\"><span class=\"keyword\">where</span> E.DEPTNO<span class=\"operator\">=</span>(</span><br><span class=\"line\">    <span class=\"keyword\">select</span> DEPTNO </span><br><span class=\"line\">    <span class=\"keyword\">from</span> DEPT </span><br><span class=\"line\">    <span class=\"keyword\">where</span> DNAME<span class=\"operator\">=</span><span class=\"string\">&#x27;SALES&#x27;</span></span><br><span class=\"line\">) <span class=\"keyword\">and</span> </span><br><span class=\"line\">E.SAL<span class=\"operator\">&gt;</span><span class=\"number\">5000</span>;</span><br><span class=\"line\"><span class=\"comment\">-- 此处只能用子查询，没法用多表连接</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>delete from 表名 会将表中所有数据都删除</strong></p>\n<h3 id=\"update\"><a href=\"#update\" class=\"headerlink\" title=\"update\"></a>update</h3><p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">update</span> 表名 <span class=\"keyword\">set</span> </span><br><span class=\"line\">列名<span class=\"number\">1</span><span class=\"operator\">=</span>值<span class=\"number\">1</span>,</span><br><span class=\"line\">列名<span class=\"number\">2</span><span class=\"operator\">=</span>值<span class=\"number\">2</span>, </span><br><span class=\"line\">... </span><br><span class=\"line\"><span class=\"keyword\">where</span> 条件;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"表和库的管理\"><a href=\"#表和库的管理\" class=\"headerlink\" title=\"表和库的管理\"></a>表和库的管理</h2><h3 id=\"数据类型\"><a href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"></a>数据类型</h3><p><strong>虽然SQL有数据类型的区分，但SQL仍然为弱类型语言</strong></p>\n<ul>\n<li>整数：smallint、int、bigint</li>\n<li>小数：float、double</li>\n<li>日期时间：date、time、datetime、timestamp</li>\n<li>字符串：varchar、char、text<ul>\n<li>char分配固定存储空间，varchar会根据实际存储内容占用存储空间</li>\n<li>varchar省空间但会损失查询效率</li>\n</ul>\n</li>\n<li>其他：<ul>\n<li>clob 存储大的文本数据</li>\n<li>blob 存储大的二进制数据</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"创建表\"><a href=\"#创建表\" class=\"headerlink\" title=\"创建表\"></a>创建表</h3><p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> 表名(</span><br><span class=\"line\">    列名 数据类型 特征,</span><br><span class=\"line\">    列名 数据类型,</span><br><span class=\"line\">    列名 数据类型,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>示例：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> t_student(</span><br><span class=\"line\">    id <span class=\"type\">int</span> <span class=\"keyword\">primary</span> key <span class=\"comment\">-- 将id作为主键，</span></span><br><span class=\"line\">        auto_increment, <span class=\"comment\">-- 自动增长，默认由1开始</span></span><br><span class=\"line\">    name <span class=\"type\">varchar</span>(<span class=\"number\">10</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>, <span class=\"comment\">-- 不允许为空</span></span><br><span class=\"line\">    age <span class=\"type\">int</span>,</span><br><span class=\"line\">    sex <span class=\"type\">varchar</span>(<span class=\"number\">8</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> <span class=\"keyword\">default</span> <span class=\"string\">&#x27;female&#x27;</span> <span class=\"comment\">-- 指定默认值</span></span><br><span class=\"line\">)charset<span class=\"operator\">=</span>utf8;</span><br></pre></td></tr></table></figure>\n\n<p>若使用全列插入，自动增长列可写NULL值，达到不影响自动增长功能的目的</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> t_student </span><br><span class=\"line\"><span class=\"keyword\">values</span>(<span class=\"keyword\">NULL</span>,<span class=\"string\">&#x27;adam&#x27;</span>,<span class=\"number\">11</span>,<span class=\"string\">&#x27;male&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>自动增长总是从该列最大值开始增长，不考虑前面数据的空缺</p>\n<h3 id=\"修改表\"><a href=\"#修改表\" class=\"headerlink\" title=\"修改表\"></a>修改表</h3><ul>\n<li>添加列</li>\n</ul>\n<p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> 表名 <span class=\"keyword\">add</span> 列名 数据类型;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改列类型（也可以修改unique列属性）</li>\n</ul>\n<p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> 表名 modify 列名 数据类型;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改列名</li>\n</ul>\n<p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> 表名 change 原列名 新列名 数据类型;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>删除列</li>\n</ul>\n<p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> 表名 <span class=\"keyword\">drop</span> 列名;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改表名</li>\n</ul>\n<p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> 表名 rename 新表名;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 或者</span></span><br><span class=\"line\"></span><br><span class=\"line\">rename <span class=\"keyword\">table</span> 原表名 <span class=\"keyword\">to</span> 新表名;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除表\"><a href=\"#删除表\" class=\"headerlink\" title=\"删除表\"></a>删除表</h3><p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> 表名;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> if <span class=\"keyword\">exists</span> 表名; <span class=\"comment\">-- 有此表，则删除；若没有，不执行任何操作</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"截断表\"><a href=\"#截断表\" class=\"headerlink\" title=\"截断表\"></a>截断表</h3><p>清空表中的数据，作用类似于没有条件的delete</p>\n<p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">truncate</span> <span class=\"keyword\">table</span> 表名;</span><br></pre></td></tr></table></figure>\n\n<p>delete与truncate区别：</p>\n<ul>\n<li>delete会记录日志，所以效率低；而truncate不记录日志，清空表并释放资源，速度快</li>\n<li>delete不会将自动增长列归零，而truncate会</li>\n<li>delete可以指定条件仅删除部分数据，truncate只能用来清空所有数据</li>\n</ul>\n<h3 id=\"创建库\"><a href=\"#创建库\" class=\"headerlink\" title=\"创建库\"></a>创建库</h3><p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> database 数据库名 charset utf8;</span><br><span class=\"line\"><span class=\"keyword\">create</span> database if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> 数据库名 charset utf8;</span><br><span class=\"line\"><span class=\"comment\">-- 无此库则创建；有此库则不执行操作</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除库\"><a href=\"#删除库\" class=\"headerlink\" title=\"删除库\"></a>删除库</h3><p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">drop</span> database 数据库名;</span><br><span class=\"line\"><span class=\"keyword\">drop</span> database if <span class=\"keyword\">exists</span> 数据库名;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 有此库则删除；无此库则不执行操作</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"约束\"><a href=\"#约束\" class=\"headerlink\" title=\"约束\"></a>约束</h2><p>constraint约束是对表中数据的一种限制，保证数据的完整性和有效性</p>\n<h3 id=\"约束分类\"><a href=\"#约束分类\" class=\"headerlink\" title=\"约束分类\"></a>约束分类</h3><p>有五种约束：</p>\n<ul>\n<li>主键约束 primary key。用来唯一标识一条记录，不能为空</li>\n<li>唯一约束 unique。不允许出现重复的值</li>\n<li>检查约束 check。判断数据是否符合指定条件。<strong>MySQL会对check约束进行解析，但会忽略check约束，不会强制执行，可以通过SQL编程来解决。其他数据库基本上都是写完check都会生效。</strong></li>\n<li>非空约束 not null。不允许为null，但可以为空字符串’’</li>\n<li>外键约束 foreign key。约束两表之间的关联关系</li>\n</ul>\n<h3 id=\"添加约束\"><a href=\"#添加约束\" class=\"headerlink\" title=\"添加约束\"></a>添加约束</h3><h4 id=\"方式1：在创建表时添加约束\"><a href=\"#方式1：在创建表时添加约束\" class=\"headerlink\" title=\"方式1：在创建表时添加约束\"></a>方式1：在创建表时添加约束</h4><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> student (</span><br><span class=\"line\">    id <span class=\"type\">int</span> <span class=\"keyword\">primary</span> key, <span class=\"comment\">-- 主键约束</span></span><br><span class=\"line\">    name <span class=\"type\">varchar</span>(<span class=\"number\">10</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>, <span class=\"comment\">-- 非空约束</span></span><br><span class=\"line\">    age <span class=\"type\">int</span> <span class=\"keyword\">check</span>(age <span class=\"keyword\">between</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"number\">200</span>), <span class=\"comment\">-- 检查约束</span></span><br><span class=\"line\">    gender <span class=\"type\">varchar</span>(<span class=\"number\">8</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> <span class=\"keyword\">check</span>(gender <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;male&#x27;</span>,<span class=\"string\">&#x27;female&#x27;</span>),</span><br><span class=\"line\">    IDCard <span class=\"type\">varchar</span>(<span class=\"number\">18</span>) <span class=\"keyword\">unique</span>, <span class=\"comment\">-- 唯一约束</span></span><br><span class=\"line\">    class id <span class=\"type\">int</span>, <span class=\"comment\">-- 外键列</span></span><br><span class=\"line\">    <span class=\"keyword\">foreign</span> key (class_id) <span class=\"keyword\">references</span> class(c_id) <span class=\"comment\">-- 外键约束单独说明，引用主表主键</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> class (</span><br><span class=\"line\">    c_id <span class=\"type\">int</span> <span class=\"keyword\">primary</span> key,</span><br><span class=\"line\">    c_name <span class=\"type\">varchar</span>(<span class=\"number\">20</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>查看表的所有信息（约束）：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> <span class=\"keyword\">create</span> <span class=\"keyword\">table</span> 表名;</span><br></pre></td></tr></table></figure>\n\n<p>为约束指定名称</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> student (</span><br><span class=\"line\">    id <span class=\"type\">int</span>, </span><br><span class=\"line\">    name <span class=\"type\">varchar</span>(<span class=\"number\">10</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>, </span><br><span class=\"line\">    age <span class=\"type\">int</span>, </span><br><span class=\"line\">    gender <span class=\"type\">varchar</span>(<span class=\"number\">8</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>, </span><br><span class=\"line\">    IDCard <span class=\"type\">varchar</span>(<span class=\"number\">18</span>) <span class=\"keyword\">unique</span>, </span><br><span class=\"line\">    class id <span class=\"type\">int</span>, </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">constraint</span> pk_id <span class=\"keyword\">primary</span> key (id),</span><br><span class=\"line\">    <span class=\"keyword\">constraint</span> ck_age <span class=\"keyword\">check</span>(age <span class=\"keyword\">between</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"number\">200</span>),</span><br><span class=\"line\">    <span class=\"keyword\">constraint</span> ck_gender <span class=\"keyword\">check</span>(gender <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;male&#x27;</span>,<span class=\"string\">&#x27;female&#x27;</span>)),</span><br><span class=\"line\">    <span class=\"keyword\">constraint</span> uq_IDCard <span class=\"keyword\">unique</span>(IDCard),</span><br><span class=\"line\">    <span class=\"keyword\">constraint</span> fk_class_id <span class=\"keyword\">foreign</span> key (class_id) <span class=\"keyword\">references</span> class(c_id)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p><strong>非空约束只能在建表时在列名后面指定</strong></p>\n<h4 id=\"方式2：在创建表之后再添加约束\"><a href=\"#方式2：在创建表之后再添加约束\" class=\"headerlink\" title=\"方式2：在创建表之后再添加约束\"></a>方式2：在创建表之后再添加约束</h4><p>为表添加约束，语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> 表名 <span class=\"keyword\">add</span> <span class=\"keyword\">constraint</span> 约束名 约束类型 约束内容</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> student <span class=\"keyword\">add</span> <span class=\"keyword\">constraint</span> pk_id <span class=\"keyword\">primary</span> key (id);</span><br><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> student <span class=\"keyword\">add</span> <span class=\"keyword\">constraint</span> ck_age <span class=\"keyword\">check</span>(age <span class=\"keyword\">between</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"number\">200</span>);</span><br><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> student <span class=\"keyword\">add</span> <span class=\"keyword\">constraint</span> ck_gender <span class=\"keyword\">check</span>(gender <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;male&#x27;</span>,<span class=\"string\">&#x27;female&#x27;</span>));</span><br><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> student <span class=\"keyword\">add</span> <span class=\"keyword\">constraint</span> uq_IDCard <span class=\"keyword\">unique</span>(IDCard);</span><br><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> student <span class=\"keyword\">add</span> <span class=\"keyword\">constraint</span> fk_class_id <span class=\"keyword\">foreign</span> key (class_id) <span class=\"keyword\">references</span> class(c_id);</span><br></pre></td></tr></table></figure>\n\n<p><strong>如果表中原有数据不符合新添加的约束，则无法添加</strong></p>\n<h3 id=\"删除约束\"><a href=\"#删除约束\" class=\"headerlink\" title=\"删除约束\"></a>删除约束</h3><p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 删除主键约束</span></span><br><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> student <span class=\"keyword\">drop</span> <span class=\"keyword\">primary</span> key; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 删除外键约束</span></span><br><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> student <span class=\"keyword\">drop</span> <span class=\"keyword\">foreign</span> key 约束名称;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 删除唯一约束</span></span><br><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> student <span class=\"keyword\">drop</span> index 约束名称; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 删除非空约束</span></span><br><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> student modify 列名 数据类型 <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 删除检查约束</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h3><ul>\n<li>创建表时，应先创建主表再创建从表；删除表时，应先删除从表，再删除主表</li>\n<li>可以在创建表时指定级联删除，当主表数据被删除时，将自动删除从表中的相关数据</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> student (</span><br><span class=\"line\">    id <span class=\"type\">int</span> <span class=\"keyword\">primary</span> key, </span><br><span class=\"line\">    class_id <span class=\"type\">int</span>, </span><br><span class=\"line\">     <span class=\"keyword\">foreign</span> key(class_id) <span class=\"keyword\">references</span> class(c_id) <span class=\"keyword\">on</span> <span class=\"keyword\">delete</span> cascade <span class=\"comment\">-- 级联删除</span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"用户和权限管理\"><a href=\"#用户和权限管理\" class=\"headerlink\" title=\"用户和权限管理\"></a>用户和权限管理</h2><h3 id=\"创建用户并授予权限\"><a href=\"#创建用户并授予权限\" class=\"headerlink\" title=\"创建用户并授予权限\"></a>创建用户并授予权限</h3><p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">grant</span> 权限列表 <span class=\"keyword\">on</span> 库名.表名 <span class=\"keyword\">to</span> 用户名@来源地址 identified <span class=\"keyword\">by</span> <span class=\"string\">&#x27;密码&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>示例：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">grant</span> <span class=\"keyword\">select</span> <span class=\"keyword\">on</span> test.EMP <span class=\"keyword\">to</span> tom<span class=\"variable\">@localhost</span> identified <span class=\"keyword\">by</span> <span class=\"string\">&#x27;password&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>说明：</p>\n<ul>\n<li>默认测试库可能不受权限管理控制</li>\n<li>只有root管理员才具有创建用户的权限</li>\n<li>可以在库名表名使用*表示所有库、表可用</li>\n<li>可以在地址来源使用’%’来表示所有地址来源可用</li>\n</ul>\n<p>上述语法适用于MySQL5.6的版本</p>\n<p>对比查看<a href=\"https://dev.mysql.com/doc/refman/5.6/en/grant.html\">5.6</a>和<a href=\"https://dev.mysql.com/doc/refman/8.0/en/grant.html\">8.0</a>两个版本的文档，在8.0版本中grant命令没法同时新增用户和为用户授权。</p>\n<h3 id=\"查看权限\"><a href=\"#查看权限\" class=\"headerlink\" title=\"查看权限\"></a>查看权限</h3><p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> grants; <span class=\"comment\">-- 可查看自己的权限</span></span><br><span class=\"line\"><span class=\"keyword\">show</span> grants <span class=\"keyword\">for</span> 用户名@来源地址; <span class=\"comment\">-- 查看其他人权限，仅root可用</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"撤销权限\"><a href=\"#撤销权限\" class=\"headerlink\" title=\"撤销权限\"></a>撤销权限</h3><p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">revoke</span> 权限列表 <span class=\"keyword\">on</span> 库名.表名 用户名@来源地址;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除用户\"><a href=\"#删除用户\" class=\"headerlink\" title=\"删除用户\"></a>删除用户</h3><p>语法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> mysql.user </span><br><span class=\"line\"><span class=\"keyword\">where</span> <span class=\"keyword\">user</span><span class=\"operator\">=</span><span class=\"string\">&#x27;用户名&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">flush privileges; <span class=\"comment\">-- 刷新权限</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"事务处理\"><a href=\"#事务处理\" class=\"headerlink\" title=\"事务处理\"></a>事务处理</h2><p>Transaction。事务处理是用来保证数据操作的完整性。</p>\n<p>一个事务由若干个一次性的操作组成，这些操作不是都成功，就是都失败，如银行转账。</p>\n<p>事务的特性ACID：</p>\n<ul>\n<li>原子性（Atomicity）：不可再分</li>\n<li>一致性（Consistency）：要保证数据前后的一致性</li>\n<li>隔离性（Isolation）：两个事务的操作互不干扰</li>\n<li>持久性（Durability）：一旦事务提交，不可回滚</li>\n</ul>\n<h3 id=\"事务操作\"><a href=\"#事务操作\" class=\"headerlink\" title=\"事务操作\"></a>事务操作</h3><p>MySQL默认是自动提交事务的，将每一条语句都当做一个独立的事务执行，可以通过autocommit关闭自动提交事务。</p>\n<ul>\n<li>查看autocommit模式：show variables like ‘autocommit’;</li>\n<li>设置autocommit模式：set autocommit&#x3D;on&#x2F;off;</li>\n<li>手动提交事务：commit;</li>\n<li>回滚未提交的事务：rollback;</li>\n</ul>\n","categories":["Database"],"tags":["MySQL"]},{"title":"JMM和底层实现原理","url":"/%E7%AC%94%E8%AE%B0/Java/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JMM%E5%92%8C%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/","content":"<blockquote>\n<p>(╬￣皿￣)&#x3D;凸  -你苟辟才艺！</p>\n</blockquote>\n<h2 id=\"线程间的通信和同步\"><a href=\"#线程间的通信和同步\" class=\"headerlink\" title=\"线程间的通信和同步\"></a>线程间的通信和同步</h2><h3 id=\"线程间通信\"><a href=\"#线程间通信\" class=\"headerlink\" title=\"线程间通信\"></a>线程间通信</h3><p>线程间通信是指线程之间用来交换信息的机制。线程间的通信机制有两种， <strong>共享内存</strong> 和 <strong>消息传递</strong>。</p>\n<ul>\n<li>共享内存。线程之间共享程序的公共状态，线程之间通过写-读内存中的公共状态进行隐式通信。典型的案例是通过共享对象进行通信。</li>\n<li>消息传递。线程之间没有公共状态，必须通过发送显式消息进行通信。典型的案例是wait()和notify()。</li>\n</ul>\n<h3 id=\"线程间同步\"><a href=\"#线程间同步\" class=\"headerlink\" title=\"线程间同步\"></a>线程间同步</h3><p>线程间同步是指程序用于控制不同线程之间发生相对顺序的机制。</p>\n<ul>\n<li>共享内存模型中，同步是显式进行的。开发者必须显式指定某个方法或代码需要在线程之间互斥执行。</li>\n<li>在消息传递并发模型中，由于消息的发送必须在消息的接收之前，因此同步是隐式进行的。</li>\n</ul>\n<h2 id=\"JMM\"><a href=\"#JMM\" class=\"headerlink\" title=\"JMM\"></a>JMM</h2><p>Java Memory Module，Java内存模型。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">// 一般计算机的内存模型</span><br><span class=\"line\">处理器&lt;-&gt;高速缓存&lt;-&gt;  缓</span><br><span class=\"line\">                     存</span><br><span class=\"line\">                     一</span><br><span class=\"line\">处理器&lt;-&gt;高速缓存&lt;-&gt;  致  &lt;--&gt;  主内存</span><br><span class=\"line\">                     性</span><br><span class=\"line\">                     协</span><br><span class=\"line\">处理器&lt;-&gt;高速缓存&lt;-&gt;  议</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">// Java 内存模型</span><br><span class=\"line\">Java线程&lt;-&gt;工作内存&lt;-&gt;  Store</span><br><span class=\"line\">                       和</span><br><span class=\"line\">Java线程&lt;-&gt;工作内存&lt;-&gt;  Load   &lt;--&gt;  主内存</span><br><span class=\"line\">                       操</span><br><span class=\"line\">Java线程&lt;-&gt;工作内存&lt;-&gt;  作</span><br></pre></td></tr></table></figure>\n\n<p>JVM 对Java内存模型的实现。</p>\n<p>JVM内部将内存分为堆区和栈区。每个线程都拥有自己的线程栈，包含当前线程执行的方法调用信息。</p>\n<p>线程栈还包含了当前方法的所有局部变量信息。线程只能读取自己的线程栈，所以线程中的本地变量不可见，是线程安全的。</p>\n<h2 id=\"Java内存模型带来的问题\"><a href=\"#Java内存模型带来的问题\" class=\"headerlink\" title=\"Java内存模型带来的问题\"></a>Java内存模型带来的问题</h2><ul>\n<li>共享对象的可见性。线程1将变量修改后，还未写回主内存，此时线程2读取变量的值是未更新的。</li>\n<li>共享对象的竞争。多个线程同时对同一变量做修改，结果会出现异常无法预知。</li>\n</ul>\n<h2 id=\"重排序\"><a href=\"#重排序\" class=\"headerlink\" title=\"重排序\"></a>重排序</h2><p>源代码-&gt;编译器优化重排序-&gt;指令集并行重排序-&gt;内存系统重排序-&gt;最终执行指令序列</p>\n<p>有数据依赖或控制依赖时是不会有重排序的，因为执行逻辑会改变。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 不会重排序的一些场景</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 写后读</span></span><br><span class=\"line\">a = <span class=\"number\">1</span>;</span><br><span class=\"line\">b = a;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 写后写</span></span><br><span class=\"line\">a = <span class=\"number\">1</span>;</span><br><span class=\"line\">a = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 读后写</span></span><br><span class=\"line\">a = b;</span><br><span class=\"line\">b = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 控制依赖。b=1跑不到if外面去。（好吧，也有可能，有一个猜测执行的东西，在判断前就先执行语句块里的东西了。但从外部是感知不到的。</span></span><br><span class=\"line\">a = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(flag)&#123;</span><br><span class=\"line\">    b = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"重排序问题\"><a href=\"#重排序问题\" class=\"headerlink\" title=\"重排序问题\"></a>重排序问题</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">a</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">init</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        a = <span class=\"number\">1</span>; <span class=\"comment\">// 1</span></span><br><span class=\"line\">        flag = <span class=\"literal\">true</span>; <span class=\"comment\">// 2</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">use</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(flag)&#123; <span class=\"comment\">// 3</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> a * a; <span class=\"comment\">// 4</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上方的代码。当线程1执行init()方法时，线程2同时执行use()方法。可能会因为重排序得到预期外的结果。</p>\n<p>原因在于语句1和语句2可能会重排序，flag &#x3D; true先执行，此时a的值还是0，而非预期的1。</p>\n<h2 id=\"Happens-Before\"><a href=\"#Happens-Before\" class=\"headerlink\" title=\"Happens-Before\"></a>Happens-Before</h2><p>先行发生原则。用于阐述操作之间的内存可见性。无需其他操作就可默认保证的。</p>\n<p>在JMM中，如果一个操作执行的结果需要对另一个操作可见，那么这两个操作之间必须要存在happens-before关系。</p>\n<p>两个操作之间具有happens-before关系，<strong>并不意味着前一个操作必须要在后一个操作之前执行</strong>。仅要求前一个操作（执行的结果）对后一个操作可见。</p>\n<p>如果重排序后执行的结果，与按happens-before关系执行的结果一致，则这种重排序是允许的（对于编译器和处理器）。</p>\n<h3 id=\"单一线程原则\"><a href=\"#单一线程原则\" class=\"headerlink\" title=\"单一线程原则\"></a>单一线程原则</h3><ol>\n<li>单一线程原则。Single Thread Rule 。在一个线程内，程序前面的操作先行发生于后面的操作。</li>\n<li>管程锁定规则。Monitor Lock Rule 。对同一个锁的unlock操作先行发生于锁的lock操作。</li>\n<li>volatile变量规则。Volatile Variable Rule 。对于一个volatile变量的写操作先行发生于后面对其的读操作。</li>\n<li>线程启动规则。Thread Start Rule 。Thread对象的start方法调用先行发生于此线程的每一个动作。</li>\n<li>线程加入规则。Thread Join Rule 。Thread对象的结束先行发生于join方法返回。</li>\n<li>线程中断规则。Thread Interruption Rule 。对线程interrupt方法的调用先行发生于 被中断线程的代码检测到中断事件的发生。如interrupted()。</li>\n<li>对象终结规则。Finalizer Rule 。一个对象的初始化先行发生于 它 finalize()方法的开始。</li>\n<li>传递性。Transtivity 。如果操作A先行发生于操作B，操作B先行发生于操作C，那么操作A先行发生于操作C。</li>\n</ol>\n<h2 id=\"volatile的内存语义\"><a href=\"#volatile的内存语义\" class=\"headerlink\" title=\"volatile的内存语义\"></a>volatile的内存语义</h2><ul>\n<li>可见性：对一个volatile变量的读，总是能看到任意线程对此变量<strong>最后</strong>的写入。</li>\n<li>原子性：对任意单个volatile变量的读&#x2F;写具有原子性，但类似于volatile++这种复合操作不具有原子性。</li>\n</ul>\n<p>内存语义：</p>\n<ul>\n<li>当写一个volatile变量时，JMM会把该线程对应的本地内存中的共享变量值刷新到主内存。</li>\n<li>当读一个volatile变量时，JMM会把该线程对应的本地内存置为无效。线程接下来将从主内存中读取共享变量。</li>\n</ul>\n<p>可以把对volatile变量的单个读&#x2F;写，看成是同一个锁对这些单个读&#x2F;写操作做了同步。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">volatile</span> <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getI</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setI</span><span class=\"params\">(<span class=\"type\">int</span> i)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.i = i;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">inc</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        i++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上方关于volatile变量的代码，粗略相当于下方代码的同步效果。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"type\">int</span> <span class=\"title function_\">getI</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setI</span><span class=\"params\">(<span class=\"type\">int</span> i)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.i = i;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">inc</span><span class=\"params\">()</span> &#123; <span class=\"comment\">// volatile只保证了内存可见性，以及get和set的原子性，自增操作包含多种操作，不是并发安全的。</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">temp</span> <span class=\"operator\">=</span> getI();</span><br><span class=\"line\">        temp = temp + <span class=\"number\">1</span>;</span><br><span class=\"line\">        setI(temp);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当写一个volatile变量时，JMM会把该线程对应的本地内存中的共享变量值刷新到主内存。</p>\n<p>当读一个volatile变量时，JMM会把该线程对应的本地内存置为无效。线程接下来将从主内存中读取共享变量。</p>\n<p>之前举过的例子，如果当flag变量设置为volatile类型，则线程调用init方法为flag赋值时，也会将变量a的值刷到主内存；线程调用use方法读flag时，重新从主内存读flag的值。避免了重排序的问题。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">a</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">init</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        a = <span class=\"number\">1</span>; <span class=\"comment\">// 1</span></span><br><span class=\"line\">        flag = <span class=\"literal\">true</span>; <span class=\"comment\">// 2</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">use</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(flag)&#123; <span class=\"comment\">// 3</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> a * a; <span class=\"comment\">// 4</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"禁止重排序规则\"><a href=\"#禁止重排序规则\" class=\"headerlink\" title=\"禁止重排序规则\"></a>禁止重排序规则</h3><p>下列代码顺序，不允许重排序。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">// 1</span><br><span class=\"line\">普通读/写；</span><br><span class=\"line\">volatile写;</span><br><span class=\"line\"></span><br><span class=\"line\">// 2</span><br><span class=\"line\">volatile读/写;</span><br><span class=\"line\">volatile读/写;</span><br><span class=\"line\"></span><br><span class=\"line\">// 3</span><br><span class=\"line\">volatile写;</span><br><span class=\"line\">volatile读/写;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"内存屏障插入策略\"><a href=\"#内存屏障插入策略\" class=\"headerlink\" title=\"内存屏障插入策略\"></a>内存屏障插入策略</h3><ul>\n<li>每个volatile写操作前插入一个Store-Store屏障。在每个volatile写操作后插入一个Store-Load屏障。</li>\n<li>每个volatile读操作后插入一个Load-Load屏障和一个Load-Store屏障。</li>\n</ul>\n<h2 id=\"锁的内存语义\"><a href=\"#锁的内存语义\" class=\"headerlink\" title=\"锁的内存语义\"></a>锁的内存语义</h2><ul>\n<li>线程释放锁时，JMM会把该线程对应的本地内存中的共享变量值刷新到主内存。</li>\n<li>线程获取锁时，JMM会把该线程对应的本地内存置为无效。从而使得被监视器保护的临界区代码必须从主内存中读取共享变量。</li>\n</ul>\n<h2 id=\"final的内存语义\"><a href=\"#final的内存语义\" class=\"headerlink\" title=\"final的内存语义\"></a>final的内存语义</h2><p>编译器和处理器要遵守两个重排序规则。</p>\n<ul>\n<li>在构造函数内对一个final域的写入，与随后把这个被构造对象的引用复制给一个引用对象。这两个操作之间不能重排序。</li>\n<li>初次读一个包含final域的对象的引用，与随后初次读这个final域。这两个操作之间不能重排序。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">int</span> a;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Test</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.a = <span class=\"number\">1</span>; <span class=\"comment\">// 1</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Test</span> <span class=\"variable\">test</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Test</span>(); <span class=\"comment\">// 2</span></span><br><span class=\"line\">        System.out.println(test); <span class=\"comment\">// 3，初次读对象引用</span></span><br><span class=\"line\">        System.out.println(test.a); <span class=\"comment\">// 4，初次读final域</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在上例中，操作1和操作2不能重排序。即对于final域的初始化完成后，再将其所在的对象赋给一个引用。</p>\n<p>操作3和操作4不能重排序。</p>\n<p>如果final域是引用类型。则 在构造函数内对于final引用对象成员域的写入，与随后在构造函数外把这个被构造对象的引用赋值给一个引用变量。这两个操作不能重排序。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Object a;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Test</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.a = <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Test</span> <span class=\"variable\">test</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Test</span>(); <span class=\"comment\">// 2</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>操作1和操作2不能重排序。即 先等待 this.a &#x3D; new Object(); 语句完全执行完成后，再将new出来的Test对象赋给test。</p>\n<p>final语义在处理器中的实现</p>\n<ul>\n<li>在final域的写后，构造函数在return前插入一个Store-Store屏障。</li>\n<li>在读final域的操作前插入一个Load-Load屏障。</li>\n</ul>\n<h2 id=\"volatile的实现原理\"><a href=\"#volatile的实现原理\" class=\"headerlink\" title=\"volatile的实现原理\"></a>volatile的实现原理</h2><p>有volatile修饰的共享变量写操作时会使用CPU提供的Lock前缀指令。</p>\n<ul>\n<li>将当前处理器缓存行的数据写回到系统内存。</li>\n<li>写回内存的操作会使其他CPU里缓存了该内存地址的数据无效。</li>\n</ul>\n<h2 id=\"synchronized的实现原理\"><a href=\"#synchronized的实现原理\" class=\"headerlink\" title=\"synchronized的实现原理\"></a>synchronized的实现原理</h2><p>使用monitorenter和monitorexit指令实现的</p>\n<ul>\n<li>monitor指令是在编译后插入到同步代码块的开始位置，而monitorexit是插入到方法结束处或异常处</li>\n<li>每个monitorenter必须要有对应的monitorexit与之匹配。</li>\n<li>任何对象都有一个monitor与之关联，当一个monitor被持有后，它将处于锁定状态。</li>\n</ul>\n<p>锁放在对象头里。</p>\n<h2 id=\"了解各种锁\"><a href=\"#了解各种锁\" class=\"headerlink\" title=\"了解各种锁\"></a>了解各种锁</h2><p>锁一共有4中状态，级别从低到高依次是：无锁状态、偏向锁状态、轻量级锁状态和重量级锁状态</p>\n<h3 id=\"偏向锁\"><a href=\"#偏向锁\" class=\"headerlink\" title=\"偏向锁\"></a>偏向锁</h3><p>大多数情况下，锁不仅不存在多线程竞争，而且总是由同一线程多次获得，为了让线程获得锁的代价更低而引入了偏向锁。无竞争时不需要进行CAS操作来加锁和解锁。</p>\n<h3 id=\"轻量级锁\"><a href=\"#轻量级锁\" class=\"headerlink\" title=\"轻量级锁\"></a>轻量级锁</h3><p>通过CAS操作来加锁和解锁。</p>\n<p>使用CAS操作尝试修改对象头中的锁持有状态。自旋失败后锁会膨胀成轻量锁。</p>\n<h3 id=\"重量级锁\"><a href=\"#重量级锁\" class=\"headerlink\" title=\"重量级锁\"></a>重量级锁</h3>","categories":["多线程"],"tags":["Java"]},{"title":"原子操作CAS","url":"/%E7%AC%94%E8%AE%B0/Java/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9CCAS/","content":"<h2 id=\"CAS\"><a href=\"#CAS\" class=\"headerlink\" title=\"CAS\"></a>CAS</h2><p>Compare And Swap</p>\n<h3 id=\"原子操作\"><a href=\"#原子操作\" class=\"headerlink\" title=\"原子操作\"></a>原子操作</h3><p>这种操作一旦开始，就一直运行到结束，中间不会有任何 context switch（上下文切换）。</p>\n<p>synchronize关键字，基于阻塞和锁机制，可以实现原子操作，但会带来以下几个问题：</p>\n<ol>\n<li>被阻塞的高优先级线程无法及时执行</li>\n<li>拿到锁的线程一直不释放线程，或死锁</li>\n<li>大量锁竞争带来频繁的上下文切换，消耗cpu资源</li>\n</ol>\n<h3 id=\"CAS原理\"><a href=\"#CAS原理\" class=\"headerlink\" title=\"CAS原理\"></a>CAS原理</h3><p>指令级别保证CAS是一个原子操作。</p>\n<p>CAS有三个运算符：内存位置V、预期原值A和新值B</p>\n<p>基本思路：如果内存位置的值与预期原值相匹配，那么处理器会自动将该位置值更新为新值。否则，处理器不做任何操作。</p>\n<p>“我认为位置V应该包含值A；如果包含该值，则将B放到这个位置；否则，不要更改该位置，只告诉我这个位置现在的值即可。”</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// sun.misc.Unsafe#getAndAddInt</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">getAndAddInt</span><span class=\"params\">(Object object, <span class=\"type\">long</span> offset, <span class=\"type\">int</span> update)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> expect;</span><br><span class=\"line\">    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">        expect = <span class=\"built_in\">this</span>.getIntVolatile(<span class=\"built_in\">this</span>, offset);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">while</span> (!<span class=\"built_in\">this</span>.compareAndSwapInt(<span class=\"built_in\">this</span>, offset, expect, expect + update));</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> expect;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"CAS的问题\"><a href=\"#CAS的问题\" class=\"headerlink\" title=\"CAS的问题\"></a>CAS的问题</h3><h4 id=\"ABA问题\"><a href=\"#ABA问题\" class=\"headerlink\" title=\"ABA问题\"></a>ABA问题</h4><p>内存位置V的值原先是A，之后被改为B，再被改为A，此时再去和预期原值比较，会得出匹配的结果，无法感知内存值的实际变化过程。</p>\n<p>解决方案是可以给变量值加上版本号，A1-&gt;B2-&gt;A3</p>\n<h4 id=\"开销问题\"><a href=\"#开销问题\" class=\"headerlink\" title=\"开销问题\"></a>开销问题</h4><p>因为CAS操作是需要死循环（自旋）不停检测的，如果长时间不成功，资源开销会很大。</p>\n<h4 id=\"只能保证单个共享变量\"><a href=\"#只能保证单个共享变量\" class=\"headerlink\" title=\"只能保证单个共享变量\"></a>只能保证单个共享变量</h4><p>CAS的原子操作只能针对一个共享变量，假如需要针对多个变量进行原子操作也是可以解决的。</p>\n<h2 id=\"原子操作类\"><a href=\"#原子操作类\" class=\"headerlink\" title=\"原子操作类\"></a>原子操作类</h2><ul>\n<li>更新基本类型类<ul>\n<li>AtomicBoolean</li>\n<li>AtomicInteger</li>\n<li>AtomicLong…</li>\n</ul>\n</li>\n<li>更新数组类<ul>\n<li>AtomicIntegerArray</li>\n<li>AtomicLongArray</li>\n<li>AtomicReferenceArray…</li>\n</ul>\n</li>\n<li>更新引用类型<ul>\n<li>AtomicReferenceArray</li>\n<li>AtomicMarkableReference</li>\n<li>AtomicStampedReference</li>\n</ul>\n</li>\n<li>原子更新字段类<ul>\n<li>AtomicReferenceFieldUpdater</li>\n<li>AtomicIntegerFieldUpdater</li>\n<li>AtomicLongFiledUpdater</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Integer原子类\"><a href=\"#Integer原子类\" class=\"headerlink\" title=\"Integer原子类\"></a>Integer原子类</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">AtomicInteger</span> <span class=\"variable\">atomicInteger</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicInteger</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">System.out.println(atomicInteger.incrementAndGet());</span><br><span class=\"line\"><span class=\"comment\">// 输出2</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"原子引用类\"><a href=\"#原子引用类\" class=\"headerlink\" title=\"原子引用类\"></a>原子引用类</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        AtomicReference&lt;Tester&gt; testerRef = <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicReference</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">Tester</span> <span class=\"variable\">testerA</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Tester</span> <span class=\"variable\">testerB</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;B&quot;</span>);</span><br><span class=\"line\">        testerRef.set(testerA);</span><br><span class=\"line\"></span><br><span class=\"line\">        testerRef.compareAndSet(testerA, testerB);</span><br><span class=\"line\">        System.out.println(testerRef.get().toString());</span><br><span class=\"line\">        System.out.println(testerA.toString());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">int</span> id;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getId</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> id;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setId</span><span class=\"params\">(<span class=\"type\">int</span> id)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.id = id;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getName</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> name;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setName</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Tester</span><span class=\"params\">(<span class=\"type\">int</span> id, String name)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.id = id;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;My ID is &quot;</span> + id + <span class=\"string\">&quot;, My name is &quot;</span> + name;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">My ID is 2, My name is B</span><br><span class=\"line\">My ID is 1, My name is A</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"带版本号的原子引用类\"><a href=\"#带版本号的原子引用类\" class=\"headerlink\" title=\"带版本号的原子引用类\"></a>带版本号的原子引用类</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;A&quot;</span>;</span><br><span class=\"line\">        AtomicStampedReference&lt;String&gt; asr = <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicStampedReference</span>&lt;&gt;(str, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">oldStamp</span> <span class=\"operator\">=</span> asr.getStamp();</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">threadA</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(asr, asr.getReference(), <span class=\"string\">&quot;B&quot;</span>, oldStamp), <span class=\"string\">&quot;ThreadA&quot;</span>);</span><br><span class=\"line\">        threadA.start();</span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">500</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">threadB</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(asr, asr.getReference(), <span class=\"string\">&quot;C&quot;</span>, oldStamp), <span class=\"string\">&quot;ThreadB&quot;</span>);</span><br><span class=\"line\">        threadB.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        AtomicStampedReference&lt;String&gt; asr;</span><br><span class=\"line\">        String oldString;</span><br><span class=\"line\">        String newString;</span><br><span class=\"line\">        <span class=\"type\">int</span> oldStamp;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Tester</span><span class=\"params\">(AtomicStampedReference&lt;String&gt; asr, String oldString, String newString, <span class=\"type\">int</span> oldStamp)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.asr = asr;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.oldString = oldString;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.newString = newString;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.oldStamp = oldStamp;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;This is &quot;</span> + threadName + <span class=\"string\">&quot;, is going to change old string &#x27;&quot;</span> + oldString + <span class=\"string\">&quot;&#x27; to &#x27;&quot;</span> + newString + <span class=\"string\">&quot;&#x27;.&quot;</span>);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;The expected stamp is &quot;</span> + oldStamp + <span class=\"string\">&quot;, the current stamp is &quot;</span> + asr.getStamp());</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">boolean</span> <span class=\"variable\">isSuccess</span> <span class=\"operator\">=</span> asr.compareAndSet(oldString, newString, oldStamp, oldStamp + <span class=\"number\">1</span>);</span><br><span class=\"line\">            </span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;The change is successful? &quot;</span> + isSuccess + <span class=\"string\">&quot;. Now the string is &quot;</span> + asr.getReference());</span><br><span class=\"line\">            System.out.println();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">This is ThreadA, is going to change old string &#x27;A&#x27; to &#x27;B&#x27;.</span><br><span class=\"line\">The expected stamp is 0, the current stamp is 0</span><br><span class=\"line\">The change is successful? true. Now the string is B</span><br><span class=\"line\"></span><br><span class=\"line\">This is ThreadB, is going to change old string &#x27;B&#x27; to &#x27;C&#x27;.</span><br><span class=\"line\">The expected stamp is 0, the current stamp is 1</span><br><span class=\"line\">The change is successful? false. Now the string is B</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"原子数组引用类\"><a href=\"#原子数组引用类\" class=\"headerlink\" title=\"原子数组引用类\"></a>原子数组引用类</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span>[] arr = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[]&#123;<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>&#125;;</span><br><span class=\"line\">    <span class=\"type\">AtomicIntegerArray</span> <span class=\"variable\">aia</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicIntegerArray</span>(arr);</span><br><span class=\"line\">    System.out.println(aia.getAndSet(<span class=\"number\">0</span>, <span class=\"number\">100</span>));</span><br><span class=\"line\">    System.out.println(aia.get(<span class=\"number\">0</span>));</span><br><span class=\"line\">    System.out.println(arr[<span class=\"number\">0</span>]);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">0</span><br><span class=\"line\">100</span><br><span class=\"line\">0</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"原子操作类模仿CAS操作\"><a href=\"#原子操作类模仿CAS操作\" class=\"headerlink\" title=\"原子操作类模仿CAS操作\"></a>原子操作类模仿CAS操作</h2><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> oldVal;</span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            oldVal = ai.get();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span> (!ai.compareAndSet(oldVal,oldVal+<span class=\"number\">1</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["多线程"],"tags":["Java"]},{"title":"并发安全","url":"/%E7%AC%94%E8%AE%B0/Java/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8/","content":"<h2 id=\"线程安全\"><a href=\"#线程安全\" class=\"headerlink\" title=\"线程安全\"></a>线程安全</h2><p>在拥有共享数据的多条线程并行执行的程序中，线程安全的代码会通过同步机制保证各个线程都可以正常且正确的执行，不会出现数据污染等意外情况。</p>\n<p>线程安全的类一般都要满足 操作的原子性 和 内存的可见性。</p>\n<p>线程不安全一般出现在多个线程之间<strong>共享状态</strong>时。</p>\n<h2 id=\"实现并发安全的方案\"><a href=\"#实现并发安全的方案\" class=\"headerlink\" title=\"实现并发安全的方案\"></a>实现并发安全的方案</h2><h3 id=\"栈封闭\"><a href=\"#栈封闭\" class=\"headerlink\" title=\"栈封闭\"></a>栈封闭</h3><p>方法的局部变量是栈封闭的，多线程访问同一方法，使用到其中的局部变量时，每个线程都有自己的局部变量，不会出现线程安全问题。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">StackCloseExample</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add100</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">cnt</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">100</span>; i++)&#123;</span><br><span class=\"line\">            cnt++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(cnt);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"无同步方案\"><a href=\"#无同步方案\" class=\"headerlink\" title=\"无同步方案\"></a>无同步方案</h3><h4 id=\"无状态\"><a href=\"#无状态\" class=\"headerlink\" title=\"无状态\"></a>无状态</h4><p>一个类如果没有成员变量，则不涉及共享状态，无需同步措施。</p>\n<h4 id=\"状态不可变\"><a href=\"#状态不可变\" class=\"headerlink\" title=\"状态不可变\"></a>状态不可变</h4><p>一个类如果所有成员变量都不可变，即状态不可变，也无需同步措施。</p>\n<p>让外部无法修改成员变量。成员变量加上final关键字。不提供修改变量或返回变量引用的方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImmutableFinalRef</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> a;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> b;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Object obj; <span class=\"comment\">// 会有线程安全问题。需要final的基本类型变量，如果是引用类型变量，虽然引用不可变，但变量内部的其他成员变量可能是可变的</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImmutableCloseRef</span>&#123;</span><br><span class=\"line\">    List&lt;Integer&gt; list = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;(); <span class=\"comment\">// 让外部无法修改成员变量。不提供修改变量或返回变量引用的方法。</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">func</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        list.add(<span class=\"number\">1</span>);</span><br><span class=\"line\">        list.add(<span class=\"number\">2</span>);</span><br><span class=\"line\">        list.add(<span class=\"number\">3</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">containsNum</span><span class=\"params\">(<span class=\"type\">int</span> i)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> list.contains(i);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Integer&gt; <span class=\"title function_\">getList</span><span class=\"params\">()</span>&#123; <span class=\"comment\">// 不安全的发布。会有线程安全问题。外部拿到内部成员引用后可随意更改其中内容。</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> list; <span class=\"comment\">// 要保证线程安全，可将容器替换为现成安全的，或返回容器的拷贝。</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"volatile、CAS操作和加锁\"><a href=\"#volatile、CAS操作和加锁\" class=\"headerlink\" title=\"volatile、CAS操作和加锁\"></a>volatile、CAS操作和加锁</h3><p>保证类的可见性。适合一个线程写，多个线程读的场景。</p>\n<p>例如ConcurrentHashMap，将 V 设置为 volatile 类型。get操作不加锁，put操作使用CAS操作或加锁。</p>\n<h3 id=\"ThreadLocal\"><a href=\"#ThreadLocal\" class=\"headerlink\" title=\"ThreadLocal\"></a>ThreadLocal</h3><p>每个线程保存一份资源的副本，互相不影响，就不存在线程安全问题。</p>\n<p>Servlet不是线程安全的。经典Web交互模型使用Thread-per-Request，一个请求对应一个服务器线程的处理方式。且大部分使用消费队列的架构模式，都会将产品的消费过程尽量在一个线程中消费完。</p>\n<h2 id=\"死锁\"><a href=\"#死锁\" class=\"headerlink\" title=\"死锁\"></a>死锁</h2><p>两个或两个以上的进程在执行过程中，由于竞争资源或者由于彼此通信而造成的一种阻塞的现象，若无外力作用，它们都将无法推进下去。</p>\n<p>发生死锁的实质，是获取锁的顺序不一致。</p>\n<p>jstack命令工具可协助检测死锁。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">solveDeadLock</span><span class=\"params\">(Object first, Object second)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (first) &#123;</span><br><span class=\"line\">        System.out.println(threadName + <span class=\"string\">&quot; Get first lock, do some work.&quot;</span>);</span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">500</span>);</span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (second) &#123;</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot; Get second lock, do other work.&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上方代码中，如果线程1调用此方法，传入参数顺序为 (Object A, Object B)，而线程2调用此方法，传入参数顺序为 (Object B, Object A)，则会发生死锁。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">A</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>();</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">B</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">thread1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(A, B), <span class=\"string\">&quot;Thread1&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">thread2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(B, A), <span class=\"string\">&quot;Thread2&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        thread1.start();</span><br><span class=\"line\">        thread2.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> Object f;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> Object s;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Tester</span><span class=\"params\">(Object f, Object s)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.f = f;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.s = s;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Test.solveDeadLock(f, s);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">solveDeadLock</span><span class=\"params\">(Object first, Object second)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Thread1 Get first lock, do some work.</span><br><span class=\"line\">Thread2 Get first lock, do some work.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"解决死锁\"><a href=\"#解决死锁\" class=\"headerlink\" title=\"解决死锁\"></a>解决死锁</h3><p>使用System.identityHashCode() （不受用户重写HashCode方法影响），计算需要加锁对象的哈希值大小，使用固定的加锁顺序。如果哈希冲突，则在类中另外定义一个静态成员锁，让多个线程竞争这个锁。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">Object</span> <span class=\"variable\">tieLock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">solveDeadLock</span><span class=\"params\">(Object first, Object second)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">firstHashCode</span> <span class=\"operator\">=</span> System.identityHashCode(first);</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">secondHashCode</span> <span class=\"operator\">=</span> System.identityHashCode(second);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用固定的加锁顺序</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (firstHashCode &lt; secondHashCode) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (first) &#123;</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot; Get first lock, do some work.&quot;</span>);</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">500</span>);</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (second) &#123;</span><br><span class=\"line\">                System.out.println(threadName + <span class=\"string\">&quot; Get second lock, do other work.&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (secondHashCode &lt; firstHashCode) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (second) &#123;</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot; Get second lock, do some work.&quot;</span>);</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">500</span>);</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (first) &#123;</span><br><span class=\"line\">                System.out.println(threadName + <span class=\"string\">&quot; Get first lock, do other work.&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 如果哈希冲突，则在类中另外定义一个静态成员锁，让多个线程竞争这个锁。</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// firstHashCode == secondHashCode</span></span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (tieLock) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (first) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (second) &#123;</span><br><span class=\"line\">                    System.out.println(threadName + <span class=\"string\">&quot; Get first and second lock, do all the work.&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在对象中定义锁，使用锁的tryLock()。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">solveDeadLock</span><span class=\"params\">(MyObject first, MyObject second)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Lock</span> <span class=\"variable\">firstLock</span> <span class=\"operator\">=</span> first.getLock();</span><br><span class=\"line\">    <span class=\"type\">Lock</span> <span class=\"variable\">secondLock</span> <span class=\"operator\">=</span> second.getLock();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Random</span> <span class=\"variable\">random</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Random</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (firstLock.tryLock()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (secondLock.tryLock()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        System.out.println(threadName + <span class=\"string\">&quot; Get first and second lock, do all the work.&quot;</span>);</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                        secondLock.unlock();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                firstLock.unlock();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Thread.sleep(random.nextInt(<span class=\"number\">10</span>)); <span class=\"comment\">// 用于应对活锁的情况</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"活锁\"><a href=\"#活锁\" class=\"headerlink\" title=\"活锁\"></a>活锁</h2><p>如果使用tryLock的方式解决死锁。多个线程在竞争锁的时候，由于无法一次性获取所有的锁，一直重复尝试-失败-尝试-失败的过程。</p>\n<p>可以让线程在获取锁失败后休眠一个随机时长，将不同线程竞争锁的时机错开。</p>\n<h2 id=\"线程饥饿\"><a href=\"#线程饥饿\" class=\"headerlink\" title=\"线程饥饿\"></a>线程饥饿</h2><p>低优先级的线程，总是无法得到执行。</p>\n<h2 id=\"性能和思考\"><a href=\"#性能和思考\" class=\"headerlink\" title=\"性能和思考\"></a>性能和思考</h2><p>使用并发的目标是为了提高性能，引入多线程之后，相对单线程是有额外开销的。</p>\n<ol>\n<li>一般原则，先保证程序正确，再提高速度。</li>\n<li>性能表现以测试为准。</li>\n</ol>\n<h3 id=\"影响性能的因素\"><a href=\"#影响性能的因素\" class=\"headerlink\" title=\"影响性能的因素\"></a>影响性能的因素</h3><ul>\n<li>上下文切换。5000~10000个时钟周期。</li>\n<li>内存同步。加锁。</li>\n<li>阻塞。线程的挂起。包括两次额外的上下文切换。</li>\n</ul>\n<h3 id=\"可以提升的角度\"><a href=\"#可以提升的角度\" class=\"headerlink\" title=\"可以提升的角度\"></a>可以提升的角度</h3><p>减少锁的竞争</p>\n<ul>\n<li>减少锁的粒度。使用锁时，其保护的对象是多个，然其中只有部分对象会被访问修改，则可以换成多个锁独立保护各个对象。需要注意避免发生死锁。</li>\n<li>缩小锁的范围。尽量缩短持有锁的时间。另外需要避免多余的缩减缩范围的操作。如果两次获取锁的时间间隔太短的话，虚拟机可能会自动执行锁粗化。</li>\n<li>锁分段。ConcurrentHashMap即使用的分段锁。</li>\n<li>替换独占锁。<ul>\n<li>使用读写锁</li>\n<li>CAS操作</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"线程安全的单例模式\"><a href=\"#线程安全的单例模式\" class=\"headerlink\" title=\"线程安全的单例模式\"></a>线程安全的单例模式</h2><h3 id=\"懒汉式-双重检查\"><a href=\"#懒汉式-双重检查\" class=\"headerlink\" title=\"懒汉式-双重检查\"></a>懒汉式-双重检查</h3><p>现在一般不建议使用了。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SingletonClass</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> SingletonClass singleton;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">SingletonClass</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SingletonClass <span class=\"title function_\">getInstance</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == singleton) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (SingletonClass.class) &#123; <span class=\"comment\">// 类的锁</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == singleton) &#123;</span><br><span class=\"line\">                    singleton = <span class=\"keyword\">new</span> <span class=\"title class_\">SingletonClass</span>();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> singleton;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这种方式也并不是完全安全的。问题在于实例化函数 new Singleton()。并不能保证线程安全。</p>\n<p>singleton &#x3D; new Singleton(); 这段代码其实是分为三步执行：</p>\n<ol>\n<li>为singleton分配内存空间</li>\n<li>初始化singleton</li>\n<li>将singleton指向分配的内存地址</li>\n</ol>\n<p>但是由于JVM具有指令重排的特性，执行顺序有可能变成 1-&gt;3-&gt;2 。此时线程1已经执行了1和3步，线程2若调用getInstance，判断 null &#x3D;&#x3D; singleton 时会返回true，从而拿到了未完成初始化的singleton实例。</p>\n<p>可以将singleton变量设置成 volatile ，禁止JVM重排序代码。</p>\n<h3 id=\"饿汉式\"><a href=\"#饿汉式\" class=\"headerlink\" title=\"饿汉式\"></a>饿汉式</h3><p>在类初始化时就将实例创建好，由虚拟机来保证线程安全。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SingletonClass</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">SingletonClass</span> <span class=\"variable\">singleton</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SingletonClass</span>(); <span class=\"comment\">// 在类初始化时就将实例创建好</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">SingletonClass</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SingletonClass <span class=\"title function_\">getInstance</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> singleton;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"懒汉式-类初始化模式\"><a href=\"#懒汉式-类初始化模式\" class=\"headerlink\" title=\"懒汉式-类初始化模式\"></a>懒汉式-类初始化模式</h3><p>也称延迟占位模式。此模式较为常用。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SingletonClass</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">SingletonClass</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SingletonClass <span class=\"title function_\">getInstance</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> InstanceHolder.singleton;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">InstanceHolder</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">SingletonClass</span> <span class=\"variable\">singleton</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SingletonClass</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["多线程"],"tags":["Java"]},{"title":"并发容器","url":"/%E7%AC%94%E8%AE%B0/Java/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%AE%B9%E5%99%A8/","content":"<h2 id=\"ConcurrentHashMap\"><a href=\"#ConcurrentHashMap\" class=\"headerlink\" title=\"ConcurrentHashMap\"></a>ConcurrentHashMap</h2><p>线程安全的哈希表。<br>另外HashTable也是线程安全的，但其中的增删改查方法都是synchronized修饰的，效率不高。</p>\n<h3 id=\"哈希\"><a href=\"#哈希\" class=\"headerlink\" title=\"哈希\"></a>哈希</h3><p>压缩映射。如果出现哈希冲突，有以下几种处理方式：</p>\n<ol>\n<li>开放寻址。如果冲突，则取下一个值。</li>\n<li>再散列。如果冲突，使用另一种哈希算法。</li>\n<li>链地址法。哈希冲突的节点使用链表连接。</li>\n</ol>\n<h3 id=\"结构\"><a href=\"#结构\" class=\"headerlink\" title=\"结构\"></a>结构</h3><p>ConcurrentHashMap由Segment数组结构和HashEntry数组结构组成。Segment是一种可重入锁，扮演锁的角色；HashEntry则用于存储键值对数据。</p>\n<p>Segment的结构和HashMap类似，是一种数组和链表结构。一个Segment里包含一个HashEntry数组，每个HashEntry是一个链表结构的元素。</p>\n<h3 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h3><p>初始化方法是通过initialCapacity、loadFactor和concurrencyLevel等几个参数来初始化segment数组、偏移量segmentShift、段掩码segmentMask和每个segment里的HashEntry数组来实现的。</p>\n<ul>\n<li>initialCapacity，初始容量。segment中HashEntry数组的长度cap &#x3D; initialCapacity &#x2F; ssize 。也需要是2的N次方。默认为16。</li>\n<li>loadFactor，负载因子。决定了容器扩容的阈值threshold &#x3D; (int) cap*loadCapacity，默认为0.75f 。</li>\n<li>concurrencyLevel，并发等级，决定了segment数组的长度ssize，其需要是2的N次方，默认为16。</li>\n<li>segmentShift和SegmentMask，用于定位数据属于哪个segment。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// JDK1.7及以前</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (concurrencyLevel &gt; MAX_SEGMENT)</span><br><span class=\"line\">    concurrencyLevel = MAX_SEGMENT;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">sshift</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">ssize</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">while</span> (ssize &lt; concurrencyLevel) &#123;</span><br><span class=\"line\">    ++sshift;</span><br><span class=\"line\">    ssize &lt;&lt;= <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">segmentShift = <span class=\"number\">32</span> - sshift;</span><br><span class=\"line\">segmentMask = ssize - <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"built_in\">this</span>.segments = Segment.newArray(ssize);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"定位Segment\"><a href=\"#定位Segment\" class=\"headerlink\" title=\"定位Segment\"></a>定位Segment</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> Segment&lt;K, V&gt; <span class=\"title function_\">segmentFor</span><span class=\"params\">(<span class=\"type\">int</span> hash)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> segments[(hash &gt;&gt;&gt; segmentShift) &amp; segmentMask];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里的 &amp;segmentMask 看似无用，实际上加了一层保险，当(hash &gt;&gt;&gt; segmentShift)的值不在数组大小范围内时，&amp;segmentMask 操作会将其调整回来。</p>\n<p>其中一个比较特殊的情况是当concurrencyLevel &#x3D; 1 时，segmentShift为32，segmentMask为0，hash &gt;&gt;&gt; 32 的值为 hash，此时就需要 &amp;0 操作调整了。</p>\n<blockquote>\n<p><a href=\"https://stackoverflow.com/questions/16409674/what-does-segmentmask-mean-in-java-concurrenthashmap\">segmentmask有什么用</a></p>\n</blockquote>\n<h3 id=\"get操作\"><a href=\"#get操作\" class=\"headerlink\" title=\"get操作\"></a>get操作</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">get</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">hash</span> <span class=\"operator\">=</span> hash(key.hashCode());</span><br><span class=\"line\">    <span class=\"keyword\">return</span> segmentFor(hash).get(key, hash);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>整个get过程不需要加锁，除非读到的值是空才加锁重读。</p>\n<p>原因是他的get方法里将要使用的共享变量都定义成volatile类型，能够在线程之间保持可见性，能够被多线程同时读，并且保证不会读到过期的值，但只能被单线程写。</p>\n<p>根据Java内存模型的happen before原则，对volatile字段的写操作先于读操作，即使两个线程同时修改和获取volatile变量，get操作也能拿到最新的值，这是用volatile替换锁的经典应用场景。</p>\n<h3 id=\"put操作\"><a href=\"#put操作\" class=\"headerlink\" title=\"put操作\"></a>put操作</h3><p>在操作共享变量时必须加锁。</p>\n<p>put方法首先定位到Segment，然后再Segment里进行插入操作。插入操作需要经历两个步骤。</p>\n<p>首先判断是否需要对Segment里的HashEntry数组进行扩容，第二步定位添加元素的位置，放置元素。</p>\n<h3 id=\"size操作\"><a href=\"#size操作\" class=\"headerlink\" title=\"size操作\"></a>size操作</h3><p>Segment里的全局变量count虽然是一个volatile变量，但统计整个ConcurrentHashMap的大小时，也不可以使用累加所有Segment的count值的方法。因为累加过程中之前的count可能会变。</p>\n<p>最安全的方式是在统计size的时候把所有Segment的put、remove和clean方法全部锁住，但这种方式显然很低效。</p>\n<p>ConcurrentHashMap的做法是先尝试两次通过不锁住Segment的方式来统计各个Segment大小，如果统计过程中容器的count发生了变化，则再采用加锁的方式统计所有Segment的大小。</p>\n<p>put、remove和clean方法操作元素前都会将变量modCount加1，统计size前后比较modCount是否发生变化，从而得知容器大小是否发生了变化。</p>\n<h2 id=\"JDK1-8中的改进\"><a href=\"#JDK1-8中的改进\" class=\"headerlink\" title=\"JDK1.8中的改进\"></a>JDK1.8中的改进</h2><h3 id=\"结构-1\"><a href=\"#结构-1\" class=\"headerlink\" title=\"结构\"></a>结构</h3><p>取消了Segment数组，直接使用Node类存储键值对，锁的粒度更小，减少并发冲突的概率。</p>\n<p>使用Node数组存每个块的头节点，头节点之后的节点结构为链表或红黑树。</p>\n<p>当链表长度大于等于8时会被转为红黑树。红黑树节点数量小于等于6时会被转为链表。</p>\n<h3 id=\"初始化-1\"><a href=\"#初始化-1\" class=\"headerlink\" title=\"初始化\"></a>初始化</h3><p>只是给成员变量赋值，put时进行实际数组填充</p>\n<h2 id=\"更多的并发容器\"><a href=\"#更多的并发容器\" class=\"headerlink\" title=\"更多的并发容器\"></a>更多的并发容器</h2><p>ConcurrentSkipListMap 和 ConcurrentSkipListSet 为 TreeMap 和 TreeSet 的并发版本。</p>\n<p>使用跳表结构。</p>\n<p>ConcurrentLinkedQueue 为 LinkedList 的并发版本。</p>\n<p>写时复制容器 CopyOnWriteArrayList 和 CopyOnWriteArraySet</p>\n<p>在写入数据时会将整个容器复制一份，在复制的容器上写入，此时读数据还是在原先的容器上。</p>\n<h2 id=\"阻塞队列\"><a href=\"#阻塞队列\" class=\"headerlink\" title=\"阻塞队列\"></a>阻塞队列</h2><h3 id=\"生产者消费者模式\"><a href=\"#生产者消费者模式\" class=\"headerlink\" title=\"生产者消费者模式\"></a>生产者消费者模式</h3><p>当队列满时，插入元素的线程被阻塞，直到队列有空位；当队列为空时，获取元素的线程被阻塞，直到队列不空。</p>\n<p>用于处理生产者和消费者之间能力不匹配的问题，加一个容器解决生产者和消费者之间的耦合。</p>\n<h3 id=\"常用方法\"><a href=\"#常用方法\" class=\"headerlink\" title=\"常用方法\"></a>常用方法</h3><table>\n<thead>\n<tr>\n<th align=\"center\">方法</th>\n<th align=\"center\">抛出异常</th>\n<th align=\"center\">返回值</th>\n<th align=\"center\">一直阻塞</th>\n<th align=\"center\">超时退出</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">插入方法</td>\n<td align=\"center\">add</td>\n<td align=\"center\">offer</td>\n<td align=\"center\">put</td>\n<td align=\"center\">offer(time)</td>\n</tr>\n<tr>\n<td align=\"center\">移除方法</td>\n<td align=\"center\">remove</td>\n<td align=\"center\">poll</td>\n<td align=\"center\">take</td>\n<td align=\"center\">poll(time)</td>\n</tr>\n<tr>\n<td align=\"center\">检查方法</td>\n<td align=\"center\">element</td>\n<td align=\"center\">peek</td>\n<td align=\"center\">无</td>\n<td align=\"center\">无</td>\n</tr>\n</tbody></table>\n<h3 id=\"常用阻塞队列\"><a href=\"#常用阻塞队列\" class=\"headerlink\" title=\"常用阻塞队列\"></a>常用阻塞队列</h3><p>都实现了BlockingQueue接口。</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">类名</th>\n<th align=\"center\">结构</th>\n<th align=\"center\">是否有界</th>\n<th align=\"center\">feature</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">ArrayBlockingQueue</td>\n<td align=\"center\">数组</td>\n<td align=\"center\">有界</td>\n<td align=\"center\">先进先出，要求设定初始大小。只有一个锁。直接存数据</td>\n</tr>\n<tr>\n<td align=\"center\">LinkedBlockingQueue</td>\n<td align=\"center\">链表</td>\n<td align=\"center\">有界</td>\n<td align=\"center\">先进先出，可不设定初始大小。有两个锁，生产者和消费者分开。数据会被包装成节点</td>\n</tr>\n<tr>\n<td align=\"center\">PriorityBlockingQueue</td>\n<td align=\"center\">支持优先级排序的</td>\n<td align=\"center\">无界</td>\n<td align=\"center\">需要实现Comparable接口或给定Comparator</td>\n</tr>\n<tr>\n<td align=\"center\">DelayQueue</td>\n<td align=\"center\">优先级队列</td>\n<td align=\"center\">无界</td>\n<td align=\"center\">支持延迟获取元素。元素必须要实现Delay接口。应用场景：缓存系统、订单到期、限时支付等</td>\n</tr>\n<tr>\n<td align=\"center\">SynchronousQueue</td>\n<td align=\"center\">不存储元素</td>\n<td align=\"center\"></td>\n<td align=\"center\">每个put操作都要等待一个take操作</td>\n</tr>\n<tr>\n<td align=\"center\">LinkedTransferQueue</td>\n<td align=\"center\">链表</td>\n<td align=\"center\">无界</td>\n<td align=\"center\">transfer()方法将元素从生产者转移到消费者，会阻塞；Trytransfer()则是尝试转移元素，能立即返回执行是否成功</td>\n</tr>\n<tr>\n<td align=\"center\">LinkedBlockingDeque</td>\n<td align=\"center\">双向链表</td>\n<td align=\"center\"></td>\n<td align=\"center\">头尾都能增删元素，实现工作密取（例如Fork&#x2F;Join）</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>问：这里的有界和无界是什么意思？</p>\n</blockquote>\n<blockquote>\n<p>答：有界队列就是说队列中的元素个数是有限制的，而无界对接表示队列中的元素个数没有限制。</p>\n</blockquote>\n<p>LinkedBlockingQueue虽然是链表结构，默认情况下是无界的，但其可以在初始化时指定大小，让其变成有界。</p>\n<h3 id=\"实现原理\"><a href=\"#实现原理\" class=\"headerlink\" title=\"实现原理\"></a>实现原理</h3><p>使用了锁和两个Condition：notEmpty 和 notFull 实现。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">put</span><span class=\"params\">(E e)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">    checkNotNull(e);</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">ReentrantLock</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.lock;</span><br><span class=\"line\">    lock.lockInterruptibly();</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (count == items.length)</span><br><span class=\"line\">            notFull.await();</span><br><span class=\"line\">        enqueue(e);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        lock.unlock();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">take</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">ReentrantLock</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.lock;</span><br><span class=\"line\">    lock.lockInterruptibly();</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (count == <span class=\"number\">0</span>)</span><br><span class=\"line\">            notEmpty.await();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dequeue();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        lock.unlock();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["多线程"],"tags":["Java"]},{"title":"显式锁和AQS","url":"/%E7%AC%94%E8%AE%B0/Java/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E6%98%BE%E5%BC%8F%E9%94%81%E5%92%8CAQS/","content":"<h2 id=\"显式锁\"><a href=\"#显式锁\" class=\"headerlink\" title=\"显式锁\"></a>显式锁</h2><h3 id=\"Lock接口和核心方法\"><a href=\"#Lock接口和核心方法\" class=\"headerlink\" title=\"Lock接口和核心方法\"></a>Lock接口和核心方法</h3><ul>\n<li>lock()</li>\n<li>unlock()</li>\n<li>tryLock()</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Lock</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ReentrantLock</span>();</span><br><span class=\"line\">lock.lock();</span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    num++;</span><br><span class=\"line\">&#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    lock.unlock();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">func</span><span class=\"params\">(<span class=\"type\">int</span> num)</span>&#123;</span><br><span class=\"line\">    num++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Lock接口和synchronized的比较\"><a href=\"#Lock接口和synchronized的比较\" class=\"headerlink\" title=\"Lock接口和synchronized的比较\"></a>Lock接口和synchronized的比较</h3><ul>\n<li>synchronized代码一般简洁。</li>\n<li>Lock接口可以做到的功能：获取锁可以被中断，尝试获取锁，尝试获取锁。</li>\n</ul>\n<h2 id=\"Condition对象\"><a href=\"#Condition对象\" class=\"headerlink\" title=\"Condition对象\"></a>Condition对象</h2><p>任意一个Java对象，都有一组监视器方法（定义在java.lang.Object上），主要包括wait()、wait(long timeout)、notify()以及notifyAll()方法，这些方法与synchronized同步关键字配合，可以 实现等待&#x2F;通知模式。</p>\n<p>Condition接口也提供了类似Object的监视器方法，与Lock配合可以实现等待&#x2F;通知模式，但是这两者在使用方式以及功能特性上还是有差别的。</p>\n<p>Condition对象只能在独占锁中才能使用。</p>\n<p>Condition 是一个多线程协调通信的工具类，可以让某些线程一起等待某个条件（condition），只有满足条件时，线程才会被唤醒。</p>\n<p>一个Condition对象包含一个等待队列（单链表），当调用signal()方法时，将链表头节点，加入到AQS线程同步队列中。（相当于等待池移动到锁池？）</p>\n<p>await():把当前线程阻塞挂起 signal()&#x2F;signalAll():唤醒阻塞的线程</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">Lock</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ReentrantLock</span>();</span><br><span class=\"line\">        <span class=\"type\">Condition</span> <span class=\"variable\">condition</span> <span class=\"operator\">=</span> lock.newCondition(); <span class=\"comment\">// Condition从锁中获取。</span></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">threadA</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">TesterA</span>(lock, condition), <span class=\"string\">&quot;ThreadA&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">threadB</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">TesterB</span>(lock, condition), <span class=\"string\">&quot;ThreadB&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        threadB.start();</span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">        threadA.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TesterA</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        Lock lock;</span><br><span class=\"line\">        Condition condition;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">TesterA</span><span class=\"params\">(Lock lock, Condition condition)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.lock = lock;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.condition = condition;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot; has sent the condition signal.&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                lock.lock();</span><br><span class=\"line\">                condition.signal(); <span class=\"comment\">// condition调用signal()方法前需要先上锁，否则会报错。</span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                lock.unlock();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TesterB</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        Lock lock;</span><br><span class=\"line\">        Condition condition;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">TesterB</span><span class=\"params\">(Lock lock, Condition condition)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.lock = lock;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.condition = condition;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot; is waiting for condition signal.&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                lock.lock();</span><br><span class=\"line\">                condition.await(); <span class=\"comment\">// condition调用await()方法前需要先上锁，否则会报错。</span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                lock.unlock();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot; now continue.&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">ThreadB is waiting for condition signal.</span><br><span class=\"line\">ThreadA has sent the condition signal.</span><br><span class=\"line\">ThreadB now continue.</span><br></pre></td></tr></table></figure>\n\n<p>lock.newCondition()方法是生成一个新的condition实例，多次调用则会生成多个condition。<br>故同一个锁可以有多个condition监控。</p>\n<h2 id=\"LockSupport工具\"><a href=\"#LockSupport工具\" class=\"headerlink\" title=\"LockSupport工具\"></a>LockSupport工具</h2><p>工具类，是一个线程阻塞工具类，所有的方法都是静态方法，可以让线程在任意位置阻塞和唤醒。主要有两类方法：park和unpark。</p>\n<h2 id=\"AQS\"><a href=\"#AQS\" class=\"headerlink\" title=\"AQS\"></a>AQS</h2><p>AbstractQueuedSynchronizer，抽象队列同步器。</p>\n<p>AQS是JUC锁框架中最重要的类，独占锁和共享锁可通过它来实现。</p>\n<p>实现AQS时，使用时必须要自行实现的方法有tryAcquire()、tryRelease()、tryAcquireShared()、tryReleaseShared()、isHeldExclusively()。</p>\n<p><img src=\"/\" alt=\"独占式同步状态的获取与释放.png\"></p>\n<h3 id=\"线程同步队列\"><a href=\"#线程同步队列\" class=\"headerlink\" title=\"线程同步队列\"></a>线程同步队列</h3><p>在AQS中使用CLH队列储存这些等待的线程。</p>\n<p>就是一个平常先进先出的双向Queue，但它并不是直接储存线程，而是储存拥有线程的node节点，并记录队列首位的node。所以先介绍重要内部类Node。</p>\n<p>Node类中定义了状态变量waitStatus，初始值为0，其他的取值如下：</p>\n<ul>\n<li>CANCELLED：线程被取消，需要从队列中移除。</li>\n<li>SIGNAL：后继线程(即队列中此节点之后的节点)需要被阻塞。(用于独占锁)。</li>\n<li>CONDITION：线程在Condition条件上等待阻塞。(用于Condition的await等待)。</li>\n<li>PROPAGATE：下一个acquireShared方法线程应该被允许。(用于共享锁)。</li>\n</ul>\n<h3 id=\"tryAcquire-int\"><a href=\"#tryAcquire-int\" class=\"headerlink\" title=\"tryAcquire(int)\"></a>tryAcquire(int)</h3><p>当前线程尝试获取锁，如果获取到锁，就会返回true，并更改锁资源。没有获取到锁返回false。方法是立即返回的，不会阻塞当前线程</p>\n<h3 id=\"tryRelease-int\"><a href=\"#tryRelease-int\" class=\"headerlink\" title=\"tryRelease(int)\"></a>tryRelease(int)</h3><p>释放当前线程持有的锁，返回true表示已经完全释放锁资源，返回false，表示还持有锁资源。</p>\n<p>对于独占锁来说，同一时间只能有一个线程持有这个锁，但是这个线程可以重复地获取锁，因为被锁住的模块，再次进入另一个被这个锁锁住的模块，是允许的。这个就做可重入性，所以对于可重入的锁释放操作，也需要多次。</p>\n<h3 id=\"tryAcquireShared-int\"><a href=\"#tryAcquireShared-int\" class=\"headerlink\" title=\"tryAcquireShared(int)\"></a>tryAcquireShared(int)</h3><p>尝试获取共享锁，返回值大于等于0，表示获取共享锁成功。</p>\n<h3 id=\"tryReleaseShared-int\"><a href=\"#tryReleaseShared-int\" class=\"headerlink\" title=\"tryReleaseShared(int)\"></a>tryReleaseShared(int)</h3><p>释放当前线程持有的锁，返回true表示已经完全释放锁资源，返回false，表示还持有锁资源。</p>\n<h3 id=\"isHeldExclusively\"><a href=\"#isHeldExclusively\" class=\"headerlink\" title=\"isHeldExclusively()\"></a>isHeldExclusively()</h3><p>此同步器是否处于独占模式。</p>\n<ul>\n<li>ReentrantLock.Sync类的tryRelease方法实现</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">tryRelease</span><span class=\"params\">(<span class=\"type\">int</span> releases)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// c表示新的锁的记录状态</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">c</span> <span class=\"operator\">=</span> getState() - releases;</span><br><span class=\"line\">    <span class=\"comment\">// 如果当前线程不是独占锁的线程，就抛出IllegalMonitorStateException异常</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Thread.currentThread() != getExclusiveOwnerThread())</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalMonitorStateException</span>();</span><br><span class=\"line\">    <span class=\"comment\">// 标志是否可以释放锁</span></span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"variable\">free</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 当新的锁的记录状态为0时，表示可以释放锁</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (c == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        free = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 设置独占锁的线程为null</span></span><br><span class=\"line\">        setExclusiveOwnerThread(<span class=\"literal\">null</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    setState(c);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> free;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>其他一些重要方法</p>\n<h3 id=\"addWaiter-Node\"><a href=\"#addWaiter-Node\" class=\"headerlink\" title=\"addWaiter(Node)\"></a>addWaiter(Node)</h3><p>将当前现成封装为一个Node，并加入到线程同步队列，设置好是否为独占模式。</p>\n<p>重写锁的时候，主要重写内部的AQS类。</p>\n<h3 id=\"自定义一个锁\"><a href=\"#自定义一个锁\" class=\"headerlink\" title=\"自定义一个锁\"></a>自定义一个锁</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">Lock</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">8</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">thread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">TesterRun</span>(lock), <span class=\"string\">&quot;Thread-&quot;</span> + i);</span><br><span class=\"line\">            thread.start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Lock</span> &#123; <span class=\"comment\">// 重写锁的时候，主要重写内部的AQS类</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Sync</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractQueuedSynchronizer</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 关于state，初始化后其值为0。当线程获取锁后将状态改为1，当线程释放锁后将状态改为0</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 锁当前是否被占用</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isHeldExclusively</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">1</span> == getState();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 尝试获取独占锁，锁state为0说明没被占用，获取成功并将state改为1，返回true；否则直接返回false</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">tryAcquire</span><span class=\"params\">(<span class=\"type\">int</span> arg)</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (compareAndSetState(<span class=\"number\">0</span>, <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                    setExclusiveOwnerThread(Thread.currentThread()); <span class=\"comment\">// 设置独占锁的拥有者</span></span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 尝试释放锁，当state为0说明锁本身就没被占用，抛出异常；否则将state设置为0，设置锁拥有者为null，返回true</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">tryRelease</span><span class=\"params\">(<span class=\"type\">int</span> arg)</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"number\">0</span> == getState()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UnsupportedOperationException</span>();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                setExclusiveOwnerThread(<span class=\"literal\">null</span>);</span><br><span class=\"line\">                setState(<span class=\"number\">0</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 需要重写Lock的newCondition方法</span></span><br><span class=\"line\">            Condition <span class=\"title function_\">newCondition</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConditionObject</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Sync</span> <span class=\"variable\">sync</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Sync</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 使用同步器的方法重写Lock需重写的方法</span></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">lock</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            sync.acquire(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">lockInterruptibly</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">            sync.acquireInterruptibly(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">tryLock</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> sync.tryAcquire(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">tryLock</span><span class=\"params\">(<span class=\"type\">long</span> time, TimeUnit unit)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> sync.tryAcquireNanos(<span class=\"number\">1</span>, unit.toNanos(time));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">unlock</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            sync.release(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Condition <span class=\"title function_\">newCondition</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> sync.newCondition();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TesterRun</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        Lock lock;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">TesterRun</span><span class=\"params\">(Lock lock)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.lock = lock;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            lock.lock();</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                System.out.println(threadName + <span class=\"string\">&quot; begins.&quot;</span>);</span><br><span class=\"line\">                Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">                System.out.println(threadName + <span class=\"string\">&quot; ends&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                lock.unlock();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Thread-0 begins.</span><br><span class=\"line\">Thread-0 ends</span><br><span class=\"line\">Thread-1 begins.</span><br><span class=\"line\">Thread-1 ends</span><br><span class=\"line\">Thread-2 begins.</span><br><span class=\"line\">Thread-2 ends</span><br><span class=\"line\">Thread-3 begins.</span><br><span class=\"line\">Thread-3 ends</span><br><span class=\"line\">Thread-6 begins.</span><br><span class=\"line\">Thread-6 ends</span><br><span class=\"line\">Thread-4 begins.</span><br><span class=\"line\">Thread-4 ends</span><br><span class=\"line\">Thread-7 begins.</span><br><span class=\"line\">Thread-7 ends</span><br><span class=\"line\">Thread-5 begins.</span><br><span class=\"line\">Thread-5 ends</span><br></pre></td></tr></table></figure>\n\n<p>可以看到各个线程的输出没有交错。</p>\n<h2 id=\"ReentrantLock\"><a href=\"#ReentrantLock\" class=\"headerlink\" title=\"ReentrantLock\"></a>ReentrantLock</h2><p>可重入锁。锁自身带一个计数器。加锁时+1，释放锁时-1。</p>\n<p>常用于递归，方法调用自身时可重复获取锁。</p>\n<p>实现AQS时主要重写 tryAcquireShared(int)和tryReleaseShared(int)方法。</p>\n<h3 id=\"公平和非公平\"><a href=\"#公平和非公平\" class=\"headerlink\" title=\"公平和非公平\"></a>公平和非公平</h3><p>公平锁就是保障了多线程下各线程获取锁的顺序，先到的线程优先获取锁，而非公平锁则无法提供这个保障。</p>\n<p>非公平锁的效率一般情况下更高。</p>\n<p>ReentrantLock默认是非公平的，但构造函数中可传入布尔值设定是否为公平锁。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 公平锁</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">tryAcquire</span><span class=\"params\">(<span class=\"type\">int</span> acquires)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">Thread</span> <span class=\"variable\">current</span> <span class=\"operator\">=</span> Thread.currentThread();</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">c</span> <span class=\"operator\">=</span> getState();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (c == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!hasQueuedPredecessors() &amp;&amp;  <span class=\"comment\">// 就多了这一个判断</span></span><br><span class=\"line\">            compareAndSetState(<span class=\"number\">0</span>, acquires)) &#123;</span><br><span class=\"line\">            setExclusiveOwnerThread(current);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (current == getExclusiveOwnerThread()) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">nextc</span> <span class=\"operator\">=</span> c + acquires;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (nextc &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&quot;Maximum lock count exceeded&quot;</span>);</span><br><span class=\"line\">        setState(nextc);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 非公平锁</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">nonfairTryAcquire</span><span class=\"params\">(<span class=\"type\">int</span> acquires)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">Thread</span> <span class=\"variable\">current</span> <span class=\"operator\">=</span> Thread.currentThread();</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">c</span> <span class=\"operator\">=</span> getState();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (c == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (compareAndSetState(<span class=\"number\">0</span>, acquires)) &#123;</span><br><span class=\"line\">            setExclusiveOwnerThread(current);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (current == getExclusiveOwnerThread()) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">nextc</span> <span class=\"operator\">=</span> c + acquires;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (nextc &lt; <span class=\"number\">0</span>) <span class=\"comment\">// overflow</span></span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&quot;Maximum lock count exceeded&quot;</span>);</span><br><span class=\"line\">        setState(nextc);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 判断等待队列中，当前线程之前有已在等待的线程</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">hasQueuedPredecessors</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">Node</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> tail; </span><br><span class=\"line\">    <span class=\"type\">Node</span> <span class=\"variable\">h</span> <span class=\"operator\">=</span> head;</span><br><span class=\"line\">    Node s;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> h != t &amp;&amp;</span><br><span class=\"line\">        ((s = h.next) == <span class=\"literal\">null</span> || s.thread != Thread.currentThread());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"读写锁\"><a href=\"#读写锁\" class=\"headerlink\" title=\"读写锁\"></a>读写锁</h2><p>ReadWriteLock， ReentrantReadWriteLock是其的一个实现类。</p>\n<p>接口内部维护了两个锁，读锁和写锁。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">ReadWriteLock</span> &#123;</span><br><span class=\"line\">    Lock <span class=\"title function_\">readLock</span><span class=\"params\">()</span>;</span><br><span class=\"line\">    Lock <span class=\"title function_\">writeLock</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>读读不互斥，读写互斥，写写互斥；适用于读多写少的操作。</p>\n<p>实现AQS时，同步器的状态值state（32位）拆分为高16位和低16位，分别控制读锁和写锁。</p>\n","categories":["多线程"],"tags":["Java"]},{"title":"线程基础、线程之间的共享和协作","url":"/%E7%AC%94%E8%AE%B0/Java/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B1%E4%BA%AB%E5%92%8C%E5%8D%8F%E4%BD%9C/","content":"<h2 id=\"基础概念\"><a href=\"#基础概念\" class=\"headerlink\" title=\"基础概念\"></a>基础概念</h2><h3 id=\"CPU核心数和线程数的关系\"><a href=\"#CPU核心数和线程数的关系\" class=\"headerlink\" title=\"CPU核心数和线程数的关系\"></a>CPU核心数和线程数的关系</h3><p>CPU核心数 : 线程数 &#x3D; 1:1</p>\n<p>使用英特尔研发的超线程技术之后，CPU核心数 : 线程数可以变成 1:2</p>\n<h3 id=\"CPU时间片和轮转机制\"><a href=\"#CPU时间片和轮转机制\" class=\"headerlink\" title=\"CPU时间片和轮转机制\"></a>CPU时间片和轮转机制</h3><p>CPU轮转机制也就是RR调度，Round-Robin，轮询调度</p>\n<p>上下文切换，也就是时间片切换的时候，需要保存原先运行进程的状态，加载即将运行进程的状态，大约会花费5000-20000个时钟周期，这个消耗并不少。</p>\n<p>操作系统会按照自身的统计值来决定在每个进程上花费时间片的大小，程序无法控制。</p>\n<h3 id=\"什么是进程和线程\"><a href=\"#什么是进程和线程\" class=\"headerlink\" title=\"什么是进程和线程\"></a>什么是进程和线程</h3><ul>\n<li>进程：程序运行资源分配的最小单位，进程内部有多个线程，会共享这个进程的资源。</li>\n<li>线程：CPU调度的最小单位。</li>\n</ul>\n<h3 id=\"澄清并行和并发\"><a href=\"#澄清并行和并发\" class=\"headerlink\" title=\"澄清并行和并发\"></a>澄清并行和并发</h3><ul>\n<li>并行：同一时刻，可以处理事情的能力。</li>\n<li>并发：与时间单位相关，某个时间段内可以同时处理的事情。</li>\n</ul>\n<h3 id=\"高并发编程的意义、好处和注意事项\"><a href=\"#高并发编程的意义、好处和注意事项\" class=\"headerlink\" title=\"高并发编程的意义、好处和注意事项\"></a>高并发编程的意义、好处和注意事项</h3><p>好处：</p>\n<ul>\n<li>充分利用CPU资源</li>\n<li>充分缩短用户请求的响应时间</li>\n<li>使代码模块化、异步化</li>\n</ul>\n<p>注意事项：</p>\n<ul>\n<li>多线程之间会共享资源，可能会存在冲突</li>\n<li>线程数越多，对硬件配置要求也就越高</li>\n</ul>\n<h2 id=\"认识Java里的线程\"><a href=\"#认识Java里的线程\" class=\"headerlink\" title=\"认识Java里的线程\"></a>认识Java里的线程</h2><p>Java里的程序天生就是多线程的。</p>\n<p>启动一个main线程，使用management包中的TreadMXBean线程管理工具打印当前运行的线程。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ThreadMXBean</span> <span class=\"variable\">tb</span> <span class=\"operator\">=</span> ManagementFactory.getThreadMXBean();</span><br><span class=\"line\">        ThreadInfo[] tinfos = tb.dumpAllThreads(<span class=\"literal\">false</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (ThreadInfo ti : tinfos) &#123;</span><br><span class=\"line\">            System.out.println(ti.getThreadId() + <span class=\"string\">&quot;: &quot;</span> + ti.getThreadName());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出结果：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">6: Monitor Ctrl-Break</span><br><span class=\"line\">5: Attach Listener</span><br><span class=\"line\">4: Signal Dispatcher</span><br><span class=\"line\">3: Finalizer</span><br><span class=\"line\">2: Reference Handler</span><br><span class=\"line\">1: main</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动新线程的方式\"><a href=\"#启动新线程的方式\" class=\"headerlink\" title=\"启动新线程的方式\"></a>启动新线程的方式</h3><ul>\n<li>继承Thread类。</li>\n<li>实现Runnable接口</li>\n<li>实现Callable接口</li>\n</ul>\n<p>由于Java是单继承，继承Thread类之后，就不能继承其他类，所以一般都使用实现接口的方式。</p>\n<h4 id=\"Runnable和Callable的区别\"><a href=\"#Runnable和Callable的区别\" class=\"headerlink\" title=\"Runnable和Callable的区别\"></a>Runnable和Callable的区别</h4><p>使用方式差不多，但Callable接口有返回值，Runnable接口没有返回值。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">UseRun</span> <span class=\"variable\">useRun</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UseRun</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">UseCall</span> <span class=\"variable\">useCall</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UseCall</span>();</span><br><span class=\"line\">        FutureTask&lt;String&gt; futureTask = <span class=\"keyword\">new</span> <span class=\"title class_\">FutureTask</span>&lt;&gt;(useCall);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(useRun).start();</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(futureTask).start();</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(futureTask.get());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UseRun</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;I implement Runnable.&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UseCall</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;String&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;I implement Callable.&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;CallResult&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"如何安全停止线程\"><a href=\"#如何安全停止线程\" class=\"headerlink\" title=\"如何安全停止线程\"></a>如何安全停止线程</h3><ol>\n<li>等待线程自然执行完毕</li>\n<li>线程抛出异常</li>\n<li>stop()、resume()、suspend()</li>\n<li>interrupt()、interrupted()方法</li>\n</ol>\n<p>良好的程序设计中，Java线程间应是协作式的，而不是抢占式的。</p>\n<p>stop()、suspend()方法会强行停止线程，但不会释放资源。已经被弃用。</p>\n<p>interrupt()用于“中断”一个线程，但并非强行停止线程，而是对线程发出停止信号，将中断标志位置为true。<br>isInterrupted()判断当前线程是否处于中断状态。<br>static方法interrupted()判断当前线程是否处于中断状态，并将终端标志位改为false。<br>isInterrupted()和 interrupt()一般会配合使用，先判断是否做了终止标记，如果没有则调用interrupt()方法。终止线程时候先判断isInterrupted()是否有终止标记，如果有，则执行自定义的线程中止逻辑。  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isInterrupted</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> isInterrupted(<span class=\"literal\">false</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">interrupted</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> currentThread().isInterrupted(<span class=\"literal\">true</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//isInterrupted的boolean入参，表示查询中断状态之后是否会重置中断标志位为false</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">thread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UseThread</span>(<span class=\"string\">&quot;endThread&quot;</span>);</span><br><span class=\"line\">        thread.start();</span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">20</span>);</span><br><span class=\"line\">        thread.interrupt();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UseThread</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">UseThread</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(name);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (!isInterrupted()) &#123; <span class=\"comment\">// 在继承Runnable接口的情况下，则是使用Thread.currentThread().isInterrupted()方式获取标志位</span></span><br><span class=\"line\">                System.out.println(threadName + <span class=\"string\">&quot; is running.&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot;&#x27;s interrupt flag is &quot;</span> + isInterrupted());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果某方法会抛出InterruptedException时，中断标志位会被置为false；需要在catch语句块中自行调用interrupt()方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">thread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UseThread</span>(<span class=\"string\">&quot;endThread&quot;</span>);</span><br><span class=\"line\">        thread.start();</span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">500</span>); <span class=\"comment\">// 等线程执行到while里面的时候再置中断位</span></span><br><span class=\"line\">        thread.interrupt();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UseThread</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">UseThread</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(name);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (!isInterrupted()) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    sleep(<span class=\"number\">200</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    System.out.println(threadName + <span class=\"string\">&quot;&#x27;s interrupt flag is &quot;</span> + isInterrupted());</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                    <span class=\"comment\">//interrupt(); // 应该在此处自行调用interrupt()来实现中断。</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                System.out.println(threadName + <span class=\"string\">&quot; is running.&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">endThread is running.</span><br><span class=\"line\">endThread is running.</span><br><span class=\"line\">endThread&#x27;s interrupt flag is false</span><br><span class=\"line\">endThread is running.</span><br><span class=\"line\">java.lang.InterruptedException: sleep interrupted</span><br><span class=\"line\">\tat java.lang.Thread.sleep(Native Method)</span><br><span class=\"line\">\tat Test$UseThread.run(Test.java:19)</span><br><span class=\"line\">endThread is running.</span><br><span class=\"line\">endThread is running.</span><br><span class=\"line\">endThread is running.</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Java线程的生命周期\"><a href=\"#Java线程的生命周期\" class=\"headerlink\" title=\"Java线程的生命周期\"></a>Java线程的生命周期</h2><p><img src=\"https://img-blog.csdnimg.cn/20210331153913843.png\" alt=\"线程的生命周期.png\"></p>\n<p>yield()：将线程从运行状态转到就绪状态。不释放锁。调用这个方法的线程可能立即又抢夺到CPU执行权。</p>\n<h3 id=\"start-方法和run-方法\"><a href=\"#start-方法和run-方法\" class=\"headerlink\" title=\"start()方法和run()方法\"></a>start()方法和run()方法</h3><p>启动一个线程需要调用对象的start()方法。直接调用run()的话，只是普通的方法调用。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">thread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UseThread</span>();</span><br><span class=\"line\">        thread.setName(<span class=\"string\">&quot;BeCalled&quot;</span>);</span><br><span class=\"line\">        thread.run();</span><br><span class=\"line\">        <span class=\"comment\">//thread.start();</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UseThread</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span> &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot; is running.&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">main is running.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"线程的优先级\"><a href=\"#线程的优先级\" class=\"headerlink\" title=\"线程的优先级\"></a>线程的优先级</h3><p>可设置为1-10，默认为5。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">thread.setPriority();</span><br></pre></td></tr></table></figure>\n\n<p>线程的优先级设置后，优先关系在不同的运行环境下是可能有差别的，优先关系并不能得到严格保证。</p>\n<h3 id=\"守护线程\"><a href=\"#守护线程\" class=\"headerlink\" title=\"守护线程\"></a>守护线程</h3><ul>\n<li>当所有非守护线程结束时，程序即中止，同时杀死所有守护线程。</li>\n<li>thread.setDaemon()方法将线程设置为守护线程，需要在<strong>线程启动前</strong>设置，否则会产生异常。</li>\n<li>守护线程中的try-finally语句块，finally中的语句此时无法保证一定能执行。</li>\n</ul>\n<h2 id=\"线程间共享\"><a href=\"#线程间共享\" class=\"headerlink\" title=\"线程间共享\"></a>线程间共享</h2><h3 id=\"synchronized关键字\"><a href=\"#synchronized关键字\" class=\"headerlink\" title=\"synchronized关键字\"></a>synchronized关键字</h3><p>同一时刻，相同的synchronized方法或语句块，只能有一处执行</p>\n<p>synchronized锁的是对象。<br>synchronized修饰实例方法时，或synchronize(this)，锁的实例对象。<br>synchronized修饰静态方法时，锁的是类，即类的class对象</p>\n<h3 id=\"volatile关键字\"><a href=\"#volatile关键字\" class=\"headerlink\" title=\"volatile关键字\"></a>volatile关键字</h3><p>最轻量的同步机制，但并非线程安全。只能保证可见性，无法保证原子性。</p>\n<p>在使用volatile修饰的变量时，一定会重新从主线程读取变量的值，放弃线程中暂存的变量值。</p>\n<p>最常用的使用场景，只有一个线程写，多个线程读。</p>\n<h3 id=\"ThreadLocal\"><a href=\"#ThreadLocal\" class=\"headerlink\" title=\"ThreadLocal\"></a>ThreadLocal</h3><p>线程变量，意思是ThreadLocal中填充的变量属于当前线程，该变量对其他线程而言是隔离的。每个使用该变量的线程都会初始化一个完全独立的实例副本。用于线程间的<strong>数据隔离</strong>。</p>\n<p>常用于数据连接池。</p>\n<p>底层利用Map实现，将线程id作为Key。</p>\n<p>由于每个线程都会有一个独立的实例副本，所以使用ThreadLocal包装的变量，最好只是简单的基本类型，否则占用的空间会很大。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">TestThread</span> <span class=\"variable\">testThread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TestThread</span>();</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(testThread);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(testThread);</span><br><span class=\"line\"></span><br><span class=\"line\">        t1.setName(<span class=\"string\">&quot;ThreadA&quot;</span>);</span><br><span class=\"line\">        t2.setName(<span class=\"string\">&quot;ThreadB&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestThread</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        ThreadLocal&lt;String&gt; threadLocal = <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadLocal</span>&lt;&gt;();</span><br><span class=\"line\">        String normalVar;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\"></span><br><span class=\"line\">            threadLocal.set(threadName);</span><br><span class=\"line\">            normalVar = threadName;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Thread.sleep(<span class=\"number\">200</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot;&#x27;s threadLocal var is &quot;</span> + threadLocal.get());</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot;&#x27;s normal var is &quot;</span> + normalVar);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">ThreadA&#x27;s threadLocal var is ThreadA</span><br><span class=\"line\">ThreadB&#x27;s threadLocal var is ThreadB</span><br><span class=\"line\">ThreadB&#x27;s normal var is ThreadB</span><br><span class=\"line\">ThreadA&#x27;s normal var is ThreadB</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"线程间协作\"><a href=\"#线程间协作\" class=\"headerlink\" title=\"线程间协作\"></a>线程间协作</h2><p>轮询：难以保证及时性，且系统开销大。</p>\n<h3 id=\"等待和通知\"><a href=\"#等待和通知\" class=\"headerlink\" title=\"等待和通知\"></a>等待和通知</h3><p>wait() 和 notify()&#x2F;notifyAll() 方法</p>\n<p>这些是<strong>Object的对象方法</strong></p>\n<ul>\n<li>wait()<br>作用是使当前线程从运行状态(Running)转为等待，进入等待队列，直到收到notify通知后，才进入锁池队列，等待获取同步锁，回到可运行状态(Runnnable)。<br>方法可以有一个long类型的入参，表示等待时间，经过等待时间后仍然没有收到通知的话，自动从等待队列转到锁池队列。<br><strong>wait语句会释放锁</strong>。</li>\n<li>notify()<br>从等待队列中通知一个<strong>持有相同锁的线程</strong>，锁不同信号会被忽略。<br>notify 唤醒线程的规则是随机唤醒还是顺序唤醒取决于 JVM 的具体实现，作为主流的 HotSpot 虚拟机中的 notify 的唤醒规则是顺序的，也就是 notify 会按照线程的休眠顺序，依次唤醒线程。谁先wait，谁先notify。</li>\n<li>notifyAll()<br>通知等待队列中所有<strong>持有相同锁的线程</strong></li>\n<li>notify()&#x2F;notifyAll()方法通知是延迟通知，必须等待当前线程执行完所有的同步方法&#x2F;代码块中的语句退出释放锁才通知wait线程。</li>\n</ul>\n<p>这些方法都<strong>必须在获得锁的情况下才能调用</strong>，否则会出现非法监视状态异常。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Object</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * Wakes up a single thread that is waiting on this object&#x27;s</span></span><br><span class=\"line\"><span class=\"comment\">    * monitor. If any threads are waiting on this object, one of them</span></span><br><span class=\"line\"><span class=\"comment\">    * is chosen to be awakened. The choice is arbitrary and occurs at</span></span><br><span class=\"line\"><span class=\"comment\">    * the discretion of the implementation. A thread waits on an object&#x27;s</span></span><br><span class=\"line\"><span class=\"comment\">    * monitor by calling one of the &#123;<span class=\"doctag\">@code</span> wait&#125; methods.</span></span><br><span class=\"line\"><span class=\"comment\">    * ...</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">native</span> <span class=\"keyword\">void</span> <span class=\"title function_\">notify</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">The choice is arbitrary and occurs at the discretion of the implementation.</span></span><br><span class=\"line\"><span class=\"comment\">唤醒线程的选择是任意的，由实现者自行决定。</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"等待和通知的标准范式\"><a href=\"#等待和通知的标准范式\" class=\"headerlink\" title=\"等待和通知的标准范式\"></a>等待和通知的标准范式</h3><p>等待方：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">synchronized(对象) &#123;</span><br><span class=\"line\">    while(条件不满足) &#123;</span><br><span class=\"line\">        对象.wait();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    对应的处理逻辑</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>获取对象的锁</li>\n<li>循环里判断条件是否满足，不满足则调用wait()方法</li>\n<li>条件满足则执行业务逻辑</li>\n</ol>\n<blockquote>\n<p>问：这里的条件，具体指的是什么条件？</p>\n</blockquote>\n<blockquote>\n<p>答：指的是实际业务运行需要满足的条件。</p>\n</blockquote>\n<p>通知方：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">synchronized(对象) &#123;</span><br><span class=\"line\">    改变条件</span><br><span class=\"line\">    对象.notifyAll();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>获取对象的锁</li>\n<li>改变条件</li>\n<li>通知所有在等待对象的方法</li>\n</ol>\n<p>应尽量使用notifyAll()，使用notify()可能发生信号丢失的情况。</p>\n<p>相反，对于之后提及的Condition类的await()&#x2F;signal()&#x2F;signalAll()方法，则应尽量使用signal()方法。</p>\n<p>因为wait()是Object的方法，所有线程都能调用，并不指明在等待什么，通知的时候要通知所有；而await()调用时就确定了正在等待的Condition。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">Tester</span> <span class=\"variable\">tester</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>();</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                tester.waitFun();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                tester.waitFun();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t3</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                tester.notifyFun();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        t1.setName(<span class=\"string\">&quot;ThreadA&quot;</span>);</span><br><span class=\"line\">        t2.setName(<span class=\"string\">&quot;ThreadB&quot;</span>);</span><br><span class=\"line\">        t3.setName(<span class=\"string\">&quot;ThreadC&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\"></span><br><span class=\"line\">        Thread.currentThread().sleep(<span class=\"number\">500</span>);</span><br><span class=\"line\">        t3.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>();</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">condition</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">waitFun</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (lock) &#123; <span class=\"comment\">// 对象锁</span></span><br><span class=\"line\">                <span class=\"keyword\">while</span> (!condition) &#123; <span class=\"comment\">// 使用循环，而不是直接wait()，以符合范式。</span></span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        System.out.println(threadName + <span class=\"string\">&quot; waiting...&quot;</span>);</span><br><span class=\"line\">                        lock.wait();</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                System.out.println(threadName + <span class=\"string\">&quot; continue processing.&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">notifyFun</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (lock) &#123;</span><br><span class=\"line\">                condition = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                System.out.println(threadName + <span class=\"string\">&quot; has change the condition, now will notify all.&quot;</span>);</span><br><span class=\"line\">                lock.notifyAll();</span><br><span class=\"line\">                <span class=\"comment\">// notify(); // 如果是notify()，则按照先进先出顺序唤醒线程（hotspot）。</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在标准等待通知范式下，加上等待超时的方式。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">synchronized(对象) &#123;</span><br><span class=\"line\">    long remain = T; // 设置超时时间</span><br><span class=\"line\">    long endTime = now() + T; // 根据当前时刻算出超时时刻。</span><br><span class=\"line\">    while(条件不满足 &amp;&amp; remain&gt;0) &#123;</span><br><span class=\"line\">        对象.wait(remain);</span><br><span class=\"line\">        remain = endTime - now();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    对应的处理逻辑</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>问：为什么不直接 对象.wait(T) ？</p>\n</blockquote>\n<blockquote>\n<p>答：注意这里循环的条件有两个。如果直接 wait(T) ，但 条件 一直不满足的话，则会重复调用 wait(T) 而无限期等待，设置超时时间也就没意义了。</p>\n</blockquote>\n<h3 id=\"join-方法\"><a href=\"#join-方法\" class=\"headerlink\" title=\"join()方法\"></a>join()方法</h3><p>线程A，执行了线程B的join方法，线程A必须要等待线程B执行完成了之后，线程A才能继续执行。</p>\n<blockquote>\n<p>就像C语言的中断一样。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">previous</span> <span class=\"operator\">=</span> Thread.currentThread();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123; <span class=\"comment\">//线程0需要等待线程main，线程1等线程0，线程2等线程1，...，线程9等线程8</span></span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">thread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(previous), String.valueOf(i));</span><br><span class=\"line\">            thread.start();</span><br><span class=\"line\">            previous = thread;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot; begins.&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        Thread thread;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Tester</span><span class=\"params\">(Thread thread)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.thread = thread;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                thread.join();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot; now end.&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">main begins.</span><br><span class=\"line\">0 now end.</span><br><span class=\"line\">1 now end.</span><br><span class=\"line\">2 now end.</span><br><span class=\"line\">3 now end.</span><br><span class=\"line\">4 now end.</span><br><span class=\"line\">5 now end.</span><br><span class=\"line\">6 now end.</span><br><span class=\"line\">7 now end.</span><br><span class=\"line\">8 now end.</span><br><span class=\"line\">9 now end.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"各种方法对锁的影响\"><a href=\"#各种方法对锁的影响\" class=\"headerlink\" title=\"各种方法对锁的影响\"></a>各种方法对锁的影响</h3><ul>\n<li>线程执行yield()、sleep()方法之后，持有的锁不释放。</li>\n<li>调用wait()之前<strong>必须要持有锁</strong>，在调用wait()时，系统会自动释放这个锁。wait()方法调用结束后，线程会重新获得锁。</li>\n<li>调用notify()方法前<strong>必须要持有锁</strong>，调用notify()方法本身不会释放锁。</li>\n<li>notify()&#x2F;notifyAll()方法通知是延迟通知，必须等待当前线程执行完所有的同步方法&#x2F;代码块中的语句退出释放锁才通知wait线程。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">Object</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">threadA</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">TesterA</span>(), <span class=\"string\">&quot;threadA&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">threadB</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">TesterB</span>(), <span class=\"string\">&quot;threadB&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        threadA.start();</span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">        threadB.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TesterA</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot; now will sleep.&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (lock) &#123;</span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">5000</span>);</span><br><span class=\"line\">                    System.out.println(threadName + <span class=\"string\">&quot; end sleep.&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TesterB</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot; try to get lock.&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (lock) &#123;</span><br><span class=\"line\">                System.out.println(threadName + <span class=\"string\">&quot; have got the lock!&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot; end.&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">threadA now will sleep.</span><br><span class=\"line\">threadB try to get lock.</span><br><span class=\"line\">threadA end sleep.</span><br><span class=\"line\">threadB have got the lock!</span><br><span class=\"line\">threadB end.</span><br></pre></td></tr></table></figure>\n","categories":["多线程"],"tags":["Java"]},{"title":"线程池","url":"/%E7%AC%94%E8%AE%B0/Java/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E6%B1%A0/","content":"<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>线程的容器。用于：</p>\n<ul>\n<li>降低线程创建和销毁的资源消耗；</li>\n<li>提高响应速度；</li>\n<li>提高线程的可管理性。</li>\n</ul>\n<h2 id=\"尝试实现一个自定义的线程池\"><a href=\"#尝试实现一个自定义的线程池\" class=\"headerlink\" title=\"尝试实现一个自定义的线程池\"></a>尝试实现一个自定义的线程池</h2><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyThreadPool</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">WORKER_NUM</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>; <span class=\"comment\">// 默认工作线程数</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">MAX_WORKER</span> <span class=\"operator\">=</span> <span class=\"number\">100</span>; <span class=\"comment\">// 可接收的最大任务数</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> workerNum; <span class=\"comment\">// 工作线程数</span></span><br><span class=\"line\"></span><br><span class=\"line\">    WorkerThread[] workers; <span class=\"comment\">// 工作线程</span></span><br><span class=\"line\"></span><br><span class=\"line\">    BlockingQueue&lt;Runnable&gt; blockingQueue; <span class=\"comment\">// 阻塞队列，用于存储尚未执行的任务</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">MyThreadPool</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>(WORKER_NUM, MAX_WORKER);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">MyThreadPool</span><span class=\"params\">(<span class=\"type\">int</span> _workerNum, <span class=\"type\">int</span> _maxWorker)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_workerNum &lt;= <span class=\"number\">0</span>) _workerNum = WORKER_NUM;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_maxWorker &lt;= <span class=\"number\">0</span>) _maxWorker = MAX_WORKER;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.workerNum = _workerNum; <span class=\"comment\">// 初始化参数</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 实例化 工作线程 和 阻塞队列</span></span><br><span class=\"line\">        workers = <span class=\"keyword\">new</span> <span class=\"title class_\">WorkerThread</span>[workerNum];</span><br><span class=\"line\">        blockingQueue = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayBlockingQueue</span>&lt;&gt;(_maxWorker);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"built_in\">this</span>.workerNum; i++) &#123;</span><br><span class=\"line\">            workers[i] = <span class=\"keyword\">new</span> <span class=\"title class_\">WorkerThread</span>();</span><br><span class=\"line\">            workers[i].start(); <span class=\"comment\">// 让工作线程开始运行，等待任务</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 将任务加入线程池。首先是放到阻塞队列中，由队列将任务分配给工作线程</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">execute</span><span class=\"params\">(Runnable task)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            blockingQueue.put(task);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;Error happens when try to put &quot;</span> + task + <span class=\"string\">&quot;  to the queue.&quot;</span>);</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 销毁线程池。将所有工作线程中断，将阻塞队列清空。</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">destroy</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Start closing the Pool...&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; workerNum; i++) &#123;</span><br><span class=\"line\">            workers[i].stopWork();</span><br><span class=\"line\">            workers[i] = <span class=\"literal\">null</span>; <span class=\"comment\">// 帮助GC</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        blockingQueue.clear();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 工作线程</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WorkerThread</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span> &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Runnable</span> <span class=\"variable\">r</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">while</span> (!isInterrupted()) &#123; <span class=\"comment\">// 由此看来，当线程池销毁时，已开始运行的任务并不会中断，执行完方法才退出。</span></span><br><span class=\"line\">                    r = blockingQueue.take();</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> != r) &#123;</span><br><span class=\"line\">                        r.run(); <span class=\"comment\">// 直接调用run()方法</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    r = <span class=\"literal\">null</span>; <span class=\"comment\">// 帮助GC</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"built_in\">this</span>.getName() + <span class=\"string\">&quot; gets an error.&quot;</span>);</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 开放给外部用于中断自身线程</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">stopWork</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.interrupt();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Runnable</span> <span class=\"variable\">task</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Runnable</span>() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">                System.out.println(threadName);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"type\">MyThreadPool</span> <span class=\"variable\">threadPool</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MyThreadPool</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">20</span>; i++) &#123;</span><br><span class=\"line\">            threadPool.execute(task);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>有几个缺点：</p>\n<ul>\n<li>线程池实例化时，工作线程是预加载的，可能会浪费资源。</li>\n<li>当在阻塞队列满，无法设置处理机制，外界线程提交任务时会被阻塞。</li>\n</ul>\n<h2 id=\"线程池的创建\"><a href=\"#线程池的创建\" class=\"headerlink\" title=\"线程池的创建\"></a>线程池的创建</h2><p>ThreadPoolExecutor，JDK所有线程池实现的父类。</p>\n<h2 id=\"各个参数含义\"><a href=\"#各个参数含义\" class=\"headerlink\" title=\"各个参数含义\"></a>各个参数含义</h2><table>\n<thead>\n<tr>\n<th align=\"center\">参数类型</th>\n<th align=\"center\">参数名</th>\n<th align=\"center\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">int</td>\n<td align=\"center\">corePoolSize</td>\n<td align=\"center\">核心线程数。长期存活的线程数。提交任务时，如果已经有corePoolSize个线程在运行，则该任务会保存在阻塞队列中；否则直接创建新线程</td>\n</tr>\n<tr>\n<td align=\"center\">int</td>\n<td align=\"center\">maximumPoolSize</td>\n<td align=\"center\">允许的最大线程数</td>\n</tr>\n<tr>\n<td align=\"center\">long</td>\n<td align=\"center\">keepAliveTime</td>\n<td align=\"center\">空闲线程存活时间，当非核心线程没有任务时，超过存活时间会被销毁</td>\n</tr>\n<tr>\n<td align=\"center\">TimeUnit</td>\n<td align=\"center\">unit</td>\n<td align=\"center\">keepAliveTime的单位</td>\n</tr>\n<tr>\n<td align=\"center\">BlockingQueue&lt;Runnable&gt;</td>\n<td align=\"center\">workQueue</td>\n<td align=\"center\">保存任务的阻塞队列</td>\n</tr>\n<tr>\n<td align=\"center\">ThreadFactory</td>\n<td align=\"center\">threadFactory</td>\n<td align=\"center\">线程池创建线程时调用的工厂方法。通过此方法可以设置线程的优先级、线程命名规则以及线程类型(用户线程还是守护线程)等。</td>\n</tr>\n<tr>\n<td align=\"center\">RejectedExecutionHandler</td>\n<td align=\"center\">handler</td>\n<td align=\"center\">拒绝策略：当线程池的任务超出线程池队列可以存储的最大值之后，执行的策略</td>\n</tr>\n</tbody></table>\n<p>拒绝策略有以下4种：</p>\n<ul>\n<li>AbortPolicy：直接抛出异常，默认；</li>\n<li>CallerRunsPolicy：用调用者所在线程来执行任务；</li>\n<li>DiscardOldestPolicy：丢弃阻塞队列里最老的任务，即队列头的任务；</li>\n<li>DiscardPolicy：当前任务直接丢弃。</li>\n</ul>\n<p>或者实现一个自定义的 RejectedExecutionHandler去 使用。</p>\n<h2 id=\"提交任务\"><a href=\"#提交任务\" class=\"headerlink\" title=\"提交任务\"></a>提交任务</h2><p>void execute(Runnable command) 不需要返回值；<br>Future&lt;T&gt; submit(Callable&lt;T&gt; task) 需要返回值。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">execute</span><span class=\"params\">(Runnable command)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (command == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NullPointerException</span>();</span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        * Proceed in 3 steps:</span></span><br><span class=\"line\"><span class=\"comment\">        *</span></span><br><span class=\"line\"><span class=\"comment\">        * 1. If fewer than corePoolSize threads are running, try to</span></span><br><span class=\"line\"><span class=\"comment\">        * start a new thread with the given command as its first</span></span><br><span class=\"line\"><span class=\"comment\">        * task.  The call to addWorker atomically checks runState and</span></span><br><span class=\"line\"><span class=\"comment\">        * workerCount, and so prevents false alarms that would add</span></span><br><span class=\"line\"><span class=\"comment\">        * threads when it shouldn&#x27;t, by returning false.</span></span><br><span class=\"line\"><span class=\"comment\">        *</span></span><br><span class=\"line\"><span class=\"comment\">        * 1. 如果运行的线程数小于核心线程数，则直接新建核心线程处理任务。（由此可见工作线程是懒加载的）</span></span><br><span class=\"line\"><span class=\"comment\">        *</span></span><br><span class=\"line\"><span class=\"comment\">        * 2. If a task can be successfully queued, then we still need</span></span><br><span class=\"line\"><span class=\"comment\">        * to double-check whether we should have added a thread</span></span><br><span class=\"line\"><span class=\"comment\">        * (because existing ones died since last checking) or that</span></span><br><span class=\"line\"><span class=\"comment\">        * the pool shut down since entry into this method. So we</span></span><br><span class=\"line\"><span class=\"comment\">        * recheck state and if necessary roll back the enqueuing if</span></span><br><span class=\"line\"><span class=\"comment\">        * stopped, or start a new thread if there are none.</span></span><br><span class=\"line\"><span class=\"comment\">        *</span></span><br><span class=\"line\"><span class=\"comment\">        * 2. 如果任务可被成功加入阻塞队列里，那就加吧。但加的时候需要二次检查任务能否直接被执行。</span></span><br><span class=\"line\"><span class=\"comment\">        *</span></span><br><span class=\"line\"><span class=\"comment\">        * 3. If we cannot queue task, then we try to add a new</span></span><br><span class=\"line\"><span class=\"comment\">        * thread.  If it fails, we know we are shut down or saturated</span></span><br><span class=\"line\"><span class=\"comment\">        * and so reject the task.</span></span><br><span class=\"line\"><span class=\"comment\">        *</span></span><br><span class=\"line\"><span class=\"comment\">        * 3. 如果任务无法加入阻塞队列里。尝试新建非核心线程处理任务，如果没法创建（如已经达到了最大线程数），则使用拒绝策略。</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">c</span> <span class=\"operator\">=</span> ctl.get();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (addWorker(command, <span class=\"literal\">true</span>))</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        c = ctl.get();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">recheck</span> <span class=\"operator\">=</span> ctl.get();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class=\"line\">            reject(command);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (workerCountOf(recheck) == <span class=\"number\">0</span>)</span><br><span class=\"line\">            addWorker(<span class=\"literal\">null</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!addWorker(command, <span class=\"literal\">false</span>))</span><br><span class=\"line\">        reject(command);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>问：为什么使用阻塞队列而不是普通队列？</p>\n</blockquote>\n<blockquote>\n<p>答：一般队列只是有限长度的缓冲区，一旦超出缓冲长度，任务就无法保留。阻塞队列通过阻塞可以保留住当前想要继续入队的任务。阻塞队列带有阻塞和唤醒的功能，不需要额外处理，无任务执行时，线程池利用阻塞队列的take方法挂起，从而维持核心线程的存活，不至于一直占用cpu资源。</p>\n</blockquote>\n<blockquote>\n<p>问：为什么先添加队列而不是先创建最大线程？</p>\n</blockquote>\n<blockquote>\n<p>答：在创建新线程的时候，是要获取全局锁的，这时候其他线程会被阻塞，影响整体效率。这样设计的代价低。</p>\n</blockquote>\n<h2 id=\"关闭线程池\"><a href=\"#关闭线程池\" class=\"headerlink\" title=\"关闭线程池\"></a>关闭线程池</h2><p>使用方法 shutdown() 或 shutdownNow()</p>\n<p>shutdown() 会设置线程池的状态，只会中断没有执行任务的线程。</p>\n<p>shutdownNow() 不仅会设置线程池的状态，还会尝试停止正在运行或暂停任务的线程。</p>\n<h2 id=\"合理配置线程池\"><a href=\"#合理配置线程池\" class=\"headerlink\" title=\"合理配置线程池\"></a>合理配置线程池</h2><p>任务性质大致有几种：计算（CPU）密集型、IO密集型、混合型。</p>\n<ul>\n<li>计算密集型：加密、大数分解、正则等。最大线程数适当小一些，推荐设置为机器CPU+1 。</li>\n<li>IO密集型：读取文件、数据库连接、网络通讯等。最大线程数适当大一些，推荐设置为机器的CPU*2 。</li>\n<li>混合型：尽量拆分。IO密集型&gt;&gt;计算密集型，拆分意义不大；IO密集型≈计算密集型，是和拆分。</li>\n</ul>\n<p>阻塞队列的选择，因尽量使用有界，无界队列可能会导致内存溢出。</p>\n<h2 id=\"预定义的线程池\"><a href=\"#预定义的线程池\" class=\"headerlink\" title=\"预定义的线程池\"></a>预定义的线程池</h2><p>由java.util.concurrent.Executors，使用静态方法的方式提供。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 先放一个构造函数在这里</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ThreadPoolExecutor</span><span class=\"params\">(<span class=\"type\">int</span> corePoolSize,</span></span><br><span class=\"line\"><span class=\"params\">                            <span class=\"type\">int</span> maximumPoolSize,</span></span><br><span class=\"line\"><span class=\"params\">                            <span class=\"type\">long</span> keepAliveTime,</span></span><br><span class=\"line\"><span class=\"params\">                            TimeUnit unit,</span></span><br><span class=\"line\"><span class=\"params\">                            BlockingQueue&lt;Runnable&gt; workQueue,</span></span><br><span class=\"line\"><span class=\"params\">                            ThreadFactory threadFactory,</span></span><br><span class=\"line\"><span class=\"params\">                            RejectedExecutionHandler handler)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"FixedThreadPool\"><a href=\"#FixedThreadPool\" class=\"headerlink\" title=\"FixedThreadPool\"></a>FixedThreadPool</h3><p>创建固定线程数量的，适用于负载较重的服务器，使用无界队列。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 核心线程数和最大线程数相同</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title function_\">newFixedThreadPool</span><span class=\"params\">(<span class=\"type\">int</span> nThreads, ThreadFactory threadFactory)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadPoolExecutor</span>(nThreads, nThreads,</span><br><span class=\"line\">                                    <span class=\"number\">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class=\"line\">                                    <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedBlockingQueue</span>&lt;Runnable&gt;(),</span><br><span class=\"line\">                                    threadFactory);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"SingleThreadPool\"><a href=\"#SingleThreadPool\" class=\"headerlink\" title=\"SingleThreadPool\"></a>SingleThreadPool</h3><p>创建单个线程，需要顺序保证执行任务，不会有多个线程活动，使用无界队列。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 核心线程数和最大线程数都为1</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title function_\">newSingleThreadExecutor</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FinalizableDelegatedExecutorService</span></span><br><span class=\"line\">        (<span class=\"keyword\">new</span> <span class=\"title class_\">ThreadPoolExecutor</span>(<span class=\"number\">1</span>, <span class=\"number\">1</span>,</span><br><span class=\"line\">                                <span class=\"number\">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedBlockingQueue</span>&lt;Runnable&gt;()));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"CachedThreadPool\"><a href=\"#CachedThreadPool\" class=\"headerlink\" title=\"CachedThreadPool\"></a>CachedThreadPool</h3><p>会根据需要来创建新线程，执行很多短期异步任务的程序，使用了SynchronousQueue</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 不设置核心线程数，最大线程数为21亿+，且线程超时时间为60秒</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title function_\">newCachedThreadPool</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadPoolExecutor</span>(<span class=\"number\">0</span>, Integer.MAX_VALUE,</span><br><span class=\"line\">                                    <span class=\"number\">60L</span>, TimeUnit.SECONDS,</span><br><span class=\"line\">                                    <span class=\"keyword\">new</span> <span class=\"title class_\">SynchronousQueue</span>&lt;Runnable&gt;());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"WorkStealingPool\"><a href=\"#WorkStealingPool\" class=\"headerlink\" title=\"WorkStealingPool\"></a>WorkStealingPool</h3><p>基于ForkJoinPool实现</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title function_\">newWorkStealingPool</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ForkJoinPool</span></span><br><span class=\"line\">        (Runtime.getRuntime().availableProcessors(),</span><br><span class=\"line\">            ForkJoinPool.defaultForkJoinWorkerThreadFactory,</span><br><span class=\"line\">            <span class=\"literal\">null</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ScheduledThreadPoolExecutor\"><a href=\"#ScheduledThreadPoolExecutor\" class=\"headerlink\" title=\"ScheduledThreadPoolExecutor\"></a>ScheduledThreadPoolExecutor</h3><p>适合需定期执行的周期性任务</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ScheduledThreadPoolExecutor</span></span><br><span class=\"line\">        <span class=\"keyword\">extends</span> <span class=\"title class_\">ThreadPoolExecutor</span></span><br><span class=\"line\">        <span class=\"keyword\">implements</span> <span class=\"title class_\">ScheduledExecutorService</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ScheduledExecutorService <span class=\"title function_\">newScheduledThreadPool</span><span class=\"params\">(<span class=\"type\">int</span> corePoolSize)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ScheduledThreadPoolExecutor</span>(corePoolSize);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 单线程版本</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ScheduledExecutorService <span class=\"title function_\">newSingleThreadScheduledExecutor</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DelegatedScheduledExecutorService</span></span><br><span class=\"line\">        (<span class=\"keyword\">new</span> <span class=\"title class_\">ScheduledThreadPoolExecutor</span>(<span class=\"number\">1</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>几个比较重要的方法：</p>\n<ul>\n<li>schedule， 执行一次任务，可以设置延时执行</li>\n<li>scheduleAtFixedRate，提交固定时间间隔执行的任务</li>\n<li>scheduleWithFixedDelay，提交固定延时间隔执行的任务</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> ScheduledFuture&lt;?&gt; schedule(Runnable command,</span><br><span class=\"line\">                                    <span class=\"type\">long</span> delay,</span><br><span class=\"line\">                                    TimeUnit unit) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>问：scheduleAtFixedRate 和 scheduleWithFixedDelay 有什么区别？</p>\n</blockquote>\n<blockquote>\n<p>答：scheduleAtFixedRate 中的时间间隔，是每次<strong>任务开始时刻</strong>的间隔，但是，如果上个任务超时未结束，则下个任务需要等待上个任务执行完毕后立马执行；scheduleWithFixedDelay中的时间间隔，是<strong>上一次任务结束，到下一次任务开始时刻</strong>之间的间隔。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ScheduledExecutorService</span> <span class=\"variable\">scheduledExecutorService</span> <span class=\"operator\">=</span> Executors.newSingleThreadScheduledExecutor();</span><br><span class=\"line\">        scheduledExecutorService.scheduleAtFixedRate(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(), <span class=\"number\">0</span>, <span class=\"number\">2</span>, TimeUnit.SECONDS);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">SimpleDateFormat</span> <span class=\"variable\">simpleDateFormat</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleDateFormat</span>(<span class=\"string\">&quot;HH:mm:ss&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName() + <span class=\"string\">&quot; &quot;</span> + simpleDateFormat.format(<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>());</span><br><span class=\"line\">            System.out.println(threadName);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">pool-1-thread-1 11:53:11</span><br><span class=\"line\">pool-1-thread-1 11:53:13</span><br><span class=\"line\">pool-1-thread-1 11:53:15</span><br><span class=\"line\">pool-1-thread-1 11:53:17</span><br></pre></td></tr></table></figure>\n\n<p>如果在任务执行中抛出了异常而自身未处理，则整个周期任务会停止，只能重启恢复。</p>\n<h2 id=\"CompletionService\"><a href=\"#CompletionService\" class=\"headerlink\" title=\"CompletionService\"></a>CompletionService</h2><p>思考如下场景：线程池接收Callable任务，需要有一个容器接收任务的返回值。如果使用阻塞队列存放任务、获取任务返回值的话，由于队列先入先出的性质，处于队列后的任务，总是需要等待处于队列前的任务执行完成才能给出结果，效率会非常低。</p>\n<p>即有些任务因为执行时间较长，而在他后面的任务可能执行任务的时间较短，已经提前完成了，但是并不能得到及时的处理。</p>\n<h3 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">POOL_SIZE</span> <span class=\"operator\">=</span> Runtime.getRuntime().availableProcessors();</span><br><span class=\"line\">        <span class=\"type\">ExecutorService</span> <span class=\"variable\">pool</span> <span class=\"operator\">=</span> Executors.newFixedThreadPool(POOL_SIZE);</span><br><span class=\"line\">        BlockingQueue&lt;Future&lt;String&gt;&gt; resultQueue = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayBlockingQueue</span>&lt;&gt;(POOL_SIZE);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> System.currentTimeMillis();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 创建CPU核数相同数量的任务，加到线程池中，并预先将返回值future存储在自定义容器resultQueue中</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; POOL_SIZE; i++) &#123;</span><br><span class=\"line\">            Future&lt;String&gt; future = pool.submit(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(<span class=\"string\">&quot;Task-&quot;</span> + i));</span><br><span class=\"line\"></span><br><span class=\"line\">            resultQueue.put(future); <span class=\"comment\">// 这里逻辑上不会阻塞，实际上直接用add应该就可以</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 输出线程池任务执行结果</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; POOL_SIZE; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> resultQueue.take().get();</span><br><span class=\"line\">            System.out.println(result);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 关闭线程池</span></span><br><span class=\"line\">        pool.shutdown();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;-----------------&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;The whole process spend &quot;</span> + (System.currentTimeMillis() - start) + <span class=\"string\">&quot;ms.&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;String&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Tester</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">call</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">sleepTime</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Random</span>().nextInt(<span class=\"number\">1000</span>);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Thread.sleep(sleepTime);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name + <span class=\"string\">&quot; slept &quot;</span> + sleepTime + <span class=\"string\">&quot;ms&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Task-0 slept 918ms</span><br><span class=\"line\">Task-1 slept 406ms</span><br><span class=\"line\">Task-2 slept 519ms</span><br><span class=\"line\">Task-3 slept 521ms</span><br><span class=\"line\">Task-4 slept 725ms</span><br><span class=\"line\">Task-5 slept 651ms</span><br><span class=\"line\">Task-6 slept 106ms</span><br><span class=\"line\">Task-7 slept 665ms</span><br><span class=\"line\">-----------------</span><br><span class=\"line\">The whole process spend 921ms.</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，Task-1执行的时间比Task-0更短，但仍然需要等待Task-0任务执行完成后，才能拿到结果。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">POOL_SIZE</span> <span class=\"operator\">=</span> Runtime.getRuntime().availableProcessors();</span><br><span class=\"line\">        <span class=\"type\">ExecutorService</span> <span class=\"variable\">pool</span> <span class=\"operator\">=</span> Executors.newFixedThreadPool(POOL_SIZE);</span><br><span class=\"line\">        <span class=\"comment\">// 使用CompletionService包装线程池</span></span><br><span class=\"line\">        CompletionService&lt;String&gt; completionService = <span class=\"keyword\">new</span> <span class=\"title class_\">ExecutorCompletionService</span>&lt;&gt;(pool);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> System.currentTimeMillis();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; POOL_SIZE; i++) &#123;</span><br><span class=\"line\">            completionService.submit(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(<span class=\"string\">&quot;Task-&quot;</span> + i)); <span class=\"comment\">// 直接向CompletionService中提交任务</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 输出线程池任务执行结果</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; POOL_SIZE; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> completionService.take().get();</span><br><span class=\"line\">            System.out.println(result);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 关闭线程池</span></span><br><span class=\"line\">        pool.shutdown();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;-----------------&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;The whole process spend &quot;</span> + (System.currentTimeMillis() - start) + <span class=\"string\">&quot;ms.&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;String&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Tester</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">call</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">sleepTime</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Random</span>().nextInt(<span class=\"number\">1000</span>);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Thread.sleep(sleepTime);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name + <span class=\"string\">&quot; slept &quot;</span> + sleepTime + <span class=\"string\">&quot;ms&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Task-3 slept 89ms</span><br><span class=\"line\">Task-0 slept 156ms</span><br><span class=\"line\">Task-2 slept 465ms</span><br><span class=\"line\">Task-6 slept 557ms</span><br><span class=\"line\">Task-5 slept 566ms</span><br><span class=\"line\">Task-4 slept 716ms</span><br><span class=\"line\">Task-7 slept 871ms</span><br><span class=\"line\">Task-1 slept 890ms</span><br><span class=\"line\">-----------------</span><br><span class=\"line\">The whole process spend 893ms.</span><br></pre></td></tr></table></figure>\n\n<p>可以看到先执行完成的任务先输出。整个过程的耗时也稍较短。</p>\n<p>需要注意，这里的线程池大小和任务数量是相同的，任务提交时间间隔远小于任务执行时间，相当于一个线程只负责一个任务，才会有这种输出效果。</p>\n<h3 id=\"实现原理\"><a href=\"#实现原理\" class=\"headerlink\" title=\"实现原理\"></a>实现原理</h3><p>实际上还是用的阻塞队列，不过提交的任务被自定义的FutureTask封装。</p>\n<p>这里的QueueingFuture，主要做的事情，就是重写了done()函数，让任务执行完后再加入阻塞队列中；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> BlockingQueue&lt;Future&lt;V&gt;&gt; completionQueue;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">class</span> <span class=\"title class_\">QueueingFuture</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">FutureTask</span>&lt;Void&gt; &#123;</span><br><span class=\"line\">    QueueingFuture(RunnableFuture&lt;V&gt; task) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(task, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.task = task;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">done</span><span class=\"params\">()</span> &#123; completionQueue.add(task); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Future&lt;V&gt; task;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>done()方法是FutureTask类的方法，默认为空。但子类可以重写，让任务执行完（或被取消）后触发执行一个回调函数。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FutureTask</span>&lt;V&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">RunnableFuture</span>&lt;V&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Protected method invoked when this task transitions to state</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@code</span> isDone&#125; (whether normally or via cancellation). The</span></span><br><span class=\"line\"><span class=\"comment\">     * default implementation does nothing.  Subclasses may override</span></span><br><span class=\"line\"><span class=\"comment\">     * this method to invoke completion callbacks or perform</span></span><br><span class=\"line\"><span class=\"comment\">     * bookkeeping. Note that you can query status inside the</span></span><br><span class=\"line\"><span class=\"comment\">     * implementation of this method to determine whether this task</span></span><br><span class=\"line\"><span class=\"comment\">     * has been cancelled.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">done</span><span class=\"params\">()</span> &#123; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","categories":["多线程"],"tags":["Java"]},{"title":"线程的并发工具类","url":"/%E7%AC%94%E8%AE%B0/Java/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB/","content":"<h2 id=\"Fork-x2F-Join\"><a href=\"#Fork-x2F-Join\" class=\"headerlink\" title=\"Fork&#x2F;Join\"></a>Fork&#x2F;Join</h2><h3 id=\"分而治之\"><a href=\"#分而治之\" class=\"headerlink\" title=\"分而治之\"></a>分而治之</h3><p>使用分而治之的思想。</p>\n<p>在必要的情况下，将一个大任务，拆分成若干的小任务，直至问题规模小到不需要再拆分，再将所有小任务的运算结果进行join汇总。<br>拆分出来的子任务，与原任务问题形式相同。</p>\n<h3 id=\"工作密取-Work-Stealing\"><a href=\"#工作密取-Work-Stealing\" class=\"headerlink\" title=\"工作密取 Work Stealing\"></a>工作密取 Work Stealing</h3><p>提高CPU利用率，尽量不要有空闲的线程。</p>\n<p>线程A的任务执行完毕，但任务B还剩下几个任务，此时线程A会将B剩下的任务偷过来执行，之后将执行完的结果放回线程B中。<br>从线程B任务队列的尾部偷取。</p>\n<h3 id=\"使用的标准范式\"><a href=\"#使用的标准范式\" class=\"headerlink\" title=\"使用的标准范式\"></a>使用的标准范式</h3><ol>\n<li>pool &#x3D; new ForkJoinPool();</li>\n<li>MyTask myTask &#x3D; new ForkJoinTask();</li>\n<li>Pool.invoke(myTask);</li>\n<li>Result &#x3D; myTask.join();</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">MyTask</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">RecursiveTask</span>/RecursiveAction/ForkJoinTask&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">compute</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 如果问题规模足够小，直接计算</span></span><br><span class=\"line\">        <span class=\"comment\">// 否则将任务拆分为更多子任务</span></span><br><span class=\"line\">        <span class=\"comment\">// 所有子任务的Join合并</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span>[] arr = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[<span class=\"number\">100000</span>];</span><br><span class=\"line\">        <span class=\"type\">Random</span> <span class=\"variable\">random</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Random</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class=\"line\">            arr[i] = random.nextInt(<span class=\"number\">100</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">ForkJoinPool</span> <span class=\"variable\">pool</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ForkJoinPool</span>();</span><br><span class=\"line\">        <span class=\"type\">Tester</span> <span class=\"variable\">tester</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(arr, <span class=\"number\">0</span>, arr.length - <span class=\"number\">1</span>);</span><br><span class=\"line\">        pool.invoke(tester);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">res</span> <span class=\"operator\">=</span> tester.join();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;The Fork/Join result is &quot;</span> + res);</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">sum</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> n : arr) &#123;</span><br><span class=\"line\">            sum = sum + n;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;The result is the same? &quot;</span> + (sum == res));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">RecursiveTask</span>&lt;Integer&gt; &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span>[] arr;</span><br><span class=\"line\">        <span class=\"type\">int</span> left, right;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Tester</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> left, <span class=\"type\">int</span> right)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.arr = arr;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.left = left;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.right = right;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> Integer <span class=\"title function_\">compute</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//System.out.println(Thread.currentThread().getName() + &quot; is processing.&quot;);</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (right - left &lt; <span class=\"number\">50</span>) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">sum</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> left; i &lt;= right; i++) &#123;</span><br><span class=\"line\">                    sum = sum + arr[i];</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> sum;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">mid</span> <span class=\"operator\">=</span> left + (right - left) / <span class=\"number\">2</span>;</span><br><span class=\"line\">                <span class=\"type\">Tester</span> <span class=\"variable\">taskLeft</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(arr, left, mid);</span><br><span class=\"line\">                <span class=\"type\">Tester</span> <span class=\"variable\">taskRight</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(arr, mid + <span class=\"number\">1</span>, right);</span><br><span class=\"line\">                invokeAll(taskLeft, taskRight);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> taskLeft.join() + taskRight.join();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">The Fork/Join result is 4940955</span><br><span class=\"line\">The result is the same? true</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>问：ForkJoinPool的作用是什么，为什么一定要使用？或者说应该如何理解ForkJoinPool在这里担任的角色。</p>\n</blockquote>\n<blockquote>\n<p>答：ForkJoinPool是一个特殊的线程池，专门用来启动Fork&#x2F;Join任务的。池中的线程数是由CPU核数决定的。</p>\n</blockquote>\n<h3 id=\"Fork-x2F-Join的异步使用\"><a href=\"#Fork-x2F-Join的异步使用\" class=\"headerlink\" title=\"Fork&#x2F;Join的异步使用\"></a>Fork&#x2F;Join的异步使用</h3><p>需要注意的是，在上节例子中，main方法里使用tester.join();启动Fork&#x2F;Join任务，这样会导致main方法阻塞，等到Fork&#x2F;Join任务完成之后才能继续运行。<br>如果想让Fork&#x2F;Join任务异步运行，可以使用ForkJoinPool.submit()，使用Future类存储任务结果，调用future.get()的时候才会阻塞。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ForkJoinPool</span> <span class=\"variable\">forkJoinPool</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ForkJoinPool</span>();</span><br><span class=\"line\">        <span class=\"type\">File</span> <span class=\"variable\">root</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(<span class=\"string\">&quot;F:\\\\Minitool&quot;</span>);</span><br><span class=\"line\">        forkJoinPool.execute(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(root));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">RecursiveAction</span> &#123;</span><br><span class=\"line\">        File path;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Tester</span><span class=\"params\">(File path)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.path = path;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">compute</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            List&lt;Tester&gt; subTask = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">            File[] subFiles = path.listFiles();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (File file : subFiles) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (file.isDirectory()) &#123;</span><br><span class=\"line\">                    subTask.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(file));</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">filename</span> <span class=\"operator\">=</span> file.getName();</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (filename.endsWith(<span class=\"string\">&quot;.exe&quot;</span>)) &#123;</span><br><span class=\"line\">                        System.out.println(filename);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!subTask.isEmpty()) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (Tester task : invokeAll(subTask)) &#123;</span><br><span class=\"line\">                    task.join(); <span class=\"comment\">// 阻塞方法，等待子任务执行完成</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;Task end.&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>invokeAll(subTask) 这里，参数要传多个 RecursiveAction 实例，也可以传集合类。</p>\n<blockquote>\n<p>问：ForkJoinPool 有 submit()、invoke()、execute()方法，都有什么区别？</p>\n</blockquote>\n<h2 id=\"CountDownLatch\"><a href=\"#CountDownLatch\" class=\"headerlink\" title=\"CountDownLatch\"></a>CountDownLatch</h2><p>用来控制一个（或多个）线程等待多个线程，可以看做加强版join()。<br>await()方法用于阻塞等待，countDown()方法用于计数器减一。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">        <span class=\"type\">CountDownLatch</span> <span class=\"variable\">latch</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CountDownLatch</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(threadName + <span class=\"string\">&quot; now waiting...&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        Thread thread;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">            thread = <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(latch));</span><br><span class=\"line\">            thread.start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        latch.await();</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(threadName + <span class=\"string\">&quot; now continue to do its work.&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        CountDownLatch latch;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Tester</span><span class=\"params\">(CountDownLatch latch)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.latch = latch;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot; now do its work, getCount() = &quot;</span> + latch.getCount());</span><br><span class=\"line\">            latch.countDown();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">main now waiting...</span><br><span class=\"line\">Thread-1 now do its work, getCount() = 5</span><br><span class=\"line\">Thread-0 now do its work, getCount() = 5</span><br><span class=\"line\">Thread-2 now do its work, getCount() = 4</span><br><span class=\"line\">Thread-3 now do its work, getCount() = 2</span><br><span class=\"line\">Thread-4 now do its work, getCount() = 1</span><br><span class=\"line\">main now continue to do its work.</span><br></pre></td></tr></table></figure>\n\n<p>从结果也可以看出，getCount()方法也不是线程安全的。</p>\n<h2 id=\"CyclicBarrier\"><a href=\"#CyclicBarrier\" class=\"headerlink\" title=\"CyclicBarrier\"></a>CyclicBarrier</h2><p>控制多个线程互相等待，只有多个线程都到达await()时，这些线程才会继续执行，也是维护计数器实现的。<br>可以用于比如多个表单计算结果，等待所有表单计算完成后汇总结果这种场景。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException, BrokenBarrierException &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">        <span class=\"type\">CyclicBarrier</span> <span class=\"variable\">barrier</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CyclicBarrier</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(threadName + <span class=\"string\">&quot; now waiting...&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        Thread thread;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">4</span>; i++) &#123; <span class=\"comment\">// 这里只生成另外4个线程，因为主线程也算一个。</span></span><br><span class=\"line\">            thread = <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(barrier));</span><br><span class=\"line\">            thread.start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        barrier.await();</span><br><span class=\"line\">        System.out.println(threadName + <span class=\"string\">&quot; now continue to do its work.&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        CyclicBarrier barrier;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Tester</span><span class=\"params\">(CyclicBarrier barrier)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.barrier = barrier;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            System.out.println(threadName + <span class=\"string\">&quot; now get to await(), existed waiting thread : &quot;</span> + barrier.getNumberWaiting());</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                barrier.await();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (BrokenBarrierException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">main now waiting...</span><br><span class=\"line\">Thread-0 now get to await(), existed waiting thread : 1</span><br><span class=\"line\">Thread-1 now get to await(), existed waiting thread : 1</span><br><span class=\"line\">Thread-3 now get to await(), existed waiting thread : 2</span><br><span class=\"line\">Thread-2 now get to await(), existed waiting thread : 1</span><br><span class=\"line\">main now continue to do its work.</span><br></pre></td></tr></table></figure>\n\n<p>可以看出，getNumberWaiting()方法也不是线程安全的。</p>\n<p>CountDownLatch放行由第三者控制，CyclicBarrier放行由一组线程本身控制。</p>\n<h2 id=\"Semaphore\"><a href=\"#Semaphore\" class=\"headerlink\" title=\"Semaphore\"></a>Semaphore</h2><p>控制对互斥资源的访问线程数。常用与流量控制。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DBConnectionPool</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Connection</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> id;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Connection</span><span class=\"params\">(<span class=\"type\">int</span> id)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.id = id;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    Semaphore used, vacant;</span><br><span class=\"line\">    Deque&lt;Connection&gt; connections;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">DBConnectionPool</span><span class=\"params\">(<span class=\"type\">int</span> size, Semaphore used, Semaphore vacant)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.used = used;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.vacant = vacant;</span><br><span class=\"line\">        connections = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayDeque</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; size; i++) &#123;</span><br><span class=\"line\">            connections.offer(<span class=\"keyword\">new</span> <span class=\"title class_\">Connection</span>(i));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Connection <span class=\"title function_\">getConnection</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        used.acquire();</span><br><span class=\"line\">        Connection conn;</span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (connections) &#123;</span><br><span class=\"line\">            conn = connections.poll();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;now &quot;</span> + used.getQueueLength() + <span class=\"string\">&quot; threads is waiting.&quot;</span>);</span><br><span class=\"line\">        vacant.release();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> conn;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">returnConnection</span><span class=\"params\">(Connection conn)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        vacant.acquire();</span><br><span class=\"line\">        System.out.println(connections.size() + <span class=\"string\">&quot; connections left.&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (connections) &#123;</span><br><span class=\"line\">            connections.offer(conn);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        used.release();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>问：这里为什么要使用两个Semaphore？</p>\n</blockquote>\n<blockquote>\n<p>答：用两个的意义在于，限制 同时 获取连接的线程 和 归还连接的线程 的总和，不超过5。只设置used的话，同时归还连接的线程数就不受控制了。</p>\n</blockquote>\n<h2 id=\"Exchanger-lt-V-gt\"><a href=\"#Exchanger-lt-V-gt\" class=\"headerlink\" title=\"Exchanger&lt;V&gt;\"></a>Exchanger&lt;V&gt;</h2><p>用于两个线程之间的数据交换。<br>线程A第一次调用exchange(V val)时，会准备好V类型的值在此阻塞等待；线程B此时调用exchange方法时，也准备好V类型的值；两个线程交换数据后，继续向下执行。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        Exchanger&lt;String&gt; exchanger = <span class=\"keyword\">new</span> <span class=\"title class_\">Exchanger</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">threadA</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(exchanger), <span class=\"string\">&quot;ThreadA&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">threadB</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>(exchanger), <span class=\"string\">&quot;ThreadB&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        threadA.start();</span><br><span class=\"line\">        threadB.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        Exchanger&lt;String&gt; exchanger;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Tester</span><span class=\"params\">(Exchanger&lt;String&gt; exchanger)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.exchanger = exchanger;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">threadName</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">exchangeMessage</span> <span class=\"operator\">=</span> exchanger.exchange(threadName);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;I&#x27;m &quot;</span> + threadName + <span class=\"string\">&quot;, now I get exchange Message : &quot;</span> + exchangeMessage);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">I&#x27;m ThreadA, now I get exchange Message : ThreadB</span><br><span class=\"line\">I&#x27;m ThreadB, now I get exchange Message : ThreadA</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Callable、Future和FutureTask\"><a href=\"#Callable、Future和FutureTask\" class=\"headerlink\" title=\"Callable、Future和FutureTask\"></a>Callable、Future和FutureTask</h2><p>Runnable没有返回值，且无法抛出异常；<br>Callable有返回值，可以抛出异常。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@FunctionalInterface</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Callable</span>&lt;V&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Computes a result, or throws an exception if unable to do so.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> computed result</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception if unable to compute a result</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    V <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>RunnableFuture接口，继承Runnable接口和Future接口；<br>FutureTask是RunnableFuture的一个实现类，同时有Runnable和Future的特性。</p>\n<p>FutureTask实例化的时候，可以传Callable或者Runnable对象进行构造。传Runnable对象的时候，还需要另外传一个变量来接收任务执行结果。</p>\n<ul>\n<li>isDone()：判断任务是否已结束，无论是正常结束或异常中断，都返回true。</li>\n<li>isCancelled()：若任务完成前被取消，返回true。</li>\n<li>cancel(boolean)：任务还未开始或已经结束，返回false；任务正在运行，调用cancel(true)，会传一个interrupt信号，若中断成功返回true；调用cancel(false)则不会中断。</li>\n</ul>\n<blockquote>\n<p>问：cancel(false)有什么用？</p>\n</blockquote>\n<blockquote>\n<p>cancel(false)用于取消还未开始的任务，cancel(true)用于取消所有状态的任务。当FutureTask处于已启动状态时，执行FutureTask.cancel(false)方法将不会对正在执行此任务的线程产生影响（让正在执行的任务运行完成）;但是当FutureTask处于未启动状态时，执行FutureTask.cancel()方法将导致此任务永远不会被执行。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class=\"line\">        FutureTask&lt;Integer&gt; futureTask = <span class=\"keyword\">new</span> <span class=\"title class_\">FutureTask</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">Tester</span>());</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">thread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(futureTask);</span><br><span class=\"line\">        thread.start();</span><br><span class=\"line\">        <span class=\"comment\">// Thread.sleep(500); // 如果先等任务执行完，则cancel()方法不会有影响，返回false</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Do I successfully canceled the task? &quot;</span> + futureTask.cancel(<span class=\"literal\">true</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Is the task canceled now? &quot;</span> + futureTask.isCancelled());</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            value = futureTask.get();</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;Result is &quot;</span> + value);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (CancellationException e) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;The task is canceled.&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Tester</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;Integer&gt; &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Integer <span class=\"title function_\">call</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">sum</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">100</span>; i++) &#123;</span><br><span class=\"line\">                sum += i;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> sum;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">Do I successfully canceled the task? true</span><br><span class=\"line\">Is the task canceled now? true</span><br><span class=\"line\">The task is canceled.</span><br></pre></td></tr></table></figure>\n\n<p>Thread包FutureTask，FutureTask包Callable</p>\n","categories":["多线程"],"tags":["Java"]},{"title":"Integer的实例化","url":"/%E7%AC%94%E8%AE%B0/Java/Java%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/Integer%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96/","content":"<h2 id=\"源码位置\"><a href=\"#源码位置\" class=\"headerlink\" title=\"源码位置\"></a>源码位置</h2><ul>\n<li>java.lang.Integer</li>\n<li>java version “1.8.0_191”</li>\n</ul>\n<h2 id=\"被弃用的构造器\"><a href=\"#被弃用的构造器\" class=\"headerlink\" title=\"被弃用的构造器\"></a>被弃用的构造器</h2><p>public Integer(int value) 这个构造器，被标明在JDK9及之后被弃用，用户被建议使用Integer valueOf(int i)的方式实例化Integer变量。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Constructs a newly allocated &#123;<span class=\"doctag\">@code</span> Integer&#125; object that</span></span><br><span class=\"line\"><span class=\"comment\"> * represents the specified &#123;<span class=\"doctag\">@code</span> int&#125; value.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>   value   the value to be represented by the</span></span><br><span class=\"line\"><span class=\"comment\"> *                  &#123;<span class=\"doctag\">@code</span> Integer&#125; object.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@deprecated</span></span></span><br><span class=\"line\"><span class=\"comment\"> * It is rarely appropriate to use this constructor. The static factory</span></span><br><span class=\"line\"><span class=\"comment\"> * &#123;<span class=\"doctag\">@link</span> #valueOf(int)&#125; is generally a better choice, as it is</span></span><br><span class=\"line\"><span class=\"comment\"> * likely to yield significantly better space and time performance.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Deprecated(since=&quot;9&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">Integer</span><span class=\"params\">(<span class=\"type\">int</span> value)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.value = value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"valueOf-int-i-方法\"><a href=\"#valueOf-int-i-方法\" class=\"headerlink\" title=\"valueOf(int i)方法\"></a>valueOf(int i)方法</h2><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Returns an &#123;<span class=\"doctag\">@code</span> Integer&#125; instance representing the specified</span></span><br><span class=\"line\"><span class=\"comment\"> * &#123;<span class=\"doctag\">@code</span> int&#125; value.  If a new &#123;<span class=\"doctag\">@code</span> Integer&#125; instance is not</span></span><br><span class=\"line\"><span class=\"comment\"> * required, this method should generally be used in preference to</span></span><br><span class=\"line\"><span class=\"comment\"> * the constructor &#123;<span class=\"doctag\">@link</span> #Integer(int)&#125;, as this method is likely</span></span><br><span class=\"line\"><span class=\"comment\"> * to yield significantly better space and time performance by</span></span><br><span class=\"line\"><span class=\"comment\"> * caching frequently requested values.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * This method will always cache values in the range -128 to 127,</span></span><br><span class=\"line\"><span class=\"comment\"> * inclusive, and may cache other values outside of this range.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  i an &#123;<span class=\"doctag\">@code</span> int&#125; value.</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> an &#123;<span class=\"doctag\">@code</span> Integer&#125; instance representing &#123;<span class=\"doctag\">@code</span> i&#125;.</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span>  1.5</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@HotSpotIntrinsicCandidate</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Integer <span class=\"title function_\">valueOf</span><span class=\"params\">(<span class=\"type\">int</span> i)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> IntegerCache.cache[i + (-IntegerCache.low)];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(i);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>建议使用此方法的原因，在注释中有给出：</p>\n<blockquote>\n<p>as this method is likely to yield significantly better space and time performance by caching frequently requested values.</p>\n</blockquote>\n<p>因为通过利用缓存的值，此方法可能会显著优化空间和时间性能。</p>\n<h2 id=\"IntegerCache\"><a href=\"#IntegerCache\" class=\"headerlink\" title=\"IntegerCache\"></a>IntegerCache</h2><p>IntegerCache是Integer的一个静态私有类，主要是存储了一个Integer数组，默认存储值在[-128, 127]的Integer实例。结合上一节，使用Integer valueOf(int i) 方法的时候，i如果在范围内，直接拿相应的对象，所以相同的值就是同一个对象了。不在范围内再使用new实例化。</p>\n<p>其中存储范围的最大值，可以手动修改<code>-XX:AutoBoxCacheMax=&lt;size&gt;</code>配置项进行设置。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Cache to support the object identity semantics of autoboxing for values between</span></span><br><span class=\"line\"><span class=\"comment\"> * -128 and 127 (inclusive) as required by JLS.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * The cache is initialized on first usage.  The size of the cache</span></span><br><span class=\"line\"><span class=\"comment\"> * may be controlled by the &#123;<span class=\"doctag\">@code</span> -XX:AutoBoxCacheMax=&lt;size&gt;&#125; option.</span></span><br><span class=\"line\"><span class=\"comment\"> * During VM initialization, java.lang.Integer.IntegerCache.high property</span></span><br><span class=\"line\"><span class=\"comment\"> * may be set and saved in the private system properties in the</span></span><br><span class=\"line\"><span class=\"comment\"> * jdk.internal.misc.VM class.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">IntegerCache</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">low</span> <span class=\"operator\">=</span> -<span class=\"number\">128</span>;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> high;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Integer cache[];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// high value may be configured by property</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">h</span> <span class=\"operator\">=</span> <span class=\"number\">127</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">integerCacheHighPropValue</span> <span class=\"operator\">=</span></span><br><span class=\"line\">            VM.getSavedProperty(<span class=\"string\">&quot;java.lang.Integer.IntegerCache.high&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (integerCacheHighPropValue != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> parseInt(integerCacheHighPropValue);</span><br><span class=\"line\">                i = Math.max(i, <span class=\"number\">127</span>);</span><br><span class=\"line\">                <span class=\"comment\">// Maximum array size is Integer.MAX_VALUE</span></span><br><span class=\"line\">                h = Math.min(i, Integer.MAX_VALUE - (-low) -<span class=\"number\">1</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span>( NumberFormatException nfe) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// If the property cannot be parsed into an int, ignore it.</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        high = h;</span><br><span class=\"line\"></span><br><span class=\"line\">        cache = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>[(high - low) + <span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> low;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> <span class=\"variable\">k</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; k &lt; cache.length; k++)</span><br><span class=\"line\">            cache[k] = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(j++);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// range [-128, 127] must be interned (JLS7 5.1.7)</span></span><br><span class=\"line\">        <span class=\"keyword\">assert</span> IntegerCache.high &gt;= <span class=\"number\">127</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">IntegerCache</span><span class=\"params\">()</span> &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","tags":["Java"]},{"title":"单例模式","url":"/%E7%AC%94%E8%AE%B0/Java/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/","content":"<h2 id=\"单例模式\"><a href=\"#单例模式\" class=\"headerlink\" title=\"单例模式\"></a>单例模式</h2><p>保证一个类仅有一个实例，并提供一个访问它的全局访问点。</p>\n<p>实现方式通常是：将构造函数私有化，创建一个静态变量持有自己的实例，然后通过这个静态变量对外提供实例的访问。</p>\n<h2 id=\"几种具体的实现方式\"><a href=\"#几种具体的实现方式\" class=\"headerlink\" title=\"几种具体的实现方式\"></a>几种具体的实现方式</h2><h3 id=\"饿汉式\"><a href=\"#饿汉式\" class=\"headerlink\" title=\"饿汉式\"></a>饿汉式</h3><p>类加载后立即创建实例，无论实例是否有被访问。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Java</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Singleton</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Singleton instance;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Singleton <span class=\"title function_\">getInstance</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">Singleton</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        instance = <span class=\"keyword\">new</span> <span class=\"title class_\">Singleton</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"懒汉式\"><a href=\"#懒汉式\" class=\"headerlink\" title=\"懒汉式\"></a>懒汉式</h3><p>类加载后不创建实例，直到实例被访问前才开始创建。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Java</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Singleton</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Singleton instance;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Singleton <span class=\"title function_\">getInstance</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == instance) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (Singleton.class) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == instance) &#123; <span class=\"comment\">// 双重校验</span></span><br><span class=\"line\">                    instance = <span class=\"keyword\">new</span> <span class=\"title class_\">Singleton</span>();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">Singleton</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>因为可能会有多个线程在synchronized语句块前排队，所以语句块中不能直接创建对象以免重复。</p>\n<p>但这种方式仍不是线程安全的，原因在于实例化对象<code>instance = new Singleton();</code>的语句中。</p>\n<p>这个语句大致有三个步骤：</p>\n<ol>\n<li>在堆中开辟对象所需空间，分配地址</li>\n<li>根据类加载的初始化顺序进行初始化</li>\n<li>将内存地址返回给栈中的引用变量</li>\n</ol>\n<p>由于 Java 内存模型允许“无序写入”，有些编译器因为性能原因，可能会把上述步骤中的 2 和 3 进行重排序，顺序就成了</p>\n<ol>\n<li>在堆中开辟对象所需空间，分配地址</li>\n<li>将内存地址返回给栈中的引用变量（此时变量已不在为null，但是变量却并没有初始化完成）</li>\n<li>根据类加载的初始化顺序进行初始化</li>\n</ol>\n<p>即实例化操作并非一个原子操作，还是有可能重复创建对象。</p>\n<p>可以给 instance 变量加个 volatile 关键字禁止重排序。</p>\n<h3 id=\"内部静态类\"><a href=\"#内部静态类\" class=\"headerlink\" title=\"内部静态类\"></a>内部静态类</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Java</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Singleton</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SingletonInstance</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">Singleton</span> <span class=\"variable\">instance</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Singleton</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Singleton <span class=\"title function_\">getInstance</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> SingletonInstance.instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">Singleton</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>能够延迟加载且效率也高，比较推荐的一种方式。</p>\n<h2 id=\"Unity的MonoBehavior单例\"><a href=\"#Unity的MonoBehavior单例\" class=\"headerlink\" title=\"Unity的MonoBehavior单例\"></a>Unity的MonoBehavior单例</h2><p>找到的一个比较好的实现</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// C#</span></span><br><span class=\"line\"><span class=\"keyword\">using</span> UnityEngine;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title\">SingletonMono</span>&lt;<span class=\"title\">T</span>&gt; : <span class=\"title\">MonoBehaviour</span> <span class=\"keyword\">where</span> <span class=\"title\">T</span> : <span class=\"title\">MonoBehaviour</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> T _instance;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"built_in\">object</span> _lock = <span class=\"keyword\">new</span> <span class=\"built_in\">object</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> T Instance &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (applicationIsQuitting) &#123;</span><br><span class=\"line\">                Debug.LogWarning(<span class=\"string\">&quot;[Singleton] Instance &#x27;&quot;</span> + <span class=\"keyword\">typeof</span>(T) +</span><br><span class=\"line\">                                 <span class=\"string\">&quot;&#x27; already destroyed on application quit.&quot;</span> +</span><br><span class=\"line\">                                 <span class=\"string\">&quot; Won&#x27;t create again - returning null.&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">lock</span> (_lock) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (_instance == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    _instance = (T)FindObjectOfType(<span class=\"keyword\">typeof</span>(T));</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (FindObjectsOfType(<span class=\"keyword\">typeof</span>(T)).Length &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                        Debug.LogError(<span class=\"string\">&quot;[Singleton] Something went really wrong &quot;</span> +</span><br><span class=\"line\">                                       <span class=\"string\">&quot; - there should never be more than 1 singleton!&quot;</span> +</span><br><span class=\"line\">                                       <span class=\"string\">&quot; Reopening the scene might fix it.&quot;</span>);</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> _instance;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (_instance == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        GameObject singletonPrefab = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        GameObject singleton = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"comment\">// Check if exists a singleton prefab on Resources Folder.</span></span><br><span class=\"line\">                        <span class=\"comment\">// -- Prefab must have the same name as the Singleton SubClass</span></span><br><span class=\"line\">                        singletonPrefab =</span><br><span class=\"line\">                            (GameObject)Resources.Load(<span class=\"string\">&quot;Prefabs/&quot;</span> + <span class=\"keyword\">typeof</span>(T).ToString(), <span class=\"keyword\">typeof</span>(GameObject));</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"comment\">// Create singleton as new or from prefab</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (singletonPrefab != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                            singleton = Instantiate(singletonPrefab);</span><br><span class=\"line\">                            _instance = singleton.GetComponent&lt;T&gt;();</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            singleton = <span class=\"keyword\">new</span> GameObject();</span><br><span class=\"line\">                            _instance = singleton.AddComponent&lt;T&gt;();</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                        singleton.name = <span class=\"string\">&quot;(singleton) &quot;</span> + <span class=\"keyword\">typeof</span>(T).ToString();</span><br><span class=\"line\"></span><br><span class=\"line\">                        DontDestroyOnLoad(singleton);</span><br><span class=\"line\"></span><br><span class=\"line\">                        Debug.Log(<span class=\"string\">&quot;[Singleton] An instance of &quot;</span> + <span class=\"keyword\">typeof</span>(T) +</span><br><span class=\"line\">                                  <span class=\"string\">&quot; is needed in the scene, so &#x27;&quot;</span> + singleton +</span><br><span class=\"line\">                                  <span class=\"string\">&quot;&#x27; was created with DontDestroyOnLoad.&quot;</span>);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        Debug.Log(<span class=\"string\">&quot;[Singleton] Using instance already created: &quot;</span> +</span><br><span class=\"line\">                                  _instance.gameObject.name);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> _instance;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"built_in\">bool</span> applicationIsQuitting = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> When Unity quits, it destroys objects in a random order.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> In principle, a Singleton is only destroyed when application quits.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> If any script calls Instance after it have been destroyed, </span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span>   it will create a buggy ghost object that will stay on the Editor scene</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span>   even after stopping playing the Application. Really bad!</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> So, this was made to be sure we&#x27;re not creating that buggy ghost object.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">OnDestroy</span>()</span> &#123;</span><br><span class=\"line\">        applicationIsQuitting = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Awake</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_instance != <span class=\"literal\">null</span> &amp;&amp; _instance != <span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">            Destroy(<span class=\"keyword\">this</span>.gameObject);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            Init();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        DontDestroyOnLoad(<span class=\"keyword\">this</span>.gameObject);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">Init</span>()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>某天在GitHub上闲逛，看到了一个<a href=\"https://github.com/UnityCommunity/UnitySingleton\">Unity社区的实现方式</a>。</p>\n<p>运行在引擎下，创建单例时需要多考虑一些事情，例如游戏是否正在退出的判断，场景切换时的影响。以及此处有一个Resources.Load先尝试从预制件中加载单例物体的功能。</p>\n<p>单例的优点就是它的缺点：全局可访问。这让获取实例对象无比方便，也容易让人忽视项目的整体结构，以及各个组件的层次和依赖关系，工程容易变乱。一般的解决方案是使用IOC容器管理单例，会改善一些，而这个，又是后话了。</p>\n","categories":["设计模式"],"tags":["C#","Java"]},{"title":"工厂模式","url":"/%E7%AC%94%E8%AE%B0/Java/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>场景：吃苹果</p>\n<p>谁想吃苹果，需要自己种苹果树。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">adamDo</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    <span class=\"type\">Fruit</span> <span class=\"variable\">fruit</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Apple</span>();</span><br><span class=\"line\">    fruit.draw();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">bobDo</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    <span class=\"type\">Fruit</span> <span class=\"variable\">fruit</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Apple</span>();</span><br><span class=\"line\">    fruit.draw();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用者需要自己负责new Apple()</li>\n<li>使用者需要管理果树，即Apple()类</li>\n<li>使用者需要知晓Apple实例化时的各项参数含义，如Apple(String name, int price);</li>\n</ul>\n<h2 id=\"简单工厂模式\"><a href=\"#简单工厂模式\" class=\"headerlink\" title=\"简单工厂模式\"></a>简单工厂模式</h2><p>工厂模式的基础。</p>\n<p>由园丁管理果园，使用者向果园（工厂）请求水果，得到返回的对象。</p>\n<ol>\n<li>将对象的创建和使用分开</li>\n<li>将生产过程集中后，便于集中管理（增删改）</li>\n<li>当水果类再有变动时，使用者不需要再去修改代码了</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 简单工厂模式——静态工厂模式</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">StaticFactory</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">TYPE_APPLE</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">TYPE_ORANGE</span> <span class=\"operator\">=</span> <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Fruit <span class=\"title function_\">getFruit</span><span class=\"params\">(<span class=\"type\">int</span> type)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(TYPE_APPLE == type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Apple</span>();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(TYPE_ORANGE == type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Orange</span>(<span class=\"string\">&quot;橘子&quot;</span>, <span class=\"number\">80</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 多方法工厂，方法含义更准确</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Fruit <span class=\"title function_\">getFruitApple</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Apple</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Fruit <span class=\"title function_\">getFruitOrange</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Orange</span>(<span class=\"string\">&quot;橘子&quot;</span>, <span class=\"number\">80</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用者使用</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">adamDo</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    <span class=\"type\">Fruit</span> <span class=\"variable\">fruit</span> <span class=\"operator\">=</span> StaticFactory.getFruit(StaticFactory.TYPE_APPLE);</span><br><span class=\"line\">    fruit.draw();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">bobDo</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    <span class=\"type\">Fruit</span> <span class=\"variable\">fruit</span> <span class=\"operator\">=</span> StaticFactory.getFruitOrange();</span><br><span class=\"line\">    fruit.draw();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当新增水果类型时，只需改造StaticFactory类的代码即可。使用者对于水果类的使用方式无需再做改变。</p>\n<h2 id=\"工厂方法模式\"><a href=\"#工厂方法模式\" class=\"headerlink\" title=\"工厂方法模式\"></a>工厂方法模式</h2><p>在简单工厂模式中，随着需要实例化的对象类型越来越多（果园生产的水果种类越来越多），工厂类会变得越来越难以管理，方法扩展其为庞大，水果品种的扩展方式不优雅。</p>\n<p>简单工厂模式实际上<br>不符合单一职责原则，一个类负责了各类对象的创建。<br>不符合开闭原则，扩展品类时，需要修改已有代码。</p>\n<ul>\n<li>为了弥补这种扩展性，在工厂方法模式中，将工厂方法抽象出来，变成单独的接口。</li>\n<li>工厂类结构与产品类结构一一对应，每一种产品都对应一个工厂子类。</li>\n<li>当新增一个产品类型时，新加对应的工厂子类即可，不需要修改既有类。</li>\n</ul>\n<p>跟简单静态工厂模式相比，工厂类膨胀太多，需要根据需求取舍。</p>\n<p>对于之前的例子来说，就是</p>\n<ul>\n<li>将静态工厂打散，每一个水果品类，对应一个水果品类工厂来生产。</li>\n<li>当需要扩展张水果品类时，对应扩展一个水果品类的工厂。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 工厂方法接口</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">FruitFactory</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> Fruit <span class=\"title function_\">getFruit</span><span class=\"params\">()</span>; <span class=\"comment\">// 摘水果指令</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>实现具体工厂</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 工厂方法模式</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppleFactory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">FruitFactory</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> Fruit <span class=\"title function_\">getFruit</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Apple</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OrangeFactory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">FruitFactory</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> Fruit <span class=\"title function_\">getFruit</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Orange</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用者使用</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> FruitFactory fruitFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span>&#123;</span><br><span class=\"line\">    fruitFactory = <span class=\"keyword\">new</span> <span class=\"title class_\">OrangeFactory</span>(); <span class=\"comment\">// Spring里实例化一般是读XML文件自动装配的，即在fruitFactory前@Autowired</span></span><br><span class=\"line\">    <span class=\"type\">Fruit</span> <span class=\"variable\">fruit</span> <span class=\"operator\">=</span> fruitFactory.getFruit();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"抽象工厂模式\"><a href=\"#抽象工厂模式\" class=\"headerlink\" title=\"抽象工厂模式\"></a>抽象工厂模式</h2><p>当一个类别的产品还有多个系列区分时，为了按系列生产产品，使用抽象工厂区分。</p>\n<p>当有多个工厂，且工厂之间有对应关系时，此对应关系也需要维护。</p>\n<p>例如水果工厂类，和水果包装的工厂类，需要一一对应。如果人工维护可能出错，苹果用了香蕉的包装。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> FruitFactory fruitFactory;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> BagFactory bagFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">pack</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    fruitFactory = <span class=\"keyword\">new</span> <span class=\"title class_\">AppleFactory</span>(); <span class=\"comment\">// 实例化苹果工厂</span></span><br><span class=\"line\">    <span class=\"type\">Fruit</span> <span class=\"variable\">fruit</span> <span class=\"operator\">=</span> fruitFactory.getFruit();</span><br><span class=\"line\">    fruit.draw();</span><br><span class=\"line\"></span><br><span class=\"line\">    bagFactory = <span class=\"keyword\">new</span> <span class=\"title class_\">OrangeBagFactory</span>(); <span class=\"comment\">// 实例化橘子包装工厂</span></span><br><span class=\"line\">    <span class=\"type\">Bag</span> <span class=\"variable\">bag</span> <span class=\"operator\">=</span> bagFactory.getBag();</span><br><span class=\"line\"></span><br><span class=\"line\">    bag.pack(fruit); <span class=\"comment\">// 苹果使用了橘子的包装</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>为了解决上述问题，可使用抽象工厂模式，将多个工厂合并成一个。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AbstractFactory</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> Fruit <span class=\"title function_\">getFruit</span><span class=\"params\">()</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> Bag <span class=\"title function_\">getBag</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppleFactory</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractFactory</span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Fruit <span class=\"title function_\">getFruit</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Apple</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Bag <span class=\"title function_\">getBag</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AppleBag</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如此，使用者只需要实例化一个AppleFactory就可以完整正确的包装了。</p>\n<h2 id=\"建造者模式\"><a href=\"#建造者模式\" class=\"headerlink\" title=\"建造者模式\"></a>建造者模式</h2><p>建造者模式本质上也是一种工厂。</p>\n<p>水果店推出水果套餐。需要为套餐建立对象，例如节假日套餐，会员套餐等。为各水果类设置价格并设置折扣。</p>\n<p>需要建造的对象较为复杂，但步骤也比较固定，都是 客户下订单-设置苹果加个-设置香蕉价格-设置橘子价格-设置折扣-结算。可以使用建造者模式。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Builder</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">buildApple</span><span class=\"params\">(<span class=\"type\">int</span> price)</span>; <span class=\"comment\">// 设置苹果</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">buildBanana</span><span class=\"params\">(<span class=\"type\">int</span> price)</span>; <span class=\"comment\">// 设置香蕉</span></span><br><span class=\"line\"></span><br><span class=\"line\">    FruitMeal <span class=\"title function_\">getFruitMeal</span><span class=\"params\">()</span>; <span class=\"comment\">// 返回创建的套餐</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建一个具体实现类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HolidayBuilder</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Builder</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">FruitMeal</span> <span class=\"variable\">fruitMeal</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FruitMeal</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">buildApple</span><span class=\"params\">(<span class=\"type\">int</span> price)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Apple</span> <span class=\"variable\">apple</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Apple</span>();</span><br><span class=\"line\">        apple.setPrice(price);</span><br><span class=\"line\">        fruitMeal.setApple(apple);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">builderBanana</span><span class=\"params\">(<span class=\"type\">int</span> price)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Banana</span> <span class=\"variable\">banana</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Banana</span>();</span><br><span class=\"line\">        banana.setPrice(price);</span><br><span class=\"line\">        fruitMeal.setBanana(banana);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> FruitMeal <span class=\"title function_\">getFruitMeal</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        fruitMeal.setDiscount(<span class=\"number\">15</span>); <span class=\"comment\">// 折扣价格对于一个套餐是固定的，直接硬编码</span></span><br><span class=\"line\">        fruitMeal.init();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fruitMeal;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FruitMeal</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Apple apple;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Banana banana;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> discount;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> totalPrice;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setApple</span><span class=\"params\">(Apple apple)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.apple = apple;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setBanana</span><span class=\"params\">(Banana banana)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.banana = banana;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setDiscount</span><span class=\"params\">(<span class=\"type\">int</span> discount)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.discount = discount;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">cost</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.totalPrice;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">init</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> != apple) &#123;</span><br><span class=\"line\">            totalPrice += apple.price();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> != banana) &#123;</span><br><span class=\"line\">            totalPrice += banana.price();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (totalPrice &gt; <span class=\"number\">0</span>) &#123; <span class=\"comment\">// 请忽略这个逻辑</span></span><br><span class=\"line\">            totalPrice -= discount;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FruitMealController</span> &#123; <span class=\"comment\">// 收银台，导演类</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">construct</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Builder</span> <span class=\"variable\">builder</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HolidayBuilder</span>();</span><br><span class=\"line\">        <span class=\"comment\">//Builder builder = new OldCustomerBuilder(); // 可以选择其他的套餐</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 以下代码模板，不会轻易改变</span></span><br><span class=\"line\">        builder.buildApple(<span class=\"number\">100</span>); <span class=\"comment\">// 设置苹果价格</span></span><br><span class=\"line\">        builder.buildBanana(<span class=\"number\">80</span>); <span class=\"comment\">// 设置香蕉价格</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">FruitMeal</span> <span class=\"variable\">fruitMeal</span> <span class=\"operator\">=</span> builder.getFruitMeal();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">cost</span> <span class=\"operator\">=</span> fruitMeal.cost();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;本套餐花费：&quot;</span> + cost);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>导演类 实例化 建造者，建造者 接收信息 装配对象 并返回，导演类拿到对象使用。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>原则：</p>\n<ol>\n<li>解耦。将对象的创建和使用分开。</li>\n<li>将创建过程黑盒化。工厂负责对象的创建，包括其初始化方法的调用。</li>\n<li>面向接口编程。使用者只需知其接口，不需知其实现类。</li>\n</ol>\n<p>对比：</p>\n<ul>\n<li>静态工厂模式。将所有对象的创建逻辑集中到一个类中处理。</li>\n<li>工厂方法模式。一个工厂负责创建一个产品类的创建。</li>\n<li>抽象工厂模式。将一个系列产品的工厂合并成一个工厂，负责生产这个系列的产品。</li>\n<li>建造者模式。对象的创建比较复杂时，按照步骤逐个创建对象进行装配，并让创建过程模板化。</li>\n</ul>\n","categories":["设计模式"],"tags":["Java"]},{"title":"设计模式六大原则","url":"/%E7%AC%94%E8%AE%B0/Java/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99/","content":"<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><ul>\n<li>创建型模式<ul>\n<li>静态工厂模式</li>\n<li>工厂方法模式</li>\n<li>抽象工厂模式</li>\n<li>单例模式</li>\n<li>建造者模式</li>\n</ul>\n</li>\n<li>结构型模式<ul>\n<li>桥接模式</li>\n<li>适配器模式</li>\n<li>装饰器模式</li>\n<li>代理模式</li>\n<li>组合模式</li>\n</ul>\n</li>\n<li>行为型模式<ul>\n<li>模板方法模式</li>\n<li>策略模式</li>\n<li>观察者模式</li>\n<li>责任链模式</li>\n<li>命令模式</li>\n<li>访问者模式</li>\n</ul>\n</li>\n</ul>\n<p>设计模式是解决问题的思想。更重要的是思想，而非具体的代码实现。</p>\n<h2 id=\"设计模式六大原则\"><a href=\"#设计模式六大原则\" class=\"headerlink\" title=\"设计模式六大原则\"></a>设计模式六大原则</h2><h3 id=\"单一职责原则\"><a href=\"#单一职责原则\" class=\"headerlink\" title=\"单一职责原则\"></a>单一职责原则</h3><p>一个类只负责一项职责。</p>\n<p>例如负责用户业务逻辑的类，使用UserController；负责订单逻辑的类，使用OrderController 。而不要合在一起。</p>\n<h3 id=\"里氏替换原则\"><a href=\"#里氏替换原则\" class=\"headerlink\" title=\"里氏替换原则\"></a>里氏替换原则</h3><p>子类可以扩展父类的功能，但不要改变父类原有的功能。</p>\n<p>例如UserServiceImpl类中有getDetail方法获取用户信息。如果此时有子类VIPUserServiceImpl继承了前类，则最好新建另外的方法获取VIP用户信息（不同逻辑），例如getVIPDetail。尽量<strong>不要</strong>重写父类原有的getDetail方法。</p>\n<h3 id=\"依赖倒置原则\"><a href=\"#依赖倒置原则\" class=\"headerlink\" title=\"依赖倒置原则\"></a>依赖倒置原则</h3><p>面向接口编程。</p>\n<p>将变化可能性较小的功能抽象为接口。</p>\n<h3 id=\"接口隔离原则\"><a href=\"#接口隔离原则\" class=\"headerlink\" title=\"接口隔离原则\"></a>接口隔离原则</h3><p>尽量设计最小功能接口。</p>\n<p>例如调用接口的时候，想使用某个实现类特有的方法，但接口没有，调不到。此时可以照着这个实现类摁造一个接口，换用新的接口。</p>\n<h3 id=\"迪米特法则\"><a href=\"#迪米特法则\" class=\"headerlink\" title=\"迪米特法则\"></a>迪米特法则</h3><p>降低耦合。局部变量中，不要引入新的类。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserController</span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">func</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">OrderService</span> <span class=\"variable\">orderService</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">OrderServiceImpl</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在实例方法func中，引用OrderService，新增了依赖，但这种依赖从类的外部无法感知到。可以将其改为成员变量。</p>\n<h3 id=\"开闭原则\"><a href=\"#开闭原则\" class=\"headerlink\" title=\"开闭原则\"></a>开闭原则</h3><p>对扩展开放，对修改关闭。</p>\n<p>例如想在代码中添加产品业务逻辑。可以直接新增业务处理的接口和类，最好不要修改已有代码的内容。</p>\n","categories":["设计模式"],"tags":["Java"]},{"title":"Maven中的type标签","url":"/%E7%AC%94%E8%AE%B0/Java/Others/Maven%E4%B8%AD%E7%9A%84type%E6%A0%87%E7%AD%BE/","content":"<h2 id=\"问题背景\"><a href=\"#问题背景\" class=\"headerlink\" title=\"问题背景\"></a>问题背景</h2><p>平常使用Maven，在pom.xml中引入包时，一般的dependency标签仅包括groupId、artifactId、version三个子标签</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>但有次不知从哪里复制来的log4j坐标，多了一个type标签，导致报错</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.17<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>bundle<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"问题原因\"><a href=\"#问题原因\" class=\"headerlink\" title=\"问题原因\"></a>问题原因</h2><p>查找Maven的<a href=\"https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism\">官方文档</a>，其对于type标签的描述出现在一个用例中，具体如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>group-c<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>artifact-b<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- This is not a jar dependency, so we must specify type. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>war<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>group-a<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>artifact-b<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- This is not a jar dependency, so we must specify type. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>bar<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>NOTE: In two of these dependency references, we had to specify the &lt;type&#x2F;&gt; element. This is because the minimal set of information for matching a dependency reference against a dependencyManagement section is actually {groupId, artifactId, type, classifier}. In many cases, these dependencies will refer to jar artifacts with no classifier. This allows us to shorthand the identity set to {groupId, artifactId}, since the default for the type field is jar, and the default classifier is null.</p>\n</blockquote>\n<blockquote>\n<p>注：在使用上述两个依赖引用时，我们必须指定&lt;type&#x2F;&gt;元素。这是因为根据dependencyManagement标签匹配依赖引用的最小信息集实际上是{groupId，artifactId，type，classifier}。在许多情况下，这些依赖项将引用没有classifier的jar构件。这使得我们可以将identity设置为{groupId，artifactId}，因为type字段的默认值是jar，而默认的classifier是null。</p>\n</blockquote>\n<p>简化一下：dependency的坐标由{groupId，artifactId，type，classifier}四项组成。平时基本不指定type和classifier，因为它们都有默认值。而遇到type不是默认值jar的dependency则需要显式指定。</p>\n<p><code>&lt;type&gt;bundle&lt;/type&gt;</code> 的含义，另找到资料：bundle是OSGI中的依赖单元，是一种特殊格式的jar，OSGI的核心框架实现了一个优雅、完整和动态的组件模型。应用程序（称为bundle）无需重新引导可以被远程安装、启动、升级和卸载。</p>\n<p>如果要在maven中使用这种功能的话，需要引入 maven-bundle-plugin 插件，不过当时的工程也没用到这个，只是将type标签删去，当做普通jar引入就可以了。</p>\n","categories":["Maven"],"tags":["Java"]},{"title":"BeanFactory的后置处理器","url":"/%E7%AC%94%E8%AE%B0/Java/Spring/BeanFactory%E5%90%8E%E7%BD%AE%E5%A4%84%E7%90%86%E5%99%A8/","content":"<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>补充解释两个Spring组件。</p>\n<ul>\n<li>BeanFactoryPostProcessor：BeanFactory的后置处理器</li>\n<li>BeanDefinitionRegistryPostProcessor：Bean定义的后置处理器</li>\n</ul>\n<h2 id=\"BeanFactoryPostProcessor\"><a href=\"#BeanFactoryPostProcessor\" class=\"headerlink\" title=\"BeanFactoryPostProcessor\"></a>BeanFactoryPostProcessor</h2><p>预先处理 BeanFactory。</p>\n<p>回顾Bean的生命周期：</p>\n<p>BeanFactoryPostProcessor -&gt; 代码块 -&gt; 实例化 -&gt; 数据装配 -&gt; 初始化方法之前 -&gt; 初始化方法 -&gt; 初始化方法之后  -&gt; 使用 -&gt; 销毁方法 -&gt; 在容器中销毁。</p>\n<p>BeanFactoryPostProcessor是在所有Bean实例化前就执行了；而普通BeanPostProcessor是在每个Bean实例化后，执行初始化前后执行。</p>\n<h3 id=\"Hello-World\"><a href=\"#Hello-World\" class=\"headerlink\" title=\"Hello World\"></a>Hello World</h3><p>创建BeanFactoryPostProcessor</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyBeanFactoryPostProcessor</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">BeanFactoryPostProcessor</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">postProcessBeanFactory</span><span class=\"params\">(ConfigurableListableBeanFactory beanFactory)</span> <span class=\"keyword\">throws</span> BeansException &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> beanFactory.getBeanDefinitionCount();</span><br><span class=\"line\">        String[] names = beanFactory.getBeanDefinitionNames();</span><br><span class=\"line\">        </span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;There are &quot;</span> + count + <span class=\"string\">&quot; beans.&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (String name :</span><br><span class=\"line\">                names) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;...&quot;</span> + name);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>自定义一个Bean意思一下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Computer</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Computer</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Computer class constructor...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后配置类中引入组件，测试类中加载IOC容器。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">There are 8 beans.</span><br><span class=\"line\">...org.springframework.context.annotation.internalConfigurationAnnotationProcessor</span><br><span class=\"line\">...org.springframework.context.annotation.internalAutowiredAnnotationProcessor</span><br><span class=\"line\">...org.springframework.context.annotation.internalCommonAnnotationProcessor</span><br><span class=\"line\">...org.springframework.context.event.internalEventListenerProcessor</span><br><span class=\"line\">...org.springframework.context.event.internalEventListenerFactory</span><br><span class=\"line\">...testConfigCap12</span><br><span class=\"line\">...computer</span><br><span class=\"line\">...myBeanFactoryPostProcessor</span><br><span class=\"line\">Computer class constructor...</span><br></pre></td></tr></table></figure>\n\n<p>可以看到先执行 BeanFactoryPostProcessor 再实例化各个Bean</p>\n<img src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjI5MnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6OTE2cHg7aGVpZ2h0OjI5MnB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDkxNiAyOTIiIHdpZHRoPSI5MTZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxnPjx0aXRsZT5hY3Rpb248L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSIyMjAuOTI5NyIgd2lkdGg9IjgiIHg9IjI5LjU0NjkiIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSIzMyIgeDI9IjMzIiB5MT0iMzYuMjk2OSIgeTI9IjI1Ny4yMjY2Ii8+PC9nPjxnPjx0aXRsZT5Bbm5vdGF0aW9uQ29uZmlnQXBwbGljYXRpb25Db250ZXh0PC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iMjIwLjkyOTciIHdpZHRoPSI4IiB4PSIyMDIuNTk3NyIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjIwNi4wOTM4IiB4Mj0iMjA2LjA5MzgiIHkxPSIzNi4yOTY5IiB5Mj0iMjU3LjIyNjYiLz48L2c+PGc+PHRpdGxlPkFic3RyYWN0QXBwbGljYXRpb25Db250ZXh0PC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iMjIwLjkyOTciIHdpZHRoPSI4IiB4PSI0NTAuMTQzMSIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjQ1NC4xMDE2IiB4Mj0iNDU0LjEwMTYiIHkxPSIzNi4yOTY5IiB5Mj0iMjU3LjIyNjYiLz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtcGFydGljaXBhbnQ9ImFjdGlvbiI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1Ny4wOTM4IiB4PSI1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDMuMDkzOCIgeD0iMTIiIHk9IjI0Ljk5NTEiPmFjdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9ImFjdGlvbiI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1Ny4wOTM4IiB4PSI1IiB5PSIyNTYuMjI2NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQzLjA5MzgiIHg9IjEyIiB5PSIyNzYuMjIxNyI+YWN0aW9uPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1wYXJ0aWNpcGFudD0iQW5ub3RhdGlvbkNvbmZpZ0FwcGxpY2F0aW9uQ29udGV4dCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyNjkuMDA3OCIgeD0iNzIuMDkzOCIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI1NS4wMDc4IiB4PSI3OS4wOTM4IiB5PSIyNC45OTUxIj5Bbm5vdGF0aW9uQ29uZmlnQXBwbGljYXRpb25Db250ZXh0PC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1wYXJ0aWNpcGFudD0iQW5ub3RhdGlvbkNvbmZpZ0FwcGxpY2F0aW9uQ29udGV4dCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyNjkuMDA3OCIgeD0iNzIuMDkzOCIgeT0iMjU2LjIyNjYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNTUuMDA3OCIgeD0iNzkuMDkzOCIgeT0iMjc2LjIyMTciPkFubm90YXRpb25Db25maWdBcHBsaWNhdGlvbkNvbnRleHQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJBYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMDYuMDgzIiB4PSIzNTEuMTAxNiIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5Mi4wODMiIHg9IjM1OC4xMDE2IiB5PSIyNC45OTUxIj5BYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dDwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9IkFic3RyYWN0QXBwbGljYXRpb25Db250ZXh0Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIwNi4wODMiIHg9IjM1MS4xMDE2IiB5PSIyNTYuMjI2NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5Mi4wODMiIHg9IjM1OC4xMDE2IiB5PSIyNzYuMjIxNyI+QWJzdHJhY3RBcHBsaWNhdGlvbkNvbnRleHQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9ImFjdGlvbiIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBbm5vdGF0aW9uQ29uZmlnQXBwbGljYXRpb25Db250ZXh0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE5NC41OTc3LDYzLjQyOTcsMjA0LjU5NzcsNjcuNDI5NywxOTQuNTk3Nyw3MS40Mjk3LDE5OC41OTc3LDY3LjQyOTciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMzMuNTQ2OSIgeDI9IjIwMC41OTc3IiB5MT0iNjcuNDI5NyIgeTI9IjY3LjQyOTciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzOSIgeD0iNDAuNTQ2OSIgeT0iNjIuMzYzOCI+JiMyMzQ1NDsmIzIwMzYzOyYjMjEyNzA7PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBbm5vdGF0aW9uQ29uZmlnQXBwbGljYXRpb25Db250ZXh0IiBkYXRhLXBhcnRpY2lwYW50LTI9IkFic3RyYWN0QXBwbGljYXRpb25Db250ZXh0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ0Mi4xNDMxLDkyLjU2MjUsNDUyLjE0MzEsOTYuNTYyNSw0NDIuMTQzMSwxMDAuNTYyNSw0NDYuMTQzMSw5Ni41NjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjIwNi41OTc3IiB4Mj0iNDQ4LjE0MzEiIHkxPSI5Ni41NjI1IiB5Mj0iOTYuNTYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNy4yNzQ1IiB4PSIyMTMuNTk3NyIgeT0iOTEuNDk2NiI+JiMyNTE5MTsmIzM0ODkyOyYjMjkyMzg7JiMzMTg2NzsmIzMwMzQwO3JlZnJlc2gmIzI2MDQxOyYjMjc4NjE7PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dCIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dCI+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQ1NC4xNDMxIiB4Mj0iNDk2LjE0MzEiIHkxPSIxMjkuNzYxNyIgeTI9IjEyOS43NjE3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQ5Ni4xNDMxIiB4Mj0iNDk2LjE0MzEiIHkxPSIxMjkuNzYxNyIgeTI9IjE0Mi43NjE3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQ1NS4xNDMxIiB4Mj0iNDk2LjE0MzEiIHkxPSIxNDIuNzYxNyIgeTI9IjE0Mi43NjE3Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NjUuMTQzMSwxMzguNzYxNyw0NTUuMTQzMSwxNDIuNzYxNyw0NjUuMTQzMSwxNDYuNzYxNyw0NjEuMTQzMSwxNDIuNzYxNyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyMi4zOTAxIiB4PSI0NjEuMTQzMSIgeT0iMTI0LjY5NTgiPmludm9rZUJlYW5GYWN0b3J5UG9zdFByb2Nlc3NvcnM8L3RleHQ+PC9nPjxwYXRoIGQ9Ik02OTUuMzkwMSwxMDkuNTYyNSBMNjk1LjM5MDEsMTQ5LjU2MjUgTDg4OC4zOTAxLDE0OS41NjI1IEw4ODguMzkwMSwxMTkuNTYyNSBMODc4LjM5MDEsMTA5LjU2MjUgTDY5NS4zOTAxLDEwOS41NjI1IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNODc4LjM5MDEsMTA5LjU2MjUgTDg3OC4zOTAxLDExOS41NjI1IEw4ODguMzkwMSwxMTkuNTYyNSBMODc4LjM5MDEsMTA5LjU2MjUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1LjAwMDEiIHg9IjcwMS4zOTAxIiB5PSIxMjYuNjI5NCI+JiMzNTMwMjsmIzIxNDU3OyYjMjUxNTI7JiMyNjM3NzsmIzMwMzQwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzIuNTkyOCIgeD0iNzAxLjM5MDEiIHk9IjE0MS43NjIyIj5CZWFuRmFjdG9yeVBvc3RQcm9jZXNzb3I8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQWJzdHJhY3RBcHBsaWNhdGlvbkNvbnRleHQiIGRhdGEtcGFydGljaXBhbnQtMj0iQWJzdHJhY3RBcHBsaWNhdGlvbkNvbnRleHQiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0NTQuMTQzMSIgeDI9IjQ5Ni4xNDMxIiB5MT0iMTgwLjAyNzMiIHkyPSIxODAuMDI3MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0OTYuMTQzMSIgeDI9IjQ5Ni4xNDMxIiB5MT0iMTgwLjAyNzMiIHkyPSIxOTMuMDI3MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0NTUuMTQzMSIgeDI9IjQ5Ni4xNDMxIiB5MT0iMTkzLjAyNzMiIHkyPSIxOTMuMDI3MyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDY1LjE0MzEsMTg5LjAyNzMsNDU1LjE0MzEsMTkzLjAyNzMsNDY1LjE0MzEsMTk3LjAyNzMsNDYxLjE0MzEsMTkzLjAyNzMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxODEuMTA1IiB4PSI0NjEuMTQzMSIgeT0iMTc0Ljk2MTQiPnJlZ2lzdGVyQmVhblBvc3RQcm9jZXNzb3JzPC90ZXh0PjwvZz48cGF0aCBkPSJNNjU0LjEwNSwxNTkuODI4MSBMNjU0LjEwNSwxOTkuODI4MSBMOTA5LjEwNSwxOTkuODI4MSBMOTA5LjEwNSwxNjkuODI4MSBMODk5LjEwNSwxNTkuODI4MSBMNjU0LjEwNSwxNTkuODI4MSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTg5OS4xMDUsMTU5LjgyODEgTDg5OS4xMDUsMTY5LjgyODEgTDkwOS4xMDUsMTY5LjgyODEgTDg5OS4xMDUsMTU5LjgyODEiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIzNC4wMDAzIiB4PSI2NjAuMTA1IiB5PSIxNzYuODk1Ij4mIzIwMDQzOyYjMjEwNjk7JiMyNTU1MjsmIzM2ODA3OyYjMzAzNDA7JiM2NTI5MjsmIzI3ODgwOyYjMjA4NzY7JiM2NTI4ODsmIzI0MjEyOyYjMzU4MTM7JiMyMDA2MzsmIzIxMjUzOyYjMjE1NDc7JiMyMzQ1NDsmIzIwMzYzOyYjMjEyNzA7JiM2NTI4OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTYyLjkxMjYiIHg9IjY2MC4xMDUiIHk9IjE5Mi4wMjc4Ij5CZWFuUG9zdFByb2Nlc3NvciYjMzAzNDA7JiMyMjMyMDsmIzI2MDQxOzwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dCIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dCI+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQ1NC4xNDMxIiB4Mj0iNDk2LjE0MzEiIHkxPSIyMjYuMjI2NiIgeTI9IjIyNi4yMjY2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQ5Ni4xNDMxIiB4Mj0iNDk2LjE0MzEiIHkxPSIyMjYuMjI2NiIgeTI9IjIzOS4yMjY2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQ1NS4xNDMxIiB4Mj0iNDk2LjE0MzEiIHkxPSIyMzkuMjI2NiIgeTI9IjIzOS4yMjY2Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NjUuMTQzMSwyMzUuMjI2Niw0NTUuMTQzMSwyMzkuMjI2Niw0NjUuMTQzMSwyNDMuMjI2Niw0NjEuMTQzMSwyMzkuMjI2NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5Ni4xMjk5IiB4PSI0NjEuMTQzMSIgeT0iMjIxLjE2MDYiPmZpbmlzaEJlYW5GYWN0b3J5SW5pdGlhbGl6YXRpb248L3RleHQ+PC9nPjxwYXRoIGQ9Ik02NjkuMTI5OSwyMTMuNTkzOCBMNjY5LjEyOTksMjM4LjU5MzggTDg1My4xMjk5LDIzOC41OTM4IEw4NTMuMTI5OSwyMjMuNTkzOCBMODQzLjEyOTksMjEzLjU5MzggTDY2OS4xMjk5LDIxMy41OTM4IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNODQzLjEyOTksMjEzLjU5MzggTDg0My4xMjk5LDIyMy41OTM4IEw4NTMuMTI5OSwyMjMuNTkzOCBMODQzLjEyOTksMjEzLjU5MzgiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2My4xMjIyIiB4PSI2NzUuMTI5OSIgeT0iMjMwLjY2MDYiPiYjMjM0NTQ7JiMyMDM2MzsmIzIxMjcwOyYjMjA4NTQ7JiMyMDE4MjsmIzIxMzMzOyYjMjAzNjM7QmVhbiYjMzAzNDA7JiMyMjMyMDsmIzI2MDQxOzwvdGV4dD48IS0tU1JDPVtoUDVGSWlEMDU4VnRTdWZTbTBrdTRBZVdrRWlMT2ZtYTN5akNjSGI0TlJiZWpRNGZoTTJwYUFBdXEwZzJWb1dLT2VFekpEdWFrcnAxSVM1SWdBNFdCal9tLXR4cHlQeGpBRTNDc2pnblFlbm5QUFZKN2NTa1VCTGNpbTdFcHVFWWZzaFJtalV4ekFrQk9LR3NmblVUWHI4OXNyNl9UVWJXZDMtNE1NVVFWU29vc3ZRV2hnM0lycjZpOXFESTNNd2UxTlIyWi1ha2pUYy0yTjFuTGtUSXJHTHRnOUhTSTZBaWdJTjB5bk45bnFfT2x6UjFYSHU1SGUxS0dPSW84d2xhX2N1YmcwVElLTDUtS0lzS25icUNVaGVfb0VUTkhnWDhHWnJ2bmlrbUkzaHVVUEVfRlFSbkZPUGo3Qm1peHIwYTBMYWhESW9FdGlxY195N1MxR1JJTnJkRDBHQzVUV0ZFNXg1TF9RS0tqZ1ZmQkNCVXE4bWJrVXhwM0cwMF0tLT48L2c+PC9zdmc+'>\n\n<h2 id=\"BeanDefinitionRegistryPostProcessor\"><a href=\"#BeanDefinitionRegistryPostProcessor\" class=\"headerlink\" title=\"BeanDefinitionRegistryPostProcessor\"></a>BeanDefinitionRegistryPostProcessor</h2><p>预先处理 定义Bean 的 注册器。</p>\n<p>BeanDefinitionRegistryPostProcessor 是 BeanFactoryPostProcessor 的子接口。所以实现类需要实现 BeanDefinitionRegistryPostProcessor 的 postProcessBeanDefinitionRegistry 方法 <strong>和</strong> BeanFactoryPostProcessor 的 postProcessBeanFactory 方法。</p>\n<img src='data:image/svg+xml;base64,ZXJyb3IgY29kZTogNTIw'>\n\n<p>BeanFactoryPostProcessor 的作用是在Bean的定义信息已经加载但还未创建初始化时，执行 postProcessBeanFactory 方法。</p>\n<p>而 BeanDefinitionRegistryPostProcessor 的执行时机更早。</p>\n<h3 id=\"Hello-World-1\"><a href=\"#Hello-World-1\" class=\"headerlink\" title=\"Hello World\"></a>Hello World</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyBeanDefinitionRegistryPostProcessor</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">BeanDefinitionRegistryPostProcessor</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">postProcessBeanDefinitionRegistry</span><span class=\"params\">(BeanDefinitionRegistry registry)</span> <span class=\"keyword\">throws</span> BeansException &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> registry.getBeanDefinitionCount();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;There are &quot;</span> + count + <span class=\"string\">&quot; beans while invoking postProcessBeanDefinitionRegistry...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 继承自父接口 BeanFactoryPostProcessor</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">postProcessBeanFactory</span><span class=\"params\">(ConfigurableListableBeanFactory beanFactory)</span> <span class=\"keyword\">throws</span> BeansException &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> beanFactory.getBeanDefinitionCount();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;There are &quot;</span> + count + <span class=\"string\">&quot; beans while invoking postProcessBeanFactory...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">There are 9 beans while invoking postProcessBeanDefinitionRegistry...</span><br><span class=\"line\">There are 9 beans while invoking postProcessBeanFactory...</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<img src='data:image/svg+xml;base64,ZXJyb3IgY29kZTogNTIw'>\n","categories":["Spring"],"tags":["Java"]},{"title":"Bean的生命周期","url":"/%E7%AC%94%E8%AE%B0/Java/Spring/Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/","content":"<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>Bean的生命周期指Bean创建-&gt;初始化-&gt;销毁的过程。</p>\n<p>可以自定义Bean初始化和销毁方法。</p>\n<p>容器在Bean来到对应生命周期时，自动调用自定义的初始化或销毁方法。</p>\n<p>BeanFactoryPostProcessor -&gt; 代码块 -&gt; 实例化 -&gt; 数据装配 -&gt; 初始化方法之前 -&gt; 初始化方法 -&gt; 初始化方法之后  -&gt; 使用 -&gt; 销毁方法 -&gt; 在容器中销毁。</p>\n<h2 id=\"初始化和销毁\"><a href=\"#初始化和销毁\" class=\"headerlink\" title=\"初始化和销毁\"></a>初始化和销毁</h2><p>自定义Bean初始化和销毁方法。</p>\n<p>使用XML配置时，可在bean标签中添加 init-method 或 destroy-method 属性，来设置自定义初始化或销毁方法。</p>\n<h3 id=\"在Bean注解中显式指定\"><a href=\"#在Bean注解中显式指定\" class=\"headerlink\" title=\"在Bean注解中显式指定\"></a>在Bean注解中显式指定</h3><p>指定初始化方法，init-method；指定销毁方法，destroy-method。</p>\n<p>创建对象Bike，定义初始化和销毁方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Bike</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Bike</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Bike constructor...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">init</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Bike init...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">destroy</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Bike destroy...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在配置类中注册类中定义的初始化和销毁方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestConfigCap7</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean(initMethod = &quot;init&quot;,destroyMethod = &quot;destroy&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Bike <span class=\"title function_\">bike</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Bike</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>测试类中加载容器。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test01</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">AnnotationConfigApplicationContext</span> <span class=\"variable\">app</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AnnotationConfigApplicationContext</span>(TestConfigCap7.class);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;IOC 容器创建完成...&quot;</span>);</span><br><span class=\"line\">        app.close();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Bike constructor...</span><br><span class=\"line\">Bike init...</span><br><span class=\"line\">IOC 容器创建完成...</span><br><span class=\"line\">Bike destroy...</span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是：对于非单例的Bean，容器只负责初始化，但不会管理Bean，容器关闭时，<strong>不会调用销毁方法</strong>。</p>\n<p>在配置类中设置Bean为非单例。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Scope(&quot;prototype&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Bean(initMethod = &quot;init&quot;, destroyMethod = &quot;destroy&quot;)</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">IOC 容器创建完成...</span><br></pre></td></tr></table></figure>\n\n<p>此时连Bean的初始化都没有了，因为非单例的Bean是懒加载的，当使用的时候才会实例化。</p>\n<h3 id=\"实现特定接口\"><a href=\"#实现特定接口\" class=\"headerlink\" title=\"实现特定接口\"></a>实现特定接口</h3><p>实现 InitializingBean 接口的 afterPropertiesSet() 方法，自定义初始化工作。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">InitializingBean</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 在Bean的属性全部设置完后被调用，可用来检查Bean属性的完整和正确性。</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"keyword\">void</span> <span class=\"title function_\">afterPropertiesSet</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>实现 DisposableBean 的 destroy() 方法，自定义销毁工作。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">DisposableBean</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Bean被销毁时调用。</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"keyword\">void</span> <span class=\"title function_\">destroy</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建对象Train</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Train</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">InitializingBean</span>, DisposableBean &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Train</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Train constructor...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">afterPropertiesSet</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Train afterPropertiesSet...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">destroy</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Train destroy...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>配置类进行注册</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ComponentScan(&quot;com.example.cap7&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Train constructor...</span><br><span class=\"line\">Train afterPropertiesSet...</span><br><span class=\"line\">IOC 容器创建完成...</span><br><span class=\"line\">Train destroy...</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"JSR-250\"><a href=\"#JSR-250\" class=\"headerlink\" title=\"JSR-250\"></a>JSR-250</h3><p>来自于 javax.annotation 包的 PostConstruct 和 PreDestroy 注解。</p>\n<p>创建对象Jeep</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Jeep</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Jeep</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Jeep constructor...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PostConstruct</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">init</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Jeep @PostConstruct...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PreDestroy</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">destroy</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Jeep @PreDestroy...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在配置类中注册，启动和销毁容器</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Jeep constructor...</span><br><span class=\"line\">Jeep @PostConstruct...</span><br><span class=\"line\">IOC 容器创建完成...</span><br><span class=\"line\">Jeep @PreDestroy...</span><br></pre></td></tr></table></figure>\n\n<p>最后，测试了一下，这三种方式同时使用时，方法的执行顺序。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Jeep constructor...</span><br><span class=\"line\">Jeep @PostConstruct...</span><br><span class=\"line\">Jeep InitializingBean afterPropertiesSet...</span><br><span class=\"line\">Jeep init-Method...</span><br><span class=\"line\">IOC 容器创建完成...</span><br><span class=\"line\">Jeep @PreDestroy...</span><br><span class=\"line\">Jeep DisposableBean destroy...</span><br><span class=\"line\">Jeep destroy-Method...</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>JSR-250</li>\n<li>实现特定接口</li>\n<li>在Bean注解中显式指定</li>\n</ol>\n<h2 id=\"BeanPostProcessor\"><a href=\"#BeanPostProcessor\" class=\"headerlink\" title=\"BeanPostProcessor\"></a>BeanPostProcessor</h2><p>Bean后处理器用来对bean的功能进行扩展增强，对IoC容器中的<strong>所有bean</strong>都有效。</p>\n<p>包括Bean的赋值，注入其他组件，生命周期注解功能等。</p>\n<p>时机：执行初始化方法之前和之后</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">BeanPostProcessor</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Bean执行初始化方法之前执行</span></span><br><span class=\"line\">\t<span class=\"meta\">@Nullable</span></span><br><span class=\"line\">\t<span class=\"keyword\">default</span> Object <span class=\"title function_\">postProcessBeforeInitialization</span><span class=\"params\">(Object bean, String beanName)</span> <span class=\"keyword\">throws</span> BeansException &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> bean;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Bean执行初始化方法之后执行</span></span><br><span class=\"line\">\t<span class=\"meta\">@Nullable</span></span><br><span class=\"line\">\t<span class=\"keyword\">default</span> Object <span class=\"title function_\">postProcessAfterInitialization</span><span class=\"params\">(Object bean, String beanName)</span> <span class=\"keyword\">throws</span> BeansException &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> bean;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>普通单例Bean的创建顺序图如下：</p>\n<img src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjcwOHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTM4N3B4O2hlaWdodDo3MDhweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMzg3IDcwOCIgd2lkdGg9IjEzODdweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxnPjx0aXRsZT5BYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dDwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9IjYzNi43ODkxIiB3aWR0aD0iOCIgeD0iMTA0LjA0MTUiIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSIxMDgiIHgyPSIxMDgiIHkxPSIzNi4yOTY5IiB5Mj0iNjczLjA4NTkiLz48L2c+PGc+PHRpdGxlPkRlZmF1bHRMaXN0YWJsZUJlYW5GYWN0b3J5PC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNjM2Ljc4OTEiIHdpZHRoPSI4IiB4PSIzMjAuOTI3NyIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjMyNC4wODMiIHgyPSIzMjQuMDgzIiB5MT0iMzYuMjk2OSIgeTI9IjY3My4wODU5Ii8+PC9nPjxnPjx0aXRsZT5BYnN0cmFjdEJlYW5GYWN0b3J5PC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNjM2Ljc4OTEiIHdpZHRoPSI4IiB4PSI1MTUuMjA0MSIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjUxOC43NzI1IiB4Mj0iNTE4Ljc3MjUiIHkxPSIzNi4yOTY5IiB5Mj0iNjczLjA4NTkiLz48L2c+PGc+PHRpdGxlPkRlZmF1bHRTaW5nbGV0b25CZWFuUmVnaXN0cnk8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI2MzYuNzg5MSIgd2lkdGg9IjgiIHg9IjczOC4wODI2IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNzQxLjcxNjgiIHgyPSI3NDEuNzE2OCIgeTE9IjM2LjI5NjkiIHkyPSI2NzMuMDg1OSIvPjwvZz48Zz48dGl0bGU+T2JqZWN0RmFjdG9yeTwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9IjYzNi43ODkxIiB3aWR0aD0iOCIgeD0iOTE2LjQ1ODUiIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSI5MjAuNDQ4MyIgeDI9IjkyMC40NDgzIiB5MT0iMzYuMjk2OSIgeTI9IjY3My4wODU5Ii8+PC9nPjxnPjx0aXRsZT5BYnN0cmFjdEF1dG93aXJlQ2FwYWJsZUJlYW5GYWN0b3J5PC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNjM2Ljc4OTEiIHdpZHRoPSI4IiB4PSIxMTIyLjYxMjMiIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSIxMTI2LjQ2ODgiIHgyPSIxMTI2LjQ2ODgiIHkxPSIzNi4yOTY5IiB5Mj0iNjczLjA4NTkiLz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtcGFydGljaXBhbnQ9IkFic3RyYWN0QXBwbGljYXRpb25Db250ZXh0Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIwNi4wODMiIHg9IjUiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTIuMDgzIiB4PSIxMiIgeT0iMjQuOTk1MSI+QWJzdHJhY3RBcHBsaWNhdGlvbkNvbnRleHQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLXBhcnRpY2lwYW50PSJBYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMDYuMDgzIiB4PSI1IiB5PSI2NzIuMDg1OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5Mi4wODMiIHg9IjEyIiB5PSI2OTIuMDgxMSI+QWJzdHJhY3RBcHBsaWNhdGlvbkNvbnRleHQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJEZWZhdWx0TGlzdGFibGVCZWFuRmFjdG9yeSI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMDcuNjg5NSIgeD0iMjIxLjA4MyIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5My42ODk1IiB4PSIyMjguMDgzIiB5PSIyNC45OTUxIj5EZWZhdWx0TGlzdGFibGVCZWFuRmFjdG9yeTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9IkRlZmF1bHRMaXN0YWJsZUJlYW5GYWN0b3J5Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIwNy42ODk1IiB4PSIyMjEuMDgzIiB5PSI2NzIuMDg1OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5My42ODk1IiB4PSIyMjguMDgzIiB5PSI2OTIuMDgxMSI+RGVmYXVsdExpc3RhYmxlQmVhbkZhY3Rvcnk8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJBYnN0cmFjdEJlYW5GYWN0b3J5Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE2MC44NjMzIiB4PSI0MzguNzcyNSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0Ni44NjMzIiB4PSI0NDUuNzcyNSIgeT0iMjQuOTk1MSI+QWJzdHJhY3RCZWFuRmFjdG9yeTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9IkFic3RyYWN0QmVhbkZhY3RvcnkiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTYwLjg2MzMiIHg9IjQzOC43NzI1IiB5PSI2NzIuMDg1OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0Ni44NjMzIiB4PSI0NDUuNzcyNSIgeT0iNjkyLjA4MTEiPkFic3RyYWN0QmVhbkZhY3Rvcnk8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJEZWZhdWx0U2luZ2xldG9uQmVhblJlZ2lzdHJ5Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIyNC43MzE0IiB4PSI2MjkuNzE2OCIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxMC43MzE0IiB4PSI2MzYuNzE2OCIgeT0iMjQuOTk1MSI+RGVmYXVsdFNpbmdsZXRvbkJlYW5SZWdpc3RyeTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9IkRlZmF1bHRTaW5nbGV0b25CZWFuUmVnaXN0cnkiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjI0LjczMTQiIHg9IjYyOS43MTY4IiB5PSI2NzIuMDg1OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxMC43MzE0IiB4PSI2MzYuNzE2OCIgeT0iNjkyLjA4MTEiPkRlZmF1bHRTaW5nbGV0b25CZWFuUmVnaXN0cnk8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJPYmplY3RGYWN0b3J5Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExMi4wMjA1IiB4PSI4NjQuNDQ4MyIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk4LjAyMDUiIHg9Ijg3MS40NDgzIiB5PSIyNC45OTUxIj5PYmplY3RGYWN0b3J5PC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1wYXJ0aWNpcGFudD0iT2JqZWN0RmFjdG9yeSI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMTIuMDIwNSIgeD0iODY0LjQ0ODMiIHk9IjY3Mi4wODU5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTguMDIwNSIgeD0iODcxLjQ0ODMiIHk9IjY5Mi4wODExIj5PYmplY3RGYWN0b3J5PC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1wYXJ0aWNpcGFudD0iQWJzdHJhY3RBdXRvd2lyZUNhcGFibGVCZWFuRmFjdG9yeSI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyODAuMjg3MSIgeD0iOTg2LjQ2ODgiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNjYuMjg3MSIgeD0iOTkzLjQ2ODgiIHk9IjI0Ljk5NTEiPkFic3RyYWN0QXV0b3dpcmVDYXBhYmxlQmVhbkZhY3Rvcnk8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLXBhcnRpY2lwYW50PSJBYnN0cmFjdEF1dG93aXJlQ2FwYWJsZUJlYW5GYWN0b3J5Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI4MC4yODcxIiB4PSI5ODYuNDY4OCIgeT0iNjcyLjA4NTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNjYuMjg3MSIgeD0iOTkzLjQ2ODgiIHk9IjY5Mi4wODExIj5BYnN0cmFjdEF1dG93aXJlQ2FwYWJsZUJlYW5GYWN0b3J5PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dCIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dCI+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEwOC4wNDE1IiB4Mj0iMTUwLjA0MTUiIHkxPSI3MS40OTYxIiB5Mj0iNzEuNDk2MSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxNTAuMDQxNSIgeDI9IjE1MC4wNDE1IiB5MT0iNzEuNDk2MSIgeTI9Ijg0LjQ5NjEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTA5LjA0MTUiIHgyPSIxNTAuMDQxNSIgeTE9Ijg0LjQ5NjEiIHkyPSI4NC40OTYxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMTkuMDQxNSw4MC40OTYxLDEwOS4wNDE1LDg0LjQ5NjEsMTE5LjA0MTUsODguNDk2MSwxMTUuMDQxNSw4NC40OTYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTk2LjEyOTkiIHg9IjExNS4wNDE1IiB5PSI2Ni40MzAyIj5maW5pc2hCZWFuRmFjdG9yeUluaXRpYWxpemF0aW9uPC90ZXh0PjwvZz48cGF0aCBkPSJNMzIzLjEyOTksNTEuMjk2OSBMMzIzLjEyOTksOTEuMjk2OSBMNTA5LjEyOTksOTEuMjk2OSBMNTA5LjEyOTksNjEuMjk2OSBMNDk5LjEyOTksNTEuMjk2OSBMMzIzLjEyOTksNTEuMjk2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTQ5OS4xMjk5LDUxLjI5NjkgTDQ5OS4xMjk5LDYxLjI5NjkgTDUwOS4xMjk5LDYxLjI5NjkgTDQ5OS4xMjk5LDUxLjI5NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OS4zMDA4IiB4PSIzMjkuMTI5OSIgeT0iNjguMzYzOCI+SW5zdGFudGlhdGUgYWxsIHJlbWFpbmluZzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjUuNDI2MyIgeD0iMzI5LjEyOTkiIHk9IjgzLjQ5NjYiPihub24tbGF6eS1pbml0KSBzaW5nbGV0b25zLjwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dCIgZGF0YS1wYXJ0aWNpcGFudC0yPSJEZWZhdWx0TGlzdGFibGVCZWFuRmFjdG9yeSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMTIuOTI3NywxMTMuNjk1MywzMjIuOTI3NywxMTcuNjk1MywzMTIuOTI3NywxMjEuNjk1MywzMTYuOTI3NywxMTcuNjk1MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMDguMDQxNSIgeDI9IjMxOC45Mjc3IiB5MT0iMTE3LjY5NTMiIHkyPSIxMTcuNjk1MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OS41NDIiIHg9IjExNS4wNDE1IiB5PSIxMTIuNjI5NCI+cHJlSW5zdGFudGlhdGVTaW5nbGV0b25zPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJEZWZhdWx0TGlzdGFibGVCZWFuRmFjdG9yeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBYnN0cmFjdEJlYW5GYWN0b3J5Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjUwNy4yMDQxLDE0Mi44MjgxLDUxNy4yMDQxLDE0Ni44MjgxLDUwNy4yMDQxLDE1MC44MjgxLDUxMS4yMDQxLDE0Ni44MjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjMyNC45Mjc3IiB4Mj0iNTEzLjIwNDEiIHkxPSIxNDYuODI4MSIgeTI9IjE0Ni44MjgxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQuNDY5MiIgeD0iMzMxLjkyNzciIHk9IjE0MS43NjIyIj5nZXRCZWFuPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBYnN0cmFjdEJlYW5GYWN0b3J5IiBkYXRhLXBhcnRpY2lwYW50LTI9IkFic3RyYWN0QmVhbkZhY3RvcnkiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1MTkuMjA0MSIgeDI9IjU2MS4yMDQxIiB5MT0iMTg3LjU5MzgiIHkyPSIxODcuNTkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1NjEuMjA0MSIgeDI9IjU2MS4yMDQxIiB5MT0iMTg3LjU5MzgiIHkyPSIyMDAuNTkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1MjAuMjA0MSIgeDI9IjU2MS4yMDQxIiB5MT0iMjAwLjU5MzgiIHkyPSIyMDAuNTkzOCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTMwLjIwNDEsMTk2LjU5MzgsNTIwLjIwNDEsMjAwLjU5MzgsNTMwLjIwNDEsMjA0LjU5MzgsNTI2LjIwNDEsMjAwLjU5MzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Mi40OTY2IiB4PSI1MjYuMjA0MSIgeT0iMTgyLjUyNzgiPmRvR2V0QmVhbjwvdGV4dD48L2c+PHBhdGggZD0iTTYxMC40OTY2LDE1OS44MjgxIEw2MTAuNDk2NiwyMTQuODI4MSBMNzQxLjQ5NjYsMjE0LjgyODEgTDc0MS40OTY2LDE2OS44MjgxIEw3MzEuNDk2NiwxNTkuODI4MSBMNjEwLjQ5NjYsMTU5LjgyODEiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik03MzEuNDk2NiwxNTkuODI4MSBMNzMxLjQ5NjYsMTY5LjgyODEgTDc0MS40OTY2LDE2OS44MjgxIEw3MzEuNDk2NiwxNTkuODI4MSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEwLjQ1NTciIHg9IjYxNi40OTY2IiB5PSIxNzYuODk1Ij4mIzI3NDkyOyYjMjI3ODg7JiMyMDI1MDsmIzIwODA4OyYjMjY1OTc7JiMzNTgxMDtiZWFuPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjAwMDEiIHg9IjYxNi40OTY2IiB5PSIxOTIuMDI3OCI+JiMyNjE1OTsmIzIxNTQyOyYjMjQwNTA7JiMzMjQ2MzsmIzIxMDE5OyYjMjQzMTQ7JiM2NTI5Mjs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iNjE2LjQ5NjYiIHk9IjIwNy4xNjA2Ij4mIzI2Mzc3OyYjMjEwMTc7JiMzMDQ1MjsmIzI1NTA5OyYjMzM3MTk7JiMyMTQ2Mjs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQWJzdHJhY3RCZWFuRmFjdG9yeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJEZWZhdWx0U2luZ2xldG9uQmVhblJlZ2lzdHJ5Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjczMC4wODI2LDIzNy4zNTk0LDc0MC4wODI2LDI0MS4zNTk0LDczMC4wODI2LDI0NS4zNTk0LDczNC4wODI2LDI0MS4zNTk0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjUxOS4yMDQxIiB4Mj0iNzM2LjA4MjYiIHkxPSIyNDEuMzU5NCIgeTI9IjI0MS4zNTk0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODIuNjAyMSIgeD0iNTI2LjIwNDEiIHk9IjIzNi4yOTM1Ij5nZXRTaW5nbGV0b248L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9IkRlZmF1bHRTaW5nbGV0b25CZWFuUmVnaXN0cnkiIGRhdGEtcGFydGljaXBhbnQtMj0iT2JqZWN0RmFjdG9yeSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5MDguNDU4NSwyNjkuNDkyMiw5MTguNDU4NSwyNzMuNDkyMiw5MDguNDU4NSwyNzcuNDkyMiw5MTIuNDU4NSwyNzMuNDkyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3NDIuMDgyNiIgeDI9IjkxNC40NTg1IiB5MT0iMjczLjQ5MjIiIHkyPSIyNzMuNDkyMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYzLjY4NiIgeD0iNzQ5LjA4MjYiIHk9IjI2OC40MjYzIj5nZXRPYmplY3Q8L3RleHQ+PC9nPjxwYXRoIGQ9Ik05MjUsMjU0LjM1OTQgTDkyNSwyNzkuMzU5NCBMMTA4OSwyNzkuMzU5NCBMMTA4OSwyNjQuMzU5NCBMMTA3OSwyNTQuMzU5NCBMOTI1LDI1NC4zNTk0IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTA3OSwyNTQuMzU5NCBMMTA3OSwyNjQuMzU5NCBMMTA4OSwyNjQuMzU5NCBMMTA3OSwyNTQuMzU5NCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQzLjQwNjMiIHg9IjkzMSIgeT0iMjcxLjQyNjMiPkNyZWF0ZSBiZWFuIGluc3RhbmNlLjwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJPYmplY3RGYWN0b3J5IiBkYXRhLXBhcnRpY2lwYW50LTI9IkFic3RyYWN0QXV0b3dpcmVDYXBhYmxlQmVhbkZhY3RvcnkiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTExNC42MTIzLDMyNy4zMjQyLDExMjQuNjEyMywzMzEuMzI0MiwxMTE0LjYxMjMsMzM1LjMyNDIsMTExOC42MTIzLDMzMS4zMjQyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjkyMC40NTg1IiB4Mj0iMTEyMC42MTIzIiB5MT0iMzMxLjMyNDIiIHkyPSIzMzEuMzI0MiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc0LjY3MzgiIHg9IjkyNy40NTg1IiB5PSIzMjYuMjU4MyI+Y3JlYXRlQmVhbjwvdGV4dD48L2c+PHBhdGggZD0iTTExMzEsMjg5LjQ5MjIgTDExMzEsMzU5LjQ5MjIgTDEyNjksMzU5LjQ5MjIgTDEyNjksMjk5LjQ5MjIgTDEyNTksMjg5LjQ5MjIgTDExMzEsMjg5LjQ5MjIiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xMjU5LDI4OS40OTIyIEwxMjU5LDI5OS40OTIyIEwxMjY5LDI5OS40OTIyIEwxMjU5LDI4OS40OTIyIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iMTEzNyIgeT0iMzA2LjU1OTEiPiYjMjM1NDU7JiMzNTkzNzsmIzI0MDM3OyYjMjEzNzg7JiMyMzU1ODsmIzIwMjUwOyYjMzU4NDM7JiMyOTk5Mjs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjExMzciIHk9IjMyMS42OTE5Ij4mIzM1MDEzOyYjMzcxOTc7JiMyNDAzNzsmIzIxMzc4OyYjNjUyOTI7JiMyODk4MjsmIzIxNTE4OyYjMzU4NDM7JiMyOTk5Mjs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMDAwMSIgeD0iMTEzNyIgeT0iMzM2LjgyNDciPiYjMjEwMjE7JiMyMjk4NzsmIzIxMjcwOyYjMjM0NTQ7JiMyMDM2MzsmIzMxNTc0OyYjMzAwNTM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjExMzciIHk9IjM1MS45NTc1Ij4mIzIwMTM1OyYjMjk5ODM7JiMyMzQ1NDsmIzIwMzYzOyYjMjM1NDU7JiMzNTkzNzs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQWJzdHJhY3RBdXRvd2lyZUNhcGFibGVCZWFuRmFjdG9yeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBYnN0cmFjdEF1dG93aXJlQ2FwYWJsZUJlYW5GYWN0b3J5Ij48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTEyNi42MTIzIiB4Mj0iMTE2OC42MTIzIiB5MT0iMzg2LjE1NjMiIHkyPSIzODYuMTU2MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMTY4LjYxMjMiIHgyPSIxMTY4LjYxMjMiIHkxPSIzODYuMTU2MyIgeTI9IjM5OS4xNTYzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjExMjcuNjEyMyIgeDI9IjExNjguNjEyMyIgeTE9IjM5OS4xNTYzIiB5Mj0iMzk5LjE1NjMiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjExMzcuNjEyMywzOTUuMTU2MywxMTI3LjYxMjMsMzk5LjE1NjMsMTEzNy42MTIzLDQwMy4xNTYzLDExMzMuNjEyMywzOTkuMTU2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkyLjgwOTEiIHg9IjExMzMuNjEyMyIgeT0iMzgxLjA5MDMiPmRvQ3JlYXRlQmVhbjwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQWJzdHJhY3RBdXRvd2lyZUNhcGFibGVCZWFuRmFjdG9yeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBYnN0cmFjdEF1dG93aXJlQ2FwYWJsZUJlYW5GYWN0b3J5Ij48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTEyNi42MTIzIiB4Mj0iMTE2OC42MTIzIiB5MT0iNDI4LjI4OTEiIHkyPSI0MjguMjg5MSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMTY4LjYxMjMiIHgyPSIxMTY4LjYxMjMiIHkxPSI0MjguMjg5MSIgeTI9IjQ0MS4yODkxIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjExMjcuNjEyMyIgeDI9IjExNjguNjEyMyIgeTE9IjQ0MS4yODkxIiB5Mj0iNDQxLjI4OTEiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjExMzcuNjEyMyw0MzcuMjg5MSwxMTI3LjYxMjMsNDQxLjI4OTEsMTEzNy42MTIzLDQ0NS4yODkxLDExMzMuNjEyMyw0NDEuMjg5MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyOS45NjgzIiB4PSIxMTMzLjYxMjMiIHk9IjQyMy4yMjMxIj5jcmVhdGVCZWFuSW5zdGFuY2U8L3RleHQ+PC9nPjxwYXRoIGQ9Ik0xMjc0Ljk2ODMsNDE1LjY1NjMgTDEyNzQuOTY4Myw0NDAuNjU2MyBMMTM4MC45NjgzLDQ0MC42NTYzIEwxMzgwLjk2ODMsNDI1LjY1NjMgTDEzNzAuOTY4Myw0MTUuNjU2MyBMMTI3NC45NjgzLDQxNS42NTYzIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTM3MC45NjgzLDQxNS42NTYzIEwxMzcwLjk2ODMsNDI1LjY1NjMgTDEzODAuOTY4Myw0MjUuNjU2MyBMMTM3MC45NjgzLDQxNS42NTYzIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4NS4xMjIxIiB4PSIxMjgwLjk2ODMiIHk9IjQzMi43MjMxIj4mIzIxMDE5OyYjMjQzMTQ7QmVhbiYjMjM0NTQ7JiMyMDM2Mzs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQWJzdHJhY3RBdXRvd2lyZUNhcGFibGVCZWFuRmFjdG9yeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBYnN0cmFjdEF1dG93aXJlQ2FwYWJsZUJlYW5GYWN0b3J5Ij48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTEyNi42MTIzIiB4Mj0iMTE2OC42MTIzIiB5MT0iNDcwLjQyMTkiIHkyPSI0NzAuNDIxOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMTY4LjYxMjMiIHgyPSIxMTY4LjYxMjMiIHkxPSI0NzAuNDIxOSIgeTI9IjQ4My40MjE5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjExMjcuNjEyMyIgeDI9IjExNjguNjEyMyIgeTE9IjQ4My40MjE5IiB5Mj0iNDgzLjQyMTkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjExMzcuNjEyMyw0NzkuNDIxOSwxMTI3LjYxMjMsNDgzLjQyMTksMTEzNy42MTIzLDQ4Ny40MjE5LDExMzMuNjEyMyw0ODMuNDIxOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg3LjMwNTciIHg9IjExMzMuNjEyMyIgeT0iNDY1LjM1NiI+aW5pdGlhbGl6ZUJlYW48L3RleHQ+PC9nPjxwYXRoIGQ9Ik0xMjMyLjMwNTcsNDU3Ljc4OTEgTDEyMzIuMzA1Nyw0ODIuNzg5MSBMMTM1MS4zMDU3LDQ4Mi43ODkxIEwxMzUxLjMwNTcsNDY3Ljc4OTEgTDEzNDEuMzA1Nyw0NTcuNzg5MSBMMTIzMi4zMDU3LDQ1Ny43ODkxIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTM0MS4zMDU3LDQ1Ny43ODkxIEwxMzQxLjMwNTcsNDY3Ljc4OTEgTDEzNTEuMzA1Nyw0NjcuNzg5MSBMMTM0MS4zMDU3LDQ1Ny43ODkxIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OC4xMjIxIiB4PSIxMjM4LjMwNTciIHk9IjQ3NC44NTYiPiYjMjEwMjE7JiMyMjk4NzsmIzIxMjcwO0JlYW4mIzIzNDU0OyYjMjAzNjM7PC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9IkFic3RyYWN0QXV0b3dpcmVDYXBhYmxlQmVhbkZhY3RvcnkiIGRhdGEtcGFydGljaXBhbnQtMj0iT2JqZWN0RmFjdG9yeSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5MzEuNDU4NSw0OTMuNDIxOSw5MjEuNDU4NSw0OTcuNDIxOSw5MzEuNDU4NSw1MDEuNDIxOSw5MjcuNDU4NSw0OTcuNDIxOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjIsMjsiIHgxPSI5MjUuNDU4NSIgeDI9IjExMjUuNjEyMyIgeTE9IjQ5Ny40MjE5IiB5Mj0iNDk3LjQyMTkiLz48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iT2JqZWN0RmFjdG9yeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJEZWZhdWx0U2luZ2xldG9uQmVhblJlZ2lzdHJ5Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijc1My4wODI2LDUwNy40MjE5LDc0My4wODI2LDUxMS40MjE5LDc1My4wODI2LDUxNS40MjE5LDc0OS4wODI2LDUxMS40MjE5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6MiwyOyIgeDE9Ijc0Ny4wODI2IiB4Mj0iOTE5LjQ1ODUiIHkxPSI1MTEuNDIxOSIgeTI9IjUxMS40MjE5Ii8+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9IkRlZmF1bHRTaW5nbGV0b25CZWFuUmVnaXN0cnkiIGRhdGEtcGFydGljaXBhbnQtMj0iRGVmYXVsdFNpbmdsZXRvbkJlYW5SZWdpc3RyeSI+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc0Mi4wODI2IiB4Mj0iNzg0LjA4MjYiIHkxPSI1NTIuMTg3NSIgeTI9IjU1Mi4xODc1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc4NC4wODI2IiB4Mj0iNzg0LjA4MjYiIHkxPSI1NTIuMTg3NSIgeTI9IjU2NS4xODc1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc0My4wODI2IiB4Mj0iNzg0LjA4MjYiIHkxPSI1NjUuMTg3NSIgeTI9IjU2NS4xODc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3NTMuMDgyNiw1NjEuMTg3NSw3NDMuMDgyNiw1NjUuMTg3NSw3NTMuMDgyNiw1NjkuMTg3NSw3NDkuMDgyNiw1NjUuMTg3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg1LjcyNTEiIHg9Ijc0OS4wODI2IiB5PSI1NDcuMTIxNiI+YWRkU2luZ2xldG9uPC90ZXh0PjwvZz48cGF0aCBkPSJNODQ2LjcyNTEsNTI0LjQyMTkgTDg0Ni43MjUxLDU3OS40MjE5IEw5NDUuNzI1MSw1NzkuNDIxOSBMOTQ1LjcyNTEsNTM0LjQyMTkgTDkzNS43MjUxLDUyNC40MjE5IEw4NDYuNzI1MSw1MjQuNDIxOSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTkzNS43MjUxLDUyNC40MjE5IEw5MzUuNzI1MSw1MzQuNDIxOSBMOTQ1LjcyNTEsNTM0LjQyMTkgTDkzNS43MjUxLDUyNC40MjE5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OC4wMDAxIiB4PSI4NTIuNzI1MSIgeT0iNTQxLjQ4ODgiPiYjMjM1NTg7JiMyMTAxOTsmIzI0MzE0OyYjMzAzNDA7JiMyMzQ1NDsmIzIwMzYzOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OC4wMDAxIiB4PSI4NTIuNzI1MSIgeT0iNTU2LjYyMTYiPiYjMjM1NDU7JiMzNTkzNzsmIzI1OTE4OyYjMjA4Mzc7JiMzMjUzMTsmIzIzMzg0OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSI4NTIuNzI1MSIgeT0iNTcxLjc1NDQiPiYjMjM1NDU7JiMzNTkzNzsmIzIwMDEzOyYjMjA0NDU7JiMyMzM4NDs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iRGVmYXVsdFNpbmdsZXRvbkJlYW5SZWdpc3RyeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBYnN0cmFjdEJlYW5GYWN0b3J5Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjUzMC4yMDQxLDYxMi41MTk1LDUyMC4yMDQxLDYxNi41MTk1LDUzMC4yMDQxLDYyMC41MTk1LDUyNi4yMDQxLDYxNi41MTk1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6MiwyOyIgeDE9IjUyNC4yMDQxIiB4Mj0iNzQxLjA4MjYiIHkxPSI2MTYuNTE5NSIgeTI9IjYxNi41MTk1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTk4Ljg3ODQiIHg9IjUzNi4yMDQxIiB5PSI2MTEuNDUzNiI+JiMzNTg0MzsmIzI5OTkyO2dldE9iamVjdEZvckJlYW5JbnN0YW5jZTwvdGV4dD48L2c+PHBhdGggZD0iTTc0Nyw1ODkuODIwMyBMNzQ3LDYyOS44MjAzIEw4NDksNjI5LjgyMDMgTDg0OSw1OTkuODIwMyBMODM5LDU4OS44MjAzIEw3NDcsNTg5LjgyMDMiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik04MzksNTg5LjgyMDMgTDgzOSw1OTkuODIwMyBMODQ5LDU5OS44MjAzIEw4MzksNTg5LjgyMDMiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1LjAwMDEiIHg9Ijc1MyIgeT0iNjA2Ljg4NzIiPiYjMjEwMjg7JiMyNjAyOTsmIzI2MTU5OyYjMjE1NDI7JiMyNjE1OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODEuODAyMiIgeD0iNzUzIiB5PSI2MjIuMDIiPkZhY3RvcnlCZWFuPC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9IkFic3RyYWN0QmVhbkZhY3RvcnkiIGRhdGEtcGFydGljaXBhbnQtMj0iRGVmYXVsdExpc3RhYmxlQmVhbkZhY3RvcnkiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzM1LjkyNzcsNjM3LjA4NTksMzI1LjkyNzcsNjQxLjA4NTksMzM1LjkyNzcsNjQ1LjA4NTksMzMxLjkyNzcsNjQxLjA4NTkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iMzI5LjkyNzciIHgyPSI1MTguMjA0MSIgeTE9IjY0MS4wODU5IiB5Mj0iNjQxLjA4NTkiLz48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iRGVmYXVsdExpc3RhYmxlQmVhbkZhY3RvcnkiIGRhdGEtcGFydGljaXBhbnQtMj0iQWJzdHJhY3RBcHBsaWNhdGlvbkNvbnRleHQiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTE5LjA0MTUsNjUxLjA4NTksMTA5LjA0MTUsNjU1LjA4NTksMTE5LjA0MTUsNjU5LjA4NTksMTE1LjA0MTUsNjU1LjA4NTkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iMTEzLjA0MTUiIHgyPSIzMjMuOTI3NyIgeTE9IjY1NS4wODU5IiB5Mj0iNjU1LjA4NTkiLz48L2c+PCEtLVNSQz1bakxORFJqRDA0QnhsSy1vSDdpODN6ODBLV2VlWThJN0g5elpPc3RJSHNPdGloS2Z4WEFHQVFhYWg0UUJJS1llV2ZibkNLZUc4ajU1djZPempKaG0yd3Z5d0piQXgyQzc1cWl4aVZabFZEei1Fb3BMQmNhSUp2S1IzTzFnSEpGMkF1OTgtYmhYcTJ2VHBpdWloWjNEaHpKT2JWNGJqNEVQNmJKRjlZQzRzZXNzODJxY25vVWdoNGJNdjlHYk5JSEtYWGU1RC1lWWVxeG9FcUdxa1VDYVdjbmliNVAwQnM1OUhXcWgxaFBrOFNYczdBQVhTTUVDVGthQk0zN2NGZ0tqZzFpcktqOFdSOWlyU2xmbzJlX24zTVRmSk03S1FoVDRMb1RtcGtoWVJkQ2g4dUpienczVlR5RzZxc2p3bjdHcFVyUzhUdGx1MHpaeDB3QkRfbFdsakdwV18tcE5VR1R4aFB6MS12SHoteUpmc3ExZDFSY3pVYnZiQTRjdWZzcDN6V0RPTExMTUlPZjRjS0Q3RTRFYi14STdMUDVRMUU5OWJLcDVmc0RVRzBjUUhyWGhEejZ1QU9pZklRckFpQ3ZETUk2RWtSTGc0RVFpUjNCdTdmc3pYUDRGZDJHb3RiODMxeUFkVl9PWTJ6d3NWaFVUbkdjZGNEeF8yTllWOUdWaThKaFBYZm1VVnRoV05zeHhKeXJfUW8zcXh5Umw3U0lZNmxTOWprR04tOEdyVEwyT3lfWGRnSDlqZ2VsUUtIZjVubWNuQ3haX0dPZlZsVkJ2MWJyaF94VnNwYmZqcnBwTmNsalJGWEktM3dGaGFQTUhQM1JUWUxWczNQYThnamVwTmxPMk14T3pWV0JFVlhEbmxabGxaQTVvZGw3NW5LTmNKOHhQbC1rQU1YOWRWeWh4TlMtQmZlUnVlV09ZUUtwbWcyZVRkdU9XaV8zTnkxVzAwXS0tPjwvZz48L3N2Zz4='>\n\n<p>在Bean的初始化方法 initializeBean 中。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> Object <span class=\"title function_\">initializeBean</span><span class=\"params\">(String beanName, Object bean, <span class=\"meta\">@Nullable</span> RootBeanDefinition mbd)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">    <span class=\"type\">Object</span> <span class=\"variable\">wrappedBean</span> <span class=\"operator\">=</span> bean;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mbd == <span class=\"literal\">null</span> || !mbd.isSynthetic()) &#123; <span class=\"comment\">// 执行BeanPostProcessor接口的初始化前置方法</span></span><br><span class=\"line\">        wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        invokeInitMethods(beanName, wrappedBean, mbd); <span class=\"comment\">// 执行Bean注解中显式指定的init-method初始化方法。</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">catch</span> (Throwable ex) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BeanCreationException</span>(</span><br><span class=\"line\">                (mbd != <span class=\"literal\">null</span> ? mbd.getResourceDescription() : <span class=\"literal\">null</span>),</span><br><span class=\"line\">                beanName, <span class=\"string\">&quot;Invocation of init method failed&quot;</span>, ex);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mbd == <span class=\"literal\">null</span> || !mbd.isSynthetic()) &#123; <span class=\"comment\">// 执行BeanPostProcessor接口的初始化后置方法</span></span><br><span class=\"line\">        wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> wrappedBean;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在 applyBeanPostProcessorsBeforeInitialization 方法中，将容器中注册的所有 BeanPostProcessor 遍历了一遍。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Object <span class=\"title function_\">applyBeanPostProcessorsBeforeInitialization</span><span class=\"params\">(Object existingBean, String beanName)</span></span><br><span class=\"line\">        <span class=\"keyword\">throws</span> BeansException &#123;</span><br><span class=\"line\">    <span class=\"type\">Object</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> existingBean;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (BeanPostProcessor processor : getBeanPostProcessors()) &#123; <span class=\"comment\">// 取出所有的processor逐个执行</span></span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">current</span> <span class=\"operator\">=</span> processor.postProcessBeforeInitialization(result, beanName);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (current == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        result = current;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Aware接口\"><a href=\"#Aware接口\" class=\"headerlink\" title=\"Aware接口\"></a>Aware接口</h3><p>adj.<br>意识到的;意识到;知道;明白;察觉到;发觉;发现;对…有兴趣的;有…意识的</p>\n<p>实现了相应的Aware接口，这个类就获取了相应的资源。</p>\n<p>比如实现了 ApplicationContextAware 接口，就获取了IOC容器 ApplicationContext；实现了 EnvironmentAware 接口，就获取了环境信息。</p>\n<h3 id=\"ApplicationContextAwareProcessor\"><a href=\"#ApplicationContextAwareProcessor\" class=\"headerlink\" title=\"ApplicationContextAwareProcessor\"></a>ApplicationContextAwareProcessor</h3><p>是BeanProcessor的一个实现类，其的 postProcessBeforeInitialization 方法实现如下</p>\n<p>对特定Aware实现类做相应处理，主要就是赋值，之后Aware实现类的get方法就能拿到相关信息或资源了。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"meta\">@Nullable</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Object <span class=\"title function_\">postProcessBeforeInitialization</span><span class=\"params\">(Object bean, String beanName)</span> <span class=\"keyword\">throws</span> BeansException &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!(bean <span class=\"keyword\">instanceof</span> EnvironmentAware || bean <span class=\"keyword\">instanceof</span> EmbeddedValueResolverAware ||</span><br><span class=\"line\">            bean <span class=\"keyword\">instanceof</span> ResourceLoaderAware || bean <span class=\"keyword\">instanceof</span> ApplicationEventPublisherAware ||</span><br><span class=\"line\">            bean <span class=\"keyword\">instanceof</span> MessageSourceAware || bean <span class=\"keyword\">instanceof</span> ApplicationContextAware ||</span><br><span class=\"line\">            bean <span class=\"keyword\">instanceof</span> ApplicationStartupAware)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> bean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">AccessControlContext</span> <span class=\"variable\">acc</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (System.getSecurityManager() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        acc = <span class=\"built_in\">this</span>.applicationContext.getBeanFactory().getAccessControlContext();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (acc != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; &#123;</span><br><span class=\"line\">            invokeAwareInterfaces(bean);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;, acc);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        invokeAwareInterfaces(bean);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> bean;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">invokeAwareInterfaces</span><span class=\"params\">(Object bean)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (bean <span class=\"keyword\">instanceof</span> EnvironmentAware) &#123;</span><br><span class=\"line\">        ((EnvironmentAware) bean).setEnvironment(<span class=\"built_in\">this</span>.applicationContext.getEnvironment());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (bean <span class=\"keyword\">instanceof</span> EmbeddedValueResolverAware) &#123;</span><br><span class=\"line\">        ((EmbeddedValueResolverAware) bean).setEmbeddedValueResolver(<span class=\"built_in\">this</span>.embeddedValueResolver);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (bean <span class=\"keyword\">instanceof</span> ResourceLoaderAware) &#123;</span><br><span class=\"line\">        ((ResourceLoaderAware) bean).setResourceLoader(<span class=\"built_in\">this</span>.applicationContext);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (bean <span class=\"keyword\">instanceof</span> ApplicationEventPublisherAware) &#123;</span><br><span class=\"line\">        ((ApplicationEventPublisherAware) bean).setApplicationEventPublisher(<span class=\"built_in\">this</span>.applicationContext);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (bean <span class=\"keyword\">instanceof</span> MessageSourceAware) &#123;</span><br><span class=\"line\">        ((MessageSourceAware) bean).setMessageSource(<span class=\"built_in\">this</span>.applicationContext);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (bean <span class=\"keyword\">instanceof</span> ApplicationStartupAware) &#123;</span><br><span class=\"line\">        ((ApplicationStartupAware) bean).setApplicationStartup(<span class=\"built_in\">this</span>.applicationContext.getApplicationStartup());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (bean <span class=\"keyword\">instanceof</span> ApplicationContextAware) &#123;</span><br><span class=\"line\">        ((ApplicationContextAware) bean).setApplicationContext(<span class=\"built_in\">this</span>.applicationContext);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以自定义类实现 ApplicationContextAware 接口，实现 setApplicationContext 方法。在Bean初始化时就会被调用。</p>\n<h2 id=\"refresh方法\"><a href=\"#refresh方法\" class=\"headerlink\" title=\"refresh方法\"></a>refresh方法</h2><p>容器的创建刷新方法，Bean创建、初始化等都是从这里开始的。</p>\n<p>源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// springframework-5.3.21</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">refresh</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> BeansException, IllegalStateException &#123;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (<span class=\"built_in\">this</span>.startupShutdownMonitor) &#123; <span class=\"comment\">// 加锁</span></span><br><span class=\"line\">        <span class=\"type\">StartupStep</span> <span class=\"variable\">contextRefresh</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.applicationStartup.start(<span class=\"string\">&quot;spring.context.refresh&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// Prepare this context for refreshing.</span></span><br><span class=\"line\">        <span class=\"comment\">// 容器刷新的准备工作</span></span><br><span class=\"line\">        prepareRefresh();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class=\"line\">        <span class=\"type\">ConfigurableListableBeanFactory</span> <span class=\"variable\">beanFactory</span> <span class=\"operator\">=</span> obtainFreshBeanFactory();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Prepare the bean factory for use in this context.</span></span><br><span class=\"line\">        prepareBeanFactory(beanFactory);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class=\"line\">            postProcessBeanFactory(beanFactory);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">StartupStep</span> <span class=\"variable\">beanPostProcess</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.applicationStartup.start(<span class=\"string\">&quot;spring.context.beans.post-process&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">// Invoke factory processors registered as beans in the context.</span></span><br><span class=\"line\">            invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Register bean processors that intercept bean creation.</span></span><br><span class=\"line\">            registerBeanPostProcessors(beanFactory);</span><br><span class=\"line\">            beanPostProcess.end();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Initialize message source for this context.</span></span><br><span class=\"line\">            initMessageSource();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Initialize event multicaster for this context.</span></span><br><span class=\"line\">            initApplicationEventMulticaster();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Initialize other special beans in specific context subclasses.</span></span><br><span class=\"line\">            onRefresh();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Check for listener beans and register them.</span></span><br><span class=\"line\">            registerListeners();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class=\"line\">            finishBeanFactoryInitialization(beanFactory);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Last step: publish corresponding event.</span></span><br><span class=\"line\">            finishRefresh();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">catch</span> (BeansException ex) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class=\"line\">                logger.warn(<span class=\"string\">&quot;Exception encountered during context initialization - &quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;cancelling refresh attempt: &quot;</span> + ex);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class=\"line\">            destroyBeans();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Reset &#x27;active&#x27; flag.</span></span><br><span class=\"line\">            cancelRefresh(ex);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Propagate exception to caller.</span></span><br><span class=\"line\">            <span class=\"keyword\">throw</span> ex;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Reset common introspection caches in Spring&#x27;s core, since we</span></span><br><span class=\"line\">            <span class=\"comment\">// might not ever need metadata for singleton beans anymore...</span></span><br><span class=\"line\">            resetCommonCaches();</span><br><span class=\"line\">            contextRefresh.end();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>执行流程大致如下：</p>\n<img src='data:image/svg+xml;base64,ZXJyb3IgY29kZTogNTIw'>\n","categories":["Spring"],"tags":["Java"]},{"title":"Spring AOP","url":"/%E7%AC%94%E8%AE%B0/Java/Spring/Spring%20AOP/","content":"<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>AOP：Aspect Oriented Programming 面向切面编程。</p>\n<p>将程序中交叉业务逻辑（事务、日志）代码提取出来，封装成切面，由AOP容器在适当时机（位置）将封装的切面动态地织入到具体业务逻辑中。</p>\n<p>适用于具有横切逻辑的场合，如事务管理、日志记录、性能监测、异常通知、访问控制等。</p>\n<p>Spring AOP原理就是使用动态代理。如果被代理类实现了接口，则使用Proxy类实现；如果没有实现接口，则通过CGLIB继承来实现。</p>\n<h2 id=\"通知方法\"><a href=\"#通知方法\" class=\"headerlink\" title=\"通知方法\"></a>通知方法</h2><ul>\n<li>前置通知：@Before ，在目标方法运行之前执行。</li>\n<li>后置通知：@After ，在目标方法运行之后执行，无论方法是正常还是异常结束。</li>\n<li>返回通知：@AfterReturning ，在目标方法正常返回后执行。</li>\n<li>异常通知：@AfterThrowing ，在目标方法出现异常后执行。</li>\n<li>环绕通知：@Around ，动态代理，最底层通知，手动指定执行目标方法。</li>\n</ul>\n<h2 id=\"Hello-World\"><a href=\"#Hello-World\" class=\"headerlink\" title=\"Hello World\"></a>Hello World</h2><p>创建测试触发类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Calculator</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">div</span><span class=\"params\">(<span class=\"type\">int</span> i, <span class=\"type\">int</span> j)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;------&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> i / j;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建切面类，在类前使用 @Aspect注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Aspect</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LogAspects</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Pointcut(&quot;execution(public int com.example.cap10.aop.Calculator.*(..))&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">pointCut</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Before(&quot;execution(int com.example.cap10.aop.Calculator.div(int,int))&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">logStart</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;除法运行，参数列表是：&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@After(&quot;pointCut()&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">logEnd</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;除法结束...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@AfterReturning(&quot;pointCut()&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">logReturn</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;除法正常返回，结果是：&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@AfterThrowing(&quot;pointCut()&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">logException</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;运行异常，异常信息：&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Around(&quot;pointCut()&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object <span class=\"title function_\">logAround</span><span class=\"params\">(ProceedingJoinPoint joinPoint)</span> <span class=\"keyword\">throws</span> Throwable &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;@Around执行目标方法之前...&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">obj</span> <span class=\"operator\">=</span> joinPoint.proceed();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;@Around执行目标方法之后...&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在配置类中引入对应Bean，并将切面自动代理打开</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAspectJAutoProxy</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestConfigCap10</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在测试类中获取容器中的测试除法类对象，并调用方法</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">@Around执行目标方法之前...</span><br><span class=\"line\">除法运行，参数列表是：</span><br><span class=\"line\">------</span><br><span class=\"line\">除法正常返回，结果是：</span><br><span class=\"line\">除法结束...</span><br><span class=\"line\">@Around执行目标方法之后...</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"切入点\"><a href=\"#切入点\" class=\"headerlink\" title=\"切入点\"></a>切入点</h2><p>Pointcut。定义切面方法针对哪些目标方法执行。</p>\n<p>写在 @Before 这类注解的 value 属性中。</p>\n<p>格式为</p>\n<p>execution(返回值类型 包名.类名.方法名(参数类型))</p>\n<p>如：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Before(&quot;execution(int com.example.cap10.aop.Calculator.div(int,int))&quot;)</span></span><br></pre></td></tr></table></figure>\n\n<p>可以使用通配符，如：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">execution(* aop06.service.impl.*.*(..)) \t\t\t<span class=\"comment\">// *表示任何字符，(..)表示参数任意</span></span><br></pre></td></tr></table></figure>\n\n<p>如果某个切入点被频繁使用，可以先单独定义，之后再进行引用。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Pointcut(&quot;execution(public int com.example.cap10.aop.Calculator.*(..))&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">pointCut</span><span class=\"params\">()</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@After(&quot;pointCut()&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">logEnd</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;除法结束...&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"注解的一些回调属性\"><a href=\"#注解的一些回调属性\" class=\"headerlink\" title=\"注解的一些回调属性\"></a>注解的一些回调属性</h2><p>注解有一些预定义的属性，用于获取相应的信息。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Target(ElementType.METHOD)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> AfterThrowing &#123;</span><br><span class=\"line\">    String <span class=\"title function_\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    String <span class=\"title function_\">pointcut</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>; <span class=\"comment\">// 和value同义</span></span><br><span class=\"line\">    String <span class=\"title function_\">throwing</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    String <span class=\"title function_\">argNames</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>例如 @AfterThrowing throwing ，用于获取切面目标方法所抛出的异常。</p>\n<p>在切面方法中，在参数中添加对应变量，将变量名注册到注解的 throwing 属性中，在方法中就可以获取切面目标方法的参数列表。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@AfterThrowing(value = &quot;pointCut()&quot;, throwing = &quot;e&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">logException</span><span class=\"params\">(Exception e)</span> &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;运行异常，异常信息：&quot;</span> + e.getMessage());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">运行异常，异常信息：/ by zero</span><br></pre></td></tr></table></figure>\n\n<p>这些注解都有 argNames 属性，用于获取目标方法的参数。</p>\n<p>使用时，需要在切入点定义中指明目标方法的参数列表，argNames属性和切面方法的参数列表都需要和这里指明的相同。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 需要在切入点定义中使用 args() 指明目标方法的参数列表</span></span><br><span class=\"line\"><span class=\"meta\">@Before(value = &quot;pointCut() &amp;&amp; args(a,b)&quot;, argNames = &quot;a,b&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">logStart</span><span class=\"params\">(<span class=\"type\">int</span> a, <span class=\"type\">int</span> b)</span> &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;除法运行，参数列表是：&quot;</span> + a + <span class=\"string\">&quot;,&quot;</span> + b);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">除法运行，参数列表是：4,3</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"连接点\"><a href=\"#连接点\" class=\"headerlink\" title=\"连接点\"></a>连接点</h2><p>JoinPoint。在切面方法中定义切入点，可以获取更多目标方法中的信息。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Before(value = &quot;pointCut()&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">logStart</span><span class=\"params\">(JoinPoint joinPoint)</span> &#123;</span><br><span class=\"line\">    System.out.println(joinPoint.getSignature().getName() + <span class=\"string\">&quot; 方法运行，参数列表是：&quot;</span> + Arrays.asList(joinPoint.getArgs()));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">div 方法运行，参数列表是：[4, 3]</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>问：这些 throwing、argNames和joinPoint之类的属性，是在哪里赋的值？</p>\n</blockquote>\n<h2 id=\"AOP相关类的创建流程\"><a href=\"#AOP相关类的创建流程\" class=\"headerlink\" title=\"AOP相关类的创建流程\"></a>AOP相关类的创建流程</h2><p>之前在配置类中，声明了注解 @EnableAspectJAutoProxy ，查看注解的定义，引入了 AspectJAutoProxyRegistrar.class 组件</p>\n<p>而这里的 Registrar 实现了 ImportBeanDefinitionRegistrar 接口，在接口方法中主要注册了 <strong>AnnotationAwareAspectJAutoProxyCreator.class</strong> 这个类。</p>\n<img src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjI3OHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTI3NnB4O2hlaWdodDoyNzhweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjc2IDI3OCIgd2lkdGg9IjEyNzZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxnPjx0aXRsZT5Bc3BlY3RKQXV0b1Byb3h5UmVnaXN0cmFyPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iMjA2LjkyOTciIHdpZHRoPSI4IiB4PSIxMDEuNzU4MyIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjEwNSIgeDI9IjEwNSIgeTE9IjM2LjI5NjkiIHkyPSIyNDMuMjI2NiIvPjwvZz48Zz48dGl0bGU+QW9wQ29uZmlnVXRpbHM8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSIyMDYuOTI5NyIgd2lkdGg9IjgiIHg9IjQ4Ni43ODEzIiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNDkwLjQwMjMiIHgyPSI0OTAuNDAyMyIgeTE9IjM2LjI5NjkiIHkyPSIyNDMuMjI2NiIvPjwvZz48Zz48dGl0bGU+QmVhbkRlZmluaXRpb25SZWdpc3RyeTwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9IjIwNi45Mjk3IiB3aWR0aD0iOCIgeD0iODYxLjgwNDIiIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSI4NjUuMTAyNSIgeDI9Ijg2NS4xMDI1IiB5MT0iMzYuMjk2OSIgeTI9IjI0My4yMjY2Ii8+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJBc3BlY3RKQXV0b1Byb3h5UmVnaXN0cmFyIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIwMS41MTY2IiB4PSI1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTg3LjUxNjYiIHg9IjEyIiB5PSIyNC45OTUxIj5Bc3BlY3RKQXV0b1Byb3h5UmVnaXN0cmFyPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1wYXJ0aWNpcGFudD0iQXNwZWN0SkF1dG9Qcm94eVJlZ2lzdHJhciI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMDEuNTE2NiIgeD0iNSIgeT0iMjQyLjIyNjYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxODcuNTE2NiIgeD0iMTIiIHk9IjI2Mi4yMjE3Ij5Bc3BlY3RKQXV0b1Byb3h5UmVnaXN0cmFyPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1wYXJ0aWNpcGFudD0iQW9wQ29uZmlnVXRpbHMiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTE2Ljc1NzgiIHg9IjQzMi40MDIzIiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAyLjc1NzgiIHg9IjQzOS40MDIzIiB5PSIyNC45OTUxIj5Bb3BDb25maWdVdGlsczwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9IkFvcENvbmZpZ1V0aWxzIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExNi43NTc4IiB4PSI0MzIuNDAyMyIgeT0iMjQyLjIyNjYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDIuNzU3OCIgeD0iNDM5LjQwMjMiIHk9IjI2Mi4yMjE3Ij5Bb3BDb25maWdVdGlsczwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtcGFydGljaXBhbnQ9IkJlYW5EZWZpbml0aW9uUmVnaXN0cnkiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTc1LjQwMzMiIHg9Ijc3OC4xMDI1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTYxLjQwMzMiIHg9Ijc4NS4xMDI1IiB5PSIyNC45OTUxIj5CZWFuRGVmaW5pdGlvblJlZ2lzdHJ5PC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1wYXJ0aWNpcGFudD0iQmVhbkRlZmluaXRpb25SZWdpc3RyeSI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzUuNDAzMyIgeD0iNzc4LjEwMjUiIHk9IjI0Mi4yMjY2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTYxLjQwMzMiIHg9Ijc4NS4xMDI1IiB5PSIyNjIuMjIxNyI+QmVhbkRlZmluaXRpb25SZWdpc3RyeTwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQXNwZWN0SkF1dG9Qcm94eVJlZ2lzdHJhciIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBb3BDb25maWdVdGlscyI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NzguNzgxMyw2My40Mjk3LDQ4OC43ODEzLDY3LjQyOTcsNDc4Ljc4MTMsNzEuNDI5Nyw0ODIuNzgxMyw2Ny40Mjk3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEwNS43NTgzIiB4Mj0iNDg0Ljc4MTMiIHkxPSI2Ny40Mjk3IiB5Mj0iNjcuNDI5NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM2MS4wMjI5IiB4PSIxMTIuNzU4MyIgeT0iNjIuMzYzOCI+cmVnaXN0ZXJBc3BlY3RKQW5ub3RhdGlvbkF1dG9Qcm94eUNyZWF0b3JJZk5lY2Vzc2FyeTwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQW9wQ29uZmlnVXRpbHMiIGRhdGEtcGFydGljaXBhbnQtMj0iQW9wQ29uZmlnVXRpbHMiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0OTAuNzgxMyIgeDI9IjUzMi43ODEzIiB5MT0iOTYuNTYyNSIgeTI9Ijk2LjU2MjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNTMyLjc4MTMiIHgyPSI1MzIuNzgxMyIgeTE9Ijk2LjU2MjUiIHkyPSIxMDkuNTYyNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0OTEuNzgxMyIgeDI9IjUzMi43ODEzIiB5MT0iMTA5LjU2MjUiIHkyPSIxMDkuNTYyNSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTAxLjc4MTMsMTA1LjU2MjUsNDkxLjc4MTMsMTA5LjU2MjUsNTAxLjc4MTMsMTEzLjU2MjUsNDk3Ljc4MTMsMTA5LjU2MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNjEuMDIyOSIgeD0iNDk3Ljc4MTMiIHk9IjkxLjQ5NjYiPnJlZ2lzdGVyQXNwZWN0SkFubm90YXRpb25BdXRvUHJveHlDcmVhdG9ySWZOZWNlc3Nhcnk8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9IkFvcENvbmZpZ1V0aWxzIiBkYXRhLXBhcnRpY2lwYW50LTI9IkFvcENvbmZpZ1V0aWxzIj48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNDkwLjc4MTMiIHgyPSI1MzIuNzgxMyIgeTE9IjE0Mi43NjE3IiB5Mj0iMTQyLjc2MTciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNTMyLjc4MTMiIHgyPSI1MzIuNzgxMyIgeTE9IjE0Mi43NjE3IiB5Mj0iMTU1Ljc2MTciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNDkxLjc4MTMiIHgyPSI1MzIuNzgxMyIgeTE9IjE1NS43NjE3IiB5Mj0iMTU1Ljc2MTciLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjUwMS43ODEzLDE1MS43NjE3LDQ5MS43ODEzLDE1NS43NjE3LDUwMS43ODEzLDE1OS43NjE3LDQ5Ny43ODEzLDE1NS43NjE3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjE5LjQ1NzUiIHg9IjQ5Ny43ODEzIiB5PSIxMzcuNjk1OCI+cmVnaXN0ZXJPckVzY2FsYXRlQXBjQXNSZXF1aXJlZDwvdGV4dD48L2c+PHBhdGggZD0iTTEyNiwxMjIuNTYyNSBMMTI2LDE2Mi41NjI1IEw0ODUsMTYyLjU2MjUgTDQ4NSwxMzIuNTYyNSBMNDc1LDEyMi41NjI1IEwxMjYsMTIyLjU2MjUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00NzUsMTIyLjU2MjUgTDQ3NSwxMzIuNTYyNSBMNDg1LDEzMi41NjI1IEw0NzUsMTIyLjU2MjUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMzOC4wMTI3IiB4PSIxMzIiIHk9IjEzOS42Mjk0Ij4mIzIwMjU2OyYjMjA4Mzc7QW5ub3RhdGlvbkF3YXJlQXNwZWN0SkF1dG9Qcm94eUNyZWF0b3IuY2xhc3M8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjMwLjEwOSIgeD0iMTMyIiB5PSIxNTQuNzYyMiI+JiMyMTQ0MjsmIzI1OTY4OyYjNjUyOTI7JiMyMTAxOTsmIzI0MzE0OyYjMjAxMDI7Um9vdEJlYW5EZWZpbml0aW9uJiMyMzQ1NDsmIzIwMzYzOzwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBb3BDb25maWdVdGlscyIgZGF0YS1wYXJ0aWNpcGFudC0yPSJCZWFuRGVmaW5pdGlvblJlZ2lzdHJ5Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijg1My44MDQyLDIwMy4wOTM4LDg2My44MDQyLDIwNy4wOTM4LDg1My44MDQyLDIxMS4wOTM4LDg1Ny44MDQyLDIwNy4wOTM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQ5MC43ODEzIiB4Mj0iODU5LjgwNDIiIHkxPSIyMDcuMDkzOCIgeTI9IjIwNy4wOTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ2LjQ5MTIiIHg9IjQ5Ny43ODEzIiB5PSIyMDIuMDI3OCI+cmVnaXN0ZXJCZWFuRGVmaW5pdGlvbjwvdGV4dD48L2c+PHBhdGggZD0iTTg3MCwxNzIuODI4MSBMODcwLDIyNy44MjgxIEwxMjY5LDIyNy44MjgxIEwxMjY5LDE4Mi44MjgxIEwxMjU5LDE3Mi44MjgxIEw4NzAsMTcyLjgyODEiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xMjU5LDE3Mi44MjgxIEwxMjU5LDE4Mi44MjgxIEwxMjY5LDE4Mi44MjgxIEwxMjU5LDE3Mi44MjgxIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzguMTA4OSIgeD0iODc2IiB5PSIxODkuODk1Ij4mIzMzNzE5OyYjMjE0NjI7Um9vdEJlYW5EZWZpbml0aW9uJiMyMzQ1NDsmIzIwMzYzOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzYuOTY2NSIgeD0iODc2IiB5PSIyMDUuMDI3OCI+JiMzNjgyNzsmIzM0ODkyOyYjMjc4ODA7JiMyMDg3NjsmIzY1MjkyOyYjMjc4ODA7JiMyMDg3NjsmIzMwMzQwO0JlYW5JRCYjMjE1MTc7JiMyMDAyNjs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzc4LjExMDgiIHg9Ijg3NiIgeT0iMjIwLjE2MDYiPm9yZy5zcHJpbmdmcmFtZXdvcmsuYW9wLmNvbmZpZy5pbnRlcm5hbEF1dG9Qcm94eUNyZWF0b3I8L3RleHQ+PCEtLVNSQz1bbFAzMUlpRDA0OFJsLW5IdjBWQzA3ZUlyekwwRkFXNFZPNFdkU0o3a25qYWpETFZIOFhZajVwck80M3E4ZGFKbWVESVlCdkVqa1ZhQTljcThma1pMc3kzQ19fX1ZfNXA3dzlqcnRaRGdZekgxdWM0ZWoyNFdQc2Q1dUlma0FIYzhTRGs4STJfSlI4VjRBdXNLb2UwSElqUmc1WTRPSFByVzB0dEs2WVhYSk96X1R6c2FEVXIzMTBQdng3Rmp1TnZGNDdQUDRPOUVYODVYc1VKTTdqX19ZRXEzOEwtZWZLOW1fR1lxUGRQdUVCcnktZmdhemNIYXR5UlBVRTBmUExPSFAxaTM4S0xmT256bGlsVEpYaEJoYjVjXzQzVmxnLUFKY2hvdmRXRUoyN1NDb3l6VnhGM2dweVp5T3ZKVmZURmQxcGo4MnlSdnk3YnpMMXZ0c2xSWUI3aVRDcU1YZ3NDSUNXbTh6aDJsUURTNTVSbC1aRDRMaVkyRzQycU1LRl9wM0cwMF0tLT48L2c+PC9zdmc+'>\n\n<p>AnnotationAwareAspectJAutoProxyCreator 类的关系图如下，</p>\n<img src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjcxMHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTI4NXB4O2hlaWdodDo3MTBweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjg1IDcxMCIgd2lkdGg9IjEyODVweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbGFzcyBBd2FyZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJBd2FyZSIgZGF0YS1zb3VyY2UtbGluZT0iMSIgZGF0YS11aWQ9ImVudDAwMDIiIGlkPSJlbnRpdHlfQXdhcmUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijc1Ljk3NTYiIHg9IjE1OS4wNSIgeT0iMTE1Ii8+PGVsbGlwc2UgY3g9IjE3NC4wNSIgY3k9IjEzMSIgZmlsbD0iI0I0QTdFNSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMTY5Ljk3MTksMTI2Ljc2NTYgTDE2OS45NzE5LDEyNC42MDk0IEwxNzcuMzYyNSwxMjQuNjA5NCBMMTc3LjM2MjUsMTI2Ljc2NTYgTDE3NC44OTM4LDEyNi43NjU2IEwxNzQuODkzOCwxMzQuODQzOCBMMTc3LjM2MjUsMTM0Ljg0MzggTDE3Ny4zNjI1LDEzNyBMMTY5Ljk3MTksMTM3IEwxNjkuOTcxOSwxMzQuODQzOCBMMTcyLjQ0MDYsMTM0Ljg0MzggTDE3Mi40NDA2LDEyNi43NjU2IEwxNjkuOTcxOSwxMjYuNzY1NiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXN0eWxlPSJpdGFsaWMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDMuOTc1NiIgeD0iMTg4LjA1IiB5PSIxMzUuODQ2NyI+QXdhcmU8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTYwLjA1IiB4Mj0iMjM0LjAyNTYiIHkxPSIxNDciIHkyPSIxNDciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNjAuMDUiIHgyPSIyMzQuMDI1NiIgeTE9IjE1NSIgeTI9IjE1NSIvPjwvZz48IS0tY2xhc3MgQmVhbkZhY3RvcnlBd2FyZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJCZWFuRmFjdG9yeUF3YXJlIiBkYXRhLXNvdXJjZS1saW5lPSIyIiBkYXRhLXVpZD0iZW50MDAwMyIgaWQ9ImVudGl0eV9CZWFuRmFjdG9yeUF3YXJlIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjQuMDcwMyIgeD0iNyIgeT0iMjIzIi8+PGVsbGlwc2UgY3g9IjIyIiBjeT0iMjM5IiBmaWxsPSIjQjRBN0U1IiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0xNy45MjE5LDIzNC43NjU2IEwxNy45MjE5LDIzMi42MDk0IEwyNS4zMTI1LDIzMi42MDk0IEwyNS4zMTI1LDIzNC43NjU2IEwyMi44NDM4LDIzNC43NjU2IEwyMi44NDM4LDI0Mi44NDM4IEwyNS4zMTI1LDI0Mi44NDM4IEwyNS4zMTI1LDI0NSBMMTcuOTIxOSwyNDUgTDE3LjkyMTksMjQyLjg0MzggTDIwLjM5MDYsMjQyLjg0MzggTDIwLjM5MDYsMjM0Ljc2NTYgTDE3LjkyMTksMjM0Ljc2NTYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMi4wNzAzIiB4PSIzNiIgeT0iMjQzLjg0NjciPkJlYW5GYWN0b3J5QXdhcmU8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOCIgeDI9IjE3MC4wNzAzIiB5MT0iMjU1IiB5Mj0iMjU1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOCIgeDI9IjE3MC4wNzAzIiB5MT0iMjYzIiB5Mj0iMjYzIi8+PC9nPjwhLS1jbGFzcyBCZWFuQ2xhc3NMb2FkZXJBd2FyZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJCZWFuQ2xhc3NMb2FkZXJBd2FyZSIgZGF0YS1zb3VyY2UtbGluZT0iMyIgZGF0YS11aWQ9ImVudDAwMDQiIGlkPSJlbnRpdHlfQmVhbkNsYXNzTG9hZGVyQXdhcmUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE5Ni42Nzc3IiB4PSIyMDUuNyIgeT0iMjIzIi8+PGVsbGlwc2UgY3g9IjIyMC43IiBjeT0iMjM5IiBmaWxsPSIjQjRBN0U1IiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0yMTYuNjIxOSwyMzQuNzY1NiBMMjE2LjYyMTksMjMyLjYwOTQgTDIyNC4wMTI1LDIzMi42MDk0IEwyMjQuMDEyNSwyMzQuNzY1NiBMMjIxLjU0MzgsMjM0Ljc2NTYgTDIyMS41NDM4LDI0Mi44NDM4IEwyMjQuMDEyNSwyNDIuODQzOCBMMjI0LjAxMjUsMjQ1IEwyMTYuNjIxOSwyNDUgTDIxNi42MjE5LDI0Mi44NDM4IEwyMTkuMDkwNiwyNDIuODQzOCBMMjE5LjA5MDYsMjM0Ljc2NTYgTDIxNi42MjE5LDIzNC43NjU2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjQuNjc3NyIgeD0iMjM0LjciIHk9IjI0My44NDY3Ij5CZWFuQ2xhc3NMb2FkZXJBd2FyZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMDYuNyIgeDI9IjQwMS4zNzc3IiB5MT0iMjU1IiB5Mj0iMjU1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjA2LjciIHgyPSI0MDEuMzc3NyIgeTE9IjI2MyIgeTI9IjI2MyIvPjwvZz48IS0tY2xhc3MgQmVhblBvc3RQcm9jZXNzb3ItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQmVhblBvc3RQcm9jZXNzb3IiIGRhdGEtc291cmNlLWxpbmU9IjQiIGRhdGEtdWlkPSJlbnQwMDA1IiBpZD0iZW50aXR5X0JlYW5Qb3N0UHJvY2Vzc29yIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjUuNDQ0MyIgeD0iNTI0LjMxIiB5PSI3Ii8+PGVsbGlwc2UgY3g9IjUzOS4zMSIgY3k9IjIzIiBmaWxsPSIjQjRBN0U1IiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik01MzUuMjMxOSwxOC43NjU2IEw1MzUuMjMxOSwxNi42MDk0IEw1NDIuNjIyNSwxNi42MDk0IEw1NDIuNjIyNSwxOC43NjU2IEw1NDAuMTUzOCwxOC43NjU2IEw1NDAuMTUzOCwyNi44NDM4IEw1NDIuNjIyNSwyNi44NDM4IEw1NDIuNjIyNSwyOSBMNTM1LjIzMTksMjkgTDUzNS4yMzE5LDI2Ljg0MzggTDUzNy43MDA2LDI2Ljg0MzggTDUzNy43MDA2LDE4Ljc2NTYgTDUzNS4yMzE5LDE4Ljc2NTYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMy40NDQzIiB4PSI1NTMuMzEiIHk9IjI3Ljg0NjciPkJlYW5Qb3N0UHJvY2Vzc29yPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjUyNS4zMSIgeDI9IjY4OC43NTQzIiB5MT0iMzkiIHkyPSIzOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjUyNS4zMSIgeDI9IjY4OC43NTQzIiB5MT0iNDciIHkyPSI0NyIvPjwvZz48IS0tY2xhc3MgSW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3ItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iSW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3IiIGRhdGEtc291cmNlLWxpbmU9IjUiIGRhdGEtdWlkPSJlbnQwMDA2IiBpZD0iZW50aXR5X0luc3RhbnRpYXRpb25Bd2FyZUJlYW5Qb3N0UHJvY2Vzc29yIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyOTcuNDMyNiIgeD0iNDU4LjMyIiB5PSIxMTUiLz48ZWxsaXBzZSBjeD0iNDczLjMyIiBjeT0iMTMxIiBmaWxsPSIjQjRBN0U1IiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik00NjkuMjQxOSwxMjYuNzY1NiBMNDY5LjI0MTksMTI0LjYwOTQgTDQ3Ni42MzI1LDEyNC42MDk0IEw0NzYuNjMyNSwxMjYuNzY1NiBMNDc0LjE2MzgsMTI2Ljc2NTYgTDQ3NC4xNjM4LDEzNC44NDM4IEw0NzYuNjMyNSwxMzQuODQzOCBMNDc2LjYzMjUsMTM3IEw0NjkuMjQxOSwxMzcgTDQ2OS4yNDE5LDEzNC44NDM4IEw0NzEuNzEwNiwxMzQuODQzOCBMNDcxLjcxMDYsMTI2Ljc2NTYgTDQ2OS4yNDE5LDEyNi43NjU2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNjUuNDMyNiIgeD0iNDg3LjMyIiB5PSIxMzUuODQ2NyI+SW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3I8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDU5LjMyIiB4Mj0iNzU0Ljc1MjYiIHkxPSIxNDciIHkyPSIxNDciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0NTkuMzIiIHgyPSI3NTQuNzUyNiIgeTE9IjE1NSIgeTI9IjE1NSIvPjwvZz48IS0tY2xhc3MgU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3Nvci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJTbWFydEluc3RhbnRpYXRpb25Bd2FyZUJlYW5Qb3N0UHJvY2Vzc29yIiBkYXRhLXNvdXJjZS1saW5lPSI2IiBkYXRhLXVpZD0iZW50MDAwNyIgaWQ9ImVudGl0eV9TbWFydEluc3RhbnRpYXRpb25Bd2FyZUJlYW5Qb3N0UHJvY2Vzc29yIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIzMzkuNzgxMyIgeD0iNDM3LjE0IiB5PSIyMjMiLz48ZWxsaXBzZSBjeD0iNDUyLjE0IiBjeT0iMjM5IiBmaWxsPSIjQjRBN0U1IiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik00NDguMDYxOSwyMzQuNzY1NiBMNDQ4LjA2MTksMjMyLjYwOTQgTDQ1NS40NTI1LDIzMi42MDk0IEw0NTUuNDUyNSwyMzQuNzY1NiBMNDUyLjk4MzgsMjM0Ljc2NTYgTDQ1Mi45ODM4LDI0Mi44NDM4IEw0NTUuNDUyNSwyNDIuODQzOCBMNDU1LjQ1MjUsMjQ1IEw0NDguMDYxOSwyNDUgTDQ0OC4wNjE5LDI0Mi44NDM4IEw0NTAuNTMwNiwyNDIuODQzOCBMNDUwLjUzMDYsMjM0Ljc2NTYgTDQ0OC4wNjE5LDIzNC43NjU2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMDcuNzgxMyIgeD0iNDY2LjE0IiB5PSIyNDMuODQ2NyI+U21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvcjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0MzguMTQiIHgyPSI3NzUuOTIxMyIgeTE9IjI1NSIgeTI9IjI1NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQzOC4xNCIgeDI9Ijc3NS45MjEzIiB5MT0iMjYzIiB5Mj0iMjYzIi8+PC9nPjwhLS1jbGFzcyBTZXJpYWxpemFibGUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iU2VyaWFsaXphYmxlIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBkYXRhLXVpZD0iZW50MDAwOCIgaWQ9ImVudGl0eV9TZXJpYWxpemFibGUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExMi44MjEzIiB4PSI4MTMuNjIiIHk9IjExNSIvPjxlbGxpcHNlIGN4PSI4MjguNjIiIGN5PSIxMzEiIGZpbGw9IiNCNEE3RTUiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTgyNC41NDE5LDEyNi43NjU2IEw4MjQuNTQxOSwxMjQuNjA5NCBMODMxLjkzMjUsMTI0LjYwOTQgTDgzMS45MzI1LDEyNi43NjU2IEw4MjkuNDYzOCwxMjYuNzY1NiBMODI5LjQ2MzgsMTM0Ljg0MzggTDgzMS45MzI1LDEzNC44NDM4IEw4MzEuOTMyNSwxMzcgTDgyNC41NDE5LDEzNyBMODI0LjU0MTksMTM0Ljg0MzggTDgyNy4wMTA2LDEzNC44NDM4IEw4MjcuMDEwNiwxMjYuNzY1NiBMODI0LjU0MTksMTI2Ljc2NTYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgwLjgyMTMiIHg9Ijg0Mi42MiIgeT0iMTM1Ljg0NjciPlNlcmlhbGl6YWJsZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4MTQuNjIiIHgyPSI5MjUuNDQxMyIgeTE9IjE0NyIgeTI9IjE0NyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjgxNC42MiIgeDI9IjkyNS40NDEzIiB5MT0iMTU1IiB5Mj0iMTU1Ii8+PC9nPjwhLS1jbGFzcyBQcm94eUNvbmZpZy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJQcm94eUNvbmZpZyIgZGF0YS1zb3VyY2UtbGluZT0iOCIgZGF0YS11aWQ9ImVudDAwMDkiIGlkPSJlbnRpdHlfUHJveHlDb25maWciPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExNi4yNTI5IiB4PSI4MTEuOTEiIHk9IjIyMyIvPjxlbGxpcHNlIGN4PSI4MjYuOTEiIGN5PSIyMzkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTgyOS44Nzg4LDI0NC42NDA2IFE4MjkuMzAwNiwyNDQuOTM3NSA4MjguNjYsMjQ1LjA3ODEgUTgyOC4wMTk0LDI0NS4yMzQ0IDgyNy4zMTYzLDI0NS4yMzQ0IFE4MjQuODE2MywyNDUuMjM0NCA4MjMuNDg4MSwyNDMuNTkzOCBRODIyLjE3NTYsMjQxLjkzNzUgODIyLjE3NTYsMjM4LjgxMjUgUTgyMi4xNzU2LDIzNS42ODc1IDgyMy40ODgxLDIzNC4wMzEzIFE4MjQuODE2MywyMzIuMzc1IDgyNy4zMTYzLDIzMi4zNzUgUTgyOC4wMTk0LDIzMi4zNzUgODI4LjY2LDIzMi41MzEzIFE4MjkuMzE2MywyMzIuNjg3NSA4MjkuODc4OCwyMzIuOTg0NCBMODI5Ljg3ODgsMjM1LjcwMzEgUTgyOS4yNTM4LDIzNS4xMjUgODI4LjY2LDIzNC44NTk0IFE4MjguMDY2MywyMzQuNTc4MSA4MjcuNDQxMywyMzQuNTc4MSBRODI2LjA5NzUsMjM0LjU3ODEgODI1LjQxLDIzNS42NTYzIFE4MjQuNzIyNSwyMzYuNzE4OCA4MjQuNzIyNSwyMzguODEyNSBRODI0LjcyMjUsMjQwLjkwNjMgODI1LjQxLDI0MS45ODQ0IFE4MjYuMDk3NSwyNDMuMDQ2OSA4MjcuNDQxMywyNDMuMDQ2OSBRODI4LjA2NjMsMjQzLjA0NjkgODI4LjY2LDI0Mi43ODEzIFE4MjkuMjUzOCwyNDIuNSA4MjkuODc4OCwyNDEuOTIxOSBMODI5Ljg3ODgsMjQ0LjY0MDYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4NC4yNTI5IiB4PSI4NDAuOTEiIHk9IjI0My44NDY3Ij5Qcm94eUNvbmZpZzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4MTIuOTEiIHgyPSI5MjcuMTYyOSIgeTE9IjI1NSIgeTI9IjI1NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjgxMi45MSIgeDI9IjkyNy4xNjI5IiB5MT0iMjYzIiB5Mj0iMjYzIi8+PC9nPjwhLS1jbGFzcyBBb3BJbmZyYXN0cnVjdHVyZUJlYW4tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQW9wSW5mcmFzdHJ1Y3R1cmVCZWFuIiBkYXRhLXNvdXJjZS1saW5lPSI5IiBkYXRhLXVpZD0iZW50MDAxMCIgaWQ9ImVudGl0eV9Bb3BJbmZyYXN0cnVjdHVyZUJlYW4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE5MC44MDU3IiB4PSI5NjMuNjMiIHk9IjIyMyIvPjxlbGxpcHNlIGN4PSI5NzguNjMiIGN5PSIyMzkiIGZpbGw9IiNCNEE3RTUiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTk3NC41NTE5LDIzNC43NjU2IEw5NzQuNTUxOSwyMzIuNjA5NCBMOTgxLjk0MjUsMjMyLjYwOTQgTDk4MS45NDI1LDIzNC43NjU2IEw5NzkuNDczOCwyMzQuNzY1NiBMOTc5LjQ3MzgsMjQyLjg0MzggTDk4MS45NDI1LDI0Mi44NDM4IEw5ODEuOTQyNSwyNDUgTDk3NC41NTE5LDI0NSBMOTc0LjU1MTksMjQyLjg0MzggTDk3Ny4wMjA2LDI0Mi44NDM4IEw5NzcuMDIwNiwyMzQuNzY1NiBMOTc0LjU1MTksMjM0Ljc2NTYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OC44MDU3IiB4PSI5OTIuNjMiIHk9IjI0My44NDY3Ij5Bb3BJbmZyYXN0cnVjdHVyZUJlYW48L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOTY0LjYzIiB4Mj0iMTE1My40MzU3IiB5MT0iMjU1IiB5Mj0iMjU1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOTY0LjYzIiB4Mj0iMTE1My40MzU3IiB5MT0iMjYzIiB5Mj0iMjYzIi8+PC9nPjwhLS1jbGFzcyBPcmRlcmVkLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ik9yZGVyZWQiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBkYXRhLXVpZD0iZW50MDAxMSIgaWQ9ImVudGl0eV9PcmRlcmVkIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4OS41MzEzIiB4PSIxMTg5LjI3IiB5PSIyMjMiLz48ZWxsaXBzZSBjeD0iMTIwNC4yNyIgY3k9IjIzOSIgZmlsbD0iI0I0QTdFNSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMTIwMC4xOTE5LDIzNC43NjU2IEwxMjAwLjE5MTksMjMyLjYwOTQgTDEyMDcuNTgyNSwyMzIuNjA5NCBMMTIwNy41ODI1LDIzNC43NjU2IEwxMjA1LjExMzgsMjM0Ljc2NTYgTDEyMDUuMTEzOCwyNDIuODQzOCBMMTIwNy41ODI1LDI0Mi44NDM4IEwxMjA3LjU4MjUsMjQ1IEwxMjAwLjE5MTksMjQ1IEwxMjAwLjE5MTksMjQyLjg0MzggTDEyMDIuNjYwNiwyNDIuODQzOCBMMTIwMi42NjA2LDIzNC43NjU2IEwxMjAwLjE5MTksMjM0Ljc2NTYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU3LjUzMTMiIHg9IjEyMTguMjciIHk9IjI0My44NDY3Ij5PcmRlcmVkPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjExOTAuMjciIHgyPSIxMjc3LjgwMTMiIHkxPSIyNTUiIHkyPSIyNTUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMTkwLjI3IiB4Mj0iMTI3Ny44MDEzIiB5MT0iMjYzIiB5Mj0iMjYzIi8+PC9nPjwhLS1jbGFzcyBBYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3ItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yIiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgZGF0YS11aWQ9ImVudDAwMTIiIGlkPSJlbnRpdHlfQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMTUuMTQxNiIgeD0iNjMwLjQ2IiB5PSIzMzEiLz48ZWxsaXBzZSBjeD0iNjQ1LjQ2IiBjeT0iMzQ3IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik02NDguNDI4OCwzNTIuNjQwNiBRNjQ3Ljg1MDYsMzUyLjkzNzUgNjQ3LjIxLDM1My4wNzgxIFE2NDYuNTY5NCwzNTMuMjM0NCA2NDUuODY2MywzNTMuMjM0NCBRNjQzLjM2NjMsMzUzLjIzNDQgNjQyLjAzODEsMzUxLjU5MzggUTY0MC43MjU2LDM0OS45Mzc1IDY0MC43MjU2LDM0Ni44MTI1IFE2NDAuNzI1NiwzNDMuNjg3NSA2NDIuMDM4MSwzNDIuMDMxMyBRNjQzLjM2NjMsMzQwLjM3NSA2NDUuODY2MywzNDAuMzc1IFE2NDYuNTY5NCwzNDAuMzc1IDY0Ny4yMSwzNDAuNTMxMyBRNjQ3Ljg2NjMsMzQwLjY4NzUgNjQ4LjQyODgsMzQwLjk4NDQgTDY0OC40Mjg4LDM0My43MDMxIFE2NDcuODAzOCwzNDMuMTI1IDY0Ny4yMSwzNDIuODU5NCBRNjQ2LjYxNjMsMzQyLjU3ODEgNjQ1Ljk5MTMsMzQyLjU3ODEgUTY0NC42NDc1LDM0Mi41NzgxIDY0My45NiwzNDMuNjU2MyBRNjQzLjI3MjUsMzQ0LjcxODggNjQzLjI3MjUsMzQ2LjgxMjUgUTY0My4yNzI1LDM0OC45MDYzIDY0My45NiwzNDkuOTg0NCBRNjQ0LjY0NzUsMzUxLjA0NjkgNjQ1Ljk5MTMsMzUxLjA0NjkgUTY0Ni42MTYzLDM1MS4wNDY5IDY0Ny4yMSwzNTAuNzgxMyBRNjQ3LjgwMzgsMzUwLjUgNjQ4LjQyODgsMzQ5LjkyMTkgTDY0OC40Mjg4LDM1Mi42NDA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTgzLjE0MTYiIHg9IjY1OS40NiIgeT0iMzUxLjg0NjciPkFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvcjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2MzEuNDYiIHgyPSI4NDQuNjAxNiIgeTE9IjM2MyIgeTI9IjM2MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjYzMS40NiIgeDI9Ijg0NC42MDE2IiB5MT0iMzcxIiB5Mj0iMzcxIi8+PC9nPjwhLS1jbGFzcyBBYnN0cmFjdEFkdmlzb3JBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkFic3RyYWN0QWR2aXNvckF1dG9Qcm94eUNyZWF0b3IiIGRhdGEtc291cmNlLWxpbmU9IjEyIiBkYXRhLXVpZD0iZW50MDAxMyIgaWQ9ImVudGl0eV9BYnN0cmFjdEFkdmlzb3JBdXRvUHJveHlDcmVhdG9yIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyNjcuMzk1NSIgeD0iNjA0LjM0IiB5PSI0MzkiLz48ZWxsaXBzZSBjeD0iNjE5LjM0IiBjeT0iNDU1IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik02MjIuMzA4OCw0NjAuNjQwNiBRNjIxLjczMDYsNDYwLjkzNzUgNjIxLjA5LDQ2MS4wNzgxIFE2MjAuNDQ5NCw0NjEuMjM0NCA2MTkuNzQ2Myw0NjEuMjM0NCBRNjE3LjI0NjMsNDYxLjIzNDQgNjE1LjkxODEsNDU5LjU5MzggUTYxNC42MDU2LDQ1Ny45Mzc1IDYxNC42MDU2LDQ1NC44MTI1IFE2MTQuNjA1Niw0NTEuNjg3NSA2MTUuOTE4MSw0NTAuMDMxMyBRNjE3LjI0NjMsNDQ4LjM3NSA2MTkuNzQ2Myw0NDguMzc1IFE2MjAuNDQ5NCw0NDguMzc1IDYyMS4wOSw0NDguNTMxMyBRNjIxLjc0NjMsNDQ4LjY4NzUgNjIyLjMwODgsNDQ4Ljk4NDQgTDYyMi4zMDg4LDQ1MS43MDMxIFE2MjEuNjgzOCw0NTEuMTI1IDYyMS4wOSw0NTAuODU5NCBRNjIwLjQ5NjMsNDUwLjU3ODEgNjE5Ljg3MTMsNDUwLjU3ODEgUTYxOC41Mjc1LDQ1MC41NzgxIDYxNy44NCw0NTEuNjU2MyBRNjE3LjE1MjUsNDUyLjcxODggNjE3LjE1MjUsNDU0LjgxMjUgUTYxNy4xNTI1LDQ1Ni45MDYzIDYxNy44NCw0NTcuOTg0NCBRNjE4LjUyNzUsNDU5LjA0NjkgNjE5Ljg3MTMsNDU5LjA0NjkgUTYyMC40OTYzLDQ1OS4wNDY5IDYyMS4wOSw0NTguNzgxMyBRNjIxLjY4MzgsNDU4LjUgNjIyLjMwODgsNDU3LjkyMTkgTDYyMi4zMDg4LDQ2MC42NDA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjM1LjM5NTUiIHg9IjYzMy4zNCIgeT0iNDU5Ljg0NjciPkFic3RyYWN0QWR2aXNvckF1dG9Qcm94eUNyZWF0b3I8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNjA1LjM0IiB4Mj0iODcwLjczNTUiIHkxPSI0NzEiIHkyPSI0NzEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2MDUuMzQiIHgyPSI4NzAuNzM1NSIgeTE9IjQ3OSIgeTI9IjQ3OSIvPjwvZz48IS0tY2xhc3MgQXNwZWN0SkF3YXJlQXV0b1Byb3h5Q3JlYXRvci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJBc3BlY3RKQXdhcmVBdXRvUHJveHlDcmVhdG9yIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgZGF0YS11aWQ9ImVudDAwMTQiIGlkPSJlbnRpdHlfQXNwZWN0SkF3YXJlQXV0b1Byb3h5Q3JlYXRvciI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0OCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjUyLjAzNTIiIHg9IjYxMi4wMiIgeT0iNTQ3Ii8+PGVsbGlwc2UgY3g9IjYyNy4wMiIgY3k9IjU2MyIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNNjI5Ljk4ODgsNTY4LjY0MDYgUTYyOS40MTA2LDU2OC45Mzc1IDYyOC43Nyw1NjkuMDc4MSBRNjI4LjEyOTQsNTY5LjIzNDQgNjI3LjQyNjMsNTY5LjIzNDQgUTYyNC45MjYzLDU2OS4yMzQ0IDYyMy41OTgxLDU2Ny41OTM4IFE2MjIuMjg1Niw1NjUuOTM3NSA2MjIuMjg1Niw1NjIuODEyNSBRNjIyLjI4NTYsNTU5LjY4NzUgNjIzLjU5ODEsNTU4LjAzMTMgUTYyNC45MjYzLDU1Ni4zNzUgNjI3LjQyNjMsNTU2LjM3NSBRNjI4LjEyOTQsNTU2LjM3NSA2MjguNzcsNTU2LjUzMTMgUTYyOS40MjYzLDU1Ni42ODc1IDYyOS45ODg4LDU1Ni45ODQ0IEw2MjkuOTg4OCw1NTkuNzAzMSBRNjI5LjM2MzgsNTU5LjEyNSA2MjguNzcsNTU4Ljg1OTQgUTYyOC4xNzYzLDU1OC41NzgxIDYyNy41NTEzLDU1OC41NzgxIFE2MjYuMjA3NSw1NTguNTc4MSA2MjUuNTIsNTU5LjY1NjMgUTYyNC44MzI1LDU2MC43MTg4IDYyNC44MzI1LDU2Mi44MTI1IFE2MjQuODMyNSw1NjQuOTA2MyA2MjUuNTIsNTY1Ljk4NDQgUTYyNi4yMDc1LDU2Ny4wNDY5IDYyNy41NTEzLDU2Ny4wNDY5IFE2MjguMTc2Myw1NjcuMDQ2OSA2MjguNzcsNTY2Ljc4MTMgUTYyOS4zNjM4LDU2Ni41IDYyOS45ODg4LDU2NS45MjE5IEw2MjkuOTg4OCw1NjguNjQwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyMC4wMzUyIiB4PSI2NDEuMDIiIHk9IjU2Ny44NDY3Ij5Bc3BlY3RKQXdhcmVBdXRvUHJveHlDcmVhdG9yPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjYxMy4wMiIgeDI9Ijg2My4wNTUyIiB5MT0iNTc5IiB5Mj0iNTc5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNjEzLjAyIiB4Mj0iODYzLjA1NTIiIHkxPSI1ODciIHkyPSI1ODciLz48L2c+PCEtLWNsYXNzIEFubm90YXRpb25Bd2FyZUFzcGVjdEpBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkFubm90YXRpb25Bd2FyZUFzcGVjdEpBdXRvUHJveHlDcmVhdG9yIiBkYXRhLXNvdXJjZS1saW5lPSIxNCIgZGF0YS11aWQ9ImVudDAwMTUiIGlkPSJlbnRpdHlfQW5ub3RhdGlvbkF3YXJlQXNwZWN0SkF1dG9Qcm94eUNyZWF0b3IiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjMyOC44MDk2IiB4PSI1NzMuNjMiIHk9IjY1NSIvPjxlbGxpcHNlIGN4PSI1ODguNjMiIGN5PSI2NzEiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTU5MS41OTg4LDY3Ni42NDA2IFE1OTEuMDIwNiw2NzYuOTM3NSA1OTAuMzgsNjc3LjA3ODEgUTU4OS43Mzk0LDY3Ny4yMzQ0IDU4OS4wMzYzLDY3Ny4yMzQ0IFE1ODYuNTM2Myw2NzcuMjM0NCA1ODUuMjA4MSw2NzUuNTkzOCBRNTgzLjg5NTYsNjczLjkzNzUgNTgzLjg5NTYsNjcwLjgxMjUgUTU4My44OTU2LDY2Ny42ODc1IDU4NS4yMDgxLDY2Ni4wMzEzIFE1ODYuNTM2Myw2NjQuMzc1IDU4OS4wMzYzLDY2NC4zNzUgUTU4OS43Mzk0LDY2NC4zNzUgNTkwLjM4LDY2NC41MzEzIFE1OTEuMDM2Myw2NjQuNjg3NSA1OTEuNTk4OCw2NjQuOTg0NCBMNTkxLjU5ODgsNjY3LjcwMzEgUTU5MC45NzM4LDY2Ny4xMjUgNTkwLjM4LDY2Ni44NTk0IFE1ODkuNzg2Myw2NjYuNTc4MSA1ODkuMTYxMyw2NjYuNTc4MSBRNTg3LjgxNzUsNjY2LjU3ODEgNTg3LjEzLDY2Ny42NTYzIFE1ODYuNDQyNSw2NjguNzE4OCA1ODYuNDQyNSw2NzAuODEyNSBRNTg2LjQ0MjUsNjcyLjkwNjMgNTg3LjEzLDY3My45ODQ0IFE1ODcuODE3NSw2NzUuMDQ2OSA1ODkuMTYxMyw2NzUuMDQ2OSBRNTg5Ljc4NjMsNjc1LjA0NjkgNTkwLjM4LDY3NC43ODEzIFE1OTAuOTczOCw2NzQuNSA1OTEuNTk4OCw2NzMuOTIxOSBMNTkxLjU5ODgsNjc2LjY0MDYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOTYuODA5NiIgeD0iNjAyLjYzIiB5PSI2NzUuODQ2NyI+QW5ub3RhdGlvbkF3YXJlQXNwZWN0SkF1dG9Qcm94eUNyZWF0b3I8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNTc0LjYzIiB4Mj0iOTAxLjQzOTYiIHkxPSI2ODciIHkyPSI2ODciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI1NzQuNjMiIHgyPSI5MDEuNDM5NiIgeTE9IjY5NSIgeTI9IjY5NSIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIEF3YXJlIHRvIEJlYW5GYWN0b3J5QXdhcmUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iQXdhcmUiIGRhdGEtZW50aXR5LTI9IkJlYW5GYWN0b3J5QXdhcmUiIGRhdGEtc291cmNlLWxpbmU9IjE1IiBkYXRhLXVpZD0ibG5rMTYiIGlkPSJsaW5rX0F3YXJlX0JlYW5GYWN0b3J5QXdhcmUiPjxwYXRoIGNvZGVMaW5lPSIxNSIgZD0iTTE2MC40ODg0LDE3NS44NzMzIEMxNDIuNDg4NCwxOTMuNTUzMyAxMzAuNjcsMjA1LjEzIDExMi42OCwyMjIuNzkiIGZpbGw9Im5vbmUiIGlkPSJBd2FyZS1iYWNrdG8tQmVhbkZhY3RvcnlBd2FyZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iMTczLjMzLDE2My4yNiwxNTYuMjg0LDE3MS41OTI3LDE2NC42OTI5LDE4MC4xNTM4LDE3My4zMywxNjMuMjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBBd2FyZSB0byBCZWFuQ2xhc3NMb2FkZXJBd2FyZS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJBd2FyZSIgZGF0YS1lbnRpdHktMj0iQmVhbkNsYXNzTG9hZGVyQXdhcmUiIGRhdGEtc291cmNlLWxpbmU9IjE2IiBkYXRhLXVpZD0ibG5rMTciIGlkPSJsaW5rX0F3YXJlX0JlYW5DbGFzc0xvYWRlckF3YXJlIj48cGF0aCBjb2RlTGluZT0iMTYiIGQ9Ik0yMzMuMzA1MSwxNzUuOTMwNSBDMjUxLjE0NTEsMTkzLjYxMDUgMjYyLjc4LDIwNS4xMyAyODAuNjEsMjIyLjc5IiBmaWxsPSJub25lIiBpZD0iQXdhcmUtYmFja3RvLUJlYW5DbGFzc0xvYWRlckF3YXJlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0ibm9uZSIgcG9pbnRzPSIyMjAuNTIsMTYzLjI2LDIyOS4wODE2LDE4MC4xOTIyLDIzNy41Mjg2LDE3MS42Njg4LDIyMC41MiwxNjMuMjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBCZWFuUG9zdFByb2Nlc3NvciB0byBJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3Nvci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJCZWFuUG9zdFByb2Nlc3NvciIgZGF0YS1lbnRpdHktMj0iSW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3IiIGRhdGEtc291cmNlLWxpbmU9IjE3IiBkYXRhLXVpZD0ibG5rMTgiIGlkPSJsaW5rX0JlYW5Qb3N0UHJvY2Vzc29yX0luc3RhbnRpYXRpb25Bd2FyZUJlYW5Qb3N0UHJvY2Vzc29yIj48cGF0aCBjb2RlTGluZT0iMTciIGQ9Ik02MDcuMDQsNzMuMjYgQzYwNy4wNCw5MC45NCA2MDcuMDQsOTcuMTMgNjA3LjA0LDExNC43OSIgZmlsbD0ibm9uZSIgaWQ9IkJlYW5Qb3N0UHJvY2Vzc29yLWJhY2t0by1JbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iNjA3LjA0LDU1LjI2LDYwMS4wNCw3My4yNiw2MTMuMDQsNzMuMjYsNjA3LjA0LDU1LjI2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgSW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3IgdG8gU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3Nvci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciIgZGF0YS1lbnRpdHktMj0iU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciIgZGF0YS1zb3VyY2UtbGluZT0iMTgiIGRhdGEtdWlkPSJsbmsxOSIgaWQ9ImxpbmtfSW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3JfU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciI+PHBhdGggY29kZUxpbmU9IjE4IiBkPSJNNjA3LjA0LDE4MS4yNiBDNjA3LjA0LDE5OC45NCA2MDcuMDQsMjA1LjEzIDYwNy4wNCwyMjIuNzkiIGZpbGw9Im5vbmUiIGlkPSJJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3Nvci1iYWNrdG8tU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iNjA3LjA0LDE2My4yNiw2MDEuMDQsMTgxLjI2LDYxMy4wNCwxODEuMjYsNjA3LjA0LDE2My4yNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIFNlcmlhbGl6YWJsZSB0byBQcm94eUNvbmZpZy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJTZXJpYWxpemFibGUiIGRhdGEtZW50aXR5LTI9IlByb3h5Q29uZmlnIiBkYXRhLXNvdXJjZS1saW5lPSIxOSIgZGF0YS11aWQ9ImxuazIwIiBpZD0ibGlua19TZXJpYWxpemFibGVfUHJveHlDb25maWciPjxwYXRoIGNvZGVMaW5lPSIxOSIgZD0iTTg3MC4wNCwxODEuMjYgQzg3MC4wNCwxOTguOTQgODcwLjA0LDIwNS4xMyA4NzAuMDQsMjIyLjc5IiBmaWxsPSJub25lIiBpZD0iU2VyaWFsaXphYmxlLWJhY2t0by1Qcm94eUNvbmZpZyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iODcwLjA0LDE2My4yNiw4NjQuMDQsMTgxLjI2LDg3Ni4wNCwxODEuMjYsODcwLjA0LDE2My4yNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIEJlYW5GYWN0b3J5QXdhcmUgdG8gQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkJlYW5GYWN0b3J5QXdhcmUiIGRhdGEtZW50aXR5LTI9IkFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciIgZGF0YS1zb3VyY2UtbGluZT0iMjAiIGRhdGEtdWlkPSJsbmsyMSIgaWQ9ImxpbmtfQmVhbkZhY3RvcnlBd2FyZV9BYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiPjxwYXRoIGNvZGVMaW5lPSIyMCIgZD0iTTE4OC45MjM2LDI3MS4zMzk4IEMzNDEuNjIzNiwzMDAuNTQ5OCA1MTguOTEsMzI1LjUxIDYzMC4xMSwzNDAuMjYiIGZpbGw9Im5vbmUiIGlkPSJCZWFuRmFjdG9yeUF3YXJlLWJhY2t0by1BYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48cG9seWdvbiBmaWxsPSJub25lIiBwb2ludHM9IjE3MS4zMSwyNjcuNjMsMTg3LjY4NywyNzcuMjEwOSwxOTAuMTYwMiwyNjUuNDY4NiwxNzEuMzEsMjY3LjYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgQmVhbkNsYXNzTG9hZGVyQXdhcmUgdG8gQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkJlYW5DbGFzc0xvYWRlckF3YXJlIiBkYXRhLWVudGl0eS0yPSJBYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiIGRhdGEtc291cmNlLWxpbmU9IjIxIiBkYXRhLXVpZD0ibG5rMjIiIGlkPSJsaW5rX0JlYW5DbGFzc0xvYWRlckF3YXJlX0Fic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciI+PHBhdGggY29kZUxpbmU9IjIxIiBkPSJNNDE3LjU2NjIsMjc1LjczIEM0ODkuNDc2MiwyOTMuMjkgNTY5LjkzLDMxMi45NCA2NDEuODcsMzMwLjUxIiBmaWxsPSJub25lIiBpZD0iQmVhbkNsYXNzTG9hZGVyQXdhcmUtYmFja3RvLUFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iNDAwLjA4LDI3MS40Niw0MTYuMTQyOCwyODEuNTU4OCw0MTguOTg5NSwyNjkuOTAxMyw0MDAuMDgsMjcxLjQ2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciB0byBBYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3ItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciIgZGF0YS1lbnRpdHktMj0iQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yIiBkYXRhLXNvdXJjZS1saW5lPSIyMiIgZGF0YS11aWQ9ImxuazIzIiBpZD0ibGlua19TbWFydEluc3RhbnRpYXRpb25Bd2FyZUJlYW5Qb3N0UHJvY2Vzc29yX0Fic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciI+PHBhdGggY29kZUxpbmU9IjIyIiBkPSJNNjQ5Ljc3MjksMjgyLjU4MjQgQzY3MS42MjI5LDMwMC4yNjI0IDY4Ny41MywzMTMuMTMgNzA5LjM1LDMzMC43OSIgZmlsbD0ibm9uZSIgaWQ9IlNtYXJ0SW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3ItYmFja3RvLUFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iNjM1Ljc4LDI3MS4yNiw2NDUuOTk4OCwyODcuMjQ2OCw2NTMuNTQ3MSwyNzcuOTE4MSw2MzUuNzgsMjcxLjI2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgUHJveHlDb25maWcgdG8gQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlByb3h5Q29uZmlnIiBkYXRhLWVudGl0eS0yPSJBYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiIGRhdGEtc291cmNlLWxpbmU9IjIzIiBkYXRhLXVpZD0ibG5rMjQiIGlkPSJsaW5rX1Byb3h5Q29uZmlnX0Fic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciI+PHBhdGggY29kZUxpbmU9IjIzIiBkPSJNODI3LjAzNjgsMjgyLjUzMjUgQzgwNS4wMjY4LDMwMC4yMTI1IDc4OC45MywzMTMuMTMgNzY2Ljk0LDMzMC43OSIgZmlsbD0ibm9uZSIgaWQ9IlByb3h5Q29uZmlnLWJhY2t0by1BYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSJub25lIiBwb2ludHM9Ijg0MS4wNywyNzEuMjYsODIzLjI3OTMsMjc3Ljg1NDcsODMwLjc5NDMsMjg3LjIxMDIsODQxLjA3LDI3MS4yNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIEFvcEluZnJhc3RydWN0dXJlQmVhbiB0byBBYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3ItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iQW9wSW5mcmFzdHJ1Y3R1cmVCZWFuIiBkYXRhLWVudGl0eS0yPSJBYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiIGRhdGEtc291cmNlLWxpbmU9IjI0IiBkYXRhLXVpZD0ibG5rMjUiIGlkPSJsaW5rX0FvcEluZnJhc3RydWN0dXJlQmVhbl9BYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiPjxwYXRoIGNvZGVMaW5lPSIyNCIgZD0iTTk3MS4wOTgsMjc3LjAzNDkgQzkxNy44MzgsMjk0LjYyNDkgODYyLjI2LDMxMi45OCA4MDguOTcsMzMwLjU3IiBmaWxsPSJub25lIiBpZD0iQW9wSW5mcmFzdHJ1Y3R1cmVCZWFuLWJhY2t0by1BYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48cG9seWdvbiBmaWxsPSJub25lIiBwb2ludHM9Ijk4OC4xOSwyNzEuMzksOTY5LjIxNjQsMjcxLjMzNzYsOTcyLjk3OTcsMjgyLjczMjIsOTg4LjE5LDI3MS4zOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIE9yZGVyZWQgdG8gQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9Ik9yZGVyZWQiIGRhdGEtZW50aXR5LTI9IkFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciIgZGF0YS1zb3VyY2UtbGluZT0iMjUiIGRhdGEtdWlkPSJsbmsyNiIgaWQ9ImxpbmtfT3JkZXJlZF9BYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiPjxwYXRoIGNvZGVMaW5lPSIyNSIgZD0iTTExNzEuOTE2NCwyNzEuNTI4NiBDMTA2Mi4zNjY0LDMwMi4wODg2IDkzNC4yOCwzMjQuNTYgODQ1Ljc1LDMzOC41MSIgZmlsbD0ibm9uZSIgaWQ9Ik9yZGVyZWQtYmFja3RvLUFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iMTE4OC45NSwyNjUuNzEsMTE2OS45NzY5LDI2NS44NTA3LDExNzMuODU1OSwyNzcuMjA2NCwxMTg4Ljk1LDI2NS43MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIEFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciB0byBBYnN0cmFjdEFkdmlzb3JBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciIgZGF0YS1lbnRpdHktMj0iQWJzdHJhY3RBZHZpc29yQXV0b1Byb3h5Q3JlYXRvciIgZGF0YS1zb3VyY2UtbGluZT0iMjYiIGRhdGEtdWlkPSJsbmsyNyIgaWQ9ImxpbmtfQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yX0Fic3RyYWN0QWR2aXNvckF1dG9Qcm94eUNyZWF0b3IiPjxwYXRoIGNvZGVMaW5lPSIyNiIgZD0iTTczOC4wNCwzOTcuMjYgQzczOC4wNCw0MTQuOTQgNzM4LjA0LDQyMS4xMyA3MzguMDQsNDM4Ljc5IiBmaWxsPSJub25lIiBpZD0iQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yLWJhY2t0by1BYnN0cmFjdEFkdmlzb3JBdXRvUHJveHlDcmVhdG9yIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0ibm9uZSIgcG9pbnRzPSI3MzguMDQsMzc5LjI2LDczMi4wNCwzOTcuMjYsNzQ0LjA0LDM5Ny4yNiw3MzguMDQsMzc5LjI2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgQWJzdHJhY3RBZHZpc29yQXV0b1Byb3h5Q3JlYXRvciB0byBBc3BlY3RKQXdhcmVBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkFic3RyYWN0QWR2aXNvckF1dG9Qcm94eUNyZWF0b3IiIGRhdGEtZW50aXR5LTI9IkFzcGVjdEpBd2FyZUF1dG9Qcm94eUNyZWF0b3IiIGRhdGEtc291cmNlLWxpbmU9IjI3IiBkYXRhLXVpZD0ibG5rMjgiIGlkPSJsaW5rX0Fic3RyYWN0QWR2aXNvckF1dG9Qcm94eUNyZWF0b3JfQXNwZWN0SkF3YXJlQXV0b1Byb3h5Q3JlYXRvciI+PHBhdGggY29kZUxpbmU9IjI3IiBkPSJNNzM4LjA0LDUwNS4yNiBDNzM4LjA0LDUyMi45NCA3MzguMDQsNTI5LjEzIDczOC4wNCw1NDYuNzkiIGZpbGw9Im5vbmUiIGlkPSJBYnN0cmFjdEFkdmlzb3JBdXRvUHJveHlDcmVhdG9yLWJhY2t0by1Bc3BlY3RKQXdhcmVBdXRvUHJveHlDcmVhdG9yIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0ibm9uZSIgcG9pbnRzPSI3MzguMDQsNDg3LjI2LDczMi4wNCw1MDUuMjYsNzQ0LjA0LDUwNS4yNiw3MzguMDQsNDg3LjI2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgQXNwZWN0SkF3YXJlQXV0b1Byb3h5Q3JlYXRvciB0byBBbm5vdGF0aW9uQXdhcmVBc3BlY3RKQXV0b1Byb3h5Q3JlYXRvci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJBc3BlY3RKQXdhcmVBdXRvUHJveHlDcmVhdG9yIiBkYXRhLWVudGl0eS0yPSJBbm5vdGF0aW9uQXdhcmVBc3BlY3RKQXV0b1Byb3h5Q3JlYXRvciIgZGF0YS1zb3VyY2UtbGluZT0iMjgiIGRhdGEtdWlkPSJsbmsyOSIgaWQ9ImxpbmtfQXNwZWN0SkF3YXJlQXV0b1Byb3h5Q3JlYXRvcl9Bbm5vdGF0aW9uQXdhcmVBc3BlY3RKQXV0b1Byb3h5Q3JlYXRvciI+PHBhdGggY29kZUxpbmU9IjI4IiBkPSJNNzM4LjA0LDYxMy4yNiBDNzM4LjA0LDYzMC45NCA3MzguMDQsNjM3LjEzIDczOC4wNCw2NTQuNzkiIGZpbGw9Im5vbmUiIGlkPSJBc3BlY3RKQXdhcmVBdXRvUHJveHlDcmVhdG9yLWJhY2t0by1Bbm5vdGF0aW9uQXdhcmVBc3BlY3RKQXV0b1Byb3h5Q3JlYXRvciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iNzM4LjA0LDU5NS4yNiw3MzIuMDQsNjEzLjI2LDc0NC4wNCw2MTMuMjYsNzM4LjA0LDU5NS4yNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tU1JDPVtiUDlESmlDbTQ4TnRGS0trcTl3V2NyMDlnSEtJYkpaMXI5YVdJeTVKWklVNThXd0ZZR0RyZEpXc296N3h0akZ5UUlGOEJJWWl3ZFRXTkVjXy1XNzFGODhJdWtrU2pFbDBzWVUyMWRiRUZmQUw4dkQyUXVhM1JNLWlXMTREZWlhQ25ZTnd2R3JPX2NiMXJqM2ZKcFhyazU4X0pMT0UteFprb0JKd0RHMWhFa3pEb3MyNVVvTXpKbXRxUHRRWk9KRGNyMlY3a010S2xQM0ZPbUl0Y3JYa0JqaHJhd0JpNlBLU1hYYklZMzRhanFiXzdKNHlZRE5zUXhzVXRZZEk5ZVVRUkMtcDlNaWtPN25PeVU3MlNwZGhQZER0aE5Xc0pvSGxDSlRrbmJCUVEyT2NRRGVsODRkRWxicWNWTnA1QWVFYlhBWVpuOGpjejM1YXdPRU5uRDVVekR0Vl0tLT48L2c+PC9zdmc+'>\n\n<p><strong>AOP核心就是创建 AnnotationAwareAspectJAutoProxyCreator 对象</strong>。</p>\n<p>该类最终实现了接口 BeanPostProcessor （后置处理器）。创建后置处理器的对象放在容器中。<br>（最终创建的BeanID为AUTO_PROXY_CREATOR_BEAN_NAME &#x3D; “org.springframework.aop.config.internalAutoProxyCreator”）<br>（其实所有注解都有对应的后置处理器）。</p>\n<p>其他Bean组件创建对象的时候，都会被 AnnotationAwareAspectJAutoProxyCreator 拦截，影响其创建过程。</p>\n<p>普通单例Bean的创建是在 容器执行 finishBeanFactoryInitialization 方法时。但如果是一个实现了 BeanPostProcessor 接口的Bean，则其创建的过程会更早发生，在执行 registerBeanPostProcessors 方法时就会创建。</p>\n<img src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjkxMnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTY4OHB4O2hlaWdodDo5MTJweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNjg4IDkxMiIgd2lkdGg9IjE2ODhweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMTI0LjY2NDEiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjQzNS40NDk0IiB4PSIxMjQ2Ljc2MDgiIHk9IjM4NS4wMjM0Ii8+PGc+PHRpdGxlPkFic3RyYWN0QXBwbGljYXRpb25Db250ZXh0PC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iODQwLjcxODgiIHdpZHRoPSI4IiB4PSIxMDQuMDQxNSIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjEwOCIgeDI9IjEwOCIgeTE9IjM2LjI5NjkiIHkyPSI4NzcuMDE1NiIvPjwvZz48Zz48dGl0bGU+UG9zdFByb2Nlc3NvclJlZ2lzdHJhdGlvbkRlbGVnYXRlPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iODQwLjcxODgiIHdpZHRoPSI4IiB4PSIzNDcuMjI5IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iMzUxLjA4MyIgeDI9IjM1MS4wODMiIHkxPSIzNi4yOTY5IiB5Mj0iODc3LjAxNTYiLz48L2c+PGc+PHRpdGxlPkRlZmF1bHRMaXN0YWJsZUJlYW5GYWN0b3J5PC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iODQwLjcxODgiIHdpZHRoPSI4IiB4PSI1OTEuMjE5NyIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjU5NC4zNzUiIHgyPSI1OTQuMzc1IiB5MT0iMzYuMjk2OSIgeTI9Ijg3Ny4wMTU2Ii8+PC9nPjxnPjx0aXRsZT5BYnN0cmFjdEJlYW5GYWN0b3J5PC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iODQwLjcxODgiIHdpZHRoPSI4IiB4PSI3ODUuNDk2MSIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9Ijc4OS4wNjQ1IiB4Mj0iNzg5LjA2NDUiIHkxPSIzNi4yOTY5IiB5Mj0iODc3LjAxNTYiLz48L2c+PGc+PHRpdGxlPkRlZmF1bHRTaW5nbGV0b25CZWFuUmVnaXN0cnk8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI4NDAuNzE4OCIgd2lkdGg9IjgiIHg9IjEwMDguMzc0NSIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjEwMTIuMDA4OCIgeDI9IjEwMTIuMDA4OCIgeTE9IjM2LjI5NjkiIHkyPSI4NzcuMDE1NiIvPjwvZz48Zz48dGl0bGU+T2JqZWN0RmFjdG9yeTwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9Ijg0MC43MTg4IiB3aWR0aD0iOCIgeD0iMTE4Ni43NTA1IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iMTE5MC43NDAzIiB4Mj0iMTE5MC43NDAzIiB5MT0iMzYuMjk2OSIgeTI9Ijg3Ny4wMTU2Ii8+PC9nPjxnPjx0aXRsZT5BYnN0cmFjdEF1dG93aXJlQ2FwYWJsZUJlYW5GYWN0b3J5PC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iODQwLjcxODgiIHdpZHRoPSI4IiB4PSIxMzkyLjkwNDMiIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSIxMzk2Ljc2MDgiIHgyPSIxMzk2Ljc2MDgiIHkxPSIzNi4yOTY5IiB5Mj0iODc3LjAxNTYiLz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtcGFydGljaXBhbnQ9IkFic3RyYWN0QXBwbGljYXRpb25Db250ZXh0Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIwNi4wODMiIHg9IjUiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTIuMDgzIiB4PSIxMiIgeT0iMjQuOTk1MSI+QWJzdHJhY3RBcHBsaWNhdGlvbkNvbnRleHQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLXBhcnRpY2lwYW50PSJBYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMDYuMDgzIiB4PSI1IiB5PSI4NzYuMDE1NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5Mi4wODMiIHg9IjEyIiB5PSI4OTYuMDEwNyI+QWJzdHJhY3RBcHBsaWNhdGlvbkNvbnRleHQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJQb3N0UHJvY2Vzc29yUmVnaXN0cmF0aW9uRGVsZWdhdGUiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjYwLjI5MiIgeD0iMjIxLjA4MyIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI0Ni4yOTIiIHg9IjIyOC4wODMiIHk9IjI0Ljk5NTEiPlBvc3RQcm9jZXNzb3JSZWdpc3RyYXRpb25EZWxlZ2F0ZTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9IlBvc3RQcm9jZXNzb3JSZWdpc3RyYXRpb25EZWxlZ2F0ZSI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyNjAuMjkyIiB4PSIyMjEuMDgzIiB5PSI4NzYuMDE1NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI0Ni4yOTIiIHg9IjIyOC4wODMiIHk9Ijg5Ni4wMTA3Ij5Qb3N0UHJvY2Vzc29yUmVnaXN0cmF0aW9uRGVsZWdhdGU8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJEZWZhdWx0TGlzdGFibGVCZWFuRmFjdG9yeSI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMDcuNjg5NSIgeD0iNDkxLjM3NSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5My42ODk1IiB4PSI0OTguMzc1IiB5PSIyNC45OTUxIj5EZWZhdWx0TGlzdGFibGVCZWFuRmFjdG9yeTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9IkRlZmF1bHRMaXN0YWJsZUJlYW5GYWN0b3J5Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIwNy42ODk1IiB4PSI0OTEuMzc1IiB5PSI4NzYuMDE1NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5My42ODk1IiB4PSI0OTguMzc1IiB5PSI4OTYuMDEwNyI+RGVmYXVsdExpc3RhYmxlQmVhbkZhY3Rvcnk8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJBYnN0cmFjdEJlYW5GYWN0b3J5Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE2MC44NjMzIiB4PSI3MDkuMDY0NSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0Ni44NjMzIiB4PSI3MTYuMDY0NSIgeT0iMjQuOTk1MSI+QWJzdHJhY3RCZWFuRmFjdG9yeTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9IkFic3RyYWN0QmVhbkZhY3RvcnkiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTYwLjg2MzMiIHg9IjcwOS4wNjQ1IiB5PSI4NzYuMDE1NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0Ni44NjMzIiB4PSI3MTYuMDY0NSIgeT0iODk2LjAxMDciPkFic3RyYWN0QmVhbkZhY3Rvcnk8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJEZWZhdWx0U2luZ2xldG9uQmVhblJlZ2lzdHJ5Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIyNC43MzE0IiB4PSI5MDAuMDA4OCIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxMC43MzE0IiB4PSI5MDcuMDA4OCIgeT0iMjQuOTk1MSI+RGVmYXVsdFNpbmdsZXRvbkJlYW5SZWdpc3RyeTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9IkRlZmF1bHRTaW5nbGV0b25CZWFuUmVnaXN0cnkiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjI0LjczMTQiIHg9IjkwMC4wMDg4IiB5PSI4NzYuMDE1NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxMC43MzE0IiB4PSI5MDcuMDA4OCIgeT0iODk2LjAxMDciPkRlZmF1bHRTaW5nbGV0b25CZWFuUmVnaXN0cnk8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJPYmplY3RGYWN0b3J5Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExMi4wMjA1IiB4PSIxMTM0Ljc0MDMiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OC4wMjA1IiB4PSIxMTQxLjc0MDMiIHk9IjI0Ljk5NTEiPk9iamVjdEZhY3Rvcnk8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLXBhcnRpY2lwYW50PSJPYmplY3RGYWN0b3J5Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExMi4wMjA1IiB4PSIxMTM0Ljc0MDMiIHk9Ijg3Ni4wMTU2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTguMDIwNSIgeD0iMTE0MS43NDAzIiB5PSI4OTYuMDEwNyI+T2JqZWN0RmFjdG9yeTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtcGFydGljaXBhbnQ9IkFic3RyYWN0QXV0b3dpcmVDYXBhYmxlQmVhbkZhY3RvcnkiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjgwLjI4NzEiIHg9IjEyNTYuNzYwOCIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI2Ni4yODcxIiB4PSIxMjYzLjc2MDgiIHk9IjI0Ljk5NTEiPkFic3RyYWN0QXV0b3dpcmVDYXBhYmxlQmVhbkZhY3Rvcnk8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLXBhcnRpY2lwYW50PSJBYnN0cmFjdEF1dG93aXJlQ2FwYWJsZUJlYW5GYWN0b3J5Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI4MC4yODcxIiB4PSIxMjU2Ljc2MDgiIHk9Ijg3Ni4wMTU2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjY2LjI4NzEiIHg9IjEyNjMuNzYwOCIgeT0iODk2LjAxMDciPkFic3RyYWN0QXV0b3dpcmVDYXBhYmxlQmVhbkZhY3Rvcnk8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9IkFic3RyYWN0QXBwbGljYXRpb25Db250ZXh0IiBkYXRhLXBhcnRpY2lwYW50LTI9IlBvc3RQcm9jZXNzb3JSZWdpc3RyYXRpb25EZWxlZ2F0ZSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMzkuMjI5LDczLjk5NjEsMzQ5LjIyOSw3Ny45OTYxLDMzOS4yMjksODEuOTk2MSwzNDMuMjI5LDc3Ljk5NjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTA4LjA0MTUiIHgyPSIzNDUuMjI5IiB5MT0iNzcuOTk2MSIgeTI9Ijc3Ljk5NjEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxODEuMTA1IiB4PSIxMTUuMDQxNSIgeT0iNzIuOTMwMiI+cmVnaXN0ZXJCZWFuUG9zdFByb2Nlc3NvcnM8L3RleHQ+PC9nPjxwYXRoIGQ9Ik0zNTYsNTEuMjk2OSBMMzU2LDkxLjI5NjkgTDU2NSw5MS4yOTY5IEw1NjUsNjEuMjk2OSBMNTU1LDUxLjI5NjkgTDM1Niw1MS4yOTY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNTU1LDUxLjI5NjkgTDU1NSw2MS4yOTY5IEw1NjUsNjEuMjk2OSBMNTU1LDUxLjI5NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4OC45MTI3IiB4PSIzNjIiIHk9IjY4LjM2MzgiPiYjMjUxNTI7JiMyNjM3NzsmIzIzNDU0OyYjMjk2MTY7JiMyMDEwMjtCZWFuUG9zdFByb2Nlc3NvcjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjMuMTIyMiIgeD0iMzYyIiB5PSI4My40OTY2Ij4mIzI1NTA5OyYjMjE0NzU7JiMzMDM0MDtCZWFuJiMzNzExNzsmIzIwMjUwOyYjMjIzMTI7JiMzNjgyNTsmIzM3MzI0OyYjMjEwMTk7JiMyNDMxNDs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iUG9zdFByb2Nlc3NvclJlZ2lzdHJhdGlvbkRlbGVnYXRlIiBkYXRhLXBhcnRpY2lwYW50LTI9IkFic3RyYWN0QmVhbkZhY3RvcnkiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNzc3LjQ5NjEsMTEzLjY5NTMsNzg3LjQ5NjEsMTE3LjY5NTMsNzc3LjQ5NjEsMTIxLjY5NTMsNzgxLjQ5NjEsMTE3LjY5NTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMzUxLjIyOSIgeDI9Ijc4My40OTYxIiB5MT0iMTE3LjY5NTMiIHkyPSIxMTcuNjk1MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU0LjQ2OTIiIHg9IjM1OC4yMjkiIHk9IjExMi42Mjk0Ij5nZXRCZWFuPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBYnN0cmFjdEJlYW5GYWN0b3J5IiBkYXRhLXBhcnRpY2lwYW50LTI9IkFic3RyYWN0QmVhbkZhY3RvcnkiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3ODkuNDk2MSIgeDI9IjgzMS40OTYxIiB5MT0iMTU4LjQ2MDkiIHkyPSIxNTguNDYwOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4MzEuNDk2MSIgeDI9IjgzMS40OTYxIiB5MT0iMTU4LjQ2MDkiIHkyPSIxNzEuNDYwOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3OTAuNDk2MSIgeDI9IjgzMS40OTYxIiB5MT0iMTcxLjQ2MDkiIHkyPSIxNzEuNDYwOSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODAwLjQ5NjEsMTY3LjQ2MDksNzkwLjQ5NjEsMTcxLjQ2MDksODAwLjQ5NjEsMTc1LjQ2MDksNzk2LjQ5NjEsMTcxLjQ2MDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Mi40OTY2IiB4PSI3OTYuNDk2MSIgeT0iMTUzLjM5NSI+ZG9HZXRCZWFuPC90ZXh0PjwvZz48cGF0aCBkPSJNODgwLjQ5NjYsMTMwLjY5NTMgTDg4MC40OTY2LDE4NS42OTUzIEwxMDExLjQ5NjYsMTg1LjY5NTMgTDEwMTEuNDk2NiwxNDAuNjk1MyBMMTAwMS40OTY2LDEzMC42OTUzIEw4ODAuNDk2NiwxMzAuNjk1MyIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTEwMDEuNDk2NiwxMzAuNjk1MyBMMTAwMS40OTY2LDE0MC42OTUzIEwxMDExLjQ5NjYsMTQwLjY5NTMgTDEwMDEuNDk2NiwxMzAuNjk1MyIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEwLjQ1NTciIHg9Ijg4Ni40OTY2IiB5PSIxNDcuNzYyMiI+JiMyNzQ5MjsmIzIyNzg4OyYjMjAyNTA7JiMyMDgwODsmIzI2NTk3OyYjMzU4MTA7YmVhbjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MS4wMDAxIiB4PSI4ODYuNDk2NiIgeT0iMTYyLjg5NSI+JiMyNjE1OTsmIzIxNTQyOyYjMjQwNTA7JiMzMjQ2MzsmIzIxMDE5OyYjMjQzMTQ7JiM2NTI5Mjs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iODg2LjQ5NjYiIHk9IjE3OC4wMjc4Ij4mIzI2Mzc3OyYjMjEwMTc7JiMzMDQ1MjsmIzI1NTA5OyYjMzM3MTk7JiMyMTQ2Mjs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQWJzdHJhY3RCZWFuRmFjdG9yeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJEZWZhdWx0U2luZ2xldG9uQmVhblJlZ2lzdHJ5Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwMDAuMzc0NSwyMDguMjI2NiwxMDEwLjM3NDUsMjEyLjIyNjYsMTAwMC4zNzQ1LDIxNi4yMjY2LDEwMDQuMzc0NSwyMTIuMjI2NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3ODkuNDk2MSIgeDI9IjEwMDYuMzc0NSIgeTE9IjIxMi4yMjY2IiB5Mj0iMjEyLjIyNjYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Mi42MDIxIiB4PSI3OTYuNDk2MSIgeT0iMjA3LjE2MDYiPmdldFNpbmdsZXRvbjwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iRGVmYXVsdFNpbmdsZXRvbkJlYW5SZWdpc3RyeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJPYmplY3RGYWN0b3J5Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjExNzguNzUwNSwyNDAuMzU5NCwxMTg4Ljc1MDUsMjQ0LjM1OTQsMTE3OC43NTA1LDI0OC4zNTk0LDExODIuNzUwNSwyNDQuMzU5NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMDEyLjM3NDUiIHgyPSIxMTg0Ljc1MDUiIHkxPSIyNDQuMzU5NCIgeTI9IjI0NC4zNTk0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjMuNjg2IiB4PSIxMDE5LjM3NDUiIHk9IjIzOS4yOTM1Ij5nZXRPYmplY3Q8L3RleHQ+PC9nPjxwYXRoIGQ9Ik0xMTk1LDIyNS4yMjY2IEwxMTk1LDI1MC4yMjY2IEwxMzU5LDI1MC4yMjY2IEwxMzU5LDIzNS4yMjY2IEwxMzQ5LDIyNS4yMjY2IEwxMTk1LDIyNS4yMjY2IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTM0OSwyMjUuMjI2NiBMMTM0OSwyMzUuMjI2NiBMMTM1OSwyMzUuMjI2NiBMMTM0OSwyMjUuMjI2NiIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQzLjQwNjMiIHg9IjEyMDEiIHk9IjI0Mi4yOTM1Ij5DcmVhdGUgYmVhbiBpbnN0YW5jZS48L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iT2JqZWN0RmFjdG9yeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBYnN0cmFjdEF1dG93aXJlQ2FwYWJsZUJlYW5GYWN0b3J5Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzODQuOTA0MywyOTguMTkxNCwxMzk0LjkwNDMsMzAyLjE5MTQsMTM4NC45MDQzLDMwNi4xOTE0LDEzODguOTA0MywzMDIuMTkxNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMTkwLjc1MDUiIHgyPSIxMzkwLjkwNDMiIHkxPSIzMDIuMTkxNCIgeTI9IjMwMi4xOTE0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzQuNjczOCIgeD0iMTE5Ny43NTA1IiB5PSIyOTcuMTI1NSI+Y3JlYXRlQmVhbjwvdGV4dD48L2c+PHBhdGggZD0iTTE0MDEsMjYwLjM1OTQgTDE0MDEsMzMwLjM1OTQgTDE1MzksMzMwLjM1OTQgTDE1MzksMjcwLjM1OTQgTDE1MjksMjYwLjM1OTQgTDE0MDEsMjYwLjM1OTQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xNTI5LDI2MC4zNTk0IEwxNTI5LDI3MC4zNTk0IEwxNTM5LDI3MC4zNTk0IEwxNTI5LDI2MC4zNTk0IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iMTQwNyIgeT0iMjc3LjQyNjMiPiYjMjM1NDU7JiMzNTkzNzsmIzI0MDM3OyYjMjEzNzg7JiMyMzU1ODsmIzIwMjUwOyYjMzU4NDM7JiMyOTk5Mjs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjE0MDciIHk9IjI5Mi41NTkxIj4mIzM1MDEzOyYjMzcxOTc7JiMyNDAzNzsmIzIxMzc4OyYjNjUyOTI7JiMyODk4MjsmIzIxNTE4OyYjMzU4NDM7JiMyOTk5Mjs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMDAwMSIgeD0iMTQwNyIgeT0iMzA3LjY5MTkiPiYjMjEwMjE7JiMyMjk4NzsmIzIxMjcwOyYjMjM0NTQ7JiMyMDM2MzsmIzMxNTc0OyYjMzAwNTM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjE0MDciIHk9IjMyMi44MjQ3Ij4mIzIwMTM1OyYjMjk5ODM7JiMyMzQ1NDsmIzIwMzYzOyYjMjM1NDU7JiMzNTkzNzs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQWJzdHJhY3RBdXRvd2lyZUNhcGFibGVCZWFuRmFjdG9yeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBYnN0cmFjdEF1dG93aXJlQ2FwYWJsZUJlYW5GYWN0b3J5Ij48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTM5Ni45MDQzIiB4Mj0iMTQzOC45MDQzIiB5MT0iMzU3LjAyMzQiIHkyPSIzNTcuMDIzNCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxNDM4LjkwNDMiIHgyPSIxNDM4LjkwNDMiIHkxPSIzNTcuMDIzNCIgeTI9IjM3MC4wMjM0Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEzOTcuOTA0MyIgeDI9IjE0MzguOTA0MyIgeTE9IjM3MC4wMjM0IiB5Mj0iMzcwLjAyMzQiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE0MDcuOTA0MywzNjYuMDIzNCwxMzk3LjkwNDMsMzcwLjAyMzQsMTQwNy45MDQzLDM3NC4wMjM0LDE0MDMuOTA0MywzNzAuMDIzNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkyLjgwOTEiIHg9IjE0MDMuOTA0MyIgeT0iMzUxLjk1NzUiPmRvQ3JlYXRlQmVhbjwvdGV4dD48L2c+PHBhdGggZD0iTTEyNDYuNzYwOCwzODUuMDIzNCBMMTM5NS4zMjI4LDM4NS4wMjM0IEwxMzk1LjMyMjgsMzkyLjE1NjMgTDEzODUuMzIyOCw0MDIuMTU2MyBMMTI0Ni43NjA4LDQwMi4xNTYzIEwxMjQ2Ljc2MDgsMzg1LjAyMzQiIGZpbGw9IiNFRUVFRUUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMTI0LjY2NDEiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjQzNS40NDk0IiB4PSIxMjQ2Ljc2MDgiIHk9IjM4NS4wMjM0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMy41NjIiIHg9IjEyNjEuNzYwOCIgeT0iMzk4LjA5MDMiPmRvQ3JlYXRlQmVhbjwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBYnN0cmFjdEF1dG93aXJlQ2FwYWJsZUJlYW5GYWN0b3J5IiBkYXRhLXBhcnRpY2lwYW50LTI9IkFic3RyYWN0QXV0b3dpcmVDYXBhYmxlQmVhbkZhY3RvcnkiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMzk2LjkwNDMiIHgyPSIxNDM4LjkwNDMiIHkxPSI0MjMuMjg5MSIgeTI9IjQyMy4yODkxIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE0MzguOTA0MyIgeDI9IjE0MzguOTA0MyIgeTE9IjQyMy4yODkxIiB5Mj0iNDM2LjI4OTEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTM5Ny45MDQzIiB4Mj0iMTQzOC45MDQzIiB5MT0iNDM2LjI4OTEiIHkyPSI0MzYuMjg5MSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTQwNy45MDQzLDQzMi4yODkxLDEzOTcuOTA0Myw0MzYuMjg5MSwxNDA3LjkwNDMsNDQwLjI4OTEsMTQwMy45MDQzLDQzNi4yODkxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI5Ljk2ODMiIHg9IjE0MDMuOTA0MyIgeT0iNDE4LjIyMzEiPmNyZWF0ZUJlYW5JbnN0YW5jZTwvdGV4dD48L2c+PHBhdGggZD0iTTE1NDQuOTY4Myw0MTAuNjU2MyBMMTU0NC45NjgzLDQzNS42NTYzIEwxNjUwLjk2ODMsNDM1LjY1NjMgTDE2NTAuOTY4Myw0MjAuNjU2MyBMMTY0MC45NjgzLDQxMC42NTYzIEwxNTQ0Ljk2ODMsNDEwLjY1NjMiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xNjQwLjk2ODMsNDEwLjY1NjMgTDE2NDAuOTY4Myw0MjAuNjU2MyBMMTY1MC45NjgzLDQyMC42NTYzIEwxNjQwLjk2ODMsNDEwLjY1NjMiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg1LjEyMjEiIHg9IjE1NTAuOTY4MyIgeT0iNDI3LjcyMzEiPiYjMjEwMTk7JiMyNDMxNDtCZWFuJiMyMzQ1NDsmIzIwMzYzOzwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBYnN0cmFjdEF1dG93aXJlQ2FwYWJsZUJlYW5GYWN0b3J5IiBkYXRhLXBhcnRpY2lwYW50LTI9IkFic3RyYWN0QXV0b3dpcmVDYXBhYmxlQmVhbkZhY3RvcnkiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMzk2LjkwNDMiIHgyPSIxNDM4LjkwNDMiIHkxPSI0NzcuMDU0NyIgeTI9IjQ3Ny4wNTQ3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE0MzguOTA0MyIgeDI9IjE0MzguOTA0MyIgeTE9IjQ3Ny4wNTQ3IiB5Mj0iNDkwLjA1NDciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTM5Ny45MDQzIiB4Mj0iMTQzOC45MDQzIiB5MT0iNDkwLjA1NDciIHkyPSI0OTAuMDU0NyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTQwNy45MDQzLDQ4Ni4wNTQ3LDEzOTcuOTA0Myw0OTAuMDU0NywxNDA3LjkwNDMsNDk0LjA1NDcsMTQwMy45MDQzLDQ5MC4wNTQ3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODcuMzA1NyIgeD0iMTQwMy45MDQzIiB5PSI0NzEuOTg4OCI+aW5pdGlhbGl6ZUJlYW48L3RleHQ+PC9nPjxwYXRoIGQ9Ik0xNTAyLjMwNTcsNDQ5LjI4OTEgTDE1MDIuMzA1Nyw1MDQuMjg5MSBMMTY2Ni4zMDU3LDUwNC4yODkxIEwxNjY2LjMwNTcsNDU5LjI4OTEgTDE2NTYuMzA1Nyw0NDkuMjg5MSBMMTUwMi4zMDU3LDQ0OS4yODkxIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTY1Ni4zMDU3LDQ0OS4yODkxIEwxNjU2LjMwNTcsNDU5LjI4OTEgTDE2NjYuMzA1Nyw0NTkuMjg5MSBMMTY1Ni4zMDU3LDQ0OS4yODkxIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OC4xMjIxIiB4PSIxNTA4LjMwNTciIHk9IjQ2Ni4zNTYiPiYjMjEwMjE7JiMyMjk4NzsmIzIxMjcwO0JlYW4mIzIzNDU0OyYjMjAzNjM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExOC44MzQ2IiB4PSIxNTA4LjMwNTciIHk9IjQ4MS40ODg4Ij4mIzM1MzAyOyYjMjE0NTc7QXdhcmUmIzI1NTA5OyYjMjE0NzU7JiMyNjA0MTsmIzI3ODYxOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDMuMDAwMiIgeD0iMTUwOC4zMDU3IiB5PSI0OTYuNjIxNiI+JiMyNDIxMjsmIzI5OTkyOyYjMjEwMjE7JiMyMjk4NzsmIzIxMjcwOyYjMjEwNjk7JiMyMTUxODsmIzMwMzQwOyYjMjI3ODg7JiMyOTcwMjsmIzIyMTIwOzwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBYnN0cmFjdEF1dG93aXJlQ2FwYWJsZUJlYW5GYWN0b3J5IiBkYXRhLXBhcnRpY2lwYW50LTI9Ik9iamVjdEZhY3RvcnkiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTIwMS43NTA1LDUxOC42ODc1LDExOTEuNzUwNSw1MjIuNjg3NSwxMjAxLjc1MDUsNTI2LjY4NzUsMTE5Ny43NTA1LDUyMi42ODc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6MiwyOyIgeDE9IjExOTUuNzUwNSIgeDI9IjEzOTUuOTA0MyIgeTE9IjUyMi42ODc1IiB5Mj0iNTIyLjY4NzUiLz48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iT2JqZWN0RmFjdG9yeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJEZWZhdWx0U2luZ2xldG9uQmVhblJlZ2lzdHJ5Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwMjMuMzc0NSw1MzIuNjg3NSwxMDEzLjM3NDUsNTM2LjY4NzUsMTAyMy4zNzQ1LDU0MC42ODc1LDEwMTkuMzc0NSw1MzYuNjg3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjIsMjsiIHgxPSIxMDE3LjM3NDUiIHgyPSIxMTg5Ljc1MDUiIHkxPSI1MzYuNjg3NSIgeTI9IjUzNi42ODc1Ii8+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9IkRlZmF1bHRTaW5nbGV0b25CZWFuUmVnaXN0cnkiIGRhdGEtcGFydGljaXBhbnQtMj0iRGVmYXVsdFNpbmdsZXRvbkJlYW5SZWdpc3RyeSI+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEwMTIuMzc0NSIgeDI9IjEwNTQuMzc0NSIgeTE9IjU3Ny40NTMxIiB5Mj0iNTc3LjQ1MzEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTA1NC4zNzQ1IiB4Mj0iMTA1NC4zNzQ1IiB5MT0iNTc3LjQ1MzEiIHkyPSI1OTAuNDUzMSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMDEzLjM3NDUiIHgyPSIxMDU0LjM3NDUiIHkxPSI1OTAuNDUzMSIgeTI9IjU5MC40NTMxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMDIzLjM3NDUsNTg2LjQ1MzEsMTAxMy4zNzQ1LDU5MC40NTMxLDEwMjMuMzc0NSw1OTQuNDUzMSwxMDE5LjM3NDUsNTkwLjQ1MzEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4NS43MjUxIiB4PSIxMDE5LjM3NDUiIHk9IjU3Mi4zODcyIj5hZGRTaW5nbGV0b248L3RleHQ+PC9nPjxwYXRoIGQ9Ik0xMTE2LjcyNTEsNTQ5LjY4NzUgTDExMTYuNzI1MSw2MDQuNjg3NSBMMTIxNS43MjUxLDYwNC42ODc1IEwxMjE1LjcyNTEsNTU5LjY4NzUgTDEyMDUuNzI1MSw1NDkuNjg3NSBMMTExNi43MjUxLDU0OS42ODc1IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTIwNS43MjUxLDU0OS42ODc1IEwxMjA1LjcyNTEsNTU5LjY4NzUgTDEyMTUuNzI1MSw1NTkuNjg3NSBMMTIwNS43MjUxLDU0OS42ODc1IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OC4wMDAxIiB4PSIxMTIyLjcyNTEiIHk9IjU2Ni43NTQ0Ij4mIzIzNTU4OyYjMjEwMTk7JiMyNDMxNDsmIzMwMzQwOyYjMjM0NTQ7JiMyMDM2Mzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iMTEyMi43MjUxIiB5PSI1ODEuODg3MiI+JiMyMzU0NTsmIzM1OTM3OyYjMjU5MTg7JiMyMDgzNzsmIzMyNTMxOyYjMjMzODQ7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1LjAwMDEiIHg9IjExMjIuNzI1MSIgeT0iNTk3LjAyIj4mIzIzNTQ1OyYjMzU5Mzc7JiMyMDAxMzsmIzIwNDQ1OyYjMjMzODQ7PC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9IkRlZmF1bHRTaW5nbGV0b25CZWFuUmVnaXN0cnkiIGRhdGEtcGFydGljaXBhbnQtMj0iQWJzdHJhY3RCZWFuRmFjdG9yeSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4MDAuNDk2MSw2MzcuNzg1Miw3OTAuNDk2MSw2NDEuNzg1Miw4MDAuNDk2MSw2NDUuNzg1Miw3OTYuNDk2MSw2NDEuNzg1MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjIsMjsiIHgxPSI3OTQuNDk2MSIgeDI9IjEwMTEuMzc0NSIgeTE9IjY0MS43ODUyIiB5Mj0iNjQxLjc4NTIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTguODc4NCIgeD0iODA2LjQ5NjEiIHk9IjYzNi43MTkyIj4mIzM1ODQzOyYjMjk5OTI7Z2V0T2JqZWN0Rm9yQmVhbkluc3RhbmNlPC90ZXh0PjwvZz48cGF0aCBkPSJNMTAxNyw2MTUuMDg1OSBMMTAxNyw2NTUuMDg1OSBMMTExOSw2NTUuMDg1OSBMMTExOSw2MjUuMDg1OSBMMTEwOSw2MTUuMDg1OSBMMTAxNyw2MTUuMDg1OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTExMDksNjE1LjA4NTkgTDExMDksNjI1LjA4NTkgTDExMTksNjI1LjA4NTkgTDExMDksNjE1LjA4NTkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1LjAwMDEiIHg9IjEwMjMiIHk9IjYzMi4xNTI4Ij4mIzIxMDI4OyYjMjYwMjk7JiMyNjE1OTsmIzIxNTQyOyYjMjYxNTk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjgwMjIiIHg9IjEwMjMiIHk9IjY0Ny4yODU2Ij5GYWN0b3J5QmVhbjwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBYnN0cmFjdEJlYW5GYWN0b3J5IiBkYXRhLXBhcnRpY2lwYW50LTI9IlBvc3RQcm9jZXNzb3JSZWdpc3RyYXRpb25EZWxlZ2F0ZSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNjIuMjI5LDY2Mi4zNTE2LDM1Mi4yMjksNjY2LjM1MTYsMzYyLjIyOSw2NzAuMzUxNiwzNTguMjI5LDY2Ni4zNTE2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6MiwyOyIgeDE9IjM1Ni4yMjkiIHgyPSI3ODguNDk2MSIgeTE9IjY2Ni4zNTE2IiB5Mj0iNjY2LjM1MTYiLz48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iUG9zdFByb2Nlc3NvclJlZ2lzdHJhdGlvbkRlbGVnYXRlIiBkYXRhLXBhcnRpY2lwYW50LTI9IkFic3RyYWN0QXBwbGljYXRpb25Db250ZXh0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjExOS4wNDE1LDY3Ni4zNTE2LDEwOS4wNDE1LDY4MC4zNTE2LDExOS4wNDE1LDY4NC4zNTE2LDExNS4wNDE1LDY4MC4zNTE2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6MiwyOyIgeDE9IjExMy4wNDE1IiB4Mj0iMzUwLjIyOSIgeTE9IjY4MC4zNTE2IiB5Mj0iNjgwLjM1MTYiLz48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQWJzdHJhY3RBcHBsaWNhdGlvbkNvbnRleHQiIGRhdGEtcGFydGljaXBhbnQtMj0iQWJzdHJhY3RBcHBsaWNhdGlvbkNvbnRleHQiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMDguMDQxNSIgeDI9IjE1MC4wNDE1IiB5MT0iNzA5LjQ4NDQiIHkyPSI3MDkuNDg0NCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxNTAuMDQxNSIgeDI9IjE1MC4wNDE1IiB5MT0iNzA5LjQ4NDQiIHkyPSI3MjIuNDg0NCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMDkuMDQxNSIgeDI9IjE1MC4wNDE1IiB5MT0iNzIyLjQ4NDQiIHkyPSI3MjIuNDg0NCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTE5LjA0MTUsNzE4LjQ4NDQsMTA5LjA0MTUsNzIyLjQ4NDQsMTE5LjA0MTUsNzI2LjQ4NDQsMTE1LjA0MTUsNzIyLjQ4NDQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTYuMTI5OSIgeD0iMTE1LjA0MTUiIHk9IjcwNC40MTg1Ij5maW5pc2hCZWFuRmFjdG9yeUluaXRpYWxpemF0aW9uPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dCIgZGF0YS1wYXJ0aWNpcGFudC0yPSJEZWZhdWx0TGlzdGFibGVCZWFuRmFjdG9yeSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1ODMuMjE5Nyw3NDcuNjE3Miw1OTMuMjE5Nyw3NTEuNjE3Miw1ODMuMjE5Nyw3NTUuNjE3Miw1ODcuMjE5Nyw3NTEuNjE3MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMDguMDQxNSIgeDI9IjU4OS4yMTk3IiB5MT0iNzUxLjYxNzIiIHkyPSI3NTEuNjE3MiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OS41NDIiIHg9IjExNS4wNDE1IiB5PSI3NDYuNTUxMyI+cHJlSW5zdGFudGlhdGVTaW5nbGV0b25zPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJEZWZhdWx0TGlzdGFibGVCZWFuRmFjdG9yeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBYnN0cmFjdEJlYW5GYWN0b3J5Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijc3Ny40OTYxLDc3Ni43NSw3ODcuNDk2MSw3ODAuNzUsNzc3LjQ5NjEsNzg0Ljc1LDc4MS40OTYxLDc4MC43NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1OTUuMjE5NyIgeDI9Ijc4My40OTYxIiB5MT0iNzgwLjc1IiB5Mj0iNzgwLjc1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQuNDY5MiIgeD0iNjAyLjIxOTciIHk9Ijc3NS42ODQxIj5nZXRCZWFuPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBYnN0cmFjdEJlYW5GYWN0b3J5IiBkYXRhLXBhcnRpY2lwYW50LTI9IkFic3RyYWN0QmVhbkZhY3RvcnkiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3ODkuNDk2MSIgeDI9IjgzMS40OTYxIiB5MT0iODEzLjk0OTIiIHkyPSI4MTMuOTQ5MiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4MzEuNDk2MSIgeDI9IjgzMS40OTYxIiB5MT0iODEzLjk0OTIiIHkyPSI4MjYuOTQ5MiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3OTAuNDk2MSIgeDI9IjgzMS40OTYxIiB5MT0iODI2Ljk0OTIiIHkyPSI4MjYuOTQ5MiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODAwLjQ5NjEsODIyLjk0OTIsNzkwLjQ5NjEsODI2Ljk0OTIsODAwLjQ5NjEsODMwLjk0OTIsNzk2LjQ5NjEsODI2Ljk0OTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Mi40OTY2IiB4PSI3OTYuNDk2MSIgeT0iODA4Ljg4MzMiPmRvR2V0QmVhbjwvdGV4dD48L2c+PHBhdGggZD0iTTg4MC40OTY2LDc5My43NSBMODgwLjQ5NjYsODMzLjc1IEw5ODYuNDk2Niw4MzMuNzUgTDk4Ni40OTY2LDgwMy43NSBMOTc2LjQ5NjYsNzkzLjc1IEw4ODAuNDk2Niw3OTMuNzUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik05NzYuNDk2Niw3OTMuNzUgTDk3Ni40OTY2LDgwMy43NSBMOTg2LjQ5NjYsODAzLjc1IEw5NzYuNDk2Niw3OTMuNzUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg1LjEyMjEiIHg9Ijg4Ni40OTY2IiB5PSI4MTAuODE2OSI+QmVhbiYjMjQwNTA7JiMzMjQ2MzsmIzIxMDE5OyYjMjQzMTQ7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyLjAwMDEiIHg9Ijg4Ni40OTY2IiB5PSI4MjUuOTQ5NyI+JiMzMDQ1MjsmIzI1NTA5OyYjMzM3MTk7JiMyMTQ2Mjs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQWJzdHJhY3RCZWFuRmFjdG9yeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJEZWZhdWx0TGlzdGFibGVCZWFuRmFjdG9yeSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2MDYuMjE5Nyw4NDEuMDE1Niw1OTYuMjE5Nyw4NDUuMDE1Niw2MDYuMjE5Nyw4NDkuMDE1Niw2MDIuMjE5Nyw4NDUuMDE1NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjIsMjsiIHgxPSI2MDAuMjE5NyIgeDI9Ijc4OC40OTYxIiB5MT0iODQ1LjAxNTYiIHkyPSI4NDUuMDE1NiIvPjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJEZWZhdWx0TGlzdGFibGVCZWFuRmFjdG9yeSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBYnN0cmFjdEFwcGxpY2F0aW9uQ29udGV4dCI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMTkuMDQxNSw4NTUuMDE1NiwxMDkuMDQxNSw4NTkuMDE1NiwxMTkuMDQxNSw4NjMuMDE1NiwxMTUuMDQxNSw4NTkuMDE1NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjIsMjsiIHgxPSIxMTMuMDQxNSIgeDI9IjU5NC4yMTk3IiB5MT0iODU5LjAxNTYiIHkyPSI4NTkuMDE1NiIvPjwvZz48IS0tU1JDPVtqTE5EUmpmMDRCeGxLLW1CajBfMGVIOGJJWE1mS2dGczJPcFBhQXNHcnJmbGJBUWRnVzRBSVc5SzlJWmFmcjRSSTdBWGVKeWczUTc5b3gyc1MtZWhURFZoT1dFcmVMQkFtUzhwaS1GbGNzemM5dmNzNkRMcWJaSkQ3RE9yWGVjSDhXUDNCbll5em0wazR1aWpLdzhab29CcUFTZlk2SW5aNWIwRVBKTTY0ZjF3TGFHVjhpcU8yeFUwZ0w2NlRNbmcxZUNCUTRMUm94Nzc4YlBCdnYyQ05YSVY5TkczNjhHWEk3NXNiRzZ4X0NlLUJGREZ4dnJBVHpXbEprSzRUZ05EZ29WRVZid3dSWlRfM1dWeF9GM1NsTWRVbGpkY2ZHRC1yR1Y4bzQyUDRpbTRCbmFjVlZ1WEcwY09IVHV4LThpcHlhbzZGRjlGWFZicU1ob0xibzBCOVZrdXhMdnlKQ2k4VS0gLTJycXZ2eHVqcExMTWVWbXNzV01IVVFaZTd0bUg5anpCWnJLUjA5R0E5TnpMZHNDWmM0MkU2VEZqQ0RuQTJuU1cxdVk5YmZZVmZ2cVhkdUdlZUl2WERZWTlQREthMU9hQzhRVVplVmUxbkI0TXVKaWFySGpPbkhJZERkRDAtME5LbHZzSlQtQ01iLV9hM3h4THZ2Sk5sNWFLMXRVd2NLcHk3eGFkWGpoMlo3QTljSmx1eGhyTHk3b3lUeVJDamxqcUdfSkV5dGQ4dzNNVXQzT1J6Q3dULWg0bWd4TkhMZW03RUlJRDNLVzZGQjJMaDlYbXBHVjZ4aXV5NTlMbG9IVjNvWHllZE5yTFZvSVo1dEpFRWNEeWY4Nm5XWGhLU1ZYY0dkR0JaSXBFMW5wcXh2VE10b05NRDhaTlBUa0ZJX2hnaHBsSmhHakwwckZBRWE1ZkNsWFdlZnJSYXBWRG5Ia0JGTjdmRXpsZmFzeXdPZ2ZjMzUza0lNWU9KWjZJdXR4ajVmUFZhZnlnWlVqTWtOX0Qyc25jeXV2cXp0cEp5cUhkVTdDZHRHQ3J1SzU1TmJmZ1JxUVdsNFpoTUw2NXlmUFJUd0FYaElwbzFkeUFKRV93RWNjVTlwN0RKWHBqblFiTTFQRW1NWV9PY3U4ZmVOY2lyMTdkZkpwRHhTSkNvSHMtcjEzR2ZLZ0tLd0hXUUlNRTF3NEZfVm81dnluVlFFLTBWcmFxaXRyWE1pSGh5MVcwMF0tLT48L2c+PC9zdmc+'>\n\n<p>被增强类的代理对象，创建过程为</p>\n<p>在BeanFactory的doCreateBean方法中，对象实例被创建后，在初始化方法中，为对象应用后置处理器，应用到 internalAutoProxyCreator 时，增强的代理对象被创建。</p>\n<p>首先，被增强类实例化过程调用的方法栈为：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">AbstractApplicationContext: registerBeanPostProcessors</span><br><span class=\"line\">PostProcessorRegistrationDelegate: getBean</span><br><span class=\"line\">AbstractBeanFactory: doGetBean getSingleton</span><br><span class=\"line\">DefaultSingletonBeanRegistry: getObject</span><br><span class=\"line\">ObjectFactory: createBean</span><br><span class=\"line\">AbstractAutowireCapableBeanFactory: doCreateBean createBeanInstance initializeBean</span><br></pre></td></tr></table></figure>\n\n<p>之前的顺序图也有表示，故在下图不再展现。</p>\n<img src='data:image/svg+xml;base64,ZXJyb3IgY29kZTogNTIw'>\n\n<h2 id=\"AOP调用流程\"><a href=\"#AOP调用流程\" class=\"headerlink\" title=\"AOP调用流程\"></a>AOP调用流程</h2><p>执行被增强类对象的方法时，代理对象就会调用之前保存好的切面通知，代码会跳转到代理类（此处是CglibAopProxy类）的 intercept 方法。</p>\n<p>此方法主要做了两件事情：</p>\n<ol>\n<li>获取拦截链（MethodInterceptor）</li>\n<li>链式调用通知方法</li>\n</ol>\n<img src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjQ5N3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTQ2M3B4O2hlaWdodDo0OTdweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNDYzIDQ5NyIgd2lkdGg9IjE0NjNweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxnPjx0aXRsZT4uLi4uPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNDI1Ljk5MjIiIHdpZHRoPSI4IiB4PSIzNS45OTk5IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iMzkiIHgyPSIzOSIgeTE9IjM2LjI5NjkiIHkyPSI0NjIuMjg5MSIvPjwvZz48Zz48dGl0bGU+Q2dsaWJBb3BQcm94eTwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9IjQyNS45OTIyIiB3aWR0aD0iOCIgeD0iMjYxLjc4NTciIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSIyNjQuOTQiIHgyPSIyNjQuOTQiIHkxPSIzNi4yOTY5IiB5Mj0iNDYyLjI4OTEiLz48L2c+PGc+PHRpdGxlPkFkdmlzZWRTdXBwb3J0PC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNDI1Ljk5MjIiIHdpZHRoPSI4IiB4PSI1OTEuMzM2NSIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjU5NC45NDgzIiB4Mj0iNTk0Ljk0ODMiIHkxPSIzNi4yOTY5IiB5Mj0iNDYyLjI4OTEiLz48L2c+PGc+PHRpdGxlPi4uLkNnbGliTWV0aG9kSW52b2NhdGlvbjwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9IjQyNS45OTIyIiB3aWR0aD0iOCIgeD0iNzcyLjExNTIiIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSI3NzUuNzI0NyIgeDI9Ijc3NS43MjQ3IiB5MT0iMzYuMjk2OSIgeTI9IjQ2Mi4yODkxIi8+PC9nPjxnPjx0aXRsZT5SZWZsZWN0aXZlTWV0aG9kSW52b2NhdGlvbjwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9IjQyNS45OTIyIiB3aWR0aD0iOCIgeD0iOTk1LjEwNTgiIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSI5OTguNTA1NyIgeDI9Ijk5OC41MDU3IiB5MT0iMzYuMjk2OSIgeTI9IjQ2Mi4yODkxIi8+PC9nPjxnPjx0aXRsZT5pbnRlcmNlcHRvck9ySW50ZXJjZXB0aW9uQWR2aWNlPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNDI1Ljk5MjIiIHdpZHRoPSI4IiB4PSIxMjI5LjgyMDIiIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSIxMjMzLjcwNTkiIHgyPSIxMjMzLjcwNTkiIHkxPSIzNi4yOTY5IiB5Mj0iNDYyLjI4OTEiLz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtcGFydGljaXBhbnQ9Ii4uLi4iPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjkuOTk5OCIgeD0iNSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjEyIiB5PSIyNC45OTUxIj4mIzM0OTg3OyYjMjI2ODY7JiMyNDM3ODsmIzMxODY3OzwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9Ii4uLi4iPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjkuOTk5OCIgeD0iNSIgeT0iNDYxLjI4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIxMiIgeT0iNDgxLjI4NDIiPiYjMzQ5ODc7JiMyMjY4NjsmIzI0Mzc4OyYjMzE4Njc7PC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1wYXJ0aWNpcGFudD0iQ2dsaWJBb3BQcm94eSI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMTUuNjkxNCIgeD0iMjA3Ljk0IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAxLjY5MTQiIHg9IjIxNC45NCIgeT0iMjQuOTk1MSI+Q2dsaWJBb3BQcm94eTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9IkNnbGliQW9wUHJveHkiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTE1LjY5MTQiIHg9IjIwNy45NCIgeT0iNDYxLjI4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDEuNjkxNCIgeD0iMjE0Ljk0IiB5PSI0ODEuMjg0MiI+Q2dsaWJBb3BQcm94eTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtcGFydGljaXBhbnQ9IkFkdmlzZWRTdXBwb3J0Ij48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyNC43NzY0IiB4PSI1MzIuOTQ4MyIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMC43NzY0IiB4PSI1MzkuOTQ4MyIgeT0iMjQuOTk1MSI+QWR2aXNlZFN1cHBvcnQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLXBhcnRpY2lwYW50PSJBZHZpc2VkU3VwcG9ydCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjQuNzc2NCIgeD0iNTMyLjk0ODMiIHk9IjQ2MS4yODkxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEwLjc3NjQiIHg9IjUzOS45NDgzIiB5PSI0ODEuMjg0MiI+QWR2aXNlZFN1cHBvcnQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSIuLi5DZ2xpYk1ldGhvZEludm9jYXRpb24iPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjE2Ljc4MTEiIHg9IjY2Ny43MjQ3IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjAyLjc4MTEiIHg9IjY3NC43MjQ3IiB5PSIyNC45OTUxIj4mIzIwODY5OyYjMzcwOTY7JiMzMTg2NztDZ2xpYk1ldGhvZEludm9jYXRpb248L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLXBhcnRpY2lwYW50PSIuLi5DZ2xpYk1ldGhvZEludm9jYXRpb24iPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjE2Ljc4MTEiIHg9IjY2Ny43MjQ3IiB5PSI0NjEuMjg5MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIwMi43ODExIiB4PSI2NzQuNzI0NyIgeT0iNDgxLjI4NDIiPiYjMjA4Njk7JiMzNzA5NjsmIzMxODY3O0NnbGliTWV0aG9kSW52b2NhdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtcGFydGljaXBhbnQ9IlJlZmxlY3RpdmVNZXRob2RJbnZvY2F0aW9uIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIwOS4yMDAyIiB4PSI4OTQuNTA1NyIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5NS4yMDAyIiB4PSI5MDEuNTA1NyIgeT0iMjQuOTk1MSI+UmVmbGVjdGl2ZU1ldGhvZEludm9jYXRpb248L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLXBhcnRpY2lwYW50PSJSZWZsZWN0aXZlTWV0aG9kSW52b2NhdGlvbiI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMDkuMjAwMiIgeD0iODk0LjUwNTciIHk9IjQ2MS4yODkxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTk1LjIwMDIiIHg9IjkwMS41MDU3IiB5PSI0ODEuMjg0MiI+UmVmbGVjdGl2ZU1ldGhvZEludm9jYXRpb248L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSJpbnRlcmNlcHRvck9ySW50ZXJjZXB0aW9uQWR2aWNlIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI0MC4yMjg1IiB4PSIxMTEzLjcwNTkiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjYuMjI4NSIgeD0iMTEyMC43MDU5IiB5PSIyNC45OTUxIj5pbnRlcmNlcHRvck9ySW50ZXJjZXB0aW9uQWR2aWNlPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1wYXJ0aWNpcGFudD0iaW50ZXJjZXB0b3JPckludGVyY2VwdGlvbkFkdmljZSI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyNDAuMjI4NSIgeD0iMTExMy43MDU5IiB5PSI0NjEuMjg5MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyNi4yMjg1IiB4PSIxMTIwLjcwNTkiIHk9IjQ4MS4yODQyIj5pbnRlcmNlcHRvck9ySW50ZXJjZXB0aW9uQWR2aWNlPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSIuLi4uIiBkYXRhLXBhcnRpY2lwYW50LTI9IkNnbGliQW9wUHJveHkiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjUzLjc4NTcsNjMuNDI5NywyNjMuNzg1Nyw2Ny40Mjk3LDI1My43ODU3LDcxLjQyOTcsMjU3Ljc4NTcsNjcuNDI5NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzOS45OTk5IiB4Mj0iMjU5Ljc4NTciIHkxPSI2Ny40Mjk3IiB5Mj0iNjcuNDI5NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIwMS43ODU4IiB4PSI0Ni45OTk5IiB5PSI2Mi4zNjM4Ij4mIzI2MjIyOyYjMzY4OTA7JiMzNTg0MzsmIzI5OTkyOyYjMjYwNDE7JiMyNzg2MTsmIzY1MjkyOyYjMjM0NTQ7JiMzODQ2OTsmIzI1MTkxOyYjMzQ4OTI7aW50ZXJjZXB0PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJDZ2xpYkFvcFByb3h5IiBkYXRhLXBhcnRpY2lwYW50LTI9IkFkdmlzZWRTdXBwb3J0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU4My4zMzY1LDk1LjU2MjUsNTkzLjMzNjUsOTkuNTYyNSw1ODMuMzM2NSwxMDMuNTYyNSw1ODcuMzM2NSw5OS41NjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI2NS43ODU3IiB4Mj0iNTg5LjMzNjUiIHkxPSI5OS41NjI1IiB5Mj0iOTkuNTYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMwNS41NTA4IiB4PSIyNzIuNzg1NyIgeT0iOTQuNDk2NiI+Z2V0SW50ZXJjZXB0b3JzQW5kRHluYW1pY0ludGVyY2VwdGlvbkFkdmljZTwvdGV4dD48L2c+PHBhdGggZD0iTTYwMCw4MC40Mjk3IEw2MDAsMTA1LjQyOTcgTDY4NiwxMDUuNDI5NyBMNjg2LDkwLjQyOTcgTDY3Niw4MC40Mjk3IEw2MDAsODAuNDI5NyIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTY3Niw4MC40Mjk3IEw2NzYsOTAuNDI5NyBMNjg2LDkwLjQyOTcgTDY3Niw4MC40Mjk3IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSI2MDYiIHk9Ijk3LjQ5NjYiPiYjMzM3MTk7JiMyMTQ2MjsmIzI1MzE4OyYjMjUxMzA7JiMzODE0Mjs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQWR2aXNlZFN1cHBvcnQiIGRhdGEtcGFydGljaXBhbnQtMj0iQ2dsaWJBb3BQcm94eSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNzYuNzg1NywxMjcuNjk1MywyNjYuNzg1NywxMzEuNjk1MywyNzYuNzg1NywxMzUuNjk1MywyNzIuNzg1NywxMzEuNjk1MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjIsMjsiIHgxPSIyNzAuNzg1NyIgeDI9IjU5NC4zMzY1IiB5MT0iMTMxLjY5NTMiIHkyPSIxMzEuNjk1MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNi4yMDQyIiB4PSIyODIuNzg1NyIgeT0iMTI2LjYyOTQiPiYjMzY4MjA7JiMyMjIzODsmIzI1MzE4OyYjMjUxMzA7JiMzODE0MjsmIzIzNTQ1OyYjMzU5Mzc7Y2hhaW48L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9IkNnbGliQW9wUHJveHkiIGRhdGEtcGFydGljaXBhbnQtMj0iLi4uQ2dsaWJNZXRob2RJbnZvY2F0aW9uIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijc2NC4xMTUyLDE1Ni44MjgxLDc3NC4xMTUyLDE2MC44MjgxLDc2NC4xMTUyLDE2NC44MjgxLDc2OC4xMTUyLDE2MC44MjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI2NS43ODU3IiB4Mj0iNzcwLjExNTIiIHkxPSIxNjAuODI4MSIgeTI9IjE2MC44MjgxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY5Ljk0NTkiIHg9IjI3Mi43ODU3IiB5PSIxNTUuNzYyMiI+JiMyMTAxOTsmIzI0MzE0OyYjMjAxOTU7JiMyOTcwMjsmIzIzNTQ1OyYjMzU5Mzc7JiMyMTUxODsmIzI1MTkxOyYjMzQ4OTI7cHJvY2VlZDwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iLi4uQ2dsaWJNZXRob2RJbnZvY2F0aW9uIiBkYXRhLXBhcnRpY2lwYW50LTI9IlJlZmxlY3RpdmVNZXRob2RJbnZvY2F0aW9uIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijk4Ny4xMDU4LDE4NS45NjA5LDk5Ny4xMDU4LDE4OS45NjA5LDk4Ny4xMDU4LDE5My45NjA5LDk5MS4xMDU4LDE4OS45NjA5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc3Ni4xMTUyIiB4Mj0iOTkzLjEwNTgiIHkxPSIxODkuOTYwOSIgeTI9IjE4OS45NjA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQzLjk0NTkiIHg9Ijc4My4xMTUyIiB5PSIxODQuODk1Ij4mIzIzNDU0OyYjMzg0Njk7JiMyNTE5MTsmIzM0ODkyOyYjMjkyMzg7JiMzMTg2NzsmIzMwMzQwO3Byb2NlZWQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9IlJlZmxlY3RpdmVNZXRob2RJbnZvY2F0aW9uIiBkYXRhLXBhcnRpY2lwYW50LTI9ImludGVyY2VwdG9yT3JJbnRlcmNlcHRpb25BZHZpY2UiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTIyMS44MjAyLDIxNS4wOTM4LDEyMzEuODIwMiwyMTkuMDkzOCwxMjIxLjgyMDIsMjIzLjA5MzgsMTIyNS44MjAyLDIxOS4wOTM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijk5OS4xMDU4IiB4Mj0iMTIyNy44MjAyIiB5MT0iMjE5LjA5MzgiIHkyPSIyMTkuMDkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0Ny4wMjQ1IiB4PSIxMDA2LjEwNTgiIHk9IjIxNC4wMjc4Ij4mIzM1ODQzOyYjMjk5OTI7JiMzNjg5MDsmIzMwNjkzOyYjMzE4Njc7JiMzMDM0MDtpbnZva2UmIzI2MDQxOyYjMjc4NjE7PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJpbnRlcmNlcHRvck9ySW50ZXJjZXB0aW9uQWR2aWNlIiBkYXRhLXBhcnRpY2lwYW50LTI9ImludGVyY2VwdG9yT3JJbnRlcmNlcHRpb25BZHZpY2UiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMjMzLjgyMDIiIHgyPSIxMjc1LjgyMDIiIHkxPSIyNjMuMzU5NCIgeTI9IjI2My4zNTk0Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEyNzUuODIwMiIgeDI9IjEyNzUuODIwMiIgeTE9IjI2My4zNTk0IiB5Mj0iMjc2LjM1OTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTIzNC44MjAyIiB4Mj0iMTI3NS44MjAyIiB5MT0iMjc2LjM1OTQiIHkyPSIyNzYuMzU5NCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTI0NC44MjAyLDI3Mi4zNTk0LDEyMzQuODIwMiwyNzYuMzU5NCwxMjQ0LjgyMDIsMjgwLjM1OTQsMTI0MC44MjAyLDI3Ni4zNTk0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjEyNDAuODIwMiIgeT0iMjQzLjE2MDYiPiYjMzY4OTA7JiMzMDY5MzsmIzI2MDQxOyYjMjc4NjE7JiMyMDAxMzsmIzM3MzI1OyYjMjYwMzI7JiMzNTg0MzsmIzI5OTkyOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMTUuMjQyNyIgeD0iMTI0MC44MjAyIiB5PSIyNTguMjkzNSI+Q2dsaWJNZXRob2RJbnZvY2F0aW9uJiMzMDM0MDtwcm9jZWVkPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJpbnRlcmNlcHRvck9ySW50ZXJjZXB0aW9uQWR2aWNlIiBkYXRhLXBhcnRpY2lwYW50LTI9Ii4uLkNnbGliTWV0aG9kSW52b2NhdGlvbiI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3ODcuMTE1MiwzMDEuNDkyMiw3NzcuMTE1MiwzMDUuNDkyMiw3ODcuMTE1MiwzMDkuNDkyMiw3ODMuMTE1MiwzMDUuNDkyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjIsMjsiIHgxPSI3ODEuMTE1MiIgeDI9IjEyMzIuODIwMiIgeTE9IjMwNS40OTIyIiB5Mj0iMzA1LjQ5MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMDguMDAwMiIgeD0iNzkzLjExNTIiIHk9IjMwMC40MjYzIj4mIzIyOTE0OyYjMjc0OTI7JiM2NTI5MjsmIzIyODEwOyYjMjAwMTA7JiMzNjg5MDsmIzMwNjkzOyYjMjYwNDE7JiMyNzg2MTsmIzI1MzUzOyYjMzkwMzQ7JiMyNDIwNzsmIzM2ODgyOyYjMjQ0MDI7JiMzNTg0MzsmIzI5OTkyOzwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iLi4uQ2dsaWJNZXRob2RJbnZvY2F0aW9uIiBkYXRhLXBhcnRpY2lwYW50LTI9IkNnbGliQW9wUHJveHkiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjc2Ljc4NTcsMzE1LjQ5MjIsMjY2Ljc4NTcsMzE5LjQ5MjIsMjc2Ljc4NTcsMzIzLjQ5MjIsMjcyLjc4NTcsMzE5LjQ5MjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iMjcwLjc4NTciIHgyPSI3NzUuMTE1MiIgeTE9IjMxOS40OTIyIiB5Mj0iMzE5LjQ5MjIiLz48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQ2dsaWJBb3BQcm94eSIgZGF0YS1wYXJ0aWNpcGFudC0yPSIuLi4uIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjUwLjk5OTksMzc3Ljg5MDYsNDAuOTk5OSwzODEuODkwNiw1MC45OTk5LDM4NS44OTA2LDQ2Ljk5OTksMzgxLjg5MDYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iNDQuOTk5OSIgeDI9IjI2NC43ODU3IiB5MT0iMzgxLjg5MDYiIHkyPSIzODEuODkwNiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk5LjgxNjkiIHg9IjU2Ljk5OTkiIHk9IjM3Ni44MjQ3Ij5pbnZva2VKb2lucG9pbnQ8L3RleHQ+PC9nPjxwYXRoIGQ9Ik0yNzAsMzMyLjQ5MjIgTDI3MCw0MTcuNDkyMiBMNTI1LDQxNy40OTIyIEw1MjUsMzQyLjQ5MjIgTDUxNSwzMzIuNDkyMiBMMjcwLDMzMi40OTIyIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNTE1LDMzMi40OTIyIEw1MTUsMzQyLjQ5MjIgTDUyNSwzNDIuNDkyMiBMNTE1LDMzMi40OTIyIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDMuMDAwMiIgeD0iMjc2IiB5PSIzNDkuNTU5MSI+JiMyNTE5MTsmIzM0ODkyOyYjMzQ5ODc7JiMyMjY4NjsmIzI0Mzc4OyYjMzE4Njc7JiMyMTQwNzsmIzI2Mzc3OyYjMzAzNDA7JiMyNjA0MTsmIzI3ODYxOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTMuNzExNSIgeD0iMjc2IiB5PSIzNjQuNjkxOSI+JiMyMjMxMjsmIzI3NDkyOyYjMjAwNDM7JiMyMTA2OTsmIzY1MjkyO0Fyb3VuZCYjMjE2NDQ7QmVmb3JlJiMyMjY4NjsmIzI0Mzc4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMzQuOTQ2IiB4PSIyNzYiIHk9IjM3OS44MjQ3Ij4mIzI2MDQxOyYjMjc4NjE7JiMyNDA1MDsmIzMyNDYzOyYjMjUxOTE7JiMzNDg5MjsmIzM2ODA3OyYjNjUyOTI7JiMyMDg3NzsmIzM2ODgyOyYjMjQ0MDI7JiMzNTg0MzsmIzI5OTkyOyYjMzAzNDA7cHJvY2VlZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMDguMDAwMiIgeD0iMjc2IiB5PSIzOTQuOTU3NSI+JiMyMjMxMjsmIzI3NDkyOyYjMjAwNDM7JiMyMTUxODsmIzY1MjkyOyYjMjI4MTA7JiMyMDAxMDsmIzM2ODgyOyYjMjQ0MDI7JiMzNTg0MzsmIzI5OTkyOyYjMzAzNDA7JiMzNjg5MDsmIzMwNjkzOyYjMjYwNDE7JiMyNzg2MTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTgyLjAwMDIiIHg9IjI3NiIgeT0iNDEwLjA5MDMiPiYjMjQzMjA7JiMyMjk4NzsmIzIwOTg2OyYjMjY2MzI7JiM2NTI5MjsmIzI1MTkxOyYjMzQ4OTI7JiMyMTUwODsmIzMzMjU4OyYjMzAzNDA7JiMzNjg5MDsmIzMwNjkzOyYjMzY5MjM7JiMzNjc1Mzs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iQ2dsaWJBb3BQcm94eSIgZGF0YS1wYXJ0aWNpcGFudC0yPSJpbnRlcmNlcHRvck9ySW50ZXJjZXB0aW9uQWR2aWNlIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyMjEuODIwMiw0NDAuMjg5MSwxMjMxLjgyMDIsNDQ0LjI4OTEsMTIyMS44MjAyLDQ0OC4yODkxLDEyMjUuODIwMiw0NDQuMjg5MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjIsMjsiIHgxPSIyNjUuNzg1NyIgeDI9IjEyMjcuODIwMiIgeTE9IjQ0NC4yODkxIiB5Mj0iNDQ0LjI4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyODUuOTQ5NCIgeD0iMjcyLjc4NTciIHk9IjQzOS4yMjMxIj5pbnZva2VKb2lucG9pbnQgJiM2NTI5MjsmIzM2ODgyOyYjMjQ0MDI7JiMzNTg0MzsmIzI5OTkyOyYjMzAzNDA7JiMzNjg5MDsmIzMwNjkzOyYjMjYwNDE7JiMyNzg2MTsmIzI0MzIwOyYjMjI5ODc7JiMyMDk4NjsmIzI2NjMyOzwvdGV4dD48L2c+PCEtLVNSQz1bWkxGVEpYRDE1QnhWZnpXTncwaXFuZ0pnM0lQNmV4VlVyRHNYZE9XcGNzTGZ2QXVIdzRfd1F5S2M1NThpOFpHcjg2V1lUQlYyb19KQ3BieHYyaXVtSzhVc2o1cGlwU3h2Vml2dHBrNXh0czZsM0dDX0YwdENzNEZwU01lOWxxYkd2dUxCdHdfNkpSUHI3NkxSXzZHanRFb29QZl96LWxudEs4UlpUaElybU9nN2w1RjZuNEVrWEhwRms4TUtMMGF4V3ZVSF9NaDVTUVpoblNxS3lYUGtnZ2N4ZDIzc2FyTUlWOFVqcUx6Q1lHSFBvMjNLR3dRQktzZEZ1REtwZzNMUHdPMExVajZkMm1DSHN2SkZPdThGT2g0OUhOd3YyVGxqNEhILXpGYmZucWVkQ1BicTJ4Y0RRQXFoS2hYd1VPUXlEQktOSThQUUlNYWhSYTlYNm05XzY3bUR3cGI1MUZNZ29pMW5nT01HUlNvY2EyOGxxVThJaVpvU0dMQzRqNUozbWN6MTR4Uk1Sd1psMWFmUV8zX012LXZhY1lBOGdtNkFJT1F4dG5HbjVXSGxhSGdmQ0dUX0JtYjVoV1k3dnFUSGxpQVE5cWh0RFBhUVlEUlVkRUphUkVTUVc4Q0Z4NlhWaGtULVF0WlVxX3NtU1o3Zy1FM05lY20zX1pJS2dvZHhDems2bVZMUmFWTFpudzhvVktlblNTSmR3S2tpbmdlSkc3TU54SEg1MWpTcFc5c2tpM19pYncxTzRLcWFOQmYyUjZZSzd3NTV3WTg1Q3JHamRGcUNXemVydk1MVWpmb2h3QXRmb092ZXdyS2pjcmtyVWJHNjNCOW1NOEF5cHh1SzE0MmZHN3NUdnRrWnFZV1J5OGtGVHJyWXgzeGhDZlFMQVFIY2tEOURfR0MwXS0tPjwvZz48L3N2Zz4='>\n\n<p>其中多个方法递归调用的顺序和执行顺序是一致的：</p>\n<ol>\n<li>Around</li>\n<li>Before</li>\n<li>After</li>\n<li>AfterReturning</li>\n<li>AfterThrowing</li>\n</ol>\n<p>拦截链执行的顺序没有受递归影响而倒置，看上去是因为用了</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mi.proceed();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 通知方法的逻辑</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>另外，使用环绕通知时，需要手动调用proceed方法，这里proceed实际就是CglibMethodInvocation类的，也就是参与到通知方法递归调用proceed的过程中了。</p>\n","categories":["Spring"],"tags":["Java"]},{"title":"SpringBoot基础","url":"/%E7%AC%94%E8%AE%B0/Java/Spring/SpringBoot%E5%9F%BA%E7%A1%80/","content":"<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>SpringBoot提供了一种快速使用Spring的方式，基于约定优于配置的思想，可让开发人员不必在配置与逻辑业务之间进行思维的转换，提高开发效率。</p>\n<p>2014年4月，SpringBoot 1.0.0发布。Spring的顶级项目之一。<a href=\"https://spring.io/\">官网</a></p>\n<h3 id=\"Spring的缺点\"><a href=\"#Spring的缺点\" class=\"headerlink\" title=\"Spring的缺点\"></a>Spring的缺点</h3><h4 id=\"配置繁琐\"><a href=\"#配置繁琐\" class=\"headerlink\" title=\"配置繁琐\"></a>配置繁琐</h4><p>虽然Spring的组件代码是轻量级的，但它的配置却是重量级的。从XML配置到引入注解扫描，再到基于Java的配置，都不算很简洁。</p>\n<p>SpringBoot的自动配置是一个运行时（更准确的说，是应用程序启动时）的过程，该过程是SpringBoot自动完成的。</p>\n<h4 id=\"依赖繁琐\"><a href=\"#依赖繁琐\" class=\"headerlink\" title=\"依赖繁琐\"></a>依赖繁琐</h4><p>环境搭建时，需要分析要导入哪些库的坐标。不同的坐标需要处理好版本间关系，和所依赖包之间的冲突问题。</p>\n<p>SpringBoot使用的是起步依赖，本质上是一个Maven项目对象模型（POM ，roject Object Model），定义了对其他库的传递依赖，这些东西加在一起即支持某项功能。</p>\n<p>简单地说，起步依赖就是将具备某种功能的坐标打包到一起，并提供一些默认的功能。（我理解就是针对场景给你提前组合好了）</p>\n<p>此外，SpringBoot还提供了一些辅助功能，如嵌入式服务、安全、指标、健康监测和外部配置等。</p>\n<p>SpringBoot并不是对Spring功能上的增强，而是提供了一种<strong>快速使用Spring的方式</strong>。</p>\n<h2 id=\"Hello-World\"><a href=\"#Hello-World\" class=\"headerlink\" title=\"Hello World\"></a>Hello World</h2><p>创建工程，在pom.xml文件引入依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- SpringBoot 需要继承的父工程 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.7.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Web开发的起步依赖，注意没有指明版本 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是，SpringBoot创建项目时，使用的是<strong>jar的打包方式</strong>。</p>\n<ul>\n<li>在 spring-boot-starter-parent 中，定义了一套各种技术的版本信息，已经组合搭配好了。</li>\n<li>在各种 starter 中，定义了完成该功能需要的坐标合集，大部分信息来自于父工程。所以版本号不用写，会从父工程继承。</li>\n<li>工程继承parent，引入starter后，通过<strong>依赖传递</strong>，就可以简单方便获得所需jar包，并不会存在版本冲突等问题。</li>\n</ul>\n<p>新建Controller</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HelloController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">hello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Hello SpringBoot!&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>@RestController 注解相当于是 @ResponseBody 和 @Controller 注解共同作用的结果。</p>\n<p>最后，新建引导类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 引导类，SpringBoot项目的入口</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HelloApplication</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(HelloApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这个引导类需要在刚才 Controller 类的同级或上级目录。</p>\n<p>直接从main方法启动工程，在控制台处看到如下输出，则说明启动成功</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">  .   ____          _            __ _ _</span><br><span class=\"line\"> /\\\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \\ \\ \\ \\</span><br><span class=\"line\">( ( )\\___ | &#x27;_ | &#x27;_| | &#x27;_ \\/ _` | \\ \\ \\ \\</span><br><span class=\"line\"> \\\\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class=\"line\">  &#x27;  |____| .__|_| |_|_| |_\\__, | / / / /</span><br><span class=\"line\"> =========|_|==============|___/=/_/_/_/</span><br><span class=\"line\"> :: Spring Boot ::                (v2.7.2)</span><br><span class=\"line\"></span><br><span class=\"line\">2022-08-02 16:37:02.144  INFO...</span><br><span class=\"line\">2022-08-02 16:37:02.144  INFO...</span><br><span class=\"line\">2022-08-02 16:37:02.144  INFO...</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>访问 <code>http://localhost:8080/hello</code></p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Hello SpringBoot!</span><br></pre></td></tr></table></figure>\n\n<p>如果使用的集成环境是IDEA，创建工程时直接选 Spring Initializr 还能将工程创建再简化。</p>\n<h2 id=\"SpringBoot配置\"><a href=\"#SpringBoot配置\" class=\"headerlink\" title=\"SpringBoot配置\"></a>SpringBoot配置</h2><p>SpringBoot是基于约定的，所以很多配置都有默认值（如web服务端口为8080）。如果想使用自定义配置，可以使用配置文件进行配置。不同的配置文件类型有不同的语法，如：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">application.properties</span></span><br><span class=\"line\">server.port=8080</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">application.yaml</span></span><br><span class=\"line\">server:</span><br><span class=\"line\">  port: 8080</span><br></pre></td></tr></table></figure>\n\n<p>SpringBoot 对同级目录配置文件的优先级，默认为：application.properties &gt; application.yml &gt; application.yaml</p>\n<p>如何在代码中获取配置的值，有下列几种方式：</p>\n<h3 id=\"Value注解\"><a href=\"#Value注解\" class=\"headerlink\" title=\"@Value注解\"></a>@Value注解</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Value(&quot;$&#123;person.name&#125;&quot;)</span> <span class=\"comment\">// 获取对象值</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"><span class=\"meta\">@Value(&quot;&#123;address[0]&#125;&quot;)</span> <span class=\"comment\">// 获取数组值</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> String firstAddress;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Environment对象\"><a href=\"#Environment对象\" class=\"headerlink\" title=\"Environment对象\"></a>Environment对象</h3><p>全路径类名 org.springframework.core.env.Environment</p>\n<p>可以自动注入，使用时，调用 getProperty 方法，通过键值获取变量值。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HelloController</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Environment env;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">HelloController</span><span class=\"params\">(Environment env)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.env = env;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">hello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Hello SpringBoot! &quot;</span> + env.getProperty(<span class=\"string\">&quot;name&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ConfigurationProperties\"><a href=\"#ConfigurationProperties\" class=\"headerlink\" title=\"@ConfigurationProperties\"></a>@ConfigurationProperties</h3><p>将类和配置文件关联起来</p>\n<p>举例，yaml配置文件如下</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">name: adam</span><br><span class=\"line\"></span><br><span class=\"line\">person:</span><br><span class=\"line\">  name: bob</span><br><span class=\"line\">  age: 20</span><br></pre></td></tr></table></figure>\n\n<p>创建Person类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Person</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Getter and Setters...</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Person&#123;&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;name=&#x27;&quot;</span> + name + <span class=\"string\">&#x27;\\&#x27;&#x27;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;, age=&quot;</span> + age +</span><br><span class=\"line\">                <span class=\"string\">&#x27;&#125;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在Controller类中注入person对象后，方法里返回person对象的字符串。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> String <span class=\"title function_\">hello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> person.toString();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Person&#123;name=&#x27;adam&#x27;, age=0&#125;</span><br></pre></td></tr></table></figure>\n\n<p>看到拿不到配置文件中person下级的配置。所以需要指定 @ConfigurationProperties 注解的前缀。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br></pre></td></tr></table></figure>\n\n<p>这样就可以获取person下级的配置了。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Person&#123;name=&#x27;bob&#x27;, age=20&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"profile\"><a href=\"#profile\" class=\"headerlink\" title=\"profile\"></a>profile</h3><p>在开发SpringBoot应用时，通常同一套程序会被安装到不同环境，其中数据库地址，服务器端口等等配置都不同，如果每次打包时，都要修改配置文件就会很麻烦。通过profile功能可实现动态配置切换。</p>\n<p>使用properties文件配置，可以用文件名为标识。application-XXX.properties 表示名为 XXX 的profile。</p>\n<p>在 application.properties 文件中，用下列写法激活某个profile</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">spring.profiles.active=test</span><br></pre></td></tr></table></figure>\n\n<p>使用yaml文件配置的话，不以profile文件名为标识，需要在profile文件中指定自己的名称.</p>\n<p>另外，yaml有多文件的特性，可以将不同profile写在同一个文件中。</p>\n<p>例如，在profile中按下列写法声明profile名为dev</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  config:</span><br><span class=\"line\">    activate:</span><br><span class=\"line\">      on-profile: dev</span><br></pre></td></tr></table></figure>\n\n<p>在 application.yml 文件中以如下方式激活</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  profiles:</span><br><span class=\"line\">    active: dev</span><br></pre></td></tr></table></figure>\n\n<p>可以同时开启多个profile，中间用逗号分隔。</p>\n<p>除了在配置文件中激活指定的profile，还能在虚拟机参数或命令行参数中指定</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">虚拟机参数</span></span><br><span class=\"line\">-DSpring.profiles.active=dev</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">命令行参数</span></span><br><span class=\"line\">--spring.profiles.active=dev</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"内部配置加载顺序\"><a href=\"#内部配置加载顺序\" class=\"headerlink\" title=\"内部配置加载顺序\"></a>内部配置加载顺序</h3><p>SpringBoot程序启动时，加载配置文件的优先级从高到低为：</p>\n<ol>\n<li>file:.&#x2F;config&#x2F; ，当前项目中的&#x2F;config 目录下</li>\n<li>file:.&#x2F; ，当前项目的根目录下</li>\n<li>CLASSPATH:&#x2F;config&#x2F; ，classpath的config目录</li>\n<li>CLASSPATH:&#x2F; ，classpath的根目录</li>\n</ol>\n<h3 id=\"外部配置加载顺序\"><a href=\"#外部配置加载顺序\" class=\"headerlink\" title=\"外部配置加载顺序\"></a>外部配置加载顺序</h3><p>常用外部配置的优先级从高到低为：</p>\n<ol>\n<li>命令行参数</li>\n<li>命令行指定的properties文件</li>\n<li>jar包目录下，config目录下的properties文件</li>\n<li>jar包同目录下的properties文件</li>\n</ol>\n<p>更多其他配置方式的优先级可查阅<a href=\"https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.external-config\">官方文档</a></p>\n<h2 id=\"自动加载机制\"><a href=\"#自动加载机制\" class=\"headerlink\" title=\"自动加载机制\"></a>自动加载机制</h2><p>目光聚焦在启动类 SpringbootInitApplication ；其使用了注解 @SpringBootApplication；而此注解上又标明了 @EnableAutoConfiguration 注解；此注解上声明了 @Import({AutoConfigurationImportSelector.class})。</p>\n<p>通过 AutoConfigurationImportSelector 的 selectImports 方法，获取返回需要加载类的全类路径。</p>\n<img src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjM0OXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTUzOHB4O2hlaWdodDozNDlweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNTM4IDM0OSIgd2lkdGg9IjE1MzhweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxnPjx0aXRsZT5TcHJpbmdib290SW5pdEFwcGxpY2F0aW9uPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iMjc4LjE5NTMiIHdpZHRoPSI4IiB4PSI5Ni42NDUiIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSIxMDAiIHgyPSIxMDAiIHkxPSIzNi4yOTY5IiB5Mj0iMzE0LjQ5MjIiLz48L2c+PGc+PHRpdGxlPi5TcHJpbmdCb290QXBwbGljYXRpb248L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSIyNzguMTk1MyIgd2lkdGg9IjgiIHg9IjI5NC4xMDM1IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iMjk3LjI5IiB4Mj0iMjk3LjI5IiB5MT0iMzYuMjk2OSIgeTI9IjMxNC40OTIyIi8+PC9nPjxnPjx0aXRsZT4uRW5hYmxlQXV0b0NvbmZpZ3VyYXRpb248L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSIyNzguMTk1MyIgd2lkdGg9IjgiIHg9IjQ5Ny40ODU0IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNTAwLjkxNyIgeDI9IjUwMC45MTciIHkxPSIzNi4yOTY5IiB5Mj0iMzE0LjQ5MjIiLz48L2c+PGc+PHRpdGxlPkF1dG9Db25maWd1cmF0aW9uSW1wb3J0U2VsZWN0b3I8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSIyNzguMTk1MyIgd2lkdGg9IjgiIHg9IjczMS43NjU2IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNzM1LjA1MzciIHgyPSI3MzUuMDUzNyIgeTE9IjM2LjI5NjkiIHkyPSIzMTQuNDkyMiIvPjwvZz48Zz48dGl0bGU+U3ByaW5nRmFjdG9yaWVzTG9hZGVyPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iMjc4LjE5NTMiIHdpZHRoPSI4IiB4PSI5NTAuMTM1MyIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9Ijk1My40Nzc1IiB4Mj0iOTUzLjQ3NzUiIHkxPSIzNi4yOTY5IiB5Mj0iMzE0LjQ5MjIiLz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtcGFydGljaXBhbnQ9IlNwcmluZ2Jvb3RJbml0QXBwbGljYXRpb24iPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTkxLjI5IiB4PSI1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTc3LjI5IiB4PSIxMiIgeT0iMjQuOTk1MSI+U3ByaW5nYm9vdEluaXRBcHBsaWNhdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9IlNwcmluZ2Jvb3RJbml0QXBwbGljYXRpb24iPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTkxLjI5IiB4PSI1IiB5PSIzMTMuNDkyMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3Ny4yOSIgeD0iMTIiIHk9IjMzMy40ODczIj5TcHJpbmdib290SW5pdEFwcGxpY2F0aW9uPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1wYXJ0aWNpcGFudD0iLlNwcmluZ0Jvb3RBcHBsaWNhdGlvbiI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxODMuNjI3IiB4PSIyMDYuMjkiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjkuNjI3IiB4PSIyMTMuMjkiIHk9IjI0Ljk5NTEiPkBTcHJpbmdCb290QXBwbGljYXRpb248L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLXBhcnRpY2lwYW50PSIuU3ByaW5nQm9vdEFwcGxpY2F0aW9uIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE4My42MjciIHg9IjIwNi4yOSIgeT0iMzEzLjQ5MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjkuNjI3IiB4PSIyMTMuMjkiIHk9IjMzMy40ODczIj5AU3ByaW5nQm9vdEFwcGxpY2F0aW9uPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1wYXJ0aWNpcGFudD0iLkVuYWJsZUF1dG9Db25maWd1cmF0aW9uIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIwMy4xMzY3IiB4PSIzOTkuOTE3IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTg5LjEzNjciIHg9IjQwNi45MTciIHk9IjI0Ljk5NTEiPkBFbmFibGVBdXRvQ29uZmlndXJhdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9Ii5FbmFibGVBdXRvQ29uZmlndXJhdGlvbiI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMDMuMTM2NyIgeD0iMzk5LjkxNyIgeT0iMzEzLjQ5MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxODkuMTM2NyIgeD0iNDA2LjkxNyIgeT0iMzMzLjQ4NzMiPkBFbmFibGVBdXRvQ29uZmlndXJhdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtcGFydGljaXBhbnQ9IkF1dG9Db25maWd1cmF0aW9uSW1wb3J0U2VsZWN0b3IiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjQ1LjQyMzgiIHg9IjYxMy4wNTM3IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjMxLjQyMzgiIHg9IjYyMC4wNTM3IiB5PSIyNC45OTUxIj5BdXRvQ29uZmlndXJhdGlvbkltcG9ydFNlbGVjdG9yPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1wYXJ0aWNpcGFudD0iQXV0b0NvbmZpZ3VyYXRpb25JbXBvcnRTZWxlY3RvciI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyNDUuNDIzOCIgeD0iNjEzLjA1MzciIHk9IjMxMy40OTIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjMxLjQyMzgiIHg9IjYyMC4wNTM3IiB5PSIzMzMuNDg3MyI+QXV0b0NvbmZpZ3VyYXRpb25JbXBvcnRTZWxlY3RvcjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtcGFydGljaXBhbnQ9IlNwcmluZ0ZhY3Rvcmllc0xvYWRlciI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzEuMzE1NCIgeD0iODY4LjQ3NzUiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTcuMzE1NCIgeD0iODc1LjQ3NzUiIHk9IjI0Ljk5NTEiPlNwcmluZ0ZhY3Rvcmllc0xvYWRlcjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtcGFydGljaXBhbnQ9IlNwcmluZ0ZhY3Rvcmllc0xvYWRlciI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzEuMzE1NCIgeD0iODY4LjQ3NzUiIHk9IjMxMy40OTIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU3LjMxNTQiIHg9Ijg3NS40Nzc1IiB5PSIzMzMuNDg3MyI+U3ByaW5nRmFjdG9yaWVzTG9hZGVyPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJTcHJpbmdib290SW5pdEFwcGxpY2F0aW9uIiBkYXRhLXBhcnRpY2lwYW50LTI9Ii5TcHJpbmdCb290QXBwbGljYXRpb24iPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjg2LjEwMzUsNjMuNDI5NywyOTYuMTAzNSw2Ny40Mjk3LDI4Ni4xMDM1LDcxLjQyOTcsMjkwLjEwMzUsNjcuNDI5NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMDAuNjQ1IiB4Mj0iMjkyLjEwMzUiIHkxPSI2Ny40Mjk3IiB5Mj0iNjcuNDI5NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyLjAwMDEiIHg9IjEwNy42NDUiIHk9IjYyLjM2MzgiPiYjMjAzNTE7JiMyOTk5MjsmIzI3ODgwOyYjMzUyOTk7PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSIuU3ByaW5nQm9vdEFwcGxpY2F0aW9uIiBkYXRhLXBhcnRpY2lwYW50LTI9Ii5FbmFibGVBdXRvQ29uZmlndXJhdGlvbiI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0ODkuNDg1NCw5Mi41NjI1LDQ5OS40ODU0LDk2LjU2MjUsNDg5LjQ4NTQsMTAwLjU2MjUsNDkzLjQ4NTQsOTYuNTYyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyOTguMTAzNSIgeDI9IjQ5NS40ODU0IiB5MT0iOTYuNTYyNSIgeTI9Ijk2LjU2MjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Mi4wMDAxIiB4PSIzMDUuMTAzNSIgeT0iOTEuNDk2NiI+JiMyMDM1MTsmIzI5OTkyOyYjMjc4ODA7JiMzNTI5OTs8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9Ii5FbmFibGVBdXRvQ29uZmlndXJhdGlvbiIgZGF0YS1wYXJ0aWNpcGFudC0yPSJBdXRvQ29uZmlndXJhdGlvbkltcG9ydFNlbGVjdG9yIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjcyMy43NjU2LDEzOS44MjgxLDczMy43NjU2LDE0My44MjgxLDcyMy43NjU2LDE0Ny44MjgxLDcyNy43NjU2LDE0My44MjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjUwMS40ODU0IiB4Mj0iNzI5Ljc2NTYiIHkxPSIxNDMuODI4MSIgeTI9IjE0My44MjgxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODguNTQzNSIgeD0iNTA4LjQ4NTQiIHk9IjEzOC43NjIyIj5zZWxlY3RJbXBvcnRzPC90ZXh0PjwvZz48cGF0aCBkPSJNNzQwLDEwOS41NjI1IEw3NDAsMTY0LjU2MjUgTDkwMSwxNjQuNTYyNSBMOTAxLDExOS41NjI1IEw4OTEsMTA5LjU2MjUgTDc0MCwxMDkuNTYyNSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTg5MSwxMDkuNTYyNSBMODkxLDExOS41NjI1IEw5MDEsMTE5LjU2MjUgTDg5MSwxMDkuNTYyNSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM4LjI3NzQiIHg9Ijc0NiIgeT0iMTI2LjYyOTQiPkBJbXBvcnQgJiMyNzg4MDsmIzM1Mjk5OyYjMjQzNDE7JiMyMDgzNzsmIzMxODY3OyYjNjUyOTI7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0MC41NDM1IiB4PSI3NDYiIHk9IjE0MS43NjIyIj5zZWxlY3RJbXBvcnRzJiMyNjA0MTsmIzI3ODYxOyYjMzY4MjA7JiMyMjIzODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9Ijc0NiIgeT0iMTU2Ljg5NSI+JiMzODY1NjsmIzIxMTUyOyYjMzY3MzM7JiMzMTg2NzsmIzMwMzQwOyYjMjA4NDA7JiMzMTg2NzsmIzM2MzM1OyYjMjQ0NTI7PC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9IkF1dG9Db25maWd1cmF0aW9uSW1wb3J0U2VsZWN0b3IiIGRhdGEtcGFydGljaXBhbnQtMj0iQXV0b0NvbmZpZ3VyYXRpb25JbXBvcnRTZWxlY3RvciI+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjczNS43NjU2IiB4Mj0iNzc3Ljc2NTYiIHkxPSIxOTEuMDkzOCIgeTI9IjE5MS4wOTM4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc3Ny43NjU2IiB4Mj0iNzc3Ljc2NTYiIHkxPSIxOTEuMDkzOCIgeTI9IjIwNC4wOTM4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjczNi43NjU2IiB4Mj0iNzc3Ljc2NTYiIHkxPSIyMDQuMDkzOCIgeTI9IjIwNC4wOTM4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3NDYuNzY1NiwyMDAuMDkzOCw3MzYuNzY1NiwyMDQuMDkzOCw3NDYuNzY1NiwyMDguMDkzOCw3NDIuNzY1NiwyMDQuMDkzOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3NC4yODEzIiB4PSI3NDIuNzY1NiIgeT0iMTg2LjAyNzgiPmdldEF1dG9Db25maWd1cmF0aW9uRW50cnk8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLXBhcnRpY2lwYW50LTE9IkF1dG9Db25maWd1cmF0aW9uSW1wb3J0U2VsZWN0b3IiIGRhdGEtcGFydGljaXBhbnQtMj0iQXV0b0NvbmZpZ3VyYXRpb25JbXBvcnRTZWxlY3RvciI+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjczNS43NjU2IiB4Mj0iNzc3Ljc2NTYiIHkxPSIyMzMuMjI2NiIgeTI9IjIzMy4yMjY2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc3Ny43NjU2IiB4Mj0iNzc3Ljc2NTYiIHkxPSIyMzMuMjI2NiIgeTI9IjI0Ni4yMjY2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjczNi43NjU2IiB4Mj0iNzc3Ljc2NTYiIHkxPSIyNDYuMjI2NiIgeTI9IjI0Ni4yMjY2Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3NDYuNzY1NiwyNDIuMjI2Niw3MzYuNzY1NiwyNDYuMjI2Niw3NDYuNzY1NiwyNTAuMjI2Niw3NDIuNzY1NiwyNDYuMjI2NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4Mi43NDI3IiB4PSI3NDIuNzY1NiIgeT0iMjI4LjE2MDYiPmdldENhbmRpZGF0ZUNvbmZpZ3VyYXRpb25zPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1wYXJ0aWNpcGFudC0xPSJBdXRvQ29uZmlndXJhdGlvbkltcG9ydFNlbGVjdG9yIiBkYXRhLXBhcnRpY2lwYW50LTI9IlNwcmluZ0ZhY3Rvcmllc0xvYWRlciI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5NDIuMTM1MywyODEuOTI1OCw5NTIuMTM1MywyODUuOTI1OCw5NDIuMTM1MywyODkuOTI1OCw5NDYuMTM1MywyODUuOTI1OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3MzUuNzY1NiIgeDI9Ijk0OC4xMzUzIiB5MT0iMjg1LjkyNTgiIHkyPSIyODUuOTI1OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMS41ODk0IiB4PSI3NDIuNzY1NiIgeT0iMjgwLjg1OTkiPmxvYWRGYWN0b3J5TmFtZXM8L3RleHQ+PC9nPjxwYXRoIGQ9Ik05NTksMjU5LjIyNjYgTDk1OSwyOTkuMjI2NiBMMTUzMSwyOTkuMjI2NiBMMTUzMSwyNjkuMjI2NiBMMTUyMSwyNTkuMjI2NiBMOTU5LDI1OS4yMjY2IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTUyMSwyNTkuMjI2NiBMMTUyMSwyNjkuMjI2NiBMMTUzMSwyNjkuMjI2NiBMMTUyMSwyNTkuMjI2NiIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzMxLjcwOTciIHg9Ijk2NSIgeT0iMjc2LjI5MzUiPiYjMjExNTI7JiMzNjczMzsmIzMxODY3OyYjNjUyOTI7JiMzMTg2NzsmIzIxNTE3OyYjMjE1MTc7JiMyMTMzMzsmIzI2NDY5OyYjMzMyNTg7JiMyMDExMDsgTUVUQS1JTkYvc3ByaW5nLmZhY3RvcmllcyAmIzI1MTEwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NTEuODMzNSIgeD0iOTY1IiB5PSIyOTEuNDI2MyI+TUVUQS1JTkYvc3ByaW5nL29yZy5zcHJpbmdmcmFtZXdvcmsuYm9vdC5hdXRvY29uZmlndXJlLkF1dG9Db25maWd1cmF0aW9uLmltcG9ydHM8L3RleHQ+PCEtLVNSQz1bMm91ZW9pbkJKeWhGQl83Q29vbm5CMlo4b0tuRUJDZENwckZHakxEbTIwUkJFVzViYU1JaTU5eGl0Vnp5b2VmZGNyVXlNQndPMnhpWWk3Uk5sQ0lhZDVKN3FmOXl2X295akNwcXFZQWkxazFHMVo4Mkd6MHBqbzJfZzJHdURJU3JrSUlfbzRnWDZDbzJZMVBwdlVNTmYyZUtQUVBkYjcwdkdDR0s4OU95dEpGclFVbEl2bmp0bHpfSm11TVl2emNxZFN5c0p0c25WeWhKc1ZFdU5pdmZVRGdydUNOVWxLMkxwc1VyRjZyVDBNSXlzQngtd1J1TWhqSXk1ME1HLUxtNHQ0SUtpekRKSXAzS2tFUUw1NUxJb3RKZG5Cb0twOUo0YWJHS1hTTjQ2MC05SnhUNDQzeXBqVFdkRnA0YjVNWGUzZjI2MjVSdzlVUWNlV0dzRkQyMG1HaWFkcXhlMVE3VWdTX2NCZHRIbGtoOWhadTVOelNHSHJyRkZwVnpPaDNmVWNhbXVuTVVUS3BaR2ZGTHBvekFydUNtcXVnMFRmTmQ1c05oV1RBZU5ZQkctU2JHdndWZ09OWDZCbkVRNDYySDFHMDBdLS0+PC9nPjwvc3ZnPg=='>\n\n<p>打开这个文件看下，就是一些需加载类的全路径名</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Logging Systems</span></span><br><span class=\"line\">org.springframework.boot.logging.LoggingSystemFactory=\\</span><br><span class=\"line\">org.springframework.boot.logging.logback.LogbackLoggingSystem.Factory,\\</span><br><span class=\"line\">org.springframework.boot.logging.log4j2.Log4J2LoggingSystem.Factory,\\</span><br><span class=\"line\">org.springframework.boot.logging.java.JavaLoggingSystem.Factory</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">PropertySource Loaders</span></span><br><span class=\"line\">org.springframework.boot.env.PropertySourceLoader=\\</span><br><span class=\"line\">org.springframework.boot.env.PropertiesPropertySourceLoader,\\</span><br><span class=\"line\">org.springframework.boot.env.YamlPropertySourceLoader</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">ConfigData Location Resolvers</span></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>…AutoConfiguration.imports 文件则只定义了 autoconfigure 相关的类路径名。</p>\n<p>但这些类并不一定全部加载，大多数类上会有 Conditional 相关的注解进行筛选。</p>\n<p>且这些配置类中声明的Bean，有些会声明 @ConditionalOnMissingBean ，当你定义了相同的 Bean，他就不会再次加载了。</p>\n<p>例如 RedisAutoConfiguration.class</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@AutoConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@ConditionalOnClass(RedisOperations.class)</span></span><br><span class=\"line\"><span class=\"meta\">@EnableConfigurationProperties(RedisProperties.class)</span></span><br><span class=\"line\"><span class=\"meta\">@Import(&#123; LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class &#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisAutoConfiguration</span> &#123;</span><br><span class=\"line\">\t<span class=\"meta\">@Bean</span></span><br><span class=\"line\">\t<span class=\"meta\">@ConditionalOnMissingBean(name = &quot;redisTemplate&quot;)</span></span><br><span class=\"line\">\t<span class=\"meta\">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> RedisTemplate&lt;Object, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class=\"line\">\t\tRedisTemplate&lt;Object, Object&gt; template = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">\t\ttemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> template;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Bean</span></span><br><span class=\"line\">\t<span class=\"meta\">@ConditionalOnMissingBean</span></span><br><span class=\"line\">\t<span class=\"meta\">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> StringRedisTemplate <span class=\"title function_\">stringRedisTemplate</span><span class=\"params\">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisTemplate</span>(redisConnectionFactory);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>另外这些类加载顺序的规则可在 AutoConfigurationSorter 类的 getInPriorityOrder 找到。</p>\n<p>先按字母排序，再按 @AutoConfigureOrder 注解排序 ，最后按 @AutoConfigureBefore&#x2F;After排序。</p>\n<h2 id=\"监听机制\"><a href=\"#监听机制\" class=\"headerlink\" title=\"监听机制\"></a>监听机制</h2><p>SpringBoot的监听机制，其实是对Java提供的事件监听机制的封装。</p>\n<p>Java中的事件监听机制定义了一下几个角色：</p>\n<ul>\n<li>事件：Event，继承 java.util.EventObject 类的对象。</li>\n<li>事件源：Source，任意对象Object。</li>\n<li>监听器：Listener，实现 java.util.EventListener 接口的对象。</li>\n</ul>\n<p>SpringBoot在项目启动时，会对几个监听器进行回调，可以实现这些监听器接口，在项目启动时完成一些操作。</p>\n<ul>\n<li>ApplicationContextInitializer</li>\n<li>SpringApplicationRunListener</li>\n<li>CommandLineRunner</li>\n<li>ApplicationRunner</li>\n</ul>\n<h3 id=\"Hello-World-1\"><a href=\"#Hello-World-1\" class=\"headerlink\" title=\"Hello World\"></a>Hello World</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyApplicationContextInitializer</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ApplicationContextInitializer</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">initialize</span><span class=\"params\">(ConfigurableApplicationContext applicationContext)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MyApplicationContextInitializer...#initialize...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是，SpringApplicationRunListener，需要显式声明带 (SpringApplication application, String[] args) 参数的构造函数，否则会报错。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MySpringApplicationRunListener</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">SpringApplicationRunListener</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">MySpringApplicationRunListener</span><span class=\"params\">(SpringApplication application, String[] args)</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">starting</span><span class=\"params\">(ConfigurableBootstrapContext bootstrapContext)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MySpringApplicationRunListener...#starting...项目启动中...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">environmentPrepared</span><span class=\"params\">(ConfigurableBootstrapContext bootstrapContext, ConfigurableEnvironment environment)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MySpringApplicationRunListener...#environmentPrepared...环境对象开始准备...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">contextPrepared</span><span class=\"params\">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MySpringApplicationRunListener...#contextPrepared...上下文对象开始准备...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">contextLoaded</span><span class=\"params\">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MySpringApplicationRunListener...#contextLoaded...上下文对象开始加载...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">running</span><span class=\"params\">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MySpringApplicationRunListener...#running...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">started</span><span class=\"params\">(ConfigurableApplicationContext context, Duration timeTaken)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MySpringApplicationRunListener...#started...上下文对象加载完成...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">ready</span><span class=\"params\">(ConfigurableApplicationContext context, Duration timeTaken)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MySpringApplicationRunListener...#ready...项目已准备完成...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">failed</span><span class=\"params\">(ConfigurableApplicationContext context, Throwable exception)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MySpringApplicationRunListener...#failed...项目启动失败...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyApplicationRunner</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ApplicationRunner</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">(ApplicationArguments args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MyApplicationRunner...#run...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyCommandLineRunner</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">CommandLineRunner</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">(String... args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MyCommandLineRunner...#run...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ApplicationContextInitializer 和 SpringApplicationRunListener 需要在 META-INF&#x2F;spring.factories 文件中显式声明。</p>\n<p>项目扫包时会扫这个文件，因此这两个类的 @Component 注解也不是必须的。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">org.springframework.context.ApplicationContextInitializer=com.example.springbootlistener.listener.MyApplicationContextInitializer</span><br><span class=\"line\">org.springframework.boot.SpringApplicationRunListener=com.example.springbootlistener.listener.MySpringApplicationRunListener</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Invoke MySpringApplicationRunListener...#starting...项目启动中...</span><br><span class=\"line\">Invoke MySpringApplicationRunListener...#environmentPrepared...环境对象开始准备...</span><br><span class=\"line\"></span><br><span class=\"line\">  .   ____          _            __ _ _</span><br><span class=\"line\"> /\\\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \\ \\ \\ \\</span><br><span class=\"line\">( ( )\\___ | &#x27;_ | &#x27;_| | &#x27;_ \\/ _` | \\ \\ \\ \\</span><br><span class=\"line\"> \\\\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class=\"line\">  &#x27;  |____| .__|_| |_|_| |_\\__, | / / / /</span><br><span class=\"line\"> =========|_|==============|___/=/_/_/_/</span><br><span class=\"line\"> :: Spring Boot ::                (v2.7.2)</span><br><span class=\"line\"></span><br><span class=\"line\">Invoke MyApplicationContextInitializer...#initialize...</span><br><span class=\"line\">Invoke MySpringApplicationRunListener...#contextPrepared...上下文对象开始准备...</span><br><span class=\"line\"></span><br><span class=\"line\">[开始运行SpringBoot应用...]</span><br><span class=\"line\"></span><br><span class=\"line\">Invoke MySpringApplicationRunListener...#contextLoaded...上下文对象开始加载...</span><br><span class=\"line\"></span><br><span class=\"line\">[Tomcat初始化...SpringBoot应用启动完毕]</span><br><span class=\"line\"></span><br><span class=\"line\">Invoke MySpringApplicationRunListener...#started...上下文对象加载完成...</span><br><span class=\"line\">Invoke MyApplicationRunner...#run...</span><br><span class=\"line\">Invoke MyCommandLineRunner...#run...</span><br><span class=\"line\">Invoke MySpringApplicationRunListener...#ready...项目已准备完成...</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"流程\"><a href=\"#流程\" class=\"headerlink\" title=\"流程\"></a>流程</h3><p>这些监听器监听的事件，在org.springframework.boot.context.event包中，包括 ApplicationContextInitializedEvent、ApplicationPrepared、ApplicationStarting等事件。都是 java.util.EventObject 的子类。</p>\n<p>从SpringBootApplication的main方法出发，可以看到run执行的是SpringApplication中的静态方法，主要做了两步操作：</p>\n<ul>\n<li>创建SpringApplication对象</li>\n<li>再执行此对象的run方法</li>\n</ul>\n<p>这个SpringApplication对象是事件源对象，之后所有监听器的注册都在这儿了；初始化时传入的 primarySources 对象，就是我们自定义的引导类，SpringBoot项目的入口。</p>\n<blockquote>\n<p>之前 SpringApplicationRunListener 需要显式声明构造函数，参数列表中的 SpringApplication 对象，也就是此处创建的对象。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ConfigurableApplicationContext <span class=\"title function_\">run</span><span class=\"params\">(Class&lt;?&gt;[] primarySources, String[] args)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SpringApplication</span>(primarySources).run(args);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>打开看一下SpringApplication的构造函数</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">SpringApplication</span><span class=\"params\">(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.resourceLoader = resourceLoader;</span><br><span class=\"line\">    Assert.notNull(primarySources, <span class=\"string\">&quot;PrimarySources must not be null&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.primarySources = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashSet</span>&lt;&gt;(Arrays.asList(primarySources));</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bootstrapRegistryInitializers = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;(</span><br><span class=\"line\">            getSpringFactoriesInstances(BootstrapRegistryInitializer.class));</span><br><span class=\"line\">    setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class)); <span class=\"comment\">// 设置Initializers</span></span><br><span class=\"line\">    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class)); <span class=\"comment\">// 设置监听器Listeners</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.mainApplicationClass = deduceMainApplicationClass();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>看到 Initializer 和 Listener 的设置，都是调用 getSpringFactoriesInstances 从 spring.factories 文件中获取。但此时也仅是获取相应Class对象而已，还没有实例化。</p>\n<p>构造函数执行流程如下：</p>\n<img src='data:image/svg+xml;base64,ZXJyb3IgY29kZTogNTIw'>\n\n<p>再打开 run 方法看一下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> ConfigurableApplicationContext <span class=\"title function_\">run</span><span class=\"params\">(String... args)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">long</span> <span class=\"variable\">startTime</span> <span class=\"operator\">=</span> System.nanoTime(); <span class=\"comment\">// 应用启动计时器开始计时</span></span><br><span class=\"line\">    <span class=\"type\">DefaultBootstrapContext</span> <span class=\"variable\">bootstrapContext</span> <span class=\"operator\">=</span> createBootstrapContext(); <span class=\"comment\">// 初始化启动上下文</span></span><br><span class=\"line\">    <span class=\"type\">ConfigurableApplicationContext</span> <span class=\"variable\">context</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>; <span class=\"comment\">// 声明IOC容器</span></span><br><span class=\"line\">    configureHeadlessProperty(); <span class=\"comment\">// 设置headless模式[#注1]</span></span><br><span class=\"line\">    <span class=\"type\">SpringApplicationRunListeners</span> <span class=\"variable\">listeners</span> <span class=\"operator\">=</span> getRunListeners(args); <span class=\"comment\">// 是个容器类，获取所有的listener监听器</span></span><br><span class=\"line\">    listeners.starting(bootstrapContext, <span class=\"built_in\">this</span>.mainApplicationClass); <span class=\"comment\">// 触发所有监听器的starting方法</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ApplicationArguments</span> <span class=\"variable\">applicationArguments</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultApplicationArguments</span>(args); <span class=\"comment\">// 将参数封装</span></span><br><span class=\"line\">        <span class=\"type\">ConfigurableEnvironment</span> <span class=\"variable\">environment</span> <span class=\"operator\">=</span> prepareEnvironment(listeners, bootstrapContext, applicationArguments); <span class=\"comment\">// 准备环境信息，并触发所有监听器的environmentPrepared方法</span></span><br><span class=\"line\">        configureIgnoreBeanInfo(environment); <span class=\"comment\">// 配置忽略的Bean信息</span></span><br><span class=\"line\">        <span class=\"type\">Banner</span> <span class=\"variable\">printedBanner</span> <span class=\"operator\">=</span> printBanner(environment); <span class=\"comment\">// 打印字符画</span></span><br><span class=\"line\">        context = createApplicationContext(); <span class=\"comment\">// 创建IOC容器</span></span><br><span class=\"line\">        context.setApplicationStartup(<span class=\"built_in\">this</span>.applicationStartup); <span class=\"comment\">// IOC容器记录当前应用的startup事件，保存相关信息</span></span><br><span class=\"line\">        prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner); <span class=\"comment\">// 初始化IOC容器，并触发所有监听器的contextPrepared相关方法</span></span><br><span class=\"line\">        refreshContext(context); <span class=\"comment\">// 容器刷新，Bean的创建初始化都在这儿。一般都是触发父类AbstractApplicationContext的refresh方法，在Bean的声明周期一文中有详细介绍。这一步直接给加载了一百多个Bean</span></span><br><span class=\"line\">        afterRefresh(context, applicationArguments); <span class=\"comment\">// 容器刷新后触发，默认为空，留给子类重写</span></span><br><span class=\"line\">        <span class=\"type\">Duration</span> <span class=\"variable\">timeTakenToStartup</span> <span class=\"operator\">=</span> Duration.ofNanos(System.nanoTime() - startTime); <span class=\"comment\">// 计时结束，计算启动耗时</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.logStartupInfo) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">StartupInfoLogger</span>(<span class=\"built_in\">this</span>.mainApplicationClass).logStarted(getApplicationLog(), timeTakenToStartup); <span class=\"comment\">// 记录started日志</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        listeners.started(context, timeTakenToStartup); <span class=\"comment\">// 触发所有监听器的started方法</span></span><br><span class=\"line\">        callRunners(context, applicationArguments); <span class=\"comment\">// 触发ApplicationRunner和CommandLineRunner的run方法</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">catch</span> (Throwable ex) &#123;</span><br><span class=\"line\">        handleRunFailure(context, ex, listeners);</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(ex);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Duration</span> <span class=\"variable\">timeTakenToReady</span> <span class=\"operator\">=</span> Duration.ofNanos(System.nanoTime() - startTime); <span class=\"comment\">// 计时结束，计算耗时</span></span><br><span class=\"line\">        listeners.ready(context, timeTakenToReady); <span class=\"comment\">// 触发所有监听器的ready方法</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">catch</span> (Throwable ex) &#123;</span><br><span class=\"line\">        handleRunFailure(context, ex, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(ex);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> context;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注1：设置headless模式是J2SE的一种模式，用于在缺失显示屏、鼠标或者键盘时的系统配置。</p>\n</blockquote>\n<p>整个流程大致如下：</p>\n<img src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9Ijc0MXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTUxN3B4O2hlaWdodDo3NDFweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNTE3IDc0MSIgd2lkdGg9IjE1MTdweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSIuLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxIiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImVudGl0eV8uLi4uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUyLjU5MzgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE3Ni4yNzgzIiB4PSI0OTYuODYiIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjIuMjc4MyIgeD0iNTAzLjg2IiB5PSIyMS45OTUxIj5TcHJpbmdBcHBsaWNhdGlvbi5ydW4oKTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSI1NDkuOTk5MyIgeT0iMzguMjkyIj4mIzIxNTUxOyYjMjExNjA7JiMyNzQ5MjsmIzI0MjEyOyYjMjk5OTI7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQ5Ny44NiIgeDI9IjY3Mi4xMzgzIiB5MT0iNDMuNTkzOCIgeTI9IjQzLjU5MzgiLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIyIiBkYXRhLXVpZD0iZW50MDAwMyIgaWQ9ImVudGl0eV8uLi4uLi4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1Mi41OTM4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjcuOTk5MyIgeD0iNTAxIiB5PSIxMTkuNiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1My45OTkzIiB4PSI1MDgiIHk9IjEzNC41OTUxIj4mIzI0MjEyOyYjMjk5OTI7JiMyMTU1MTsmIzIxMTYwOyYjMzU3NDU7JiMyNjEwMjsmIzIyMTIwOyYjMjQzMjA7JiMyMjk4NzsmIzM1NzQ1OyYjMjYxMDI7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1My45OTkzIiB4PSI1MDgiIHk9IjE1MC44OTIiPiYjMjQyMTI7JiMyOTk5MjsmIzIxNTUxOyYjMjExNjA7JiMzMDQxNzsmIzIxNTQ4OyYjMjIxMjA7JiMyNDMyMDsmIzIyOTg3OyYjMzA0MTc7JiMyMTU0ODs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNTAyIiB4Mj0iNjY3Ljk5OTMiIHkxPSIxNTYuMTkzOCIgeTI9IjE1Ni4xOTM4Ii8+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJIZWFkbGVzcy4uIiBkYXRhLXNvdXJjZS1saW5lPSIzIiBkYXRhLXVpZD0iZW50MDAwNCIgaWQ9ImVudGl0eV9IZWFkbGVzcy4uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEwNS42OTcxIiB4PSI3MDQuMTUiIHk9IjEyNy43NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjY5NzEiIHg9IjcxMS4xNSIgeT0iMTQyLjc0NTEiPkhlYWRsZXNzJiMyNzE2OTsmIzI0MzM1OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI3MDUuMTUiIHgyPSI4MDguODQ3MSIgeTE9IjE0OC4wNDY5IiB5Mj0iMTQ4LjA0NjkiLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iNCIgZGF0YS11aWQ9ImVudDAwMDUiIGlkPSJlbnRpdHlfLi4uLi4uLi4uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUyLjU5MzgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIyOC40OTgiIHg9Ijc4Ljc1IiB5PSIyMzIuMTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMTQuNDk4IiB4PSI4NS43NSIgeT0iMjQ3LjE4NTEiPlNwcmluZ0FwcGxpY2F0aW9uUnVuTGlzdGVuZXJzPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS45OTk1IiB4PSIxMjkuOTk5MyIgeT0iMjYzLjQ4MiI+JiMyNDIxMjsmIzI5OTkyOyYjMjE1NTE7JiMyMTE2MDsmIzMwNDE3OyYjMjE1NDg7JiMyMjEyMDsmIzI3MTY5OyYjMjIzNTk7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9Ijc5Ljc1IiB4Mj0iMzA2LjI0OCIgeTE9IjI2OC43ODM3IiB5Mj0iMjY4Ljc4MzciLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBkYXRhLXVpZD0iZW50MDAwNiIgaWQ9ImVudGl0eV8uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0MS45OTk5IiB4PSI1NiIgeT0iMzUyLjkzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjcuOTk5OSIgeD0iNjMiIHk9IjM2Ny45MjUxIj4mIzIxNTUxOyYjMjExNjA7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjU3IiB4Mj0iOTYuOTk5OSIgeTE9IjM3My4yMjY5IiB5Mj0iMzczLjIyNjkiLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uIiBkYXRhLXNvdXJjZS1saW5lPSI2IiBkYXRhLXVpZD0iZW50MDAwNyIgaWQ9ImVudGl0eV8uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0MS45OTk5IiB4PSIxMzMiIHk9IjM1Mi45MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI3Ljk5OTkiIHg9IjE0MCIgeT0iMzY3LjkyNTEiPiYjMzA0MTc7JiMyMTU0ODs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTM0IiB4Mj0iMTczLjk5OTkiIHkxPSIzNzMuMjI2OSIgeTI9IjM3My4yMjY5Ii8+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSIuLiIgZGF0YS1zb3VyY2UtbGluZT0iNyIgZGF0YS11aWQ9ImVudDAwMDgiIGlkPSJlbnRpdHlfLi4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNDEuOTk5OSIgeD0iMjEwIiB5PSIzNTIuOTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNy45OTk5IiB4PSIyMTciIHk9IjM2Ny45MjUxIj4mIzMyNDY3OyYjMjY0NjM7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIxMSIgeDI9IjI1MC45OTk5IiB5MT0iMzczLjIyNjkiIHkyPSIzNzMuMjI2OSIvPjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iOCIgZGF0YS11aWQ9ImVudDAwMDkiIGlkPSJlbnRpdHlfLi4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OS45OTk4IiB4PSI3IiB5PSI0NjUuNTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIxNCIgeT0iNDgwLjUyNTEiPiYjMzcxOTc7JiMzMjYyMjsmIzI5NjE1OyYjMjI2NTk7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjgiIHgyPSI3NS45OTk4IiB5MT0iNDg1LjgyNjkiIHkyPSI0ODUuODI2OSIvPjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjkiIGRhdGEtdWlkPSJlbnQwMDEwIiBpZD0iZW50aXR5Xy4uLi4uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjgzLjk5OTciIHg9IjExMiIgeT0iNDY1LjUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iMTE5IiB5PSI0ODAuNTI1MSI+JiMyNDIxMjsmIzI5OTkyOyYjMTk5Nzg7JiMxOTk3OTsmIzI1OTkxOzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMTMiIHgyPSIxOTQuOTk5NyIgeTE9IjQ4NS44MjY5IiB5Mj0iNDg1LjgyNjkiLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjEwIiBkYXRhLXVpZD0iZW50MDAxMSIgaWQ9ImVudGl0eV8uLi4uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQwLjcwMTIiIHg9IjIzMC42NSIgeT0iNDY1LjUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjYuNzAxMiIgeD0iMjM3LjY1IiB5PSI0ODAuNTI1MSI+Li4uLi4uPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIzMS42NSIgeDI9IjI3MC4zNTEyIiB5MT0iNDg1LjgyNjkiIHkyPSI0ODUuODI2OSIvPjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgZGF0YS11aWQ9ImVudDAwMTIiIGlkPSJlbnRpdHlfLi4uLi4uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUyLjU5MzgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE5OC42NDU1IiB4PSIzOTUuNjgiIHk9IjIzMi4xOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4NC42NDU1IiB4PSI0MDIuNjgiIHk9IjI0Ny4xODUxIj5Db25maWd1cmF0aW9uRW52aXJvbm1lbnQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODMuOTk5NiIgeD0iNDUzLjAwMjkiIHk9IjI2My40ODIiPiYjMzcxOTc7JiMzMjYyMjsmIzI5NjE1OyYjMjI2NTk7JiMyNzE2OTsmIzIyMzU5OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzOTYuNjgiIHgyPSI1OTMuMzI1NSIgeTE9IjI2OC43ODM3IiB5Mj0iMjY4Ljc4MzciLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTIiIGRhdGEtdWlkPSJlbnQwMDEzIiBpZD0iZW50aXR5Xy4uLi4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1Mi41OTM4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMTAuMDMxMyIgeD0iMjg2Ljk4IiB5PSIzNDQuNzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4My45OTk2IiB4PSIyOTkuOTk1OCIgeT0iMzU5Ljc3NTEiPiYjMjEwMTk7JiMyNDMxNDsmIzM3MTk3OyYjMzI2MjI7JiMyOTYxNTsmIzIyNjU5OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ni4wMzEzIiB4PSIyOTMuOTgiIHk9IjM3Ni4wNzIiPih3ZWIvbm8td2ViKTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyODcuOTgiIHgyPSIzOTYuMDExMyIgeTE9IjM4MS4zNzM4IiB5Mj0iMzgxLjM3MzgiLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgZGF0YS11aWQ9ImVudDAwMTQiIGlkPSJlbnRpdHlfLi4uLi4uLi4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI1Ljk5OTUiIHg9IjQzMiIgeT0iMzUyLjkzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTExLjk5OTUiIHg9IjQzOSIgeT0iMzY3LjkyNTEiPiYjMjExNTI7JiMzNjczMzsmIzIzNjQ2OyYjMjQ2MTU7JiMyNTk5MTsmIzIwMjE0OyYjMzYxNjQ7JiMyODMwNDs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDMzIiB4Mj0iNTU2Ljk5OTUiIHkxPSIzNzMuMjI2OSIgeTI9IjM3My4yMjY5Ii8+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSIuLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNCIgZGF0YS11aWQ9ImVudDAwMTUiIGlkPSJlbnRpdHlfLi4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OS45OTk4IiB4PSI1OTMiIHk9IjM1Mi45MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjYwMCIgeT0iMzY3LjkyNTEiPiYjMzcxOTc7JiMzMjYyMjsmIzMwNDE3OyYjMjE1NDg7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjU5NCIgeDI9IjY2MS45OTk4IiB5MT0iMzczLjIyNjkiIHkyPSIzNzMuMjI2OSIvPjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQmFubmVyLi4iIGRhdGEtc291cmNlLWxpbmU9IjE1IiBkYXRhLXVpZD0iZW50MDAxNiIgaWQ9ImVudGl0eV9CYW5uZXIuLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5Mi4yOTg3IiB4PSI2MjguODUiIHk9IjI0MC4zNCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjI5ODciIHg9IjYzNS44NSIgeT0iMjU1LjMzNTEiPkJhbm5lciYjMjUxNzE7JiMyMTM2MDs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNjI5Ljg1IiB4Mj0iNzIwLjE0ODciIHkxPSIyNjAuNjM2OSIgeTI9IjI2MC42MzY5Ii8+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSIuLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNiIgZGF0YS11aWQ9ImVudDAwMTciIGlkPSJlbnRpdHlfLi4uLi4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1Mi41OTM4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyNDIuMjU4OCIgeD0iNzc3Ljg3IiB5PSIyMzIuMTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjguMjU4OCIgeD0iNzg0Ljg3IiB5PSIyNDcuMTg1MSI+Q29uZmlndXJhdGlvbkFwcGxpY2F0aW9uQ29udGV4dDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSI4NDkuOTk5NiIgeT0iMjYzLjQ4MiI+JiMyNDIxMjsmIzI5OTkyOyYjMTk5Nzg7JiMxOTk3OTsmIzI1OTkxOyYjMjcxNjk7JiMyMjM1OTs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNzc4Ljg3IiB4Mj0iMTAxOS4xMjg4IiB5MT0iMjY4Ljc4MzciIHkyPSIyNjguNzgzNyIvPjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iLi4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNyIgZGF0YS11aWQ9ImVudDAwMTgiIGlkPSJlbnRpdHlfLi4uLi4uLi4uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUyLjU5MzgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzOS45OTk1IiB4PSI2OTgiIHk9IjM0NC43OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS45OTk1IiB4PSI3MDUiIHk9IjM1OS43NzUxIj4mIzIxMDE5OyYjMjQzMTQ7JiMyNDIxMjsmIzI5OTkyOyYjMTk5Nzg7JiMxOTk3OTsmIzI1OTkxOyYjMjM1NDU7JiMzNTkzNzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTYuMDMxMyIgeD0iNzE5Ljk4NDEiIHk9IjM3Ni4wNzIiPih3ZWIvbm8td2ViKTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2OTkiIHgyPSI4MzYuOTk5NSIgeTE9IjM4MS4zNzM4IiB5Mj0iMzgxLjM3MzgiLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTgiIGRhdGEtdWlkPSJlbnQwMDE5IiBpZD0iZW50aXR5Xy4uLi4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5Ny45OTk2IiB4PSI4NzMiIHk9IjM1Mi45MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjk5OTYiIHg9Ijg4MCIgeT0iMzY3LjkyNTEiPiYjMjI1MjI7JiMyNjQxMjsmIzIzNjQ2OyYjMjQ2MTU7JiMzNzE5NzsmIzMyNjIyOzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4NzQiIHgyPSI5NjkuOTk5NiIgeTE9IjM3My4yMjY5IiB5Mj0iMzczLjIyNjkiLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjE5IiBkYXRhLXVpZD0iZW50MDAyMCIgaWQ9ImVudGl0eV8uLi4uLi4uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExMS45OTk2IiB4PSIxMTUwIiB5PSIzNTIuOTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSIxMTU3IiB5PSIzNjcuOTI1MSI+JiMyNjM1NjsmIzI2MDMyOyYjMjQyMTI7JiMyOTk5MjsmIzE5OTc4OyYjMTk5Nzk7JiMyNTk5MTs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTE1MSIgeDI9IjEyNjAuOTk5NiIgeTE9IjM3My4yMjY5IiB5Mj0iMzczLjIyNjkiLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMjAiIGRhdGEtdWlkPSJlbnQwMDIxIiBpZD0iZW50aXR5Xy4uLi4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5Ny45OTk2IiB4PSI1OTEiIHk9IjQ2NS41MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjk5OTYiIHg9IjU5OCIgeT0iNDgwLjUyNTEiPiYjMjExNTI7JiMzNjczMzsmIzM3MTk3OyYjMzI2MjI7JiMyOTYxNTsmIzIyNjU5OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI1OTIiIHgyPSI2ODcuOTk5NiIgeTE9IjQ4NS44MjY5IiB5Mj0iNDg1LjgyNjkiLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIyMSIgZGF0YS11aWQ9ImVudDAwMjIiIGlkPSJlbnRpdHlfLi4uLi4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTIuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI3LjMzOTgiIHg9IjcyNC4zMyIgeT0iNDU3LjM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEzLjMzOTgiIHg9IjczMS4zMyIgeT0iNDcyLjM3NTEiPlJlc291cmNlTG9hZGVyPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9Ijc1My4wMDAxIiB5PSI0ODguNjcyIj4mIzM2MTY0OyYjMjgzMDQ7JiMyMTE1MjsmIzM2NzMzOyYjMjIxMjA7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjcyNS4zMyIgeDI9Ijg1MC42Njk4IiB5MT0iNDkzLjk3MzgiIHkyPSI0OTMuOTczOCIvPjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQ29udGV4dC4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjIyIiBkYXRhLXVpZD0iZW50MDAyMyIgaWQ9ImVudGl0eV9Db250ZXh0Li4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OS45OTk4IiB4PSI4ODciIHk9IjQ2NS41MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9Ijg5NCIgeT0iNDgwLjUyNTEiPiYjMzcxOTc7JiMzMjYyMjsmIzMwNDE3OyYjMjE1NDg7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9Ijg4OCIgeDI9Ijk1NS45OTk4IiB5MT0iNDg1LjgyNjkiIHkyPSI0ODUuODI2OSIvPjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIyMyIgZGF0YS11aWQ9ImVudDAwMjQiIGlkPSJlbnRpdHlfLi4uLi4uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijk3Ljk5OTYiIHg9Ijk5MiIgeT0iNDY1LjUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODMuOTk5NiIgeD0iOTk5IiB5PSI0ODAuNTI1MSI+JiMyMTE1MjsmIzM2NzMzOyYjMjE1NTE7JiMyMTE2MDsmIzIxNDQyOyYjMjU5Njg7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9Ijk5MyIgeDI9IjEwODguOTk5NiIgeTE9IjQ4NS44MjY5IiB5Mj0iNDg1LjgyNjkiLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uLi4uLkJlYW4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMjQiIGRhdGEtdWlkPSJlbnQwMDI1IiBpZD0iZW50aXR5Xy4uLi4uLkJlYW4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjEuNjY5NCIgeD0iMTEyNS4xNyIgeT0iNDY1LjUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ3LjY2OTQiIHg9IjExMzIuMTciIHk9IjQ4MC41MjUxIj4mIzIwOTM0OyYjMjI3OTE7JiMyOTYxNTsmIzIyNjU5OyYjMjUxNTI7JiMzODY1NjtCZWFuJiMyNDAzNzsmIzIxMzc4OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMTI2LjE3IiB4Mj0iMTI4NS44Mzk0IiB5MT0iNDg1LjgyNjkiIHkyPSI0ODUuODI2OSIvPjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iLi4uLi4uLi4uLkJlYW4iIGRhdGEtc291cmNlLWxpbmU9IjI1IiBkYXRhLXVpZD0iZW50MDAyNiIgaWQ9ImVudGl0eV8uLi4uLi4uLi4uQmVhbiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxODkuNjY5MyIgeD0iMTMyMi4xNyIgeT0iNDY1LjUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTc1LjY2OTMiIHg9IjEzMjkuMTciIHk9IjQ4MC41MjUxIj4mIzM2ODkwOyYjMzY4MDc7JiMyNDAzNzsmIzIxMzc4OyYjMjk5ODM7JiMyNTEwNDsmIzI5NjE1OyYjMjI2NTk7JiMyNTE1MjsmIzM4NjU2O0JlYW48L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTMyMy4xNyIgeDI9IjE1MTAuODM5MyIgeTE9IjQ4NS44MjY5IiB5Mj0iNDg1LjgyNjkiLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIyNiIgZGF0YS11aWQ9ImVudDAwMjciIGlkPSJlbnRpdHlfLi4uLi4uLi4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTIuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTY3Ljk5OTMiIHg9IjEzMzMiIHk9IjU2OS45NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1My45OTkzIiB4PSIxMzQwIiB5PSI1ODQuOTY1MSI+JiMyNDIxMjsmIzI5OTkyOyYjMjE1NTE7JiMyMTE2MDsmIzM1NzQ1OyYjMjYxMDI7JiMyMjEyMDsmIzMyNDY3OyYjMjY0NjM7JiMzNTc0NTsmIzI2MTAyOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTMuOTk5MyIgeD0iMTM0MCIgeT0iNjAxLjI2MiI+JiMyNDIxMjsmIzI5OTkyOyYjMjE1NTE7JiMyMTE2MDsmIzMwNDE3OyYjMjE1NDg7JiMyMjEyMDsmIzMyNDY3OyYjMjY0NjM7JiMzMDQxNzsmIzIxNTQ4OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMzM0IiB4Mj0iMTQ5OS45OTkzIiB5MT0iNjA2LjU2MzciIHkyPSI2MDYuNTYzNyIvPjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMjciIGRhdGEtdWlkPSJlbnQwMDI4IiBpZD0iZW50aXR5Xy4uLi4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTIuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTM3LjQwMjMiIHg9IjEzNDguMyIgeT0iNjgyLjU3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIzLjQwMjMiIHg9IjEzNTUuMyIgeT0iNjk3LjU2NTEiPlNwcmluZ0FwcGxpY2F0aW9uPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjEzODkuMDAxMyIgeT0iNzEzLjg2MiI+JiMyMTU1MTsmIzIxMTYwOyYjMzI0Njc7JiMyNjQ2Mzs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTM0OS4zIiB4Mj0iMTQ4NC43MDIzIiB5MT0iNzE5LjE2MzciIHkyPSI3MTkuMTYzNyIvPjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iR01OMzIiIGRhdGEtc291cmNlLWxpbmU9IjMzIiBkYXRhLXVpZD0iZW50MDAzMyIgaWQ9ImVudGl0eV9HTU4zMiI+PHBhdGggZD0iTTExMTksNjk2LjMgTDExMTksNzIxLjQzMjggTDEyMDUuMDAwMSw3MjEuNDMyOCBMMTIwNS4wMDAxLDcwNi4zIEwxMTk1LjAwMDEsNjk2LjMgTDExMTksNjk2LjMiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xMTk1LjAwMDEsNjk2LjMgTDExOTUuMDAwMSw3MDYuMyBMMTIwNS4wMDAxLDcwNi4zIEwxMTk1LjAwMDEsNjk2LjMiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSIxMTI1IiB5PSI3MTMuMzY2OSI+JiMzNTI2NjsmIzIzNTE5OyYjMzI3NzM7JiMyNzE2OTsmIzI0MzM1OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkdNTjU2IiBkYXRhLXNvdXJjZS1saW5lPSI1NyIgZGF0YS11aWQ9ImVudDAwNTciIGlkPSJlbnRpdHlfR01ONTYiPjxwYXRoIGQ9Ik0xMjQwLjUsNjk2LjMgTDEyNDAuNSw3MjEuNDMyOCBMMTMxMy41MDAxLDcyMS40MzI4IEwxMzEzLjUwMDEsNzA2LjMgTDEzMDMuNTAwMSw2OTYuMyBMMTI0MC41LDY5Ni4zIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTMwMy41MDAxLDY5Ni4zIEwxMzAzLjUwMDEsNzA2LjMgTDEzMTMuNTAwMSw3MDYuMyBMMTMwMy41MDAxLDY5Ni4zIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIuMDAwMSIgeD0iMTI0Ni41IiB5PSI3MTMuMzY2OSI+JiMyNDAzNzsmIzIxMzc4OyYjMjcxNjk7JiMyNDMzNTs8L3RleHQ+PC9nPjwhLS1saW5rID8/Pz8gdG8gPz8/Pz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLiIgZGF0YS1lbnRpdHktMj0iLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjI5IiBkYXRhLXVpZD0ibG5rMjkiIGlkPSJsaW5rXy4uLi5fLi4uLi4uLi4iPjxwYXRoIGNvZGVMaW5lPSIyOSIgZD0iTTU4NSw1OS45NSBDNTg1LDc3LjgyIDU4NSw5NS41NSA1ODUsMTEzLjM4IiBmaWxsPSJub25lIiBpZD0iJiMyMTU1MTsmIzIxMTYwOyYjMjQyMTI7JiMyOTk5MjstdG8tJiMyMTU1MTsmIzIxMTYwOyYjMzA0MTc7JiMyMTU0ODsmIzIyMTIwOyYjMzU3NDU7JiMyNjEwMjsmIzIyMTIwOyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTg1LDExOS4zOCw1ODksMTEwLjM4LDU4NSwxMTQuMzgsNTgxLDExMC4zOCw1ODUsMTE5LjM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rID8/Pz8/Pz8/IHRvIEhlYWRsZXNzPz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLi4uLi4iIGRhdGEtZW50aXR5LTI9IkhlYWRsZXNzLi4iIGRhdGEtc291cmNlLWxpbmU9IjMwIiBkYXRhLXVpZD0ibG5rMzAiIGlkPSJsaW5rXy4uLi4uLi4uX0hlYWRsZXNzLi4iPjxwYXRoIGNvZGVMaW5lPSIzMCIgZD0iTTY2OS4zMiwxNDUuODkgQzY4MC44NSwxNDUuODkgNjg2LjM4LDE0NS44OSA2OTcuOTEsMTQ1Ljg5IiBmaWxsPSJub25lIiBpZD0iJiMyMTU1MTsmIzIxMTYwOyYjMzA0MTc7JiMyMTU0ODsmIzIyMTIwOyYjMzU3NDU7JiMyNjEwMjsmIzIyMTIwOy10by1IZWFkbGVzcyYjMjcxNjk7JiMyNDMzNTsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjcwMy45MSwxNDUuODksNjk0LjkxLDE0MS44OSw2OTguOTEsMTQ1Ljg5LDY5NC45MSwxNDkuODksNzAzLjkxLDE0NS44OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayA/Pz8/Pz8/PyB0byA/Pz8/Pz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLi4uLi4iIGRhdGEtZW50aXR5LTI9Ii4uLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMzEiIGRhdGEtdWlkPSJsbmszMSIgaWQ9ImxpbmtfLi4uLi4uLi5fLi4uLi4uLi4uIj48cGF0aCBjb2RlTGluZT0iMzEiIGQ9Ik01MDAuOTEsMTcwLjYyIEM0MzcuMTMsMTg4LjYxIDM1NS4zNTQ1LDIxMS42ODA0IDI4OS45MDQ1LDIzMC4xNTA0IiBmaWxsPSJub25lIiBpZD0iJiMyMTU1MTsmIzIxMTYwOyYjMzA0MTc7JiMyMTU0ODsmIzIyMTIwOyYjMzU3NDU7JiMyNjEwMjsmIzIyMTIwOy10by0mIzI0MjEyOyYjMjk5OTI7JiMyMTU1MTsmIzIxMTYwOyYjMzA0MTc7JiMyMTU0ODsmIzIyMTIwOyYjMjcxNjk7JiMyMjM1OTsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI4NC4xMywyMzEuNzgsMjkzLjg3ODEsMjMzLjE4NTMsMjg4Ljk0MjEsMjMwLjQyMiwyOTEuNzA1MywyMjUuNDg2LDI4NC4xMywyMzEuNzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgR01OMzIgdG8gPz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJHTU4zMiIgZGF0YS1lbnRpdHktMj0iLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMzMiIGRhdGEtdWlkPSJsbmszNCIgaWQ9ImxpbmtfR01OMzJfLi4uLiI+PHBhdGggZD0iTTExNzQuNDYsNjk2LjA0IEMxMTg4Ljg2LDY4Mi4yMyAxMjE0LDY2MS4wOSAxMjQwLjUsNjUyLjU3IEMxMjcxLjM5LDY0Mi42NCAxMjgyLjA2LDY0NC41NyAxMzEzLjUsNjUyLjU3IEMxMzM2LjY5LDY1OC40NyAxMzYwLjMxLDY3MC43MyAxMzc5LjExLDY4Mi4zMSIgZmlsbD0ibm9uZSIgaWQ9IkdNTjMyLSYjMjE1NTE7JiMyMTE2MDsmIzMyNDY3OyYjMjY0NjM7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PC9nPjwhLS1saW5rID8/Pz8/Pz8/PyB0byA/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIuLi4uLi4uLi4iIGRhdGEtZW50aXR5LTI9Ii4uIiBkYXRhLXNvdXJjZS1saW5lPSIzNSIgZGF0YS11aWQ9ImxuazM1IiBpZD0ibGlua18uLi4uLi4uLi5fLi4iPjxwYXRoIGNvZGVMaW5lPSIzNSIgZD0iTTE2Ni4xLDI4NS4xNCBDMTQ0LjQxLDMwNS44MSAxMTguODMyOSwzMzAuMiA5OS43ODI5LDM0OC4zNiIgZmlsbD0ibm9uZSIgaWQ9IiYjMjQyMTI7JiMyOTk5MjsmIzIxNTUxOyYjMjExNjA7JiMzMDQxNzsmIzIxNTQ4OyYjMjIxMjA7JiMyNzE2OTsmIzIyMzU5Oy10by0mIzIxNTUxOyYjMjExNjA7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5NS40NCwzNTIuNSwxMDQuNzE0MywzNDkuMTg1Myw5OS4wNTkxLDM0OS4wNSw5OS4xOTQzLDM0My4zOTQ4LDk1LjQ0LDM1Mi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rID8/Pz8/Pz8/PyB0byA/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIuLi4uLi4uLi4iIGRhdGEtZW50aXR5LTI9Ii4uIiBkYXRhLXNvdXJjZS1saW5lPSIzNiIgZGF0YS11aWQ9ImxuazM2IiBpZD0ibGlua18uLi4uLi4uLi5fLi4iPjxwYXRoIGNvZGVMaW5lPSIzNiIgZD0iTTE4My45NSwyODUuMTQgQzE3Ni42NiwzMDUuODEgMTY4LjYwNzEsMzI4LjY4MjEgMTYyLjE5NzEsMzQ2Ljg0MjEiIGZpbGw9Im5vbmUiIGlkPSImIzI0MjEyOyYjMjk5OTI7JiMyMTU1MTsmIzIxMTYwOyYjMzA0MTc7JiMyMTU0ODsmIzIyMTIwOyYjMjcxNjk7JiMyMjM1OTstdG8tJiMzMDQxNzsmIzIxNTQ4OyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTYwLjIsMzUyLjUsMTY2Ljk2NzUsMzQ1LjM0NDYsMTYxLjg2NDIsMzQ3Ljc4NTEsMTU5LjQyMzcsMzQyLjY4MTgsMTYwLjIsMzUyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgPz8gdG8gPz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIuLiIgZGF0YS1lbnRpdHktMj0iLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMzciIGRhdGEtdWlkPSJsbmszNyIgaWQ9ImxpbmtfLi5fLi4uLiI+PHBhdGggY29kZUxpbmU9IjM3IiBkPSJNMTM2LjUsMzg5LjM2IEMxMTUuNTgsNDEwLjAyIDg1LjAzOSw0NDAuMTczOCA2NC4wMTksNDYwLjkzMzgiIGZpbGw9Im5vbmUiIGlkPSImIzMwNDE3OyYjMjE1NDg7LXRvLSYjMzcxOTc7JiMzMjYyMjsmIzI5NjE1OyYjMjI2NTk7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1OS43NSw0NjUuMTUsNjguOTY0Miw0NjEuNjcxNyw2My4zMDc1LDQ2MS42MzY1LDYzLjM0MjcsNDU1Ljk3OTgsNTkuNzUsNDY1LjE1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rID8/IHRvID8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9Ii4uIiBkYXRhLWVudGl0eS0yPSIuLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMzgiIGRhdGEtdWlkPSJsbmszOCIgaWQ9ImxpbmtfLi5fLi4uLi4iPjxwYXRoIGNvZGVMaW5lPSIzOCIgZD0iTTE1NCwzODkuMzYgQzE1NCw0MTAuMDIgMTU0LDQzOC4zOSAxNTQsNDU5LjE1IiBmaWxsPSJub25lIiBpZD0iJiMzMDQxNzsmIzIxNTQ4Oy10by0mIzI0MjEyOyYjMjk5OTI7JiMxOTk3ODsmIzE5OTc5OyYjMjU5OTE7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNTQsNDY1LjE1LDE1OCw0NTYuMTUsMTU0LDQ2MC4xNSwxNTAsNDU2LjE1LDE1NCw0NjUuMTUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgPz8gdG8gPz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIuLiIgZGF0YS1lbnRpdHktMj0iLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMzkiIGRhdGEtdWlkPSJsbmszOSIgaWQ9ImxpbmtfLi5fLi4uLiI+PHBhdGggY29kZUxpbmU9IjM5IiBkPSJNMTY5LjE2LDM4OS4zNiBDMTg3LjI3LDQxMC4wMiAyMTMuNDYzNCw0MzkuODc5NCAyMzEuNjczNCw0NjAuNjM5NCIgZmlsbD0ibm9uZSIgaWQ9IiYjMzA0MTc7JiMyMTU0ODstdG8tJiMyMDg1NDsmIzIwMTgyOyYjMjc0OTM7JiMzOTU4ODsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIzNS42Myw0NjUuMTUsMjMyLjcwMjIsNDU1Ljc0NjQsMjMyLjMzMjksNDYxLjM5MTIsMjI2LjY4ODEsNDYxLjAyMTgsMjM1LjYzLDQ2NS4xNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayA/Pz8/Pz8/Pz8gdG8gPz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLi4uLi4uIiBkYXRhLWVudGl0eS0yPSIuLiIgZGF0YS1zb3VyY2UtbGluZT0iNDAiIGRhdGEtdWlkPSJsbms0MCIgaWQ9ImxpbmtfLi4uLi4uLi4uXy4uIj48cGF0aCBjb2RlTGluZT0iNDAiIGQ9Ik0yMDEuODEsMjg1LjE0IEMyMDguOTIsMzA1LjgxIDIxNi43NzAyLDMyOC42NjU2IDIyMy4wMTAyLDM0Ni44MjU2IiBmaWxsPSJub25lIiBpZD0iJiMyNDIxMjsmIzI5OTkyOyYjMjE1NTE7JiMyMTE2MDsmIzMwNDE3OyYjMjE1NDg7JiMyMjEyMDsmIzI3MTY5OyYjMjIzNTk7LXRvLSYjMzI0Njc7JiMyNjQ2MzsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIyNC45NiwzNTIuNSwyMjUuODE4MiwzNDIuNjg4NiwyMjMuMzM1MiwzNDcuNzcxNCwyMTguMjUyNCwzNDUuMjg4MywyMjQuOTYsMzUyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgPz8/Pz8/Pz8gdG8gPz8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9Ii4uLi4uLi4uIiBkYXRhLWVudGl0eS0yPSIuLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjQxIiBkYXRhLXVpZD0ibG5rNDEiIGlkPSJsaW5rXy4uLi4uLi4uXy4uLi4uLiI+PHBhdGggY29kZUxpbmU9IjQxIiBkPSJNNTY0LjEzLDE3Mi41NCBDNTQ5LjU5LDE5MC40MSA1MzQuMDY3NSwyMDkuNDg2NSA1MTkuNTQ3NSwyMjcuMzI2NSIgZmlsbD0ibm9uZSIgaWQ9IiYjMjE1NTE7JiMyMTE2MDsmIzMwNDE3OyYjMjE1NDg7JiMyMjEyMDsmIzM1NzQ1OyYjMjYxMDI7JiMyMjEyMDstdG8tJiMzNzE5NzsmIzMyNjIyOyYjMjk2MTU7JiMyMjY1OTsmIzI3MTY5OyYjMjIzNTk7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1MTUuNzYsMjMxLjk4LDUyNC41NDM2LDIyNy41MjQ4LDUxOC45MTYyLDIyOC4xMDIxLDUxOC4zMzg5LDIyMi40NzQ4LDUxNS43NiwyMzEuOTgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgPz8/Pz8/IHRvID8/Pz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIuLi4uLi4iIGRhdGEtZW50aXR5LTI9Ii4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iNDIiIGRhdGEtdWlkPSJsbms0MiIgaWQ9ImxpbmtfLi4uLi4uXy4uLi4uLiI+PHBhdGggY29kZUxpbmU9IjQyIiBkPSJNNDU5LjUxLDI4NS4xNCBDNDM0Ljg4LDMwMi45NCA0MDcuMDYxOCwzMjMuMDQzOSAzODIuNDIxOCwzNDAuODYzOSIgZmlsbD0ibm9uZSIgaWQ9IiYjMzcxOTc7JiMzMjYyMjsmIzI5NjE1OyYjMjI2NTk7JiMyNzE2OTsmIzIyMzU5Oy10by0mIzIxMDE5OyYjMjQzMTQ7JiMzNzE5NzsmIzMyNjIyOyYjMjk2MTU7JiMyMjY1OTsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM3Ny41NiwzNDQuMzgsMzg3LjE5NjgsMzQyLjM0NywzODEuNjExNSwzNDEuNDQ5OSwzODIuNTA4NiwzMzUuODY0NiwzNzcuNTYsMzQ0LjM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rID8/Pz8/PyB0byA/Pz8/Pz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIuLi4uLi4iIGRhdGEtZW50aXR5LTI9Ii4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI0MyIgZGF0YS11aWQ9ImxuazQzIiBpZD0ibGlua18uLi4uLi5fLi4uLi4uLi4iPjxwYXRoIGNvZGVMaW5lPSI0MyIgZD0iTTQ5NSwyODUuMTQgQzQ5NSwzMDUuODEgNDk1LDMyOC4zNCA0OTUsMzQ2LjUiIGZpbGw9Im5vbmUiIGlkPSImIzM3MTk3OyYjMzI2MjI7JiMyOTYxNTsmIzIyNjU5OyYjMjcxNjk7JiMyMjM1OTstdG8tJiMyMTE1MjsmIzM2NzMzOyYjMjM2NDY7JiMyNDYxNTsmIzI1OTkxOyYjMjAyMTQ7JiMzNjE2NDsmIzI4MzA0OyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDk1LDM1Mi41LDQ5OSwzNDMuNSw0OTUsMzQ3LjUsNDkxLDM0My41LDQ5NSwzNTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayA/Pz8/Pz8gdG8gPz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIuLi4uLi4iIGRhdGEtZW50aXR5LTI9Ii4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjQ0IiBkYXRhLXVpZD0ibG5rNDQiIGlkPSJsaW5rXy4uLi4uLl8uLi4uIj48cGF0aCBjb2RlTGluZT0iNDQiIGQ9Ik01MjUuODUsMjg1LjE0IEM1NTAuNzEsMzA1LjgxIDU4MC4zOTY1LDMzMC41MDM5IDYwMi4yMzY1LDM0OC42NjM5IiBmaWxsPSJub25lIiBpZD0iJiMzNzE5NzsmIzMyNjIyOyYjMjk2MTU7JiMyMjY1OTsmIzI3MTY5OyYjMjIzNTk7LXRvLSYjMzcxOTc7JiMzMjYyMjsmIzMwNDE3OyYjMjE1NDg7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2MDYuODUsMzUyLjUsNjAyLjQ4NzIsMzQzLjY3MDIsNjAzLjAwNTQsMzQ5LjMwMzIsNTk3LjM3MjQsMzQ5LjgyMTUsNjA2Ljg1LDM1Mi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rID8/Pz8/Pz8/IHRvIEJhbm5lcj8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9Ii4uLi4uLi4uIiBkYXRhLWVudGl0eS0yPSJCYW5uZXIuLiIgZGF0YS1zb3VyY2UtbGluZT0iNDUiIGRhdGEtdWlkPSJsbms0NSIgaWQ9ImxpbmtfLi4uLi4uLi5fQmFubmVyLi4iPjxwYXRoIGNvZGVMaW5lPSI0NSIgZD0iTTYwNS44NywxNzIuNTQgQzYyMi43LDE5My4yMiA2NDIuMTIyNiwyMTcuMDg2NSA2NTYuOTAyNiwyMzUuMjQ2NSIgZmlsbD0ibm9uZSIgaWQ9IiYjMjE1NTE7JiMyMTE2MDsmIzMwNDE3OyYjMjE1NDg7JiMyMjEyMDsmIzM1NzQ1OyYjMjYxMDI7JiMyMjEyMDstdG8tQmFubmVyJiMyNTE3MTsmIzIxMzYwOyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjYwLjY5LDIzOS45LDY1OC4xMTEyLDIzMC4zOTQ3LDY1Ny41MzM4LDIzNi4wMjIsNjUxLjkwNjUsMjM1LjQ0NDYsNjYwLjY5LDIzOS45IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rID8/Pz8/Pz8/IHRvID8/Pz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLi4uLi4iIGRhdGEtZW50aXR5LTI9Ii4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjQ2IiBkYXRhLXVpZD0ibG5rNDYiIGlkPSJsaW5rXy4uLi4uLi4uXy4uLi4uLi4iPjxwYXRoIGNvZGVMaW5lPSI0NiIgZD0iTTY1OC4yMiwxNzIuNjggQzcwOC42OSwxOTAuNDYgNzY5Ljg0MDcsMjExLjk5NyA4MjAuMjcwNywyMjkuNzU3IiBmaWxsPSJub25lIiBpZD0iJiMyMTU1MTsmIzIxMTYwOyYjMzA0MTc7JiMyMTU0ODsmIzIyMTIwOyYjMzU3NDU7JiMyNjEwMjsmIzIyMTIwOy10by0mIzI0MjEyOyYjMjk5OTI7JiMxOTk3ODsmIzE5OTc5OyYjMjU5OTE7JiMyNzE2OTsmIzIyMzU5OyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODI1LjkzLDIzMS43NSw4MTguNzY5NywyMjQuOTg3Niw4MjEuMjEzOSwyMzAuMDg5MSw4MTYuMTEyMywyMzIuNTMzMyw4MjUuOTMsMjMxLjc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rID8/Pz8/Pz8gdG8gPz8/Pz8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9Ii4uLi4uLi4iIGRhdGEtZW50aXR5LTI9Ii4uLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iNDciIGRhdGEtdWlkPSJsbms0NyIgaWQ9ImxpbmtfLi4uLi4uLl8uLi4uLi4uLi4iPjxwYXRoIGNvZGVMaW5lPSI0NyIgZD0iTTg2OC42MiwyODUuMTQgQzg0Ny40NSwzMDMuMDEgODIzLjkzNDUsMzIyLjg1OTMgODAyLjgwNDUsMzQwLjY5OTMiIGZpbGw9Im5vbmUiIGlkPSImIzI0MjEyOyYjMjk5OTI7JiMxOTk3ODsmIzE5OTc5OyYjMjU5OTE7JiMyNzE2OTsmIzIyMzU5Oy10by0mIzIxMDE5OyYjMjQzMTQ7JiMyNDIxMjsmIzI5OTkyOyYjMTk5Nzg7JiMxOTk3OTsmIzI1OTkxOyYjMjM1NDU7JiMzNTkzNzsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijc5OC4yMiwzNDQuNTcsODA3LjY3NzIsMzQxLjgyMDMsODAyLjA0MDQsMzQxLjM0NDQsODAyLjUxNjMsMzM1LjcwNzYsNzk4LjIyLDM0NC41NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayA/Pz8/Pz8/IHRvID8/Pz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIuLi4uLi4uIiBkYXRhLWVudGl0eS0yPSIuLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjQ4IiBkYXRhLXVpZD0ibG5rNDgiIGlkPSJsaW5rXy4uLi4uLi5fLi4uLi4uIj48cGF0aCBjb2RlTGluZT0iNDgiIGQ9Ik05MDQuMzMsMjg1LjE0IEM5MDguNjMsMzA1LjgxIDkxMy4zNTA0LDMyOC40NjUzIDkxNy4xMjA0LDM0Ni42MjUzIiBmaWxsPSJub25lIiBpZD0iJiMyNDIxMjsmIzI5OTkyOyYjMTk5Nzg7JiMxOTk3OTsmIzI1OTkxOyYjMjcxNjk7JiMyMjM1OTstdG8tJiMyMjUyMjsmIzI2NDEyOyYjMjM2NDY7JiMyNDYxNTsmIzM3MTk3OyYjMzI2MjI7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5MTguMzQsMzUyLjUsOTIwLjQyNzEsMzQyLjg3NDgsOTE3LjMyMzcsMzQ3LjYwNDQsOTEyLjU5NDEsMzQ0LjUwMDksOTE4LjM0LDM1Mi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rID8/Pz8/PyB0byA/Pz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLi4uIiBkYXRhLWVudGl0eS0yPSIuLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjQ5IiBkYXRhLXVpZD0ibG5rNDkiIGlkPSJsaW5rXy4uLi4uLl8uLi4uLi4iPjxwYXRoIGNvZGVMaW5lPSI0OSIgZD0iTTg3NywzODkuNzMgQzgyNC4yOSw0MTAuNCA3NDMuMDY2LDQ0Mi4yNTk4IDY5MC40MjYsNDYyLjg5OTgiIGZpbGw9Im5vbmUiIGlkPSImIzIyNTIyOyYjMjY0MTI7JiMyMzY0NjsmIzI0NjE1OyYjMzcxOTc7JiMzMjYyMjstdG8tJiMyMTE1MjsmIzM2NzMzOyYjMzcxOTc7JiMzMjYyMjsmIzI5NjE1OyYjMjI2NTk7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2ODQuODQsNDY1LjA5LDY5NC42NzkxLDQ2NS41Mjg2LDY4OS40OTUsNDYzLjI2NDgsNjkxLjc1ODgsNDU4LjA4MDcsNjg0Ljg0LDQ2NS4wOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayA/Pz8/Pz8gdG8gPz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLi4uIiBkYXRhLWVudGl0eS0yPSIuLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iNTAiIGRhdGEtdWlkPSJsbms1MCIgaWQ9ImxpbmtfLi4uLi4uXy4uLi4uIj48cGF0aCBjb2RlTGluZT0iNTAiIGQ9Ik05MDAuNzcsMzg5LjYxIEM4NzguNzgsNDA3Ljc2IDg0OC44MDc2LDQzMi40OTA5IDgyMy43Mzc2LDQ1My4xODA5IiBmaWxsPSJub25lIiBpZD0iJiMyMjUyMjsmIzI2NDEyOyYjMjM2NDY7JiMyNDYxNTsmIzM3MTk3OyYjMzI2MjI7LXRvLSYjMzYxNjQ7JiMyODMwNDsmIzIxMTUyOyYjMzY3MzM7JiMyMjEyMDsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjgxOS4xMSw0NTcsODI4LjU5NzQsNDU0LjM1NjQsODIyLjk2NjMsNDUzLjgxNzQsODIzLjUwNTMsNDQ4LjE4NjMsODE5LjExLDQ1NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayA/Pz8/Pz8gdG8gQ29udGV4dD8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLi4uIiBkYXRhLWVudGl0eS0yPSJDb250ZXh0Li4uLiIgZGF0YS1zb3VyY2UtbGluZT0iNTEiIGRhdGEtdWlkPSJsbms1MSIgaWQ9ImxpbmtfLi4uLi4uX0NvbnRleHQuLi4uIj48cGF0aCBjb2RlTGluZT0iNTEiIGQ9Ik05MjIsMzg5LjM2IEM5MjIsNDEwLjAyIDkyMiw0MzguMzkgOTIyLDQ1OS4xNSIgZmlsbD0ibm9uZSIgaWQ9IiYjMjI1MjI7JiMyNjQxMjsmIzIzNjQ2OyYjMjQ2MTU7JiMzNzE5NzsmIzMyNjIyOy10by1Db250ZXh0JiMzNzE5NzsmIzMyNjIyOyYjMzA0MTc7JiMyMTU0ODsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjkyMiw0NjUuMTUsOTI2LDQ1Ni4xNSw5MjIsNDYwLjE1LDkxOCw0NTYuMTUsOTIyLDQ2NS4xNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayA/Pz8/Pz8gdG8gPz8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9Ii4uLi4uLiIgZGF0YS1lbnRpdHktMj0iLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI1MiIgZGF0YS11aWQ9ImxuazUyIiBpZD0ibGlua18uLi4uLi5fLi4uLi4uIj48cGF0aCBjb2RlTGluZT0iNTIiIGQ9Ik05NDAuODYsMzg5LjYxIEM5NjMuMTQsNDEwLjMxIDk5NS41OTUxLDQ0MC40NzUzIDEwMTcuODM1MSw0NjEuMTQ1MyIgZmlsbD0ibm9uZSIgaWQ9IiYjMjI1MjI7JiMyNjQxMjsmIzIzNjQ2OyYjMjQ2MTU7JiMzNzE5NzsmIzMyNjIyOy10by0mIzIxMTUyOyYjMzY3MzM7JiMyMTU1MTsmIzIxMTYwOyYjMjE0NDI7JiMyNTk2ODsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwMjIuMjMsNDY1LjIzLDEwMTguMzYwNyw0NTYuMTczLDEwMTguNTY3Niw0NjEuODI2MSwxMDEyLjkxNDUsNDYyLjAzMjksMTAyMi4yMyw0NjUuMjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgPz8/Pz8/PyB0byA/Pz8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9Ii4uLi4uLi4iIGRhdGEtZW50aXR5LTI9Ii4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjUzIiBkYXRhLXVpZD0ibG5rNTMiIGlkPSJsaW5rXy4uLi4uLi5fLi4uLi4uLiI+PHBhdGggY29kZUxpbmU9IjUzIiBkPSJNOTcwLjU5LDI4NS4yOCBDMTAyOCwzMDUuOTYgMTEwMS4zNzUyLDMzMi4zODYxIDExNTEuNjY1MiwzNTAuNTA2MSIgZmlsbD0ibm9uZSIgaWQ9IiYjMjQyMTI7JiMyOTk5MjsmIzE5OTc4OyYjMTk5Nzk7JiMyNTk5MTsmIzI3MTY5OyYjMjIzNTk7LXRvLSYjMjYzNTY7JiMyNjAzMjsmIzI0MjEyOyYjMjk5OTI7JiMxOTk3ODsmIzE5OTc5OyYjMjU5OTE7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMTU3LjMxLDM1Mi41NCwxMTUwLjE5ODgsMzQ1LjcyNiwxMTUyLjYwNiwzNTAuODQ1MSwxMTQ3LjQ4NjksMzUzLjI1MjQsMTE1Ny4zMSwzNTIuNTQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgPz8/Pz8/PyB0byA/Pz8/Pz9CZWFuPz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLi4uLiIgZGF0YS1lbnRpdHktMj0iLi4uLi4uQmVhbi4uIiBkYXRhLXNvdXJjZS1saW5lPSI1NCIgZGF0YS11aWQ9ImxuazU0IiBpZD0ibGlua18uLi4uLi4uXy4uLi4uLkJlYW4uLiI+PHBhdGggY29kZUxpbmU9IjU0IiBkPSJNMTIwNiwzODkuMzYgQzEyMDYsNDEwLjAyIDEyMDYsNDM4LjM5IDEyMDYsNDU5LjE1IiBmaWxsPSJub25lIiBpZD0iJiMyNjM1NjsmIzI2MDMyOyYjMjQyMTI7JiMyOTk5MjsmIzE5OTc4OyYjMTk5Nzk7JiMyNTk5MTstdG8tJiMyMDkzNDsmIzIyNzkxOyYjMjk2MTU7JiMyMjY1OTsmIzI1MTUyOyYjMzg2NTY7QmVhbiYjMjQwMzc7JiMyMTM3ODsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyMDYsNDY1LjE1LDEyMTAsNDU2LjE1LDEyMDYsNDYwLjE1LDEyMDIsNDU2LjE1LDEyMDYsNDY1LjE1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rID8/Pz8/Pz8gdG8gPz8/Pz8/Pz8/P0JlYW4tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLi4uLiIgZGF0YS1lbnRpdHktMj0iLi4uLi4uLi4uLkJlYW4iIGRhdGEtc291cmNlLWxpbmU9IjU1IiBkYXRhLXVpZD0ibG5rNTUiIGlkPSJsaW5rXy4uLi4uLi5fLi4uLi4uLi4uLkJlYW4iPjxwYXRoIGNvZGVMaW5lPSI1NSIgZD0iTTEyMzkuNDMsMzg5LjYxIEMxMjc4LjgzLDQxMC4yNSAxMzM4LjU4NTksNDQxLjU3NDMgMTM3OC4wNTU5LDQ2Mi4yNjQzIiBmaWxsPSJub25lIiBpZD0iJiMyNjM1NjsmIzI2MDMyOyYjMjQyMTI7JiMyOTk5MjsmIzE5OTc4OyYjMTk5Nzk7JiMyNTk5MTstdG8tJiMzNjg5MDsmIzM2ODA3OyYjMjQwMzc7JiMyMTM3ODsmIzI5OTgzOyYjMjUxMDQ7JiMyOTYxNTsmIzIyNjU5OyYjMjUxNTI7JiMzODY1NjtCZWFuIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzgzLjM3LDQ2NS4wNSwxMzc3LjI1NTksNDU3LjMyODgsMTM3OC45NDE1LDQ2Mi43Mjg2LDEzNzMuNTQxNyw0NjQuNDE0MywxMzgzLjM3LDQ2NS4wNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBHTU4zMiB0byBHTU41Ni0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJHTU4zMiIgZGF0YS1lbnRpdHktMj0iR01ONTYiIGRhdGEtc291cmNlLWxpbmU9IjU3IiBkYXRhLXVpZD0ibG5rNTgiIGlkPSJsaW5rX0dNTjMyX0dNTjU2Ij48cGF0aCBkPSJNMTIwNS4xMiw3MDguODYgQzEyMTYuODIsNzA4Ljg2IDEyMjguNTIsNzA4Ljg2IDEyNDAuMjIsNzA4Ljg2IiBmaWxsPSJub25lIiBpZD0iR01OMzItR01ONTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48L2c+PCEtLWxpbmsgPz8/Pz8/Pz8/P0JlYW4gdG8gPz8/Pz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLi4uLi4uLkJlYW4iIGRhdGEtZW50aXR5LTI9Ii4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI1OSIgZGF0YS11aWQ9ImxuazU5IiBpZD0ibGlua18uLi4uLi4uLi4uQmVhbl8uLi4uLi4uLiI+PHBhdGggY29kZUxpbmU9IjU5IiBkPSJNMTQxNyw1MDEuOTYgQzE0MTcsNTIwLjA2IDE0MTcsNTQyLjcgMTQxNyw1NjMuNDgiIGZpbGw9Im5vbmUiIGlkPSImIzM2ODkwOyYjMzY4MDc7JiMyNDAzNzsmIzIxMzc4OyYjMjk5ODM7JiMyNTEwNDsmIzI5NjE1OyYjMjI2NTk7JiMyNTE1MjsmIzM4NjU2O0JlYW4tdG8tJiMzNTc0NTsmIzI2MTAyOyYjMjIxMjA7JiMzMDQxNzsmIzIxNTQ4OyYjMjIxMjA7JiMzMjQ2NzsmIzI2NDYzOyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTQxNyw1NjkuNDgsMTQyMSw1NjAuNDgsMTQxNyw1NjQuNDgsMTQxMyw1NjAuNDgsMTQxNyw1NjkuNDgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgPz8/Pz8/Pz8gdG8gPz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIuLi4uLi4uLiIgZGF0YS1lbnRpdHktMj0iLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iNjAiIGRhdGEtdWlkPSJsbms2MCIgaWQ9ImxpbmtfLi4uLi4uLi5fLi4uLiI+PHBhdGggY29kZUxpbmU9IjYwIiBkPSJNMTQxNyw2MjIuOTIgQzE0MTcsNjQwLjc5IDE0MTcsNjU4LjUyIDE0MTcsNjc2LjM1IiBmaWxsPSJub25lIiBpZD0iJiMzNTc0NTsmIzI2MTAyOyYjMjIxMjA7JiMzMDQxNzsmIzIxNTQ4OyYjMjIxMjA7JiMzMjQ2NzsmIzI2NDYzOy10by0mIzIxNTUxOyYjMjExNjA7JiMzMjQ2NzsmIzI2NDYzOyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTQxNyw2ODIuMzUsMTQyMSw2NzMuMzUsMTQxNyw2NzcuMzUsMTQxMyw2NzMuMzUsMTQxNyw2ODIuMzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLVNSQz1bWkxKRFJqZjA0QnhwNTFRZHY0M3cxZk1RZ2I4RkVRTE5CV3ZpZzJrd0hoUGZVeEhlQUdiSDRnZkdlZkdhYjhlOEwyS1hhTGdRR2IxVlhic1Jqd1puczlscnB2aHVPa3RDRHBGeHBVbnl3ak9SYjNFYXpBa0lmazMyaXJBZmdFSGFHcjduY2JSNkF3alBKMWYzS1hfR2dudVBEd3RjODJ0OWtXR3NDQUhLQm1DU21NTFZULWRuWTltQ29CcjktZGptVDc5bjRBbHpYSkdrNkdJRU43UmNQeGR5SVktSGQyeVlOUVUzQmhhX1BGS1ozM1JCVTRGSDNPSUhmV2pnQnJBUzdLRExpVHlsMEt4XzEyMXNjWHBIaXV2X2NiVnRoVWNyVEowYUZwd29RQlYweEF1LWt6a1poSGd4enZoeG1Ic2dlemNhSFF5a3ZaenhwRnpTblRqQWVRb3ZkNXhXVHVnY3VoUzg2cmRDTC02T0hDcUZDemZmYXljTzFzSm5vZGtxekdJaDZVVXQyaFU4VzFZNS1kVHhFWU10dnpKaUVuSGNhdjd6LW5DVERxQXEwdXJQYng0cDBCZnhIRlBsdVpibjh0RmkxbGZXLUREWXBPaENBVUc5NEduWG9GMmxWVGlMQ2VyNUN5Z1RDSnN6MUNmMHBfVkd6WV9Ra1g1QzVKZUxyeUZxOWpCTGlmUDM2d2dTSHJlTUdta3pyZngwV2VMaUI5UGxpMGxxNlhSTlUyeVFMbE1tR2gtb3pmRlFQekFoVUd6YXJ2b1Zja2o4bmtKRjFKY2VpNTZRdC1uX0RSMVBwR3hUUU9Kbm9PaUYtdjJ1LTAzWG8zbTQxbzdZNVZWYjJOMnlVYTFXWWJTZ0FQRHZBWE9OYUtGQVE0aFhqVTY0WGRINzdCMGVhdzBjTTNNR0w0SlJIaWhrTHlZbU92akxCb04yVU1kWEpJTTRTb29NbWhtNzBKX040ZFlIZDN0eVo3YU5CcWZCQXFCVjR0aUplcXpINHZJRUFmNDhBTDhjMEp3bUM4Y3QzVVpOOHNPVUxnUE9BeVNrTmRxSWVnQTI1M0xuRkdicUp1MENvdXEwNVlTc1lSSzN1WUVjNUEtYWlMUDhkZ0hWdWgxN0k5Z3hja3ctZm0wTk5pcGJFUTJYOFlLSkVOWGpTV3RfMEcwMF0tLT48L2c+PC9zdmc+'>\n\n<h2 id=\"SpringBoot监控\"><a href=\"#SpringBoot监控\" class=\"headerlink\" title=\"SpringBoot监控\"></a>SpringBoot监控</h2><h3 id=\"SpringBoot-Actuator\"><a href=\"#SpringBoot-Actuator\" class=\"headerlink\" title=\"SpringBoot Actuator\"></a>SpringBoot Actuator</h3><p>SpringBoot自带监控功能Actuator，可以帮助实现对程序内部运行情况监控，比如监控状况、Bean加载情况、配置属性、日志信息等。</p>\n<p>在依赖中引入</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.7.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>工程启动后，访问 IP:端口&#x2F;actuator 即可。</p>\n<p>返回的监控信息是json格式的数据。</p>\n<h3 id=\"Spring-Boot-Admin\"><a href=\"#Spring-Boot-Admin\" class=\"headerlink\" title=\"Spring Boot Admin\"></a>Spring Boot Admin</h3><p>是一个开源社区项目，用于管理和监控SpringBoot应用程序。Spring Boot Admin有两个角色，客户端（Client）和服务端（Server）。应用程序作为Client 向 Server 注册； Server 提供UI界面展示 Client 上Actuator Endpoint上的监控信息。</p>\n<p>Server端需要注意需要在引导类上加 @EnableAdminServer 注解启用监控功能；Client端需要注意在配置文件中指定Server的url 。</p>\n<h2 id=\"打包部署\"><a href=\"#打包部署\" class=\"headerlink\" title=\"打包部署\"></a>打包部署</h2><p>SpringBoot默认打包方式为jar包，web工程中也自带Tomcat环境，打出来的jar包，直接用java执行即可。</p>\n<p>如果想换成war包的方式，需要改写引导类，让其继承SpringBootServletInitializer类并重写 configure 方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringbootActuatorApplication</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">SpringBootServletInitializer</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringbootActuatorApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> SpringApplicationBuilder <span class=\"title function_\">configure</span><span class=\"params\">(SpringApplicationBuilder builder)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> builder.sources(SpringbootActuatorApplication.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["Spring"],"tags":["Java"]},{"title":"Servlet和SpringMVC","url":"/%E7%AC%94%E8%AE%B0/Java/Spring/Servlet%E5%92%8CSpringMVC/","content":"<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>常用的Web三大组件如下：</p>\n<ul>\n<li>servlet。运行在服务器端的小程序，一个接口，定义了Java类被浏览器访问到的规则。</li>\n<li>filter，过滤器。当访问服务器的资源时，过滤器可以将请求拦截下来，完成一些特殊的功能。</li>\n<li>listener，事件监听机制。<ul>\n<li>事件：一件事情。</li>\n<li>事件源：事件发生的地方。</li>\n<li>监听器 ：一个对象。</li>\n<li>注册监听：将事件、事件源、监听器绑定在一起。当事件源上发生某个事件后，执行监听器代码。</li>\n</ul>\n</li>\n</ul>\n<p>经常在web.xml中配置使用。</p>\n<h2 id=\"Servlet使用\"><a href=\"#Servlet使用\" class=\"headerlink\" title=\"Servlet使用\"></a>Servlet使用</h2><p>引入servlet和jsp的API</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet.jsp<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsp-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>创建JSP文件</p>\n<figure class=\"highlight jsp\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;h2&gt;Hello World!&lt;/h2&gt;</span><br><span class=\"line\">&lt;a href=<span class=\"string\">&quot;order&quot;</span>&gt;order&lt;/a&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br></pre></td></tr></table></figure>\n\n<p>创建Servlet类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@WebServlet(&quot;/order&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyServlet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HttpServlet</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doGet</span><span class=\"params\">(HttpServletRequest req, HttpServletResponse resp)</span> <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\">        resp.getWriter().write(<span class=\"string\">&quot;order successful...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">运行效果：</span><br><span class=\"line\">启动并访问工程根目录 http://localhost:8080/SpringMVC_Learn_war/</span><br><span class=\"line\">显示</span><br><span class=\"line\"></span><br><span class=\"line\">Hello World!</span><br><span class=\"line\">order</span><br><span class=\"line\"></span><br><span class=\"line\">点击order超链接</span><br><span class=\"line\">跳转到 http://localhost:8080/SpringMVC_Learn_war/order</span><br><span class=\"line\">显示</span><br><span class=\"line\"></span><br><span class=\"line\">order successful...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>点击order超链接后，根据JSP会跳转到服务器的&#x2F;order路径（发送请求），MyServlet接受到注解定义的请求后执行doGet方法，重写页面。</p>\n<h2 id=\"ServletContainerInitializer\"><a href=\"#ServletContainerInitializer\" class=\"headerlink\" title=\"ServletContainerInitializer\"></a>ServletContainerInitializer</h2><p>在servlet 3.0环境中，tomcat启动时会自动调用类路径下META-INF&#x2F;services&#x2F;javax.servlet.ServletContainerInitializer这个文件中指定的ServletContainerInitializer实现类。完成servlet容器的初始化操作</p>\n<p>ServletContainerInitializer主要用于替换原来的web.xml文件，以前在xml文件中可以配置的内容，完全可以使用ServletContainerInitializer完成，减少配置xml文件的繁琐。</p>\n<h3 id=\"HelloWorld\"><a href=\"#HelloWorld\" class=\"headerlink\" title=\"HelloWorld\"></a>HelloWorld</h3><p>定义ServletContainerInitializer实现类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@HandlesTypes(value = &#123;com.example.service.MyService.class&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyServletContainerInitializer</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ServletContainerInitializer</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onStartup</span><span class=\"params\">(Set&lt;Class&lt;?&gt;&gt; c, ServletContext ctx)</span> <span class=\"keyword\">throws</span> ServletException &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;The parameter `Set&lt;Class&lt;?&gt;&gt; c` includes... :&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Class&lt;?&gt; clazz :</span><br><span class=\"line\">                c) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;...&quot;</span> + clazz);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>注解 @HandlesTypes 声明了哪些类或接口<strong>的子类或实现类</strong>会被处理。这些子类或实现类的全类名会加入到 onStartup方法的 Set&lt;Class&lt;?&gt;&gt; c 参数中，方便在方法主体中处理，比如利用反射实例化之类的。</p>\n<p>接下来定义 MyService.class 及其的几个子类或实现类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">MyService</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">MyServiceSub</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">MyService</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AbstractMyService</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">MyService</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">MyService</span> &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后按照官方指定的路径创建配置文件</p>\n<p>文件路径：src&#x2F;main&#x2F;resources&#x2F;META-INF&#x2F;services&#x2F;javax.servlet.ServletContainerInitializer</p>\n<p>内容：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">com.example.servlet.MyServletContainerInitializer</span><br></pre></td></tr></table></figure>\n\n<p>启动工程。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">...</span><br><span class=\"line\">[DateTime] Artifact SpringMVC-Learn:war: Artifact is being deployed, please wait...</span><br><span class=\"line\">The parameter `Set&lt;Class&lt;?&gt;&gt; c` includes... :</span><br><span class=\"line\">...class com.example.service.AbstractMyService</span><br><span class=\"line\">...class com.example.service.impl.MyServiceImpl</span><br><span class=\"line\">...interface com.example.service.MyServiceSub</span><br><span class=\"line\">...</span><br><span class=\"line\">DateTime 信息 [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Web应用程序目录[F:\\Program Files\\apache-tomcat-8.5.59\\webapps\\manager]的部署已在[25]毫秒内完成</span><br></pre></td></tr></table></figure>\n\n<p>看到Set集合中有三个子类&#x2F;实现类。</p>\n<h3 id=\"注册组件\"><a href=\"#注册组件\" class=\"headerlink\" title=\"注册组件\"></a>注册组件</h3><p>定义Listener组件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 监听项目的启动或停止</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OrderListener</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ServletContextListener</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">contextInitialized</span><span class=\"params\">(ServletContextEvent sce)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke OrderListener#contextInitialized...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">contextDestroyed</span><span class=\"params\">(ServletContextEvent sce)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke OrderListener#contextDestroyed...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>定义Filter组件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OrderFilter</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Filter</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">init</span><span class=\"params\">(FilterConfig filterConfig)</span> <span class=\"keyword\">throws</span> ServletException &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doFilter</span><span class=\"params\">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class=\"keyword\">throws</span> IOException, ServletException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 过滤请求，业务处理逻辑</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke OrderFilter#doFilter...&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 放行请求</span></span><br><span class=\"line\">        chain.doFilter(request, response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">destroy</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyServletContainerInitializer</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ServletContainerInitializer</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onStartup</span><span class=\"params\">(Set&lt;Class&lt;?&gt;&gt; c, ServletContext ctx)</span> <span class=\"keyword\">throws</span> ServletException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 注册Servlet组件</span></span><br><span class=\"line\">        ServletRegistration.<span class=\"type\">Dynamic</span> <span class=\"variable\">servlet</span> <span class=\"operator\">=</span> ctx.addServlet(<span class=\"string\">&quot;orderServlet&quot;</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">OrderServlet</span>());</span><br><span class=\"line\">        servlet.addMapping(<span class=\"string\">&quot;/orderTest&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 注册Listener组件</span></span><br><span class=\"line\">        ctx.addListener(OrderListener.class);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 注册Filter组件</span></span><br><span class=\"line\">        FilterRegistration.<span class=\"type\">Dynamic</span> <span class=\"variable\">filter</span> <span class=\"operator\">=</span> ctx.addFilter(<span class=\"string\">&quot;OrderFilter&quot;</span>, OrderFilter.class);</span><br><span class=\"line\">        <span class=\"comment\">// 添加filter信息，可指定拦截哪个servlet</span></span><br><span class=\"line\">        filter.addMappingForUrlPatterns(EnumSet.of(DispatcherType.REQUEST), <span class=\"literal\">true</span>, <span class=\"string\">&quot;/*&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"SpringMVC中的设置\"><a href=\"#SpringMVC中的设置\" class=\"headerlink\" title=\"SpringMVC中的设置\"></a>SpringMVC中的设置</h3><p>解开 org.springframework:spring-web:5.3.22 ，在其中的spring-web-5.3.22.jar包中，META-INF&#x2F;services路径下，就有 javax.servlet.ServletContainerInitializer 文件。其内容为：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">org.springframework.web.SpringServletContainerInitializer</span><br></pre></td></tr></table></figure>\n\n<p>打开这个类，看到其也是继承 ServletContainerInitializer ，onStartup方法如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@HandlesTypes(WebApplicationInitializer.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringServletContainerInitializer</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ServletContainerInitializer</span> &#123;</span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onStartup</span><span class=\"params\">(<span class=\"meta\">@Nullable</span> Set&lt;Class&lt;?&gt;&gt; webAppInitializerClasses, ServletContext servletContext)</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">throws</span> ServletException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// initializers数组存储从set参数里反射拿到的 WebApplicationInitializer 对象</span></span><br><span class=\"line\">\t\tList&lt;WebApplicationInitializer&gt; initializers = Collections.emptyList();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (webAppInitializerClasses != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tinitializers = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;(webAppInitializerClasses.size());</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (Class&lt;?&gt; waiClass : webAppInitializerClasses) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Be defensive: Some servlet containers provide us with invalid classes,</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// no matter what @HandlesTypes says...</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (!waiClass.isInterface() &amp;&amp; !Modifier.isAbstract(waiClass.getModifiers()) &amp;&amp;</span><br><span class=\"line\">\t\t\t\t\t\tWebApplicationInitializer.class.isAssignableFrom(waiClass)) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// 利用反射从Class拿到对象</span></span><br><span class=\"line\">\t\t\t\t\t\tinitializers.add((WebApplicationInitializer)</span><br><span class=\"line\">\t\t\t\t\t\t\t\tReflectionUtils.accessibleConstructor(waiClass).newInstance());</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">catch</span> (Throwable ex) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ServletException</span>(<span class=\"string\">&quot;Failed to instantiate WebApplicationInitializer class&quot;</span>, ex);</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (initializers.isEmpty()) &#123;</span><br><span class=\"line\">\t\t\tservletContext.log(<span class=\"string\">&quot;No Spring WebApplicationInitializer types detected on classpath&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tservletContext.log(initializers.size() + <span class=\"string\">&quot; Spring WebApplicationInitializers detected on classpath&quot;</span>);</span><br><span class=\"line\">\t\tAnnotationAwareOrderComparator.sort(initializers);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (WebApplicationInitializer initializer : initializers) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 逐个调用initializer的onStartup方法</span></span><br><span class=\"line\">\t\t\tinitializer.onStartup(servletContext);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>容器启动时，启动了一个 ServletContainerInitializer ，然后在其中启动了许多 WebApplicationInitializer</p>\n<p>现在自定义一个WebApplicationInitializer。AbstractAnnotationConfigDispatcherServletInitializer 是其的一个子类。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyWebInitializer</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractAnnotationConfigDispatcherServletInitializer</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 根容器</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Class</span>[]&#123;MyRootConfig.class&#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 子容器</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Class</span>[]&#123;MyAppConfig.class&#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取DispatcherServlet的映射信息</span></span><br><span class=\"line\">    <span class=\"comment\">// 拦截所有请求：静态资源、js、css、png等；但不包括jsp文件，jsp是tomcat引擎负责解析的</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> String[] getServletMappings() &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MyWebInitializer#getServletMappings...&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[]&#123;<span class=\"string\">&quot;/&quot;</span>&#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"EnableWebMvc\"><a href=\"#EnableWebMvc\" class=\"headerlink\" title=\"@EnableWebMvc\"></a>@EnableWebMvc</h2><h3 id=\"简述\"><a href=\"#简述\" class=\"headerlink\" title=\"简述\"></a>简述</h3><p>定制SpringMVC：</p>\n<ul>\n<li>页面请求定制</li>\n<li>静态资源托管给Tomcat</li>\n<li>注解版自定义拦截器</li>\n</ul>\n<p>Web工程处理静态资源的方式，一种是使用Tomcat提供的默认Servlet，可在XML中定义：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mvc:default-servlet-handler</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>缺点是与Tomcat耦合，且无法读取WEB-INF下的资源。</p>\n<p>另一种方式是将静态资源的访问路径与实际位置进行映射。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mvc:resources</span> <span class=\"attr\">mapping</span>=<span class=\"string\">&quot;/img/**&quot;</span> <span class=\"attr\">location</span>=<span class=\"string\">&quot;/WEB-INF/img/&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>另外，使用XML定义注解驱动的方式：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>使用XML定义拦截器的方式：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mvc:interceptors</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 拦截所有请求 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;interceptor.HelloInterceptor&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 拦截指定的请求 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mvc:interceptor</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mvc:mapping</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/entry&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mvc:mapping</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/step*&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mvc:exclude-mapping</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/login&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;interceptor.TimerInterceptor&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">mvc:interceptor</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"EnableWebMvc-1\"><a href=\"#EnableWebMvc-1\" class=\"headerlink\" title=\"@EnableWebMvc\"></a>@EnableWebMvc</h3><p>现在SpringMVC如果想使用上述那些功能，可以直接在配置类中声明注解 @EnableWebMvc 。</p>\n<p>@EnableWebMvc 引入了 DelegatingWebMvcConfiguration，主要实现了两个功能：</p>\n<ul>\n<li>为SpringMVC应用提供了默认的Spring配置</li>\n<li>检测并应用实现了 WebMvcConfigurer 接口的自定义配置类</li>\n</ul>\n<p>书接上文的 MyWebInitializer ，根容器引入非Controller层的组件。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ComponentScan(value = &quot;com.example&quot;, excludeFilters = &#123;</span></span><br><span class=\"line\"><span class=\"meta\">        @ComponentScan.Filter(type = FilterType.ANNOTATION, classes = &#123;Controller.class&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyRootConfig</span> &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>子容器仅引入Controller层的组件。另外注册一些处理器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ComponentScan(value = &quot;com.example&quot;, includeFilters = &#123;</span></span><br><span class=\"line\"><span class=\"meta\">        @ComponentScan.Filter(type = FilterType.ANNOTATION, classes = &#123;Controller.class&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">&#125;, useDefaultFilters = false)</span></span><br><span class=\"line\"><span class=\"meta\">@EnableWebMvc</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyAppConfig</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">WebMvcConfigurer</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 注册一个基于URL的JSP 内部资源视图解析器</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configureViewResolvers</span><span class=\"params\">(ViewResolverRegistry registry)</span> &#123;</span><br><span class=\"line\">        registry.jsp(<span class=\"string\">&quot;/WEB-INF/pages/&quot;</span>, <span class=\"string\">&quot;.jsp&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 指定静态资源访问使用Tomcat提供的默认Servlet</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configureDefaultServletHandling</span><span class=\"params\">(DefaultServletHandlerConfigurer configurer)</span> &#123;</span><br><span class=\"line\">        configurer.enable();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 添加拦截器并设置映射</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">addInterceptors</span><span class=\"params\">(InterceptorRegistry registry)</span> &#123;</span><br><span class=\"line\">        registry.addInterceptor(<span class=\"keyword\">new</span> <span class=\"title class_\">MyInterceptor</span>()).addPathPatterns(<span class=\"string\">&quot;/*&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后设置好RequestMapping后；就可直接访问 &#x2F;WEB_INF&#x2F;pages&#x2F; 下的所有 jsp 文件 和 webapps下的所有静态资源了。</p>\n<p>拦截器的定义如下，重写的三个方法，在处理请求（Handle）的不同时机执行。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">HandlerInterceptor</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 在目标方法执行前调用</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">preHandle</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MyInterceptor#preHandle...&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 在目标方法执行后调用</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">postHandle</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MyInterceptor#postHandle...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 页面响应之后执行</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">afterCompletion</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Invoke MyInterceptor#afterCompletion...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"异步处理\"><a href=\"#异步处理\" class=\"headerlink\" title=\"异步处理\"></a>异步处理</h2><h3 id=\"同步处理\"><a href=\"#同步处理\" class=\"headerlink\" title=\"同步处理\"></a>同步处理</h3><p>同步处理，客户端发出请求后一直等待服务器响应。</p>\n<img src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjE4MHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MjIzcHg7aGVpZ2h0OjE4MHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDIyMyAxODAiIHdpZHRoPSIyMjNweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNEREREREQiIGhlaWdodD0iMTY4Ljk5MjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEwNS45OTk2IiB4PSIxMDYuMTc4NSIgeT0iNiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Mi4xMjg1IiB4PSIxMjMuMTE0MSIgeT0iMTguMDY2OSI+V0VCJiMyNjM4MTsmIzIxMTUzOyYjMjIxMjA7PC90ZXh0PjxnPjx0aXRsZT4uLi4uLi48L3RpdGxlPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMzguMTMyOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjEwIiB4PSIxNTQuMTc4MyIgeT0iOTMuNTYyNSIvPjwvZz48Zz48dGl0bGU+Li4uLkFQUDwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9Ijg0LjI2NTYiIHdpZHRoPSI4IiB4PSI1Mi41ODkzIiB5PSI1Ni40Mjk3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNTYiIHgyPSI1NiIgeTE9IjU2LjQyOTciIHkyPSIxNDAuNjk1MyIvPjwvZz48Zz48dGl0bGU+Li4uLi4uPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iODQuMjY1NiIgd2lkdGg9IjgiIHg9IjE1NS4xNzgzIiB5PSI1Ni40Mjk3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iMTU4LjE3ODUiIHgyPSIxNTguMTc4NSIgeTE9IjU2LjQyOTciIHkyPSIxNDAuNjk1MyIvPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1wYXJ0aWNpcGFudD0iLi4uLkFQUCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4Ny4xNzg1IiB4PSIxMyIgeT0iMjUuMTMyOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjczLjE3ODUiIHg9IjIwIiB5PSI0NS4xMjc5Ij4mIzI3OTgzOyYjMzUyNzI7JiMyMjEyMDsvQVBQPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1wYXJ0aWNpcGFudD0iLi4uLkFQUCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4Ny4xNzg1IiB4PSIxMyIgeT0iMTM5LjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3My4xNzg1IiB4PSIyMCIgeT0iMTU5LjY5MDQiPiYjMjc5ODM7JiMzNTI3MjsmIzIyMTIwOy9BUFA8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLXBhcnRpY2lwYW50PSIuLi4uLi4iPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTcuOTk5NiIgeD0iMTEwLjE3ODUiIHk9IjI1LjEzMjgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4My45OTk2IiB4PSIxMTcuMTc4NSIgeT0iNDUuMTI3OSI+JiMzNTgzMTsmIzI3NzE0OyYjMjI3ODg7JiMyOTcwMjsmIzMyNDQ3OyYjMzEyNDM7PC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1wYXJ0aWNpcGFudD0iLi4uLi4uIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijk3Ljk5OTYiIHg9IjExMC4xNzg1IiB5PSIxMzkuNjk1MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjk5OTYiIHg9IjExNy4xNzg1IiB5PSIxNTkuNjkwNCI+JiMzNTgzMTsmIzI3NzE0OyYjMjI3ODg7JiMyOTcwMjsmIzMyNDQ3OyYjMzEyNDM7PC90ZXh0PjwvZz48Zz48dGl0bGU+Li4uLi4uPC90aXRsZT48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjM4LjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIxMCIgeD0iMTU0LjE3ODMiIHk9IjkzLjU2MjUiLz48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iLi4uLkFQUCIgZGF0YS1wYXJ0aWNpcGFudC0yPSIuLi4uLi4iPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTQyLjE3ODMsODkuNTYyNSwxNTIuMTc4Myw5My41NjI1LDE0Mi4xNzgzLDk3LjU2MjUsMTQ2LjE3ODMsOTMuNTYyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1Ni41ODkzIiB4Mj0iMTQ4LjE3ODMiIHkxPSI5My41NjI1IiB5Mj0iOTMuNTYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUzLjM5MDEiIHg9IjYzLjU4OTMiIHk9Ijg4LjQ5NjYiPlJlcXVlc3Q8L3RleHQ+PC9nPjxwYXRoIGQ9Ik01LDcxLjQyOTcgTDUsOTYuNDI5NyBMNTIsOTYuNDI5NyBMNTIsODEuNDI5NyBMNDIsNzEuNDI5NyBMNSw3MS40Mjk3IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNDIsNzEuNDI5NyBMNDIsODEuNDI5NyBMNTIsODEuNDI5NyBMNDIsNzEuNDI5NyIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjYiIHg9IjExIiB5PSI4OC40OTY2Ij4mIzMxNTYxOyYjMjQ0NTM7PC90ZXh0PjxwYXRoIGQ9Ik0xNjksNzEuNDI5NyBMMTY5LDk2LjQyOTcgTDIxNiw5Ni40Mjk3IEwyMTYsODEuNDI5NyBMMjA2LDcxLjQyOTcgTDE2OSw3MS40Mjk3IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjA2LDcxLjQyOTcgTDIwNiw4MS40Mjk3IEwyMTYsODEuNDI5NyBMMjA2LDcxLjQyOTciIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI2IiB4PSIxNzUiIHk9Ijg4LjQ5NjYiPiYjMjI3ODg7JiMyOTcwMjs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtcGFydGljaXBhbnQtMT0iLi4uLi4uIiBkYXRhLXBhcnRpY2lwYW50LTI9Ii4uLi5BUFAiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjcuNTg5MywxMTguNjk1Myw1Ny41ODkzLDEyMi42OTUzLDY3LjU4OTMsMTI2LjY5NTMsNjMuNTg5MywxMjIuNjk1MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI2MS41ODkzIiB4Mj0iMTUzLjE3ODMiIHkxPSIxMjIuNjk1MyIgeTI9IjEyMi42OTUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjMuMDE5NSIgeD0iNzMuNTg5MyIgeT0iMTE3LjYyOTQiPlJlc3BvbnNlPC90ZXh0PjwvZz48IS0tU1JDPVtLdGdzalZfNXlld2RDclZlRW1PNEEyZGVzWWN5TUJfenNTUWNmcWpRZGF6ZVV4dmhfX0NMdExPQUdRYzVmUWQ1OUxvOW9JTVBQT2FiZ0xXS1NVTmIweUxwS2pEQWs5d2x4Tm93aHZLaERJejUwSUc4YUlkQUpDeWV1T0JlRzRYWGNXRG9XWEFnZ3EzczVuVmF2bk1kU1lOYkxvV2VYUml3RlBsSi14SGg4TDIxNGZTMjQxR2E1ZkxhOWNTTTlFUUxPN0NRbzNnV0pXMDBdLS0+PC9nPjwvc3ZnPg=='>\n\n<p>创建一个 Servlet ，模拟一个耗时3000ms的业务</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@WebServlet(&quot;/order&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyServlet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HttpServlet</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doGet</span><span class=\"params\">(HttpServletRequest req, HttpServletResponse resp)</span> <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">startTime</span> <span class=\"operator\">=</span> <span class=\"number\">0l</span>;</span><br><span class=\"line\">        System.out.println(Thread.currentThread() + <span class=\"string\">&quot; Invoke MyServlet...doGet...start at &quot;</span> + (startTime = System.currentTimeMillis()));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            printThread(); <span class=\"comment\">// 模拟执行业务，同步执行</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        resp.getWriter().write(<span class=\"string\">&quot;order successful...&quot;</span>);</span><br><span class=\"line\">        System.out.println(Thread.currentThread() + <span class=\"string\">&quot; Invoke MyServlet...doGet...end, spending  &quot;</span> + (System.currentTimeMillis() - startTime) + <span class=\"string\">&quot;ms&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">printThread</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        System.out.println(Thread.currentThread() + <span class=\"string\">&quot; Invoke MyServlet...printThread...&quot;</span>);</span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">3000</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>访问工程的 &#x2F;order路径</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Thread[http-nio-8080-exec-9,5,main] Invoke MyServlet...doGet...start at 1658914059469</span><br><span class=\"line\">Thread[http-nio-8080-exec-9,5,main] Invoke MyServlet...printThread...</span><br><span class=\"line\">Thread[http-nio-8080-exec-9,5,main] Invoke MyServlet...doGet...end, spending  3010ms</span><br></pre></td></tr></table></figure>\n\n<p>看到只有一个线程参与执行，总耗时约3000ms。</p>\n<h3 id=\"Servlet的异步处理\"><a href=\"#Servlet的异步处理\" class=\"headerlink\" title=\"Servlet的异步处理\"></a>Servlet的异步处理</h3><p>Tomcat主线程池获取连接请求响应等信息，新建线程，异步对这些请求进行具体业务逻辑的处理。Tomcat的主线程不被阻塞直接返回，释放Tomcat连接。</p>\n<img src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjE3MHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NzExcHg7aGVpZ2h0OjE3MHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDcxMSAxNzAiIHdpZHRoPSI3MTFweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJBUFAuLi4iIGRhdGEtc291cmNlLWxpbmU9IjEiIGRhdGEtdWlkPSJlbnQwMDAyIiBpZD0iZW50aXR5X0FQUC4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1Mi41OTM4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1NS45OTk4IiB4PSI3IiB5PSI4Mi4xNTU5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjYuNDYxOSIgeD0iMjEuNzY5IiB5PSI5Ny4xNTEiPkFQUDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS45OTk4IiB4PSIxNCIgeT0iMTEzLjQ0NzkiPiYjMjc5ODM7JiMzNTI3MjsmIzIyMTIwOzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4IiB4Mj0iNjEuOTk5OCIgeTE9IjExOC43NDk3IiB5Mj0iMTE4Ljc0OTciLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IlRvbWNhdC4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjIiIGRhdGEtdWlkPSJlbnQwMDAzIiBpZD0iZW50aXR5X1RvbWNhdC4uLi4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTA5Ljc4MTMiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1My45OTk0IiB4PSIxNTIiIHk9IjUzLjU2NTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDguNTIwMyIgeD0iMTc0LjczOTYiIHk9IjY4LjU2MSI+VG9tY2F0JiMyMDAyNzsmIzMyNDQ3OyYjMzEyNDM7JiMyNzc0NDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM5Ljk5OTQiIHg9IjE1OSIgeT0iODQuODU3OSI+JiMzMzcxOTsmIzIxNDYyOyYjMzY4MzA7JiMyNTUwOTsmIzMyNDQ3OyYjMzEyNDM7JiMzNjgyNzsmIzM0ODkyOyYjMjI3ODg7JiMyOTcwMjs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTUzIiB4Mj0iMzA0Ljk5OTQiIHkxPSI5MC4xNTk3IiB5Mj0iOTAuMTU5NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM2LjkwNzEiIHg9IjE1OCIgeT0iMTA3LjE1NDgiPiYjMzI0NDc7JiMzMTI0MzsxPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM2LjkwNzEiIHg9IjE1OCIgeT0iMTIzLjQ1MTciPiYjMzI0NDc7JiMzMTI0MzsyPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzLjM1MDYiIHg9IjE1OCIgeT0iMTM5Ljc0ODUiPi4uLjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzOC40NzI1IiB4PSIxNTgiIHk9IjE1Ni4wNDU0Ij4mIzMyNDQ3OyYjMzEyNDM7TjwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjgiIGRhdGEtdWlkPSJlbnQwMDA0IiBpZD0iZW50aXR5Xy4uLi4uLi4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTA5Ljc4MTMiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE4MS45OTkzIiB4PSI1MjQiIHk9IjUzLjU2NTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSI1NjUuOTk5OCIgeT0iNjguNTYxIj4mIzI0MzIyOyYjMjc0OTM7JiMyMjc4ODsmIzI5NzAyOyYjMzI0NDc7JiMzMTI0MzsmIzI3NzQ0OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjcuOTk5MyIgeD0iNTMxIiB5PSI4NC44NTc5Ij4mIzMzNzE5OyYjMjE0NjI7JiMyNDMyMjsmIzI3NDkzOyYjMzY4MzA7JiMyNTUwOTsmIzMyNDQ3OyYjMzEyNDM7JiMzNjgyNzsmIzM0ODkyOyYjMjI3ODg7JiMyOTcwMjs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNTI1IiB4Mj0iNzA0Ljk5OTMiIHkxPSI5MC4xNTk3IiB5Mj0iOTAuMTU5NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM2LjkwNzEiIHg9IjUzMCIgeT0iMTA3LjE1NDgiPiYjMzI0NDc7JiMzMTI0MzsxPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM2LjkwNzEiIHg9IjUzMCIgeT0iMTIzLjQ1MTciPiYjMzI0NDc7JiMzMTI0MzsyPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzLjM1MDYiIHg9IjUzMCIgeT0iMTM5Ljc0ODUiPi4uLjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzOC40NzI1IiB4PSI1MzAiIHk9IjE1Ni4wNDU0Ij4mIzMyNDQ3OyYjMzEyNDM7TjwvdGV4dD48L2c+PCEtLWxpbmsgQVBQPz8/IHRvIFRvbWNhdD8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iQVBQLi4uIiBkYXRhLWVudGl0eS0yPSJUb21jYXQuLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNCIgZGF0YS11aWQ9ImxuazUiIGlkPSJsaW5rX0FQUC4uLl9Ub21jYXQuLi4uIj48cGF0aCBjb2RlTGluZT0iMTQiIGQ9Ik02My4yMSwxMDguNDU1OSBDODYuNDMsMTA4LjQ1NTkgMTE0LjUsMTA4LjQ1NTkgMTQ1LjcyLDEwOC40NTU5IiBmaWxsPSJub25lIiBpZD0iQVBQJiMyNzk4MzsmIzM1MjcyOyYjMjIxMjA7LXRvLVRvbWNhdCYjMjAwMjc7JiMzMjQ0NzsmIzMxMjQzOyYjMjc3NDQ7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNTEuNzIsMTA4LjQ1NTksMTQyLjcyLDEwNC40NTU5LDE0Ni43MiwxMDguNDU1OSwxNDIuNzIsMTEyLjQ1NTksMTUxLjcyLDEwOC40NTU5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTMuMzkwMSIgeD0iODEiIHk9IjEwMS41MjI4Ij5SZXF1ZXN0PC90ZXh0PjwvZz48IS0tbGluayBUb21jYXQ/Pz8/IHRvIFRvbWNhdD8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iVG9tY2F0Li4uLiIgZGF0YS1lbnRpdHktMj0iVG9tY2F0Li4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGRhdGEtdWlkPSJsbms2IiBpZD0ibGlua19Ub21jYXQuLi4uX1RvbWNhdC4uLi4iPjxwYXRoIGNvZGVMaW5lPSIxNSIgZD0iTTMwNi40Nyw4OC4xMTU5IEMzMjYuMTksODkuNDU1OSAzNDEsOTYuMjM1OSAzNDEsMTA4LjQ1NTkgQzM0MSwxMjAuNjc1OSAzMzIuMTc2MiwxMjcuMDQ5MSAzMTIuNDU2MiwxMjguMzg5MSIgZmlsbD0ibm9uZSIgaWQ9IlRvbWNhdCYjMjAwMjc7JiMzMjQ0NzsmIzMxMjQzOyYjMjc3NDQ7LXRvLVRvbWNhdCYjMjAwMjc7JiMzMjQ0NzsmIzMxMjQzOyYjMjc3NDQ7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMDYuNDcsMTI4Ljc5NTksMzE1LjcyMDUsMTMyLjE3NjYsMzExLjQ1ODUsMTI4LjQ1NjksMzE1LjE3ODEsMTI0LjE5NSwzMDYuNDcsMTI4Ljc5NTkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Mi4wMDAxIiB4PSIzNzEuMzg0NSIgeT0iMTA1LjUyMjgiPiYjMzA0NTI7JiMyNTUwOTsmIzM2ODIwOyYjMjIyMzg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMC43NjkxIiB4PSIzNDciIHk9IjEyMC42NTU2Ij4mIzM3MzIyOyYjMjU5MTg7VG9tY2F0JiMzODE0MjsmIzI1NTA5OzwvdGV4dD48L2c+PCEtLWxpbmsgVG9tY2F0Pz8/PyB0byA/Pz8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlRvbWNhdC4uLi4iIGRhdGEtZW50aXR5LTI9Ii4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjE2IiBkYXRhLXVpZD0ibG5rNyIgaWQ9ImxpbmtfVG9tY2F0Li4uLl8uLi4uLi4uIj48cGF0aCBjb2RlTGluZT0iMTYiIGQ9Ik0zMDYuMTksMTA4LjQ1NTkgQzM2OC44OSwxMDguNDU1OSA0NTEuNDcsMTA4LjQ1NTkgNTE3LjY5LDEwOC40NTU5IiBmaWxsPSJub25lIiBpZD0iVG9tY2F0JiMyMDAyNzsmIzMyNDQ3OyYjMzEyNDM7JiMyNzc0NDstdG8tJiMyNDMyMjsmIzI3NDkzOyYjMjI3ODg7JiMyOTcwMjsmIzMyNDQ3OyYjMzEyNDM7JiMyNzc0NDsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjUyMy42OSwxMDguNDU1OSw1MTQuNjksMTA0LjQ1NTksNTE4LjY5LDEwOC40NTU5LDUxNC42OSwxMTIuNDU1OSw1MjMuNjksMTA4LjQ1NTkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Mi4wMDAxIiB4PSIzODkiIHk9IjEwMS41MjI4Ij4mIzI0MzIyOyYjMjc0OTM7JiMzNTgzMTsmIzI3NzE0OzwvdGV4dD48L2c+PCEtLXJldmVyc2UgbGluayBBUFA/Pz8gdG8gPz8/Pz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJBUFAuLi4iIGRhdGEtZW50aXR5LTI9Ii4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjE3IiBkYXRhLXVpZD0ibG5rOSIgaWQ9ImxpbmtfQVBQLi4uXy4uLi4uLi4iPjxwYXRoIGNvZGVMaW5lPSIxNyIgZD0iTTY4LjQ5MjQsODcuMjA4MSBDODguMDEyNCw3NS4zODgxIDEwOS43NCw2My40NjU5IDEzNSw1My41NjU5IEMxODguNTMsMzIuNTc1OSAyMDMuNDMsMjkuMTY1OSAyNjAuNSwyMi4xMjU5IEMzNTEuMzQsMTAuOTI1OSA0NTIuNTgsMzkuODc1OSA1MjMuNTMsNjcuMjE1OSIgZmlsbD0ibm9uZSIgaWQ9IkFQUCYjMjc5ODM7JiMzNTI3MjsmIzIyMTIwOy1iYWNrdG8tJiMyNDMyMjsmIzI3NDkzOyYjMjI3ODg7JiMyOTcwMjsmIzMyNDQ3OyYjMzEyNDM7JiMyNzc0NDsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjYzLjM2LDkwLjMxNTksNzMuMTMwNSw4OS4wNzU4LDY3LjYzNyw4Ny43MjYxLDY4Ljk4NjcsODIuMjMyNiw2My4zNiw5MC4zMTU5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjMuMDE5NSIgeD0iMjYxLjUiIHk9IjE5LjYzMjgiPlJlc3BvbnNlPC90ZXh0PjwvZz48IS0tU1JDPVtvcV9BSWFxa0tMMW8zMFk4b05rc2pWXzV5ZXdkQ3JTZUFJR01BbTI1dTA5Uy1MMXI4VmN2b09hYkp0UmlWaHZoX19DTHRTeXNCZVo5VXo2dF9NZF9qMVZ4dnB0aE1tZUhWaDVfemVrNUZLLU5qM29WcTBPczJyRFJEUFMyNDQydVhhWGk4cDFSSnF5RklTb0ZnblJrV0FUeGNmd2pOR2VuNmlDRDQ0Y3lCaTZnZHJKNzgwVURXY3ZIUGRmNllRdVQ1YXpRQUdJYjVmUWM1ZlRtT1NlZndFQkd5ZHBzNWczcE4tb1Z5ZEpzbDlZeWItclRwd1JpV3dYeEVOYVZLMFFoTUowdE9GTVU1TEp1blZoanBwT3NTTTVMZXcyUmF2ZTZDVzdQUm8zdDVuVmF2bk1kMFcwMF0tLT48L2c+PC9zdmc+'>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">                         ┌───────────┐</span><br><span class=\"line\">                         │Tomcat Main│</span><br><span class=\"line\">                         │ThreadPool │</span><br><span class=\"line\">┌───────┐    Request     ├───────────┤</span><br><span class=\"line\">│  APP/ ├───────────────►│  Thread1  │</span><br><span class=\"line\">│Browser│◄───────────────┤  Thread2  │</span><br><span class=\"line\">└───────┘ Return directly│  Thread3  │</span><br><span class=\"line\">    ▲     Release Conn   │  ...      │</span><br><span class=\"line\">    │                    │  ThreadN  │</span><br><span class=\"line\">    │                    └─────┬─────┘</span><br><span class=\"line\">    │                          │</span><br><span class=\"line\">    │                          │</span><br><span class=\"line\">    │                          │Asynchronized</span><br><span class=\"line\">    │Response                  │  Request</span><br><span class=\"line\">    │                          │</span><br><span class=\"line\">    │                          ▼</span><br><span class=\"line\">    │                   ┌─────────────┐</span><br><span class=\"line\">    │                   │Asynchronized│</span><br><span class=\"line\">    │                   │ ThreadPool  │</span><br><span class=\"line\">    │                   ├─────────────┤</span><br><span class=\"line\">    │                   │  Thread1    │</span><br><span class=\"line\">    └───────────────────┤  Thread2    │</span><br><span class=\"line\">                        │  Thread3    │</span><br><span class=\"line\">                        │  ...        │</span><br><span class=\"line\">                        │  ThreadN    │</span><br><span class=\"line\">                        └─────────────┘</span><br></pre></td></tr></table></figure>\n\n<p>另外创建一个 Servlet，模拟异步处理一个耗时3000ms的业务</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 声明支持异步模式</span></span><br><span class=\"line\"><span class=\"meta\">@WebServlet(value = &quot;/asyncOrder&quot;, asyncSupported = true)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OrderAsyncServlet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HttpServlet</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doGet</span><span class=\"params\">(HttpServletRequest req, HttpServletResponse resp)</span> <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">startTime</span> <span class=\"operator\">=</span> <span class=\"number\">0l</span>;</span><br><span class=\"line\">        System.out.println(Thread.currentThread() + <span class=\"string\">&quot; Invoke MyServlet...doGet...start at &quot;</span> + (startTime = System.currentTimeMillis()));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">AsyncContext</span> <span class=\"variable\">myAsyncContext</span> <span class=\"operator\">=</span> req.startAsync();</span><br><span class=\"line\"></span><br><span class=\"line\">        myAsyncContext.start(() -&gt; &#123; <span class=\"comment\">// 模拟异步处理业务</span></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">long</span> <span class=\"variable\">AsyncStartTime</span> <span class=\"operator\">=</span> <span class=\"number\">0l</span>;</span><br><span class=\"line\">                System.out.println(Thread.currentThread() + <span class=\"string\">&quot; Invoke myAsyncContext...Runnable...start at &quot;</span> + (AsyncStartTime = System.currentTimeMillis()));</span><br><span class=\"line\">                printThread(); <span class=\"comment\">// 模拟业务耗时</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"type\">AsyncContext</span> <span class=\"variable\">asyncContext</span> <span class=\"operator\">=</span> req.getAsyncContext(); <span class=\"comment\">// 从请求request中获取异步容器</span></span><br><span class=\"line\">                <span class=\"type\">ServletResponse</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> asyncContext.getResponse(); <span class=\"comment\">// 从容器中获取响应response</span></span><br><span class=\"line\">                myAsyncContext.complete(); <span class=\"comment\">// 表示异步操作的结束</span></span><br><span class=\"line\"></span><br><span class=\"line\">                response.getWriter().write(<span class=\"string\">&quot;Async order success...&quot;</span>);</span><br><span class=\"line\">                System.out.println(Thread.currentThread() + <span class=\"string\">&quot; Invoke myAsyncContext...Runnable...end, spending &quot;</span> + (System.currentTimeMillis() - AsyncStartTime) + <span class=\"string\">&quot;ms&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException | IOException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        System.out.println(Thread.currentThread() + <span class=\"string\">&quot; Invoke MyServlet...doGet...end, spending  &quot;</span> + (System.currentTimeMillis() - startTime) + <span class=\"string\">&quot;ms&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">printThread</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        System.out.println(Thread.currentThread() + <span class=\"string\">&quot; Invoke MyServlet...printThread...&quot;</span>);</span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">3000</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Thread[http-nio-8080-exec-5,5,main] Invoke MyServlet...doGet...start at 1658913889256</span><br><span class=\"line\">Thread[http-nio-8080-exec-5,5,main] Invoke MyServlet...doGet...end, spending  3ms</span><br><span class=\"line\">Thread[http-nio-8080-exec-6,5,main] Invoke myAsyncContext...Runnable...start at 1658913889259</span><br><span class=\"line\">Thread[http-nio-8080-exec-6,5,main] Invoke MyServlet...printThread...</span><br><span class=\"line\">Thread[http-nio-8080-exec-6,5,main] Invoke myAsyncContext...Runnable...end, spending 3008ms</span><br></pre></td></tr></table></figure>\n\n<p>可以看到有两个线程参与了执行。主线程exec-5只花费了3ms，业务逻辑的执行交给了异步容器，另开了一个线程exec-6，花费了约3000ms</p>\n<p>虽然是异步，但在当前例子中，用户体验区别并不大，访问对应地址后都需要等待3000ms才能看到结果，此前都是白屏。</p>\n<p>但异步的好处在于将 接收请求 和 业务操作 的工作分开了。主线程接收完请求，将具体业务交给另一个线程后，自己就解放了，可以再接收其他的请求。</p>\n<h3 id=\"SpringMVC的异步处理\"><a href=\"#SpringMVC的异步处理\" class=\"headerlink\" title=\"SpringMVC的异步处理\"></a>SpringMVC的异步处理</h3><h4 id=\"Callable方式\"><a href=\"#Callable方式\" class=\"headerlink\" title=\"Callable方式\"></a>Callable方式</h4><p>一个Controller可以封装任何 Callable<T> 对象支持的类型，然后这些返回值可以通过设置 TaskExecutor，执行对应任务后获得。</p>\n<p><a href=\"https://docs.spring.io/spring-framework/docs/5.3.22/reference/html/web.html#mvc-ann-async-callable\">官方文档</a>提供的示例如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@PostMapping</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Callable&lt;String&gt; <span class=\"title function_\">processUpload</span><span class=\"params\">(<span class=\"keyword\">final</span> MultipartFile file)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Callable</span>&lt;String&gt;() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">            <span class=\"comment\">// ...</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;someView&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>自定义一个Controller，加上大量输出。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AsyncOrderController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/asyncOrderController&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Callable&lt;String&gt; <span class=\"title function_\">order</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">startTime</span> <span class=\"operator\">=</span> <span class=\"number\">0l</span>;</span><br><span class=\"line\">        System.out.println(Thread.currentThread() + <span class=\"string\">&quot; Invoke AsyncOrderController...order...start at &quot;</span> + (startTime = System.currentTimeMillis()));</span><br><span class=\"line\"></span><br><span class=\"line\">        Callable&lt;String&gt; callable = () -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">callStartTime</span> <span class=\"operator\">=</span> <span class=\"number\">0l</span>;</span><br><span class=\"line\">            System.out.println(Thread.currentThread() + <span class=\"string\">&quot; Invoke AsyncOrderController...call...start at &quot;</span> + (callStartTime = System.currentTimeMillis()));</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">3000</span>);</span><br><span class=\"line\">            System.out.println(Thread.currentThread() + <span class=\"string\">&quot; Invoke AsyncOrderController...call...end, spending &quot;</span> + (System.currentTimeMillis() - callStartTime) + <span class=\"string\">&quot;ms&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;AsyncOrderController success...&quot;</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(Thread.currentThread() + <span class=\"string\">&quot; Invoke AsyncOrderController...order...end, spending &quot;</span> + (System.currentTimeMillis() - startTime) + <span class=\"string\">&quot;ms&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> callable;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Invoke MyInterceptor#preHandle...</span><br><span class=\"line\">Thread[http-nio-8080-exec-4,5,main] Invoke AsyncOrderController...order...start at 1658918246304</span><br><span class=\"line\">Thread[http-nio-8080-exec-4,5,main] Invoke AsyncOrderController...order...end, spending 0ms</span><br><span class=\"line\">Thread[MvcAsync1,5,main] Invoke AsyncOrderController...call...start at 1658918246312</span><br><span class=\"line\">Thread[MvcAsync1,5,main] Invoke AsyncOrderController...call...end, spending 3005ms</span><br><span class=\"line\">Invoke MyInterceptor#preHandle...</span><br><span class=\"line\">Invoke MyInterceptor#postHandle...</span><br><span class=\"line\">Invoke MyInterceptor#afterCompletion...</span><br></pre></td></tr></table></figure>\n\n<p>可以看到同样是分为了接收请求的线程和具体处理业务的线程。</p>\n<p>有一点值得注意，这里只访问了对应地址一次，但之前写的拦截器，在此处被触发了两次。</p>\n<p>根据<a href=\"https://docs.spring.io/spring-framework/docs/5.3.22/reference/html/web.html#mvc-ann-async-processing\">官方文档</a>的描述，其执行过程如下：</p>\n<ul>\n<li>Controller 返回一个 Callable对象。</li>\n<li>SpringMVC 调用 request.startAsync() 并将 Callable 提交给 TaskExecutor ，在另一个线程异步处理。</li>\n<li>同时，DispatcherServlet 和所有的过滤器退出Servlet容器的线程，但response保留开放。</li>\n<li>最终 Callable 会生成一个结果，且SpringMVC将请求分发回Servlet容器，以完成整个流程。</li>\n<li>DispatcherServlet 再次被触发，流程获取 Callable 对象的返回值，恢复运行。</li>\n</ul>\n<p>也就是说，DispatcherServlet 被触发了两次，所以能看到拦截器输出了两次，这两次可能是不同的线程在执行。</p>\n<p>另外需要注意的一点是，这里返回的 Callable 对象，需要<strong>放在一个线程池里处理</strong>，没有指定的话，Spring会自动指定一 SimpleAsyncTaskExecutor 对象。</p>\n<p>这个线程池每来一个任务就新建一个线程，也不会重复利用之前的线程，所以不推荐，会报Warning。</p>\n<p>推荐的做法是在配置类中指定执行异步请求时使用的线程池。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configureAsyncSupport</span><span class=\"params\">(AsyncSupportConfigurer configurer)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">ThreadPoolTaskExecutor</span> <span class=\"variable\">executor</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadPoolTaskExecutor</span>();</span><br><span class=\"line\">    executor.initialize(); <span class=\"comment\">// 线程池的初始化。如果对象是以Bean的形式加入的，则不需要写，但这里直接new，需要手动调用下</span></span><br><span class=\"line\">    executor.setCorePoolSize(<span class=\"number\">10</span>);</span><br><span class=\"line\">    executor.setMaxPoolSize(<span class=\"number\">10</span>);</span><br><span class=\"line\">    configurer.setTaskExecutor(executor);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"DeferredResult方式\"><a href=\"#DeferredResult方式\" class=\"headerlink\" title=\"DeferredResult方式\"></a>DeferredResult方式</h4><p>一旦 Servlet 容器允许异步处理请求，Controller方法可以封装任意 DeferredResult类支持的返回值。</p>\n<p><a href=\"https://docs.spring.io/spring-framework/docs/5.3.22/reference/html/web.html#mvc-ann-async-deferredresult\">官方文档</a>提供的示例如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GetMapping(&quot;/quotes&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> DeferredResult&lt;String&gt; <span class=\"title function_\">quotes</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    DeferredResult&lt;String&gt; deferredResult = <span class=\"keyword\">new</span> <span class=\"title class_\">DeferredResult</span>&lt;String&gt;();</span><br><span class=\"line\">    <span class=\"comment\">// Save the deferredResult somewhere..</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> deferredResult;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// From some other thread...</span></span><br><span class=\"line\">deferredResult.setResult(result);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"实际案例\"><a href=\"#实际案例\" class=\"headerlink\" title=\"实际案例\"></a>实际案例</h4><p>当前需求：异步处理订单请求，Tomcat主线程和订单服务器使用消息中间件进行通信。</p>\n<img src='data:image/svg+xml;base64,ZXJyb3IgY29kZTogNTIw'>\n\n<p>首先定义一个类，用于存储 DeferredResult 对象，模拟消息队列。</p>\n<p>简陋，只能说很简陋。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyDeferredQueue</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> BlockingQueue&lt;DeferredResult&lt;Object&gt;&gt; queue = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayBlockingQueue</span>&lt;&gt;(<span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 向队列中添加元素</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">save</span><span class=\"params\">(DeferredResult&lt;Object&gt; deferredResult)</span> &#123;</span><br><span class=\"line\">        queue.add(deferredResult);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取队列的第一个元素</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> DeferredResult&lt;Object&gt; <span class=\"title function_\">get</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> queue.poll();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在之前的Controller里加一个方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/createOrder&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> DeferredResult&lt;Object&gt; <span class=\"title function_\">createOrder</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;Invoke AsyncOrderController...createOrder...&quot;</span>);</span><br><span class=\"line\">    DeferredResult&lt;Object&gt; deferredResult = <span class=\"keyword\">new</span> <span class=\"title class_\">DeferredResult</span>&lt;&gt;(<span class=\"number\">3000l</span>, <span class=\"string\">&quot;create order fail&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 这里对应的就是案例中说的 Save the deferredResult somewhere..</span></span><br><span class=\"line\">    MyDeferredQueue.save(deferredResult);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 在另外一个线程中，实际处理业务，并将业务结果存储在deferredResult中</span></span><br><span class=\"line\">    <span class=\"type\">Runnable</span> <span class=\"variable\">task</span> <span class=\"operator\">=</span> () -&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">1500</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">orderId</span> <span class=\"operator\">=</span> UUID.randomUUID().toString(); <span class=\"comment\">// 模拟订单服务返回的结果</span></span><br><span class=\"line\">        DeferredResult&lt;Object&gt; deferredOrder = MyDeferredQueue.get();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Order created... The orderId is &quot;</span> + orderId);</span><br><span class=\"line\">        deferredOrder.setResult(orderId);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    task.run();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> deferredResult;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后疯狂访问工程 createOrder 地址，可以看到各个请求的处理返回是异步交错的。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Invoke AsyncOrderController...createOrder...</span><br><span class=\"line\">Invoke AsyncOrderController...createOrder...</span><br><span class=\"line\">Invoke AsyncOrderController...createOrder...</span><br><span class=\"line\">Order created... The orderId is 86e38f1d-1ec1-4441-98cf-c3ba2c39d34a</span><br><span class=\"line\">Invoke AsyncOrderController...createOrder...</span><br><span class=\"line\">Order created... The orderId is 5931498b-1a88-43cb-9681-4aa14890ee53</span><br><span class=\"line\">Invoke AsyncOrderController...createOrder...</span><br><span class=\"line\">Order created... The orderId is a4f1d905-3869-48ef-aafb-ea06d541d9e0</span><br><span class=\"line\">Order created... The orderId is 398efee3-7180-49ca-bc17-d13292b23fa5</span><br><span class=\"line\">Order created... The orderId is d142c674-e01b-49da-8557-6fc84fbcb268</span><br></pre></td></tr></table></figure>\n","categories":["Spring"],"tags":["Java"]},{"title":"Spring基础及组件使用","url":"/%E7%AC%94%E8%AE%B0/Java/Spring/Spring%E5%9F%BA%E7%A1%80%E5%8F%8A%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>Spring是一种开源轻量级框架，是为了解决企业应用开发复杂性而创建的，Spring致力于解决JavaEE的各层解决方案，而不仅仅于某一层的方案。</p>\n<p>Spring是一个开源的控制反转（IoC）和面向切面（AOP）的容器框架，用来简化企业开发。</p>\n<p>2003年2月Spring框架正式成为一个开源项目，贯穿于表现层、业务层和持久层。但Spring并不想取代已有框架，而是以高度的开放性，与这些框架进行整合。</p>\n<p>Spring的目标：让现有的技术更容易使用；促进良好的变成习惯。</p>\n<h2 id=\"体系结构\"><a href=\"#体系结构\" class=\"headerlink\" title=\"体系结构\"></a>体系结构</h2><ul>\n<li>Spring Core。Spring核心，框架最基础的部分，提供IOC（控制反转）和DI（依赖注入）。</li>\n<li>Spring Context。Spring上下文容器，是BeanFactory功能加强的一个子接口。</li>\n<li>Spring Web。提供Web应用开发的支持。</li>\n<li>Spring MVC。针对Web应用中MVC思想的实现。</li>\n<li>Spring DAO。提供对JDBC抽象层，简化了JDBC的编码，同时让编码更具健壮性。</li>\n<li>Spring ORM。支持用于流行的ORM框架的整合，比如：Spring+Hibernate、Spring+IBatis、Spring+JDO的整合等。</li>\n<li>Spring AOP。面向切面编程，提供了与AOP兼容的编程实现。</li>\n</ul>\n<h2 id=\"Hello-World\"><a href=\"#Hello-World\" class=\"headerlink\" title=\"Hello World\"></a>Hello World</h2><p>XML配置，属于比较早期的配置方式，现在一般都不使用了。</p>\n<p>新建工程，造pom.xml中引入spring-context.jar</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.3.21<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>新建Person类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Person</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Person</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Person</span><span class=\"params\">(String name, Integer age)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getName</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setName</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Integer <span class=\"title function_\">getAge</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setAge</span><span class=\"params\">(Integer age)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Person&#123;&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;name=&#x27;&quot;</span> + name + <span class=\"string\">&#x27;\\&#x27;&#x27;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;, age=&quot;</span> + age +</span><br><span class=\"line\">                <span class=\"string\">&#x27;&#125;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>新建spring的bean.xml，配置bean</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--使用无参构造方法--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;person&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;com.example.cap1.Person&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;adam&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;10&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--使用有参构造方法--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;person1&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;com.example.cap1.Person&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;adam&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;10&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>新建测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 将beans.xml的类加载到容器</span></span><br><span class=\"line\">        <span class=\"type\">ApplicationContext</span> <span class=\"variable\">app</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ClassPathXmlApplicationContext</span>(<span class=\"string\">&quot;beans.xml&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 从容器中获取bean</span></span><br><span class=\"line\">        <span class=\"type\">Person</span> <span class=\"variable\">person</span> <span class=\"operator\">=</span> (Person) app.getBean(<span class=\"string\">&quot;person&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(person);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Person&#123;name=&#x27;adam&#x27;, age=10&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"一般问题\"><a href=\"#一般问题\" class=\"headerlink\" title=\"一般问题\"></a>一般问题</h2><h3 id=\"IOC容器\"><a href=\"#IOC容器\" class=\"headerlink\" title=\"IOC容器\"></a>IOC容器</h3><p>IOC容器，实际上就是一个map，BeanID是key，Bean对象是value。对Bean进行注册、实例化和管理。</p>\n<h3 id=\"FactoryBean和BeanFactory\"><a href=\"#FactoryBean和BeanFactory\" class=\"headerlink\" title=\"FactoryBean和BeanFactory\"></a>FactoryBean和BeanFactory</h3><p>Bean示例通过FactoryBean注入到IOC容器中；</p>\n<p>通过BeanFactory从IOC容器中获取Bean示例。</p>\n<h3 id=\"容器注册组件的方式\"><a href=\"#容器注册组件的方式\" class=\"headerlink\" title=\"容器注册组件的方式\"></a>容器注册组件的方式</h3><p>一般都是在配置类中完成。</p>\n<ul>\n<li>直接使用@Bean配以获取Bean实例的方法。</li>\n<li>使用@ComponentScan扫描指定包中的组件。</li>\n<li>使用@Import快速导入组件。<ul>\n<li>@Import(类名)。</li>\n<li>实现ImportSelector接口。</li>\n<li>使用ImportBeanDefinitionRegistrar返回自定义组件</li>\n</ul>\n</li>\n<li>使用Spring提供的FactoryBean（工厂Bean）进行注册。</li>\n</ul>\n<h2 id=\"常用组件\"><a href=\"#常用组件\" class=\"headerlink\" title=\"常用组件\"></a>常用组件</h2><ul>\n<li>AnnotationConfigApplicationContext<ul>\n<li>配置类</li>\n<li>包扫描</li>\n</ul>\n</li>\n<li>组件添加<ul>\n<li>@ComponentScan</li>\n<li>@Bean<ul>\n<li>指定初始化销毁</li>\n<li>初始化其他方式<ul>\n<li>InitializingBean（初始化设置值之后）</li>\n<li>DisposableBean（销毁）</li>\n<li>JSR250<ul>\n<li>@PostConstruct</li>\n<li>@PreDestroy</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>BeanPostProcessor</li>\n</ul>\n</li>\n<li>Configuration</li>\n<li>@Component</li>\n<li>@Service</li>\n<li>@Controller</li>\n<li>@Repository</li>\n<li>@Conditional</li>\n<li>@Primary</li>\n<li>@Lazy</li>\n<li>@Scope</li>\n<li>@Import</li>\n<li>工厂模式<ul>\n<li>FactoryBean<ul>\n<li>&amp;beanName获取Factory本身</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Configuration\"><a href=\"#Configuration\" class=\"headerlink\" title=\"@Configuration\"></a>@Configuration</h3><p>告知Spring这是一个配置类。</p>\n<p>与手动解析XML配置文件的效果是相同的，更简单灵活。</p>\n<p>新建配置类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这个类就相当于配置文件</span></span><br><span class=\"line\"><span class=\"comment\">// BeanID默认是方法的名称person。</span></span><br><span class=\"line\"><span class=\"comment\">// 此外可以在@Bean(&quot;beanID&quot;)中显式指定BeanID</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Person <span class=\"title function_\">person</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>(<span class=\"string\">&quot;bob&quot;</span>,<span class=\"number\">14</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>测试类使用</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 将配置类中的类加载到容器</span></span><br><span class=\"line\">        <span class=\"type\">ApplicationContext</span> <span class=\"variable\">app</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AnnotationConfigApplicationContext</span>(TestConfig.class);</span><br><span class=\"line\">        <span class=\"comment\">// 从容器中获取bean</span></span><br><span class=\"line\">        <span class=\"type\">Person</span> <span class=\"variable\">person</span> <span class=\"operator\">=</span> (Person) app.getBean(<span class=\"string\">&quot;person&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(person);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">Person&#123;name=&#x27;bob&#x27;, age=14&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ComponentScan\"><a href=\"#ComponentScan\" class=\"headerlink\" title=\"@ComponentScan\"></a>@ComponentScan</h3><p>扫描所有的Spring组件，Component、Repository、Service和Controller。加入到Bean容器中。</p>\n<p>沿用之前的配置类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Person <span class=\"title function_\">person</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>(<span class=\"string\">&quot;bob&quot;</span>,<span class=\"number\">14</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用测试类打印容器中所有的组件名</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Cap2Test</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test01</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ApplicationContext</span> <span class=\"variable\">app</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AnnotationConfigApplicationContext</span>(com.example.cap2.config.TestConfig.class);</span><br><span class=\"line\">        String[] names = app.getBeanDefinitionNames();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (String name : names) &#123;</span><br><span class=\"line\">            System.out.println(name);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">org.springframework.context.annotation.internalConfigurationAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.annotation.internalAutowiredAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.annotation.internalCommonAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.event.internalEventListenerProcessor</span><br><span class=\"line\">org.springframework.context.event.internalEventListenerFactory</span><br><span class=\"line\">testConfig</span><br><span class=\"line\">person</span><br></pre></td></tr></table></figure>\n\n<p>但如果在配置类中指定了组件扫描，扫描包内所有组件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan(value = &quot;com.example.cap2&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Person <span class=\"title function_\">person</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>(<span class=\"string\">&quot;bob&quot;</span>,<span class=\"number\">14</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>此时容器内有了包内其他的组件。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">org.springframework.context.annotation.internalConfigurationAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.annotation.internalAutowiredAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.annotation.internalCommonAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.event.internalEventListenerProcessor</span><br><span class=\"line\">org.springframework.context.event.internalEventListenerFactory</span><br><span class=\"line\">testConfig</span><br><span class=\"line\">orderController</span><br><span class=\"line\">orderDao</span><br><span class=\"line\">orderService</span><br><span class=\"line\">person</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"过滤器\"><a href=\"#过滤器\" class=\"headerlink\" title=\"过滤器\"></a>过滤器</h4><p>@ComponentScan支持设置复杂的过滤规则，提供了includeFilters和excludeFilters方法。</p>\n<p>includeFilters指定需要包含哪一种组件，excludeFilters指定需要排除哪一种组件。</p>\n<p>需要注意的是，@ComponentScan的useDefaultFilters方法默认为true，表明会自动include Component、Repository、Service和Controller组件。</p>\n<p>所以在使用includeFilters时，若需要达到“只包含”的效果，需将useDefaultFilters置为false。</p>\n<p>过滤器指定Filter的方式有五种</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">FilterType</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 使用注解过滤</span></span><br><span class=\"line\">\tANNOTATION,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 使用类类型过滤</span></span><br><span class=\"line\">\tASSIGNABLE_TYPE,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 根据AspectJ表达式过滤</span></span><br><span class=\"line\">\tASPECTJ,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 使用正则过滤</span></span><br><span class=\"line\">\tREGEX,</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 自定义过滤器</span></span><br><span class=\"line\">\tCUSTOM</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h4><ul>\n<li>注解过滤</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ComponentScan(value = &quot;com.example.cap2&quot;,includeFilters = &#123;</span></span><br><span class=\"line\"><span class=\"meta\">        @ComponentScan.Filter(type = FilterType.ANNOTATION,classes = &#123;Controller.class&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">&#125;,useDefaultFilters = false)</span></span><br><span class=\"line\"><span class=\"comment\">// 只扫描Controller组件</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>类名过滤</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ComponentScan(value = &quot;com.example.cap2&quot;, excludeFilters = &#123;</span></span><br><span class=\"line\"><span class=\"meta\">        @ComponentScan.Filter(type = FilterType.ASSIGNABLE_TYPE, classes = &#123;OrderDao.class&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">&#125;, useDefaultFilters = true)</span></span><br><span class=\"line\"><span class=\"comment\">// 扫描时将OrderDao类的组件排除</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>自定义过滤器</li>\n</ul>\n<p>自定义过滤器需要实现TypeFilter接口，实现boolean match() 方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyTypeFilter</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">TypeFilter</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> metadataReader        读取当前正在扫描类的信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> metadataReaderFactory 可获取到其他任何类信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IOException</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">match</span><span class=\"params\">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取当前类注解的信息</span></span><br><span class=\"line\">        <span class=\"type\">AnnotationMetadata</span> <span class=\"variable\">annotationMetadata</span> <span class=\"operator\">=</span> metadataReader.getAnnotationMetadata();</span><br><span class=\"line\">        <span class=\"comment\">// 获取当前正在扫描的类信息</span></span><br><span class=\"line\">        <span class=\"type\">ClassMetadata</span> <span class=\"variable\">classMetadata</span> <span class=\"operator\">=</span> metadataReader.getClassMetadata();</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">className</span> <span class=\"operator\">=</span> classMetadata.getClassName();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;-----&gt;&quot;</span> + className);</span><br><span class=\"line\">        <span class=\"comment\">// 获取当前类资源（类的路径）</span></span><br><span class=\"line\">        <span class=\"type\">Resource</span> <span class=\"variable\">resource</span> <span class=\"operator\">=</span> metadataReader.getResource();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (className.endsWith(<span class=\"string\">&quot;er&quot;</span>)) &#123; <span class=\"comment\">// 将类名以er结尾的组件过滤出来</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan(value = &quot;com.example.cap2&quot;, includeFilters = &#123;</span></span><br><span class=\"line\"><span class=\"meta\">        @ComponentScan.Filter(type = FilterType.CUSTOM, classes = &#123;MyTypeFilter.class&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">&#125;, useDefaultFilters = false)</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"ComponentScans\"><a href=\"#ComponentScans\" class=\"headerlink\" title=\"@ComponentScans\"></a>@ComponentScans</h4><p>装载多个ComponentScan，取并集。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ComponentScans(value = &#123;</span></span><br><span class=\"line\"><span class=\"meta\">        @ComponentScan(value = &quot;com.example.cap2.controller&quot;),</span></span><br><span class=\"line\"><span class=\"meta\">        @ComponentScan(value = &quot;com.example.cap2.dao&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">&#125;)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Scope\"><a href=\"#Scope\" class=\"headerlink\" title=\"@Scope\"></a>@Scope</h3><p>用于指定作用域，Bean对象是否为单例。有以下取值：</p>\n<ul>\n<li>singleton，单例</li>\n<li>prototype，非单例，对象在被使用时才会实例化</li>\n<li>request，同一个请求中单例</li>\n<li>session，同一个会话中单例</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这些装着Bean的东西就是IOC容器</span></span><br><span class=\"line\"><span class=\"type\">ApplicationContext</span> <span class=\"variable\">app1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ClassPathXmlApplicationContext</span>(<span class=\"string\">&quot;beans.xml&quot;</span>);</span><br><span class=\"line\"><span class=\"type\">ApplicationContext</span> <span class=\"variable\">app2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AnnotationConfigApplicationContext</span>(TestConfig.class);</span><br></pre></td></tr></table></figure>\n\n<p>单例：创建IOC容器时bean就被创建。</p>\n<p>非单例：仅当bean被使用的时候才创建。</p>\n<ul>\n<li>单例</li>\n</ul>\n<p>给容器注册一个bean，类型为返回值的类型，<strong>默认</strong>是单实例。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test01</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">ApplicationContext</span> <span class=\"variable\">app</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AnnotationConfigApplicationContext</span>(com.example.cap3.config.TestConfig.class);</span><br><span class=\"line\">    <span class=\"comment\">// 从容器中分别取两次person示例，看是否为同一个</span></span><br><span class=\"line\">    <span class=\"type\">Object</span> <span class=\"variable\">bean1</span> <span class=\"operator\">=</span> app.getBean(<span class=\"string\">&quot;person&quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">Object</span> <span class=\"variable\">bean2</span> <span class=\"operator\">=</span> app.getBean(<span class=\"string\">&quot;person&quot;</span>);</span><br><span class=\"line\">    System.out.println(bean1 == bean2);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">true</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>非单例</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Scope(&quot;prototype&quot;)</span> <span class=\"comment\">// 指定这个Bean为非单例的</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Person <span class=\"title function_\">person</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>(<span class=\"string\">&quot;cindy&quot;</span>,<span class=\"number\">11</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">false</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Lazy\"><a href=\"#Lazy\" class=\"headerlink\" title=\"@Lazy\"></a>@Lazy</h3><p>懒加载。</p>\n<p>主要针对单例bean，默认在容器启动时就被创建；如果加上@Lazy注解，则bean对象在被使用时才会被实例化。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Person <span class=\"title function_\">person</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;给容器添加person...&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>(<span class=\"string\">&quot;duke&quot;</span>,<span class=\"number\">19</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test01</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    <span class=\"type\">ApplicationContext</span> <span class=\"variable\">app</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AnnotationConfigApplicationContext</span>(com.example.cap4.config.TestConfig.class);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;IOC 容器创建完成...&quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">Object</span> <span class=\"variable\">person</span> <span class=\"operator\">=</span> app.getBean(<span class=\"string\">&quot;person&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">给容器添加person...</span><br><span class=\"line\">IOC 容器创建完成...</span><br></pre></td></tr></table></figure>\n\n<p>如果给Bean加上@Lazy注解让其懒加载。</p>\n<p>可以看出，容器率先加载完成，在使用Bean对象时才进行实例化。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Lazy</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Person <span class=\"title function_\">person</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;给容器添加person...&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>(<span class=\"string\">&quot;duke&quot;</span>,<span class=\"number\">19</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">IOC 容器创建完成...</span><br><span class=\"line\">给容器添加person...</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Condition\"><a href=\"#Condition\" class=\"headerlink\" title=\"@Condition\"></a>@Condition</h3><p>根据条件是否满足，决定是否注册Bean</p>\n<p>例如，在IOC容器加载时，如果当前操作系统是Windows，则加载BeanA；如果当前操作系统是Linux则加载BeanB。</p>\n<p>需要实现Spring的Condition接口。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Condition;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WinCondition</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Condition</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> context  判断条件可以使用的上下文环境</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> metadata 注解的信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">matches</span><span class=\"params\">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">osName</span> <span class=\"operator\">=</span> context.getEnvironment().getProperty(<span class=\"string\">&quot;os.name&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (osName.toLowerCase().contains(<span class=\"string\">&quot;windows&quot;</span>)) &#123; <span class=\"comment\">// 判断当前操作系统是否为Windows</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后，在配置类中设置@Condition注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestConfigCap5</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Conditional(WinCondition.class)</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean(&quot;frank&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Person <span class=\"title function_\">frank</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;给容器中添加Frank...&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>(<span class=\"string\">&quot;Frank&quot;</span>, <span class=\"number\">45</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Conditional(LinCondition.class)</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean(&quot;goofy&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Person <span class=\"title function_\">goofy</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;给容器中添加Goofy...&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>(<span class=\"string\">&quot;Goofy&quot;</span>, <span class=\"number\">6</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Cap5Test</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test01</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ApplicationContext</span> <span class=\"variable\">app</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AnnotationConfigApplicationContext</span>(TestConfigCap5.class);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;IOC 容器创建完成...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出结果中只加载了Frank</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">给容器中添加Frank...</span><br><span class=\"line\">IOC 容器创建完成...</span><br></pre></td></tr></table></figure>\n\n<p>matches方法中 metadata 的使用方式：</p>\n<p>比如当前自定义了一个注解，加上原先的 @Conditional 注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Conditional(WinCondition.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> MyConditional &#123;</span><br><span class=\"line\">\tString[] value();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这样在 WinConditional 中 matches 方法的 metadata 变量就可以获取到自定义注解的信息</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">metadata.getAnnotationAttributes(MyConditional.class.getName()); <span class=\"comment\">// Map键值对</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Import\"><a href=\"#Import\" class=\"headerlink\" title=\"@Import\"></a>@Import</h3><p>使用@Import可快速导入组件。</p>\n<ul>\n<li>@Import(类名)，此类不需要有注解，容器会自动注册，BeanID为类全名。</li>\n<li>可将多个Bean合并在一个类中，@Import 注解直接导入此合并类即可。</li>\n<li>实现ImportSelector接口创建一个选择器。@Import(选择器)进行使用。</li>\n<li>使用ImportBeanDefinitionRegistrar返回自定义组件。</li>\n</ul>\n<p>有很多 @EnableXXX 的注解，本质上，就是加了 @Import 注解的注解。</p>\n<h4 id=\"直接导入组件\"><a href=\"#直接导入组件\" class=\"headerlink\" title=\"直接导入组件\"></a>直接导入组件</h4><p>配置类的注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@Import(&#123;Dog.class, Cat.class&#125;)</span></span><br></pre></td></tr></table></figure>\n\n<p>测试类打印容器中所有组件。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">IOC 容器创建完成...</span><br><span class=\"line\">org.springframework.context.annotation.internalConfigurationAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.annotation.internalAutowiredAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.annotation.internalCommonAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.event.internalEventListenerProcessor</span><br><span class=\"line\">org.springframework.context.event.internalEventListenerFactory</span><br><span class=\"line\">testConfigCap6</span><br><span class=\"line\">com.example.cap6.bean.Dog</span><br><span class=\"line\">com.example.cap6.bean.Cat</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"导入合并类\"><a href=\"#导入合并类\" class=\"headerlink\" title=\"导入合并类\"></a>导入合并类</h4><p>将多个Bean合并在一个类中。一般用配置类。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span> <span class=\"comment\">// 可加可不加</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AnimalsConfiguration</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Dog <span class=\"title function_\">dog</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Dog</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Cat <span class=\"title function_\">cat</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Cat</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>配置类的注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@Import(&#123;AnimalsConfiguration.class&#125;)</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"定义ImportSelector导入组件\"><a href=\"#定义ImportSelector导入组件\" class=\"headerlink\" title=\"定义ImportSelector导入组件\"></a>定义ImportSelector导入组件</h4><p>定义选择器，实现ImportSelector接口。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyImportSelector</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ImportSelector</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[]&#123;<span class=\"string\">&quot;com.example.cap6.bean.Dog&quot;</span>&#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>配置类的注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@Import(&#123;MyImportSelector.class&#125;)</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">IOC 容器创建完成...</span><br><span class=\"line\">org.springframework.context.annotation.internalConfigurationAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.annotation.internalAutowiredAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.annotation.internalCommonAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.event.internalEventListenerProcessor</span><br><span class=\"line\">org.springframework.context.event.internalEventListenerFactory</span><br><span class=\"line\">testConfigCap6</span><br><span class=\"line\">com.example.cap6.bean.Dog</span><br></pre></td></tr></table></figure>\n\n<p>可以想到的一种用法是，当维护了一个类名数组，用这种方式注册Bean。或者有一个包里全是Person1、Person2、…、PersonN这种类名，用个for循环合成String数组返回。</p>\n<h4 id=\"使用ImportBeanDefinitionRegistrar返回自定义组件\"><a href=\"#使用ImportBeanDefinitionRegistrar返回自定义组件\" class=\"headerlink\" title=\"使用ImportBeanDefinitionRegistrar返回自定义组件\"></a>使用ImportBeanDefinitionRegistrar返回自定义组件</h4><p>定义注册器，实现ImportBeanDefinitionRegistrar接口。</p>\n<p>手动添加Bean实例组件到IOC容器中，Bean的注册使用BeanDefinitionRegistry方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyImportBeanDefinitionRegistrar</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> importingClassMetadata 当前类的注解信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> registry               注册类，把所有需要添加到容器的bean加入</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">registerBeanDefinitions</span><span class=\"params\">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">bean1</span> <span class=\"operator\">=</span> registry.containsBeanDefinition(<span class=\"string\">&quot;com.example.cap6.bean.Cat&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">bean2</span> <span class=\"operator\">=</span> registry.containsBeanDefinition(<span class=\"string\">&quot;com.example.cap6.bean.Dog&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 如果Dog和Cat都在IOC容器中，那么创建Pig类，加入到容器中</span></span><br><span class=\"line\">        <span class=\"comment\">// 对于即将注册的Bean，将其进行封装</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (bean1 &amp;&amp; bean2) &#123;</span><br><span class=\"line\">            <span class=\"type\">BeanDefinition</span> <span class=\"variable\">beanDefinition</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RootBeanDefinition</span>(Pig.class);</span><br><span class=\"line\">            registry.registerBeanDefinition(<span class=\"string\">&quot;pig&quot;</span>, beanDefinition); <span class=\"comment\">// 加入到map中</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>配置类的注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@Import(&#123;MyImportBeanDefinitionRegistrar.class, Dog.class,Cat.class&#125;)</span></span><br></pre></td></tr></table></figure>\n\n<p>测试类的输出结果</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">输出结果：</span><br><span class=\"line\">IOC 容器创建完成...</span><br><span class=\"line\">org.springframework.context.annotation.internalConfigurationAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.annotation.internalAutowiredAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.annotation.internalCommonAnnotationProcessor</span><br><span class=\"line\">org.springframework.context.event.internalEventListenerProcessor</span><br><span class=\"line\">org.springframework.context.event.internalEventListenerFactory</span><br><span class=\"line\">testConfigCap6</span><br><span class=\"line\">com.example.cap6.bean.Dog</span><br><span class=\"line\">com.example.cap6.bean.Cat</span><br><span class=\"line\">pig</span><br></pre></td></tr></table></figure>\n\n<p>可以看出，@Import注解中的导入顺序，并未影响注册器的逻辑。可能是直接导入的优先级更高？</p>\n<h3 id=\"FactoryBean\"><a href=\"#FactoryBean\" class=\"headerlink\" title=\"@FactoryBean\"></a>@FactoryBean</h3><p>使用Spring提供的FactoryBean（工厂Bean）进行注册。</p>\n<p>创建工厂类，实现FactoryBean接口。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyFactoryBean</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">FactoryBean</span>&lt;Pig&gt; &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Pig <span class=\"title function_\">getObject</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Pig</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Pig.class;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isSingleton</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>配置类的注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@Import(&#123;MyFactoryBean.class&#125;)</span></span><br></pre></td></tr></table></figure>\n\n<p>或者按原始的方法写。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestConfigCap6</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> MyFactoryBean <span class=\"title function_\">myFactoryBean</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MyFactoryBean</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test01</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">ApplicationContext</span> <span class=\"variable\">app</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AnnotationConfigApplicationContext</span>(TestConfigCap6.class);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;IOC 容器创建完成...&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">Object</span> <span class=\"variable\">bean</span> <span class=\"operator\">=</span> app.getBean(<span class=\"string\">&quot;com.example.cap6.config.MyFactoryBean&quot;</span>);</span><br><span class=\"line\">    System.out.println(bean.getClass());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>app.getBeanDefinitionNames()方法获取的BeanID，叫做MyFactoryBean而不是Pig。但实际上其对应的Bean就是Pig的一个实例。</p>\n<h3 id=\"Value赋值\"><a href=\"#Value赋值\" class=\"headerlink\" title=\"@Value赋值\"></a>@Value赋值</h3><h4 id=\"使用bean-xml配置文件进行赋值\"><a href=\"#使用bean-xml配置文件进行赋值\" class=\"headerlink\" title=\"使用bean.xml配置文件进行赋值\"></a>使用bean.xml配置文件进行赋值</h4><p>property标签</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;bird&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;com.example.cap8.bean.Bird&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;crow&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;10&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"使用-Value注解赋值\"><a href=\"#使用-Value注解赋值\" class=\"headerlink\" title=\"使用@Value注解赋值\"></a>使用@Value注解赋值</h4><p>@Value注解有3种赋值方式：</p>\n<ul>\n<li>字符串</li>\n<li>SpringEL表达式</li>\n<li>properties文件</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Bird</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;sparrow&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;#&#123;1+2&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;bird.color&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String color;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用properties文件时，需要在配置类中指定properties文件的路径</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@PropertySource(&quot;classpath:/test.properties&quot;)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Autowired\"><a href=\"#Autowired\" class=\"headerlink\" title=\"@Autowired\"></a>@Autowired</h3><p>自动装配。Spring利用依赖注入（DI），完成对IOC容器中的各个组件的依赖关系赋值。</p>\n<p>@Autowired注解实际上是将 AutowiredAnnotationBeanPostProcessor 注册到IOC容器中。</p>\n<p>例如在 TestService 类中，有一个 TestDao 成员变量，可以用 @AutoWired 注解，自动从IOC容器中找到相应对象进行赋值。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestService</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> TestDao testDao;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Primary\"><a href=\"#Primary\" class=\"headerlink\" title=\"@Primary\"></a>@Primary</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Indicates that a bean should be given preference when multiple candidates</span></span><br><span class=\"line\"><span class=\"comment\"> * are qualified to autowire a single-valued dependency. If exactly one</span></span><br><span class=\"line\"><span class=\"comment\"> * &#x27;primary&#x27; bean exists among the candidates, it will be the autowired value.</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * 当有多个对象能够被自动装配时，拥有<span class=\"doctag\">@Primary</span>注解的Bean应被优先考虑。</span></span><br><span class=\"line\"><span class=\"comment\"> * 如果其中只有一个对象有<span class=\"doctag\">@Primary</span>注解，那么它将被自动装配。</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Primary &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>例如创建了两个TestDao类型的Bean，在为 TestService 自动装配时：</p>\n<p>如果配置类中不指明 @Primary ，则 TestDao 对象会被自动装配；</p>\n<p>如果为 testDaoSub 指明 @Primary ，则 TestDaoSub 对象被自动装配。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ComponentScan(&quot;com.example.cap9&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestConfigCap9</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean(&quot;testDao&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> TestDao <span class=\"title function_\">testDao</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TestDao</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean(&quot;testDaoSub&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> TestDao <span class=\"title function_\">testDaoSub</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TestDaoSub</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Qualifier\"><a href=\"#Qualifier\" class=\"headerlink\" title=\"@Qualifier\"></a>@Qualifier</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * This annotation may be used on a field or parameter as a qualifier for</span></span><br><span class=\"line\"><span class=\"comment\"> * candidate beans when autowiring. It may also be used to annotate other</span></span><br><span class=\"line\"><span class=\"comment\"> * custom annotations that can then in turn be used as qualifiers.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 自动装配时，显式指明需要装配哪个Bean</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Target(&#123;ElementType.FIELD, ElementType.METHOD, ElementType.PARAMETER, ElementType.TYPE, ElementType.ANNOTATION_TYPE&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Inherited</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Qualifier &#123;</span><br><span class=\"line\">\tString <span class=\"title function_\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>例如在 TestService 类中，显式指明 TestDao 成员需要装配哪个Bean。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Qualifier(&quot;testDaoSub&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> TestDao testDao;</span><br></pre></td></tr></table></figure>\n\n<p>@Qualifier 优先级比 @Primary 更高。</p>\n<p>@Qualifier 可用来消除依赖注入冲突，在需要注入的类中使用；@Primary 适合定义默认注入的类，给被注入的类使用。</p>\n<h4 id=\"Resource\"><a href=\"#Resource\" class=\"headerlink\" title=\"@Resource\"></a>@Resource</h4><p>自动注入的另一种方式，和 @Autowired 类似。</p>\n<p>@Autowired 的自动装配，默认按byType，如果有多个同类型的bean，则按byName。另外可以结合@Qualifier按指定的byName注入。</p>\n<p>@Resource 注解中较为重要的两个个属性是 name 和 type。分别指定将装配Bean的名字和类型。如果都不指定，则按byType。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Resource(name = &quot;testDaoSub&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> TestDao testDao;</span><br></pre></td></tr></table></figure>\n\n<p>另外需要注意的是，使用@Resource 时无法使用 @Primary 指定优先级。</p>\n<h4 id=\"Inject\"><a href=\"#Inject\" class=\"headerlink\" title=\"@Inject\"></a>@Inject</h4><p>和 @Autowired 注解的功能基本一样。区别在于 @Inject 没有require属性，不能指明是否强制需要注入。</p>\n<p>使用时需要引入对应的包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.inject<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.inject<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Inject</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> TestDao testDao;</span><br></pre></td></tr></table></figure>\n\n<p>可以配合 @Primary 使用</p>\n<h4 id=\"不建议使用变量方式注入的原因\"><a href=\"#不建议使用变量方式注入的原因\" class=\"headerlink\" title=\"不建议使用变量方式注入的原因\"></a>不建议使用变量方式注入的原因</h4><p>@Autowired 依赖注入有三种方式：</p>\n<ul>\n<li>变量（field）注入</li>\n<li>构造器注入</li>\n<li>set方法注入</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 变量（field）注入</span></span><br><span class=\"line\"><span class=\"comment\">// 变量方式注入非常简洁，没有任何多余代码，但是没有有效地指明依赖</span></span><br><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> UserDao userDao;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 构造器注入</span></span><br><span class=\"line\"><span class=\"comment\">// 表示依赖必须注入，否则无法有效实例化</span></span><br><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">UserServiceImpl</span><span class=\"params\">(UserDao useDao)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.userDao = userDao;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// set方法注入</span></span><br><span class=\"line\"><span class=\"comment\">// 表示这是一种选择注入，可有可无</span></span><br><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setUserDao</span> <span class=\"params\">(UserDao userDao)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.userDao = userDao;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>既然使用了依赖注入方式，那么就表明这个类不再对这些依赖负责，这些都由容器管理，那么如何清楚的知道这个类需要哪些依赖。就需要使用set方法方式注入或者构造器注入来区分。</p>\n<p>故变量方式注入应该尽量避免，而应使用set方式注入或者构造器注入，这两种方式的选择就要看这个类是强制依赖，若强制就用构造器方式，若不强制就用set方法注入。</p>\n","categories":["Spring"],"tags":["Java"]},{"title":"Spring的声明式事务","url":"/%E7%AC%94%E8%AE%B0/Java/Spring/Spring%E7%9A%84%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1/","content":"<h2 id=\"声明式事务\"><a href=\"#声明式事务\" class=\"headerlink\" title=\"声明式事务\"></a>声明式事务</h2><p>声明，就是指在配置文件中声明是否需要Spring管理事务。好处是事务管理不侵入开发的组件。</p>\n<p>事务是恢复和并发控制的基本单位。</p>\n<p>事务特性主要有四个，被称为ACID特性：</p>\n<ul>\n<li>Atomicity ，原子性。一个事务是一个不可分割的工作单位，事务中操作要么都做，要么都不做。</li>\n<li>Consistency ，一致性。事务必须是使数据库从一个有效状态变到另一个有效状态。整个事务对数据处理是正确的。与原子性密切相关。</li>\n<li>Isolation ，独立性。一个事务的执行不能被其他事务干扰。</li>\n<li>Durability ，持久性。事务一旦提交，对数据的改变就是持久的。</li>\n</ul>\n<h2 id=\"Hello-World\"><a href=\"#Hello-World\" class=\"headerlink\" title=\"Hello World\"></a>Hello World</h2><p>创建OrderDao、OrderService类，向数据库中写入一条记录。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Repository</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OrderDao</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> JdbcTemplate jdbcTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">OrderDao</span><span class=\"params\">(JdbcTemplate jdbcTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">insert</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">sql</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;insert into `order` (ordertime, ordermoney, orderstatus) value (?,?,?)&quot;</span>;</span><br><span class=\"line\">        jdbcTemplate.update(sql, <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(), <span class=\"number\">20</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OrderService</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> OrderDao orderDao;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">OrderService</span><span class=\"params\">(OrderDao orderDao)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.orderDao = orderDao;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Transactional</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">addOrder</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        orderDao.insert();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;addOrder successfully!&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// int a = 1 / 0; 生成异常，用来测试事务回滚</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>配置类引入组件，设置好数据库参数、JDBC模板和事务管理器。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan(&quot;com.example.cap11&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@EnableTransactionManagement</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestConfigCap11</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> TransactionManager <span class=\"title function_\">transactionManager</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> PropertyVetoException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DataSourceTransactionManager</span>(dataSource());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DataSource <span class=\"title function_\">dataSource</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> PropertyVetoException &#123;</span><br><span class=\"line\">        <span class=\"type\">ComboPooledDataSource</span> <span class=\"variable\">dataSource</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ComboPooledDataSource</span>();</span><br><span class=\"line\">        dataSource.setUser(<span class=\"string\">&quot;root&quot;</span>);</span><br><span class=\"line\">        dataSource.setPassword(<span class=\"string\">&quot;aaa972666122&quot;</span>);</span><br><span class=\"line\">        dataSource.setDriverClass(<span class=\"string\">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class=\"line\">        dataSource.setJdbcUrl(<span class=\"string\">&quot;jdbc:mysql://localhost:3306/spring&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dataSource;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> JdbcTemplate <span class=\"title function_\">jdbcTemplate</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> PropertyVetoException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JdbcTemplate</span>(dataSource());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>测试类获取Service对象，执行操作。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test01</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">AnnotationConfigApplicationContext</span> <span class=\"variable\">app</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AnnotationConfigApplicationContext</span>(TestConfigCap11.class);</span><br><span class=\"line\">    <span class=\"type\">OrderService</span> <span class=\"variable\">bean</span> <span class=\"operator\">=</span> app.getBean(OrderService.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    bean.addOrder();</span><br><span class=\"line\"></span><br><span class=\"line\">    app.close();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Spring声明式事务流程\"><a href=\"#Spring声明式事务流程\" class=\"headerlink\" title=\"Spring声明式事务流程\"></a>Spring声明式事务流程</h2><h3 id=\"代理创建器类\"><a href=\"#代理创建器类\" class=\"headerlink\" title=\"代理创建器类\"></a>代理创建器类</h3><p>在AOP中，声明了注解 @EnableAspectJAutoProxy ，用来注册 AnnotationAwareAspectJAutoProxyCreator 类。</p>\n<p>同样地，在声明式事务中，声明了注解 @EnableTransactionManagement ，引入了 TransactionManagementConfigurationSelector.class ，注册了 <strong>InfrastructureAdvisorAutoProxyCreator</strong> 类。</p>\n<p>InfrastructureAdvisorAutoProxyCreator 类的关系图如下，</p>\n<img src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjcxMHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTI4NXB4O2hlaWdodDo3MTBweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjg1IDcxMCIgd2lkdGg9IjEyODVweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbGFzcyBBd2FyZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJBd2FyZSIgZGF0YS1zb3VyY2UtbGluZT0iMSIgZGF0YS11aWQ9ImVudDAwMDIiIGlkPSJlbnRpdHlfQXdhcmUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijc1Ljk3NTYiIHg9IjE1OS4wNSIgeT0iMTE1Ii8+PGVsbGlwc2UgY3g9IjE3NC4wNSIgY3k9IjEzMSIgZmlsbD0iI0I0QTdFNSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMTY5Ljk3MTksMTI2Ljc2NTYgTDE2OS45NzE5LDEyNC42MDk0IEwxNzcuMzYyNSwxMjQuNjA5NCBMMTc3LjM2MjUsMTI2Ljc2NTYgTDE3NC44OTM4LDEyNi43NjU2IEwxNzQuODkzOCwxMzQuODQzOCBMMTc3LjM2MjUsMTM0Ljg0MzggTDE3Ny4zNjI1LDEzNyBMMTY5Ljk3MTksMTM3IEwxNjkuOTcxOSwxMzQuODQzOCBMMTcyLjQ0MDYsMTM0Ljg0MzggTDE3Mi40NDA2LDEyNi43NjU2IEwxNjkuOTcxOSwxMjYuNzY1NiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXN0eWxlPSJpdGFsaWMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDMuOTc1NiIgeD0iMTg4LjA1IiB5PSIxMzUuODQ2NyI+QXdhcmU8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTYwLjA1IiB4Mj0iMjM0LjAyNTYiIHkxPSIxNDciIHkyPSIxNDciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNjAuMDUiIHgyPSIyMzQuMDI1NiIgeTE9IjE1NSIgeTI9IjE1NSIvPjwvZz48IS0tY2xhc3MgQmVhbkZhY3RvcnlBd2FyZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJCZWFuRmFjdG9yeUF3YXJlIiBkYXRhLXNvdXJjZS1saW5lPSIyIiBkYXRhLXVpZD0iZW50MDAwMyIgaWQ9ImVudGl0eV9CZWFuRmFjdG9yeUF3YXJlIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjQuMDcwMyIgeD0iNyIgeT0iMjIzIi8+PGVsbGlwc2UgY3g9IjIyIiBjeT0iMjM5IiBmaWxsPSIjQjRBN0U1IiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0xNy45MjE5LDIzNC43NjU2IEwxNy45MjE5LDIzMi42MDk0IEwyNS4zMTI1LDIzMi42MDk0IEwyNS4zMTI1LDIzNC43NjU2IEwyMi44NDM4LDIzNC43NjU2IEwyMi44NDM4LDI0Mi44NDM4IEwyNS4zMTI1LDI0Mi44NDM4IEwyNS4zMTI1LDI0NSBMMTcuOTIxOSwyNDUgTDE3LjkyMTksMjQyLjg0MzggTDIwLjM5MDYsMjQyLjg0MzggTDIwLjM5MDYsMjM0Ljc2NTYgTDE3LjkyMTksMjM0Ljc2NTYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMi4wNzAzIiB4PSIzNiIgeT0iMjQzLjg0NjciPkJlYW5GYWN0b3J5QXdhcmU8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOCIgeDI9IjE3MC4wNzAzIiB5MT0iMjU1IiB5Mj0iMjU1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOCIgeDI9IjE3MC4wNzAzIiB5MT0iMjYzIiB5Mj0iMjYzIi8+PC9nPjwhLS1jbGFzcyBCZWFuQ2xhc3NMb2FkZXJBd2FyZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJCZWFuQ2xhc3NMb2FkZXJBd2FyZSIgZGF0YS1zb3VyY2UtbGluZT0iMyIgZGF0YS11aWQ9ImVudDAwMDQiIGlkPSJlbnRpdHlfQmVhbkNsYXNzTG9hZGVyQXdhcmUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE5Ni42Nzc3IiB4PSIyMDUuNyIgeT0iMjIzIi8+PGVsbGlwc2UgY3g9IjIyMC43IiBjeT0iMjM5IiBmaWxsPSIjQjRBN0U1IiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0yMTYuNjIxOSwyMzQuNzY1NiBMMjE2LjYyMTksMjMyLjYwOTQgTDIyNC4wMTI1LDIzMi42MDk0IEwyMjQuMDEyNSwyMzQuNzY1NiBMMjIxLjU0MzgsMjM0Ljc2NTYgTDIyMS41NDM4LDI0Mi44NDM4IEwyMjQuMDEyNSwyNDIuODQzOCBMMjI0LjAxMjUsMjQ1IEwyMTYuNjIxOSwyNDUgTDIxNi42MjE5LDI0Mi44NDM4IEwyMTkuMDkwNiwyNDIuODQzOCBMMjE5LjA5MDYsMjM0Ljc2NTYgTDIxNi42MjE5LDIzNC43NjU2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjQuNjc3NyIgeD0iMjM0LjciIHk9IjI0My44NDY3Ij5CZWFuQ2xhc3NMb2FkZXJBd2FyZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMDYuNyIgeDI9IjQwMS4zNzc3IiB5MT0iMjU1IiB5Mj0iMjU1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjA2LjciIHgyPSI0MDEuMzc3NyIgeTE9IjI2MyIgeTI9IjI2MyIvPjwvZz48IS0tY2xhc3MgQmVhblBvc3RQcm9jZXNzb3ItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQmVhblBvc3RQcm9jZXNzb3IiIGRhdGEtc291cmNlLWxpbmU9IjQiIGRhdGEtdWlkPSJlbnQwMDA1IiBpZD0iZW50aXR5X0JlYW5Qb3N0UHJvY2Vzc29yIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjUuNDQ0MyIgeD0iNTI0LjMxIiB5PSI3Ii8+PGVsbGlwc2UgY3g9IjUzOS4zMSIgY3k9IjIzIiBmaWxsPSIjQjRBN0U1IiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik01MzUuMjMxOSwxOC43NjU2IEw1MzUuMjMxOSwxNi42MDk0IEw1NDIuNjIyNSwxNi42MDk0IEw1NDIuNjIyNSwxOC43NjU2IEw1NDAuMTUzOCwxOC43NjU2IEw1NDAuMTUzOCwyNi44NDM4IEw1NDIuNjIyNSwyNi44NDM4IEw1NDIuNjIyNSwyOSBMNTM1LjIzMTksMjkgTDUzNS4yMzE5LDI2Ljg0MzggTDUzNy43MDA2LDI2Ljg0MzggTDUzNy43MDA2LDE4Ljc2NTYgTDUzNS4yMzE5LDE4Ljc2NTYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMy40NDQzIiB4PSI1NTMuMzEiIHk9IjI3Ljg0NjciPkJlYW5Qb3N0UHJvY2Vzc29yPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjUyNS4zMSIgeDI9IjY4OC43NTQzIiB5MT0iMzkiIHkyPSIzOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjUyNS4zMSIgeDI9IjY4OC43NTQzIiB5MT0iNDciIHkyPSI0NyIvPjwvZz48IS0tY2xhc3MgSW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3ItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iSW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3IiIGRhdGEtc291cmNlLWxpbmU9IjUiIGRhdGEtdWlkPSJlbnQwMDA2IiBpZD0iZW50aXR5X0luc3RhbnRpYXRpb25Bd2FyZUJlYW5Qb3N0UHJvY2Vzc29yIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyOTcuNDMyNiIgeD0iNDU4LjMyIiB5PSIxMTUiLz48ZWxsaXBzZSBjeD0iNDczLjMyIiBjeT0iMTMxIiBmaWxsPSIjQjRBN0U1IiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik00NjkuMjQxOSwxMjYuNzY1NiBMNDY5LjI0MTksMTI0LjYwOTQgTDQ3Ni42MzI1LDEyNC42MDk0IEw0NzYuNjMyNSwxMjYuNzY1NiBMNDc0LjE2MzgsMTI2Ljc2NTYgTDQ3NC4xNjM4LDEzNC44NDM4IEw0NzYuNjMyNSwxMzQuODQzOCBMNDc2LjYzMjUsMTM3IEw0NjkuMjQxOSwxMzcgTDQ2OS4yNDE5LDEzNC44NDM4IEw0NzEuNzEwNiwxMzQuODQzOCBMNDcxLjcxMDYsMTI2Ljc2NTYgTDQ2OS4yNDE5LDEyNi43NjU2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNjUuNDMyNiIgeD0iNDg3LjMyIiB5PSIxMzUuODQ2NyI+SW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3I8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDU5LjMyIiB4Mj0iNzU0Ljc1MjYiIHkxPSIxNDciIHkyPSIxNDciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0NTkuMzIiIHgyPSI3NTQuNzUyNiIgeTE9IjE1NSIgeTI9IjE1NSIvPjwvZz48IS0tY2xhc3MgU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3Nvci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJTbWFydEluc3RhbnRpYXRpb25Bd2FyZUJlYW5Qb3N0UHJvY2Vzc29yIiBkYXRhLXNvdXJjZS1saW5lPSI2IiBkYXRhLXVpZD0iZW50MDAwNyIgaWQ9ImVudGl0eV9TbWFydEluc3RhbnRpYXRpb25Bd2FyZUJlYW5Qb3N0UHJvY2Vzc29yIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIzMzkuNzgxMyIgeD0iNDM3LjE0IiB5PSIyMjMiLz48ZWxsaXBzZSBjeD0iNDUyLjE0IiBjeT0iMjM5IiBmaWxsPSIjQjRBN0U1IiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik00NDguMDYxOSwyMzQuNzY1NiBMNDQ4LjA2MTksMjMyLjYwOTQgTDQ1NS40NTI1LDIzMi42MDk0IEw0NTUuNDUyNSwyMzQuNzY1NiBMNDUyLjk4MzgsMjM0Ljc2NTYgTDQ1Mi45ODM4LDI0Mi44NDM4IEw0NTUuNDUyNSwyNDIuODQzOCBMNDU1LjQ1MjUsMjQ1IEw0NDguMDYxOSwyNDUgTDQ0OC4wNjE5LDI0Mi44NDM4IEw0NTAuNTMwNiwyNDIuODQzOCBMNDUwLjUzMDYsMjM0Ljc2NTYgTDQ0OC4wNjE5LDIzNC43NjU2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMDcuNzgxMyIgeD0iNDY2LjE0IiB5PSIyNDMuODQ2NyI+U21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvcjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0MzguMTQiIHgyPSI3NzUuOTIxMyIgeTE9IjI1NSIgeTI9IjI1NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQzOC4xNCIgeDI9Ijc3NS45MjEzIiB5MT0iMjYzIiB5Mj0iMjYzIi8+PC9nPjwhLS1jbGFzcyBTZXJpYWxpemFibGUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iU2VyaWFsaXphYmxlIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBkYXRhLXVpZD0iZW50MDAwOCIgaWQ9ImVudGl0eV9TZXJpYWxpemFibGUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExMi44MjEzIiB4PSI4MTMuNjIiIHk9IjExNSIvPjxlbGxpcHNlIGN4PSI4MjguNjIiIGN5PSIxMzEiIGZpbGw9IiNCNEE3RTUiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTgyNC41NDE5LDEyNi43NjU2IEw4MjQuNTQxOSwxMjQuNjA5NCBMODMxLjkzMjUsMTI0LjYwOTQgTDgzMS45MzI1LDEyNi43NjU2IEw4MjkuNDYzOCwxMjYuNzY1NiBMODI5LjQ2MzgsMTM0Ljg0MzggTDgzMS45MzI1LDEzNC44NDM4IEw4MzEuOTMyNSwxMzcgTDgyNC41NDE5LDEzNyBMODI0LjU0MTksMTM0Ljg0MzggTDgyNy4wMTA2LDEzNC44NDM4IEw4MjcuMDEwNiwxMjYuNzY1NiBMODI0LjU0MTksMTI2Ljc2NTYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgwLjgyMTMiIHg9Ijg0Mi42MiIgeT0iMTM1Ljg0NjciPlNlcmlhbGl6YWJsZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4MTQuNjIiIHgyPSI5MjUuNDQxMyIgeTE9IjE0NyIgeTI9IjE0NyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjgxNC42MiIgeDI9IjkyNS40NDEzIiB5MT0iMTU1IiB5Mj0iMTU1Ii8+PC9nPjwhLS1jbGFzcyBQcm94eUNvbmZpZy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJQcm94eUNvbmZpZyIgZGF0YS1zb3VyY2UtbGluZT0iOCIgZGF0YS11aWQ9ImVudDAwMDkiIGlkPSJlbnRpdHlfUHJveHlDb25maWciPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExNi4yNTI5IiB4PSI4MTEuOTEiIHk9IjIyMyIvPjxlbGxpcHNlIGN4PSI4MjYuOTEiIGN5PSIyMzkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTgyOS44Nzg4LDI0NC42NDA2IFE4MjkuMzAwNiwyNDQuOTM3NSA4MjguNjYsMjQ1LjA3ODEgUTgyOC4wMTk0LDI0NS4yMzQ0IDgyNy4zMTYzLDI0NS4yMzQ0IFE4MjQuODE2MywyNDUuMjM0NCA4MjMuNDg4MSwyNDMuNTkzOCBRODIyLjE3NTYsMjQxLjkzNzUgODIyLjE3NTYsMjM4LjgxMjUgUTgyMi4xNzU2LDIzNS42ODc1IDgyMy40ODgxLDIzNC4wMzEzIFE4MjQuODE2MywyMzIuMzc1IDgyNy4zMTYzLDIzMi4zNzUgUTgyOC4wMTk0LDIzMi4zNzUgODI4LjY2LDIzMi41MzEzIFE4MjkuMzE2MywyMzIuNjg3NSA4MjkuODc4OCwyMzIuOTg0NCBMODI5Ljg3ODgsMjM1LjcwMzEgUTgyOS4yNTM4LDIzNS4xMjUgODI4LjY2LDIzNC44NTk0IFE4MjguMDY2MywyMzQuNTc4MSA4MjcuNDQxMywyMzQuNTc4MSBRODI2LjA5NzUsMjM0LjU3ODEgODI1LjQxLDIzNS42NTYzIFE4MjQuNzIyNSwyMzYuNzE4OCA4MjQuNzIyNSwyMzguODEyNSBRODI0LjcyMjUsMjQwLjkwNjMgODI1LjQxLDI0MS45ODQ0IFE4MjYuMDk3NSwyNDMuMDQ2OSA4MjcuNDQxMywyNDMuMDQ2OSBRODI4LjA2NjMsMjQzLjA0NjkgODI4LjY2LDI0Mi43ODEzIFE4MjkuMjUzOCwyNDIuNSA4MjkuODc4OCwyNDEuOTIxOSBMODI5Ljg3ODgsMjQ0LjY0MDYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4NC4yNTI5IiB4PSI4NDAuOTEiIHk9IjI0My44NDY3Ij5Qcm94eUNvbmZpZzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4MTIuOTEiIHgyPSI5MjcuMTYyOSIgeTE9IjI1NSIgeTI9IjI1NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjgxMi45MSIgeDI9IjkyNy4xNjI5IiB5MT0iMjYzIiB5Mj0iMjYzIi8+PC9nPjwhLS1jbGFzcyBBb3BJbmZyYXN0cnVjdHVyZUJlYW4tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQW9wSW5mcmFzdHJ1Y3R1cmVCZWFuIiBkYXRhLXNvdXJjZS1saW5lPSI5IiBkYXRhLXVpZD0iZW50MDAxMCIgaWQ9ImVudGl0eV9Bb3BJbmZyYXN0cnVjdHVyZUJlYW4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE5MC44MDU3IiB4PSI5NjMuNjMiIHk9IjIyMyIvPjxlbGxpcHNlIGN4PSI5NzguNjMiIGN5PSIyMzkiIGZpbGw9IiNCNEE3RTUiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTk3NC41NTE5LDIzNC43NjU2IEw5NzQuNTUxOSwyMzIuNjA5NCBMOTgxLjk0MjUsMjMyLjYwOTQgTDk4MS45NDI1LDIzNC43NjU2IEw5NzkuNDczOCwyMzQuNzY1NiBMOTc5LjQ3MzgsMjQyLjg0MzggTDk4MS45NDI1LDI0Mi44NDM4IEw5ODEuOTQyNSwyNDUgTDk3NC41NTE5LDI0NSBMOTc0LjU1MTksMjQyLjg0MzggTDk3Ny4wMjA2LDI0Mi44NDM4IEw5NzcuMDIwNiwyMzQuNzY1NiBMOTc0LjU1MTksMjM0Ljc2NTYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OC44MDU3IiB4PSI5OTIuNjMiIHk9IjI0My44NDY3Ij5Bb3BJbmZyYXN0cnVjdHVyZUJlYW48L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOTY0LjYzIiB4Mj0iMTE1My40MzU3IiB5MT0iMjU1IiB5Mj0iMjU1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOTY0LjYzIiB4Mj0iMTE1My40MzU3IiB5MT0iMjYzIiB5Mj0iMjYzIi8+PC9nPjwhLS1jbGFzcyBPcmRlcmVkLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ik9yZGVyZWQiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBkYXRhLXVpZD0iZW50MDAxMSIgaWQ9ImVudGl0eV9PcmRlcmVkIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4OS41MzEzIiB4PSIxMTg5LjI3IiB5PSIyMjMiLz48ZWxsaXBzZSBjeD0iMTIwNC4yNyIgY3k9IjIzOSIgZmlsbD0iI0I0QTdFNSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMTIwMC4xOTE5LDIzNC43NjU2IEwxMjAwLjE5MTksMjMyLjYwOTQgTDEyMDcuNTgyNSwyMzIuNjA5NCBMMTIwNy41ODI1LDIzNC43NjU2IEwxMjA1LjExMzgsMjM0Ljc2NTYgTDEyMDUuMTEzOCwyNDIuODQzOCBMMTIwNy41ODI1LDI0Mi44NDM4IEwxMjA3LjU4MjUsMjQ1IEwxMjAwLjE5MTksMjQ1IEwxMjAwLjE5MTksMjQyLjg0MzggTDEyMDIuNjYwNiwyNDIuODQzOCBMMTIwMi42NjA2LDIzNC43NjU2IEwxMjAwLjE5MTksMjM0Ljc2NTYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU3LjUzMTMiIHg9IjEyMTguMjciIHk9IjI0My44NDY3Ij5PcmRlcmVkPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjExOTAuMjciIHgyPSIxMjc3LjgwMTMiIHkxPSIyNTUiIHkyPSIyNTUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMTkwLjI3IiB4Mj0iMTI3Ny44MDEzIiB5MT0iMjYzIiB5Mj0iMjYzIi8+PC9nPjwhLS1jbGFzcyBBYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3ItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yIiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgZGF0YS11aWQ9ImVudDAwMTIiIGlkPSJlbnRpdHlfQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMTUuMTQxNiIgeD0iNjMwLjQ2IiB5PSIzMzEiLz48ZWxsaXBzZSBjeD0iNjQ1LjQ2IiBjeT0iMzQ3IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik02NDguNDI4OCwzNTIuNjQwNiBRNjQ3Ljg1MDYsMzUyLjkzNzUgNjQ3LjIxLDM1My4wNzgxIFE2NDYuNTY5NCwzNTMuMjM0NCA2NDUuODY2MywzNTMuMjM0NCBRNjQzLjM2NjMsMzUzLjIzNDQgNjQyLjAzODEsMzUxLjU5MzggUTY0MC43MjU2LDM0OS45Mzc1IDY0MC43MjU2LDM0Ni44MTI1IFE2NDAuNzI1NiwzNDMuNjg3NSA2NDIuMDM4MSwzNDIuMDMxMyBRNjQzLjM2NjMsMzQwLjM3NSA2NDUuODY2MywzNDAuMzc1IFE2NDYuNTY5NCwzNDAuMzc1IDY0Ny4yMSwzNDAuNTMxMyBRNjQ3Ljg2NjMsMzQwLjY4NzUgNjQ4LjQyODgsMzQwLjk4NDQgTDY0OC40Mjg4LDM0My43MDMxIFE2NDcuODAzOCwzNDMuMTI1IDY0Ny4yMSwzNDIuODU5NCBRNjQ2LjYxNjMsMzQyLjU3ODEgNjQ1Ljk5MTMsMzQyLjU3ODEgUTY0NC42NDc1LDM0Mi41NzgxIDY0My45NiwzNDMuNjU2MyBRNjQzLjI3MjUsMzQ0LjcxODggNjQzLjI3MjUsMzQ2LjgxMjUgUTY0My4yNzI1LDM0OC45MDYzIDY0My45NiwzNDkuOTg0NCBRNjQ0LjY0NzUsMzUxLjA0NjkgNjQ1Ljk5MTMsMzUxLjA0NjkgUTY0Ni42MTYzLDM1MS4wNDY5IDY0Ny4yMSwzNTAuNzgxMyBRNjQ3LjgwMzgsMzUwLjUgNjQ4LjQyODgsMzQ5LjkyMTkgTDY0OC40Mjg4LDM1Mi42NDA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTgzLjE0MTYiIHg9IjY1OS40NiIgeT0iMzUxLjg0NjciPkFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvcjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2MzEuNDYiIHgyPSI4NDQuNjAxNiIgeTE9IjM2MyIgeTI9IjM2MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjYzMS40NiIgeDI9Ijg0NC42MDE2IiB5MT0iMzcxIiB5Mj0iMzcxIi8+PC9nPjwhLS1jbGFzcyBBYnN0cmFjdEFkdmlzb3JBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkFic3RyYWN0QWR2aXNvckF1dG9Qcm94eUNyZWF0b3IiIGRhdGEtc291cmNlLWxpbmU9IjEyIiBkYXRhLXVpZD0iZW50MDAxMyIgaWQ9ImVudGl0eV9BYnN0cmFjdEFkdmlzb3JBdXRvUHJveHlDcmVhdG9yIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyNjcuMzk1NSIgeD0iNjA0LjM0IiB5PSI0MzkiLz48ZWxsaXBzZSBjeD0iNjE5LjM0IiBjeT0iNDU1IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik02MjIuMzA4OCw0NjAuNjQwNiBRNjIxLjczMDYsNDYwLjkzNzUgNjIxLjA5LDQ2MS4wNzgxIFE2MjAuNDQ5NCw0NjEuMjM0NCA2MTkuNzQ2Myw0NjEuMjM0NCBRNjE3LjI0NjMsNDYxLjIzNDQgNjE1LjkxODEsNDU5LjU5MzggUTYxNC42MDU2LDQ1Ny45Mzc1IDYxNC42MDU2LDQ1NC44MTI1IFE2MTQuNjA1Niw0NTEuNjg3NSA2MTUuOTE4MSw0NTAuMDMxMyBRNjE3LjI0NjMsNDQ4LjM3NSA2MTkuNzQ2Myw0NDguMzc1IFE2MjAuNDQ5NCw0NDguMzc1IDYyMS4wOSw0NDguNTMxMyBRNjIxLjc0NjMsNDQ4LjY4NzUgNjIyLjMwODgsNDQ4Ljk4NDQgTDYyMi4zMDg4LDQ1MS43MDMxIFE2MjEuNjgzOCw0NTEuMTI1IDYyMS4wOSw0NTAuODU5NCBRNjIwLjQ5NjMsNDUwLjU3ODEgNjE5Ljg3MTMsNDUwLjU3ODEgUTYxOC41Mjc1LDQ1MC41NzgxIDYxNy44NCw0NTEuNjU2MyBRNjE3LjE1MjUsNDUyLjcxODggNjE3LjE1MjUsNDU0LjgxMjUgUTYxNy4xNTI1LDQ1Ni45MDYzIDYxNy44NCw0NTcuOTg0NCBRNjE4LjUyNzUsNDU5LjA0NjkgNjE5Ljg3MTMsNDU5LjA0NjkgUTYyMC40OTYzLDQ1OS4wNDY5IDYyMS4wOSw0NTguNzgxMyBRNjIxLjY4MzgsNDU4LjUgNjIyLjMwODgsNDU3LjkyMTkgTDYyMi4zMDg4LDQ2MC42NDA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjM1LjM5NTUiIHg9IjYzMy4zNCIgeT0iNDU5Ljg0NjciPkFic3RyYWN0QWR2aXNvckF1dG9Qcm94eUNyZWF0b3I8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNjA1LjM0IiB4Mj0iODcwLjczNTUiIHkxPSI0NzEiIHkyPSI0NzEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2MDUuMzQiIHgyPSI4NzAuNzM1NSIgeTE9IjQ3OSIgeTI9IjQ3OSIvPjwvZz48IS0tY2xhc3MgQXNwZWN0SkF3YXJlQXV0b1Byb3h5Q3JlYXRvci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJBc3BlY3RKQXdhcmVBdXRvUHJveHlDcmVhdG9yIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgZGF0YS11aWQ9ImVudDAwMTQiIGlkPSJlbnRpdHlfQXNwZWN0SkF3YXJlQXV0b1Byb3h5Q3JlYXRvciI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0OCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjUyLjAzNTIiIHg9IjQ1Ni4wMiIgeT0iNTQ3Ii8+PGVsbGlwc2UgY3g9IjQ3MS4wMiIgY3k9IjU2MyIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNNDczLjk4ODgsNTY4LjY0MDYgUTQ3My40MTA2LDU2OC45Mzc1IDQ3Mi43Nyw1NjkuMDc4MSBRNDcyLjEyOTQsNTY5LjIzNDQgNDcxLjQyNjMsNTY5LjIzNDQgUTQ2OC45MjYzLDU2OS4yMzQ0IDQ2Ny41OTgxLDU2Ny41OTM4IFE0NjYuMjg1Niw1NjUuOTM3NSA0NjYuMjg1Niw1NjIuODEyNSBRNDY2LjI4NTYsNTU5LjY4NzUgNDY3LjU5ODEsNTU4LjAzMTMgUTQ2OC45MjYzLDU1Ni4zNzUgNDcxLjQyNjMsNTU2LjM3NSBRNDcyLjEyOTQsNTU2LjM3NSA0NzIuNzcsNTU2LjUzMTMgUTQ3My40MjYzLDU1Ni42ODc1IDQ3My45ODg4LDU1Ni45ODQ0IEw0NzMuOTg4OCw1NTkuNzAzMSBRNDczLjM2MzgsNTU5LjEyNSA0NzIuNzcsNTU4Ljg1OTQgUTQ3Mi4xNzYzLDU1OC41NzgxIDQ3MS41NTEzLDU1OC41NzgxIFE0NzAuMjA3NSw1NTguNTc4MSA0NjkuNTIsNTU5LjY1NjMgUTQ2OC44MzI1LDU2MC43MTg4IDQ2OC44MzI1LDU2Mi44MTI1IFE0NjguODMyNSw1NjQuOTA2MyA0NjkuNTIsNTY1Ljk4NDQgUTQ3MC4yMDc1LDU2Ny4wNDY5IDQ3MS41NTEzLDU2Ny4wNDY5IFE0NzIuMTc2Myw1NjcuMDQ2OSA0NzIuNzcsNTY2Ljc4MTMgUTQ3My4zNjM4LDU2Ni41IDQ3My45ODg4LDU2NS45MjE5IEw0NzMuOTg4OCw1NjguNjQwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyMC4wMzUyIiB4PSI0ODUuMDIiIHk9IjU2Ny44NDY3Ij5Bc3BlY3RKQXdhcmVBdXRvUHJveHlDcmVhdG9yPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQ1Ny4wMiIgeDI9IjcwNy4wNTUyIiB5MT0iNTc5IiB5Mj0iNTc5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDU3LjAyIiB4Mj0iNzA3LjA1NTIiIHkxPSI1ODciIHkyPSI1ODciLz48L2c+PCEtLWNsYXNzIEFubm90YXRpb25Bd2FyZUFzcGVjdEpBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkFubm90YXRpb25Bd2FyZUFzcGVjdEpBdXRvUHJveHlDcmVhdG9yIiBkYXRhLXNvdXJjZS1saW5lPSIxNCIgZGF0YS11aWQ9ImVudDAwMTUiIGlkPSJlbnRpdHlfQW5ub3RhdGlvbkF3YXJlQXNwZWN0SkF1dG9Qcm94eUNyZWF0b3IiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjMyOC44MDk2IiB4PSI0MTcuNjMiIHk9IjY1NSIvPjxlbGxpcHNlIGN4PSI0MzIuNjMiIGN5PSI2NzEiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTQzNS41OTg4LDY3Ni42NDA2IFE0MzUuMDIwNiw2NzYuOTM3NSA0MzQuMzgsNjc3LjA3ODEgUTQzMy43Mzk0LDY3Ny4yMzQ0IDQzMy4wMzYzLDY3Ny4yMzQ0IFE0MzAuNTM2Myw2NzcuMjM0NCA0MjkuMjA4MSw2NzUuNTkzOCBRNDI3Ljg5NTYsNjczLjkzNzUgNDI3Ljg5NTYsNjcwLjgxMjUgUTQyNy44OTU2LDY2Ny42ODc1IDQyOS4yMDgxLDY2Ni4wMzEzIFE0MzAuNTM2Myw2NjQuMzc1IDQzMy4wMzYzLDY2NC4zNzUgUTQzMy43Mzk0LDY2NC4zNzUgNDM0LjM4LDY2NC41MzEzIFE0MzUuMDM2Myw2NjQuNjg3NSA0MzUuNTk4OCw2NjQuOTg0NCBMNDM1LjU5ODgsNjY3LjcwMzEgUTQzNC45NzM4LDY2Ny4xMjUgNDM0LjM4LDY2Ni44NTk0IFE0MzMuNzg2Myw2NjYuNTc4MSA0MzMuMTYxMyw2NjYuNTc4MSBRNDMxLjgxNzUsNjY2LjU3ODEgNDMxLjEzLDY2Ny42NTYzIFE0MzAuNDQyNSw2NjguNzE4OCA0MzAuNDQyNSw2NzAuODEyNSBRNDMwLjQ0MjUsNjcyLjkwNjMgNDMxLjEzLDY3My45ODQ0IFE0MzEuODE3NSw2NzUuMDQ2OSA0MzMuMTYxMyw2NzUuMDQ2OSBRNDMzLjc4NjMsNjc1LjA0NjkgNDM0LjM4LDY3NC43ODEzIFE0MzQuOTczOCw2NzQuNSA0MzUuNTk4OCw2NzMuOTIxOSBMNDM1LjU5ODgsNjc2LjY0MDYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOTYuODA5NiIgeD0iNDQ2LjYzIiB5PSI2NzUuODQ2NyI+QW5ub3RhdGlvbkF3YXJlQXNwZWN0SkF1dG9Qcm94eUNyZWF0b3I8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDE4LjYzIiB4Mj0iNzQ1LjQzOTYiIHkxPSI2ODciIHkyPSI2ODciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0MTguNjMiIHgyPSI3NDUuNDM5NiIgeTE9IjY5NSIgeTI9IjY5NSIvPjwvZz48IS0tY2xhc3MgSW5mcmFzdHJ1Y3R1cmVBZHZpc29yQXV0b1Byb3h5Q3JlYXRvci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJJbmZyYXN0cnVjdHVyZUFkdmlzb3JBdXRvUHJveHlDcmVhdG9yIiBkYXRhLXNvdXJjZS1saW5lPSIyOCIgZGF0YS11aWQ9ImVudDAwMjkiIGlkPSJlbnRpdHlfSW5mcmFzdHJ1Y3R1cmVBZHZpc29yQXV0b1Byb3h5Q3JlYXRvciI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0OCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMzA0LjczMzQiIHg9Ijc0Mi42NyIgeT0iNTQ3Ii8+PGVsbGlwc2UgY3g9Ijc1Ny42NyIgY3k9IjU2MyIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNNzYwLjYzODgsNTY4LjY0MDYgUTc2MC4wNjA2LDU2OC45Mzc1IDc1OS40Miw1NjkuMDc4MSBRNzU4Ljc3OTQsNTY5LjIzNDQgNzU4LjA3NjMsNTY5LjIzNDQgUTc1NS41NzYzLDU2OS4yMzQ0IDc1NC4yNDgxLDU2Ny41OTM4IFE3NTIuOTM1Niw1NjUuOTM3NSA3NTIuOTM1Niw1NjIuODEyNSBRNzUyLjkzNTYsNTU5LjY4NzUgNzU0LjI0ODEsNTU4LjAzMTMgUTc1NS41NzYzLDU1Ni4zNzUgNzU4LjA3NjMsNTU2LjM3NSBRNzU4Ljc3OTQsNTU2LjM3NSA3NTkuNDIsNTU2LjUzMTMgUTc2MC4wNzYzLDU1Ni42ODc1IDc2MC42Mzg4LDU1Ni45ODQ0IEw3NjAuNjM4OCw1NTkuNzAzMSBRNzYwLjAxMzgsNTU5LjEyNSA3NTkuNDIsNTU4Ljg1OTQgUTc1OC44MjYzLDU1OC41NzgxIDc1OC4yMDEzLDU1OC41NzgxIFE3NTYuODU3NSw1NTguNTc4MSA3NTYuMTcsNTU5LjY1NjMgUTc1NS40ODI1LDU2MC43MTg4IDc1NS40ODI1LDU2Mi44MTI1IFE3NTUuNDgyNSw1NjQuOTA2MyA3NTYuMTcsNTY1Ljk4NDQgUTc1Ni44NTc1LDU2Ny4wNDY5IDc1OC4yMDEzLDU2Ny4wNDY5IFE3NTguODI2Myw1NjcuMDQ2OSA3NTkuNDIsNTY2Ljc4MTMgUTc2MC4wMTM4LDU2Ni41IDc2MC42Mzg4LDU2NS45MjE5IEw3NjAuNjM4OCw1NjguNjQwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI3Mi43MzM0IiB4PSI3NzEuNjciIHk9IjU2Ny44NDY3Ij5JbmZyYXN0cnVjdHVyZUFkdmlzb3JBdXRvUHJveHlDcmVhdG9yPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9Ijc0My42NyIgeDI9IjEwNDYuNDAzNCIgeTE9IjU3OSIgeTI9IjU3OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9Ijc0My42NyIgeDI9IjEwNDYuNDAzNCIgeTE9IjU4NyIgeTI9IjU4NyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIEF3YXJlIHRvIEJlYW5GYWN0b3J5QXdhcmUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iQXdhcmUiIGRhdGEtZW50aXR5LTI9IkJlYW5GYWN0b3J5QXdhcmUiIGRhdGEtc291cmNlLWxpbmU9IjE1IiBkYXRhLXVpZD0ibG5rMTYiIGlkPSJsaW5rX0F3YXJlX0JlYW5GYWN0b3J5QXdhcmUiPjxwYXRoIGNvZGVMaW5lPSIxNSIgZD0iTTE2MC40ODg0LDE3NS44NzMzIEMxNDIuNDg4NCwxOTMuNTUzMyAxMzAuNjcsMjA1LjEzIDExMi42OCwyMjIuNzkiIGZpbGw9Im5vbmUiIGlkPSJBd2FyZS1iYWNrdG8tQmVhbkZhY3RvcnlBd2FyZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iMTczLjMzLDE2My4yNiwxNTYuMjg0LDE3MS41OTI3LDE2NC42OTI5LDE4MC4xNTM4LDE3My4zMywxNjMuMjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBBd2FyZSB0byBCZWFuQ2xhc3NMb2FkZXJBd2FyZS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJBd2FyZSIgZGF0YS1lbnRpdHktMj0iQmVhbkNsYXNzTG9hZGVyQXdhcmUiIGRhdGEtc291cmNlLWxpbmU9IjE2IiBkYXRhLXVpZD0ibG5rMTciIGlkPSJsaW5rX0F3YXJlX0JlYW5DbGFzc0xvYWRlckF3YXJlIj48cGF0aCBjb2RlTGluZT0iMTYiIGQ9Ik0yMzMuMzA1MSwxNzUuOTMwNSBDMjUxLjE0NTEsMTkzLjYxMDUgMjYyLjc4LDIwNS4xMyAyODAuNjEsMjIyLjc5IiBmaWxsPSJub25lIiBpZD0iQXdhcmUtYmFja3RvLUJlYW5DbGFzc0xvYWRlckF3YXJlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0ibm9uZSIgcG9pbnRzPSIyMjAuNTIsMTYzLjI2LDIyOS4wODE2LDE4MC4xOTIyLDIzNy41Mjg2LDE3MS42Njg4LDIyMC41MiwxNjMuMjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBCZWFuUG9zdFByb2Nlc3NvciB0byBJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3Nvci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJCZWFuUG9zdFByb2Nlc3NvciIgZGF0YS1lbnRpdHktMj0iSW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3IiIGRhdGEtc291cmNlLWxpbmU9IjE3IiBkYXRhLXVpZD0ibG5rMTgiIGlkPSJsaW5rX0JlYW5Qb3N0UHJvY2Vzc29yX0luc3RhbnRpYXRpb25Bd2FyZUJlYW5Qb3N0UHJvY2Vzc29yIj48cGF0aCBjb2RlTGluZT0iMTciIGQ9Ik02MDcuMDQsNzMuMjYgQzYwNy4wNCw5MC45NCA2MDcuMDQsOTcuMTMgNjA3LjA0LDExNC43OSIgZmlsbD0ibm9uZSIgaWQ9IkJlYW5Qb3N0UHJvY2Vzc29yLWJhY2t0by1JbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iNjA3LjA0LDU1LjI2LDYwMS4wNCw3My4yNiw2MTMuMDQsNzMuMjYsNjA3LjA0LDU1LjI2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgSW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3IgdG8gU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3Nvci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciIgZGF0YS1lbnRpdHktMj0iU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciIgZGF0YS1zb3VyY2UtbGluZT0iMTgiIGRhdGEtdWlkPSJsbmsxOSIgaWQ9ImxpbmtfSW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3JfU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciI+PHBhdGggY29kZUxpbmU9IjE4IiBkPSJNNjA3LjA0LDE4MS4yNiBDNjA3LjA0LDE5OC45NCA2MDcuMDQsMjA1LjEzIDYwNy4wNCwyMjIuNzkiIGZpbGw9Im5vbmUiIGlkPSJJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3Nvci1iYWNrdG8tU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iNjA3LjA0LDE2My4yNiw2MDEuMDQsMTgxLjI2LDYxMy4wNCwxODEuMjYsNjA3LjA0LDE2My4yNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIFNlcmlhbGl6YWJsZSB0byBQcm94eUNvbmZpZy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJTZXJpYWxpemFibGUiIGRhdGEtZW50aXR5LTI9IlByb3h5Q29uZmlnIiBkYXRhLXNvdXJjZS1saW5lPSIxOSIgZGF0YS11aWQ9ImxuazIwIiBpZD0ibGlua19TZXJpYWxpemFibGVfUHJveHlDb25maWciPjxwYXRoIGNvZGVMaW5lPSIxOSIgZD0iTTg3MC4wNCwxODEuMjYgQzg3MC4wNCwxOTguOTQgODcwLjA0LDIwNS4xMyA4NzAuMDQsMjIyLjc5IiBmaWxsPSJub25lIiBpZD0iU2VyaWFsaXphYmxlLWJhY2t0by1Qcm94eUNvbmZpZyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iODcwLjA0LDE2My4yNiw4NjQuMDQsMTgxLjI2LDg3Ni4wNCwxODEuMjYsODcwLjA0LDE2My4yNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIEJlYW5GYWN0b3J5QXdhcmUgdG8gQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkJlYW5GYWN0b3J5QXdhcmUiIGRhdGEtZW50aXR5LTI9IkFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciIgZGF0YS1zb3VyY2UtbGluZT0iMjAiIGRhdGEtdWlkPSJsbmsyMSIgaWQ9ImxpbmtfQmVhbkZhY3RvcnlBd2FyZV9BYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiPjxwYXRoIGNvZGVMaW5lPSIyMCIgZD0iTTE4OC45MjM2LDI3MS4zMzk4IEMzNDEuNjIzNiwzMDAuNTQ5OCA1MTguOTEsMzI1LjUxIDYzMC4xMSwzNDAuMjYiIGZpbGw9Im5vbmUiIGlkPSJCZWFuRmFjdG9yeUF3YXJlLWJhY2t0by1BYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48cG9seWdvbiBmaWxsPSJub25lIiBwb2ludHM9IjE3MS4zMSwyNjcuNjMsMTg3LjY4NywyNzcuMjEwOSwxOTAuMTYwMiwyNjUuNDY4NiwxNzEuMzEsMjY3LjYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgQmVhbkNsYXNzTG9hZGVyQXdhcmUgdG8gQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkJlYW5DbGFzc0xvYWRlckF3YXJlIiBkYXRhLWVudGl0eS0yPSJBYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiIGRhdGEtc291cmNlLWxpbmU9IjIxIiBkYXRhLXVpZD0ibG5rMjIiIGlkPSJsaW5rX0JlYW5DbGFzc0xvYWRlckF3YXJlX0Fic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciI+PHBhdGggY29kZUxpbmU9IjIxIiBkPSJNNDE3LjU2NjIsMjc1LjczIEM0ODkuNDc2MiwyOTMuMjkgNTY5LjkzLDMxMi45NCA2NDEuODcsMzMwLjUxIiBmaWxsPSJub25lIiBpZD0iQmVhbkNsYXNzTG9hZGVyQXdhcmUtYmFja3RvLUFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iNDAwLjA4LDI3MS40Niw0MTYuMTQyOCwyODEuNTU4OCw0MTguOTg5NSwyNjkuOTAxMyw0MDAuMDgsMjcxLjQ2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciB0byBBYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3ItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iU21hcnRJbnN0YW50aWF0aW9uQXdhcmVCZWFuUG9zdFByb2Nlc3NvciIgZGF0YS1lbnRpdHktMj0iQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yIiBkYXRhLXNvdXJjZS1saW5lPSIyMiIgZGF0YS11aWQ9ImxuazIzIiBpZD0ibGlua19TbWFydEluc3RhbnRpYXRpb25Bd2FyZUJlYW5Qb3N0UHJvY2Vzc29yX0Fic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciI+PHBhdGggY29kZUxpbmU9IjIyIiBkPSJNNjQ5Ljc3MjksMjgyLjU4MjQgQzY3MS42MjI5LDMwMC4yNjI0IDY4Ny41MywzMTMuMTMgNzA5LjM1LDMzMC43OSIgZmlsbD0ibm9uZSIgaWQ9IlNtYXJ0SW5zdGFudGlhdGlvbkF3YXJlQmVhblBvc3RQcm9jZXNzb3ItYmFja3RvLUFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iNjM1Ljc4LDI3MS4yNiw2NDUuOTk4OCwyODcuMjQ2OCw2NTMuNTQ3MSwyNzcuOTE4MSw2MzUuNzgsMjcxLjI2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgUHJveHlDb25maWcgdG8gQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlByb3h5Q29uZmlnIiBkYXRhLWVudGl0eS0yPSJBYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiIGRhdGEtc291cmNlLWxpbmU9IjIzIiBkYXRhLXVpZD0ibG5rMjQiIGlkPSJsaW5rX1Byb3h5Q29uZmlnX0Fic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciI+PHBhdGggY29kZUxpbmU9IjIzIiBkPSJNODI3LjAzNjgsMjgyLjUzMjUgQzgwNS4wMjY4LDMwMC4yMTI1IDc4OC45MywzMTMuMTMgNzY2Ljk0LDMzMC43OSIgZmlsbD0ibm9uZSIgaWQ9IlByb3h5Q29uZmlnLWJhY2t0by1BYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSJub25lIiBwb2ludHM9Ijg0MS4wNywyNzEuMjYsODIzLjI3OTMsMjc3Ljg1NDcsODMwLjc5NDMsMjg3LjIxMDIsODQxLjA3LDI3MS4yNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIEFvcEluZnJhc3RydWN0dXJlQmVhbiB0byBBYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3ItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iQW9wSW5mcmFzdHJ1Y3R1cmVCZWFuIiBkYXRhLWVudGl0eS0yPSJBYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiIGRhdGEtc291cmNlLWxpbmU9IjI0IiBkYXRhLXVpZD0ibG5rMjUiIGlkPSJsaW5rX0FvcEluZnJhc3RydWN0dXJlQmVhbl9BYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiPjxwYXRoIGNvZGVMaW5lPSIyNCIgZD0iTTk3MS4wOTgsMjc3LjAzNDkgQzkxNy44MzgsMjk0LjYyNDkgODYyLjI2LDMxMi45OCA4MDguOTcsMzMwLjU3IiBmaWxsPSJub25lIiBpZD0iQW9wSW5mcmFzdHJ1Y3R1cmVCZWFuLWJhY2t0by1BYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48cG9seWdvbiBmaWxsPSJub25lIiBwb2ludHM9Ijk4OC4xOSwyNzEuMzksOTY5LjIxNjQsMjcxLjMzNzYsOTcyLjk3OTcsMjgyLjczMjIsOTg4LjE5LDI3MS4zOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIE9yZGVyZWQgdG8gQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9Ik9yZGVyZWQiIGRhdGEtZW50aXR5LTI9IkFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciIgZGF0YS1zb3VyY2UtbGluZT0iMjUiIGRhdGEtdWlkPSJsbmsyNiIgaWQ9ImxpbmtfT3JkZXJlZF9BYnN0cmFjdEF1dG9Qcm94eUNyZWF0b3IiPjxwYXRoIGNvZGVMaW5lPSIyNSIgZD0iTTExNzEuOTE2NCwyNzEuNTI4NiBDMTA2Mi4zNjY0LDMwMi4wODg2IDkzNC4yOCwzMjQuNTYgODQ1Ljc1LDMzOC41MSIgZmlsbD0ibm9uZSIgaWQ9Ik9yZGVyZWQtYmFja3RvLUFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iMTE4OC45NSwyNjUuNzEsMTE2OS45NzY5LDI2NS44NTA3LDExNzMuODU1OSwyNzcuMjA2NCwxMTg4Ljk1LDI2NS43MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIEFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciB0byBBYnN0cmFjdEFkdmlzb3JBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkFic3RyYWN0QXV0b1Byb3h5Q3JlYXRvciIgZGF0YS1lbnRpdHktMj0iQWJzdHJhY3RBZHZpc29yQXV0b1Byb3h5Q3JlYXRvciIgZGF0YS1zb3VyY2UtbGluZT0iMjYiIGRhdGEtdWlkPSJsbmsyNyIgaWQ9ImxpbmtfQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yX0Fic3RyYWN0QWR2aXNvckF1dG9Qcm94eUNyZWF0b3IiPjxwYXRoIGNvZGVMaW5lPSIyNiIgZD0iTTczOC4wNCwzOTcuMjYgQzczOC4wNCw0MTQuOTQgNzM4LjA0LDQyMS4xMyA3MzguMDQsNDM4Ljc5IiBmaWxsPSJub25lIiBpZD0iQWJzdHJhY3RBdXRvUHJveHlDcmVhdG9yLWJhY2t0by1BYnN0cmFjdEFkdmlzb3JBdXRvUHJveHlDcmVhdG9yIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0ibm9uZSIgcG9pbnRzPSI3MzguMDQsMzc5LjI2LDczMi4wNCwzOTcuMjYsNzQ0LjA0LDM5Ny4yNiw3MzguMDQsMzc5LjI2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgQWJzdHJhY3RBZHZpc29yQXV0b1Byb3h5Q3JlYXRvciB0byBBc3BlY3RKQXdhcmVBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkFic3RyYWN0QWR2aXNvckF1dG9Qcm94eUNyZWF0b3IiIGRhdGEtZW50aXR5LTI9IkFzcGVjdEpBd2FyZUF1dG9Qcm94eUNyZWF0b3IiIGRhdGEtc291cmNlLWxpbmU9IjI3IiBkYXRhLXVpZD0ibG5rMjgiIGlkPSJsaW5rX0Fic3RyYWN0QWR2aXNvckF1dG9Qcm94eUNyZWF0b3JfQXNwZWN0SkF3YXJlQXV0b1Byb3h5Q3JlYXRvciI+PHBhdGggY29kZUxpbmU9IjI3IiBkPSJNNjg4LjkxMTIsNDk3LjM3NTUgQzY2Mi45OTEyLDUxNC45ODU1IDY0Mi40Myw1MjguOTcgNjE2LjQ2LDU0Ni42MSIgZmlsbD0ibm9uZSIgaWQ9IkFic3RyYWN0QWR2aXNvckF1dG9Qcm94eUNyZWF0b3ItYmFja3RvLUFzcGVjdEpBd2FyZUF1dG9Qcm94eUNyZWF0b3IiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSJub25lIiBwb2ludHM9IjcwMy44LDQ4Ny4yNiw2ODUuNTM5Myw0OTIuNDEyNSw2OTIuMjgzLDUwMi4zMzg0LDcwMy44LDQ4Ny4yNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIEFic3RyYWN0QWR2aXNvckF1dG9Qcm94eUNyZWF0b3IgdG8gSW5mcmFzdHJ1Y3R1cmVBZHZpc29yQXV0b1Byb3h5Q3JlYXRvci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJBYnN0cmFjdEFkdmlzb3JBdXRvUHJveHlDcmVhdG9yIiBkYXRhLWVudGl0eS0yPSJJbmZyYXN0cnVjdHVyZUFkdmlzb3JBdXRvUHJveHlDcmVhdG9yIiBkYXRhLXNvdXJjZS1saW5lPSIyOCIgZGF0YS11aWQ9ImxuazMwIiBpZD0ibGlua19BYnN0cmFjdEFkdmlzb3JBdXRvUHJveHlDcmVhdG9yX0luZnJhc3RydWN0dXJlQWR2aXNvckF1dG9Qcm94eUNyZWF0b3IiPjxwYXRoIGNvZGVMaW5lPSIyOCIgZD0iTTc4Ny40MDk1LDQ5Ny4zMzAyIEM4MTMuNDk5NSw1MTQuOTQwMiA4MzQuMjYsNTI4Ljk3IDg2MC4zOSw1NDYuNjEiIGZpbGw9Im5vbmUiIGlkPSJBYnN0cmFjdEFkdmlzb3JBdXRvUHJveHlDcmVhdG9yLWJhY2t0by1JbmZyYXN0cnVjdHVyZUFkdmlzb3JBdXRvUHJveHlDcmVhdG9yIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0ibm9uZSIgcG9pbnRzPSI3NzIuNDksNDg3LjI2LDc4NC4wNTI3LDUwMi4zMDM0LDc5MC43NjYyLDQ5Mi4zNTcxLDc3Mi40OSw0ODcuMjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBBc3BlY3RKQXdhcmVBdXRvUHJveHlDcmVhdG9yIHRvIEFubm90YXRpb25Bd2FyZUFzcGVjdEpBdXRvUHJveHlDcmVhdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkFzcGVjdEpBd2FyZUF1dG9Qcm94eUNyZWF0b3IiIGRhdGEtZW50aXR5LTI9IkFubm90YXRpb25Bd2FyZUFzcGVjdEpBdXRvUHJveHlDcmVhdG9yIiBkYXRhLXNvdXJjZS1saW5lPSIyOSIgZGF0YS11aWQ9ImxuazMxIiBpZD0ibGlua19Bc3BlY3RKQXdhcmVBdXRvUHJveHlDcmVhdG9yX0Fubm90YXRpb25Bd2FyZUFzcGVjdEpBdXRvUHJveHlDcmVhdG9yIj48cGF0aCBjb2RlTGluZT0iMjkiIGQ9Ik01ODIuMDQsNjEzLjI2IEM1ODIuMDQsNjMwLjk0IDU4Mi4wNCw2MzcuMTMgNTgyLjA0LDY1NC43OSIgZmlsbD0ibm9uZSIgaWQ9IkFzcGVjdEpBd2FyZUF1dG9Qcm94eUNyZWF0b3ItYmFja3RvLUFubm90YXRpb25Bd2FyZUFzcGVjdEpBdXRvUHJveHlDcmVhdG9yIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0ibm9uZSIgcG9pbnRzPSI1ODIuMDQsNTk1LjI2LDU3Ni4wNCw2MTMuMjYsNTg4LjA0LDYxMy4yNiw1ODIuMDQsNTk1LjI2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1TUkM9W2JMRDFKaUNtNEJwdDVWYjAtdTlVR1lNYUxhWEt1V0xSUHVDaTFNLXJ0VzE1RjF1Slh6UHJ1aldTZXZjVHBFb2lqSDdhNVhITXpHU21obEpyLW03MUY4OEl1aWlTakVsMHNZVTIxZGFFRmZBTDh2RDJRdWEzUjYtaVcxNERlaWFDV3FsaWJwVFctVVM4aWVQRVZ5NmZtdk53RExhdnNrVGJId1JMaG02bmZsRlVqMG5NazVWSVV6SzBWc09OM1BqSGVwdXZkamo2dEdqdkZLUG1rdWRYdmJxeEZvY01GUUVJbXYwWEhKNjZ2OVJxUm84YzNzMnJfTHdsZnByNXNBSWVvVk95anNKRDFIbWxMYm5TTTlTUnRNcGtzZWdwVUtRb1l4Y3VjUDVJZW5jUG1CSFZHOTh2VXRPUHpWNEtnbW1qMUtJRTRZVVFtS1VIZkdpa0toV0ZkcElweTlfSElUNTMtRzQwXS0tPjwvZz48L3N2Zz4='>\n\n<p>注册过程也是类似的：</p>\n<img src='data:image/svg+xml;base64,ZXJyb3IgY29kZTogNTIw'>\n\n<blockquote>\n<p>问：这里的BeanID怎么和AOP中的一模一样，不会弄混吗？</p>\n</blockquote>\n<blockquote>\n<p>答：不会。从 AopConfigUtils 中可以看出，名为 internalAutoProxyCreator 的Bean，存在三种有优先级的候选实例。只会注册优先级最高的那个。</p>\n</blockquote>\n<p>优先级从高到低为：</p>\n<ul>\n<li>AnnotationAwareAspectJAutoProxyCreator.class</li>\n<li>AspectJAwareAdvisorAutoProxyCreator.class</li>\n<li>InfrastructureAdvisorAutoProxyCreator.class</li>\n</ul>\n<p>也就是说，若同时存在 @EnableAspectJAutoProxy 和 @EnableTransactionManagement 注解，最终容器中 internalAutoProxyCreator 对应的实例就是 AnnotationAwareAspectJAutoProxyCreator 类型的。</p>\n<p><strong>所以声明式事务和AOP类似，都是利用后置处理器，创建增强的代理类。代理对象执行方法时，利用拦截器链进行调用</strong>。</p>\n<h3 id=\"事务拦截器\"><a href=\"#事务拦截器\" class=\"headerlink\" title=\"事务拦截器\"></a>事务拦截器</h3><p>注解引入的 ProxyTransactionManagementConfiguration 配置类中，主要是对事务拦截器类进行了创建和装配。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"meta\">@Role(BeanDefinition.ROLE_INFRASTRUCTURE)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> TransactionInterceptor <span class=\"title function_\">transactionInterceptor</span><span class=\"params\">(TransactionAttributeSource transactionAttributeSource)</span> &#123; <span class=\"comment\">// 事务拦截器</span></span><br><span class=\"line\">    <span class=\"type\">TransactionInterceptor</span> <span class=\"variable\">interceptor</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TransactionInterceptor</span>();</span><br><span class=\"line\">    interceptor.setTransactionAttributeSource(transactionAttributeSource); <span class=\"comment\">// 配置事务注解解析器</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.txManager != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        interceptor.setTransactionManager(<span class=\"built_in\">this</span>.txManager); <span class=\"comment\">// 配置事务管理器</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> interceptor;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"以事务执行方法\"><a href=\"#以事务执行方法\" class=\"headerlink\" title=\"以事务执行方法\"></a>以事务执行方法</h3><p>调用业务类的业务方法，和AOP一样，代码会跳转到代理类（此处是CglibAopProxy类）的 intercept 方法。运行过程中调用的增强方法，就是 TransactionInterceptor 类的 invoke 方法，实际执行的是 invokeWithinTransaction ，核心代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (txAttr == <span class=\"literal\">null</span> || !(ptm <span class=\"keyword\">instanceof</span> CallbackPreferringPlatformTransactionManager)) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Standard transaction demarcation with getTransaction and commit/rollback calls.</span></span><br><span class=\"line\">    <span class=\"type\">TransactionInfo</span> <span class=\"variable\">txInfo</span> <span class=\"operator\">=</span> createTransactionIfNecessary(ptm, txAttr, joinpointIdentification);</span><br><span class=\"line\"></span><br><span class=\"line\">    Object retVal;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 这是一个环绕通知: 触发拦截链中的下一个拦截器</span></span><br><span class=\"line\">        <span class=\"comment\">// This will normally result in a target object being invoked.</span></span><br><span class=\"line\">        retVal = invocation.proceedWithInvocation();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">catch</span> (Throwable ex) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// target invocation exception</span></span><br><span class=\"line\">        completeTransactionAfterThrowing(txInfo, ex); <span class=\"comment\">// 如果执行过程中抛出异常，此方法会调用事务管理器的 rollback 方法</span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> ex;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        cleanupTransactionInfo(txInfo);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (retVal != <span class=\"literal\">null</span> &amp;&amp; vavrPresent &amp;&amp; VavrDelegate.isVavrTry(retVal)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Set rollback-only in case of Vavr failure matching our rollback rules...</span></span><br><span class=\"line\">        <span class=\"type\">TransactionStatus</span> <span class=\"variable\">status</span> <span class=\"operator\">=</span> txInfo.getTransactionStatus();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (status != <span class=\"literal\">null</span> &amp;&amp; txAttr != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            retVal = VavrDelegate.evaluateTryFailure(retVal, txAttr, status);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    commitTransactionAfterReturning(txInfo); <span class=\"comment\">// 如果执行正常，则会调用事务管理器的 commit 方法</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> retVal;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["Spring"],"tags":["Java"]},{"title":"Boolean拆箱问题","url":"/%E7%AC%94%E8%AE%B0/Java/Tips/Boolean%E6%8B%86%E7%AE%B1%E9%97%AE%E9%A2%98/","content":"<h2 id=\"简述\"><a href=\"#简述\" class=\"headerlink\" title=\"简述\"></a>简述</h2><p>假设当前在写一个返回值为boolean类型的方法，调用了其他方法的逻辑，被调用方法的返回值为Boolean对象。如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">foo</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    <span class=\"type\">Boolean</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> SomeUtil.goo();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> flag;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>变量flag会通过自动拆箱从对象变为基本变量，过程中可能会产生空指针异常，所以应当通过equals方法来避免。如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">foo</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    <span class=\"type\">Boolean</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> SomeUtil.goo();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Boolean.TRUE.equals(flag);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","tags":["Java"]},{"title":"水塘抽样","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E6%B0%B4%E5%A1%98%E6%8A%BD%E6%A0%B7/","content":"<p>水塘抽样由于空间小，时间复杂度低，可以用于大数据流中的随机抽样问题。</p>\n<p>例如，给定一个未知长度的链表，设计一个算法，只遍历一次，随机返回链表中的一个节点。</p>\n<p>问题的难点在于随机选择是「动态」的，例如现在有 5 个元素，已随机选取了其中某个元素 a 作为结果，但如果再新增元素 b，应保留 a 还是取 b 作为结果，以什么逻辑选择，如何证明使用的方法在概率上公平</p>\n<p>当遇到第 i 个元素时，应该有 1&#x2F;i 的概率选择该元素，1 - 1&#x2F;i 的概率保持原有的选择。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 返回链表中一个随机节点的值 */</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">getRandom</span><span class=\"params\">(ListNode head)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">Random</span> <span class=\"variable\">r</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Random</span>();</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>, res = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">ListNode</span> <span class=\"variable\">p</span> <span class=\"operator\">=</span> head;</span><br><span class=\"line\">    <span class=\"comment\">// while 循环遍历链表</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (p != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 生成一个 [0, i) 之间的整数，其等于 0 的概率是 1/i</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (r.nextInt(++i) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            res = p.val;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        p = p.next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>证明：假设共有 n 个元素，则需要每个元素被选择的概率都是 1&#x2F;n。而上述算法，对于第 i 个元素，它被选择的概率是：</p>\n<p>$\\frac{1}{i}<em>(1-\\frac{1}{i+1})</em>(1-\\frac{1}{i+2})<em>…</em>(1-\\frac{1}{n+1})$<br>$&#x3D;\\frac1i*\\frac{i}{i+1}<em>\\frac{i+1}{i+2}</em>…*\\frac{n-1}{n}$<br>$&#x3D;\\frac1n$</p>\n<p>第 i 个元素被选择的概率是 1&#x2F;i，第 i+1 次不被替换的概率是 1 - 1&#x2F;(i+1)，以此类推，相乘就是第 i 个元素最终被选中的概率，就是 1&#x2F;n。</p>\n<p>因此该算法的逻辑正确。</p>\n<p>同理，如果要随机选择 k 个数，只要在第 i 个元素处以 k&#x2F;i 的概率选择该元素，以 1 - k&#x2F;i 的概率保持原有选择即可。代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 返回链表中 k 个随机节点的值 */</span></span><br><span class=\"line\"><span class=\"type\">int</span>[] getRandom(ListNode head, <span class=\"type\">int</span> k) &#123;</span><br><span class=\"line\">    <span class=\"type\">Random</span> <span class=\"variable\">r</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Random</span>();</span><br><span class=\"line\">    <span class=\"type\">int</span>[] res = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[k];</span><br><span class=\"line\">    <span class=\"type\">ListNode</span> <span class=\"variable\">p</span> <span class=\"operator\">=</span> head;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 前 k 个元素先默认选上</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; j &lt; k &amp;&amp; p != <span class=\"literal\">null</span>; j++) &#123;</span><br><span class=\"line\">        res[j] = p.val;</span><br><span class=\"line\">        p = p.next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> k;</span><br><span class=\"line\">    <span class=\"comment\">// while 循环遍历链表</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (p != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 生成一个 [0, i) 之间的整数</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> r.nextInt(++i);</span><br><span class=\"line\">        <span class=\"comment\">// 这个整数小于 k 的概率就是 k/i</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (j &lt; k) &#123;</span><br><span class=\"line\">            res[j] = p.val;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        p = p.next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>例：leetcode-398 random-pick-index 随机数索引</p>\n<p>给定一个可能含有 重复元素 的整数数组 nums ，随机输出给定的目标数字 target 的索引。可以假设给定的数字一定存在于数组中。</p>\n<p>实现 Solution 类：</p>\n<p>Solution(int[] nums) 用数组 nums 初始化对象。<br>int pick(int target) 从 nums 中选出一个满足 nums[i] &#x3D;&#x3D; target 的随机索引 i 。如果存在多个有效的索引，则每个索引的返回概率应当相等。</p>\n<p>示例：</p>\n<p>输入<br>[“Solution”, “pick”, “pick”, “pick”]<br>[[[1, 2, 3, 3, 3]], [3], [1], [3]]<br>输出<br>[null, 4, 0, 2]</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span>[] nums;</span><br><span class=\"line\">    Random random;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Solution</span><span class=\"params\">(<span class=\"type\">int</span>[] nums)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.nums = nums;</span><br><span class=\"line\">        random = <span class=\"keyword\">new</span> <span class=\"title class_\">Random</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">pick</span><span class=\"params\">(<span class=\"type\">int</span> target)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">ans</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>, cnt = <span class=\"number\">0</span>; i &lt; nums.length; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (nums[i] == target) &#123;</span><br><span class=\"line\">                ++cnt; <span class=\"comment\">// 第 cnt 次遇到 target</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (random.nextInt(cnt) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    ans = i;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>例：leetcode-382 linked-list-random-node 链表随机节点</p>\n<p>给你一个单链表，随机选择链表的一个节点，并返回相应的节点值。每个节点 被选中的概率一样 。</p>\n<p>实现 Solution 类：</p>\n<p>Solution(ListNode head) 使用整数数组初始化对象。<br>int getRandom() 从链表中随机选择一个节点并返回该节点的值。链表中所有节点被选中的概率相等。</p>\n<p>示例：</p>\n<p>输入<br>[“Solution”, “getRandom”, “getRandom”, “getRandom”, “getRandom”, “getRandom”]<br>[[[1, 2, 3]], [], [], [], [], []]<br>输出<br>[null, 1, 3, 2, 2, 3]</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    ListNode head;</span><br><span class=\"line\">    Random random;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Solution</span><span class=\"params\">(ListNode head)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.head = head;</span><br><span class=\"line\">        random = <span class=\"keyword\">new</span> <span class=\"title class_\">Random</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getRandom</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>, ans = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">ListNode</span> <span class=\"variable\">node</span> <span class=\"operator\">=</span> head; node != <span class=\"literal\">null</span>; node = node.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (random.nextInt(i) == <span class=\"number\">0</span>) &#123; <span class=\"comment\">// 1/i 的概率选中（替换为答案）</span></span><br><span class=\"line\">                ans = node.val;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            ++i;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><a href=\"https://zhuanlan.zhihu.com/p/107793995\">知乎 - 随机算法：水塘抽样算法</a></p>\n</blockquote>\n","categories":["算法"],"tags":["Java"]},{"title":"约瑟夫环","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E7%BA%A6%E7%91%9F%E5%A4%AB%E7%8E%AF/","content":"<h2 id=\"定义\"><a href=\"#定义\" class=\"headerlink\" title=\"定义\"></a>定义</h2><ol>\n<li>约瑟夫环操作：把一些数字排成一个圆圈，从数字 1 开始，每次从这个圆圈里删除第 m 个数字，直到最后只剩一个数字。</li>\n<li>函数 f(n,m) ：表示对 n 个数字 1,2,3,…,n 做约瑟夫环操作，最后剩下的这个数字。</li>\n</ol>\n<h2 id=\"推导思路\"><a href=\"#推导思路\" class=\"headerlink\" title=\"推导思路\"></a>推导思路</h2><p>第一个数字（一定符合 m mod n） 删除之后，剩下的n-1个数字组成了一个新的约瑟夫环（以编号为 k&#x3D;(m+1) mod n的人开始）:</p>\n<p>例如 f(7,3) 在第一次删除数字时<br>[1,2,3,4,5,6,7]<br>删除3后，新的约瑟夫环为<br>[4,5,6,7,1,2]<br>例如 f(5,9) 在第一次删除数字时<br>[1,2,3,4,5]<br>删除4后，新的约瑟夫环为<br>[5,1,2,3]</p>\n<p>f(m,n) 在第一次删除数字时<br>[1,2,3,…,n]<br>删除 k-1 &#x3D; m mod n后，新的约瑟夫环为<br>[k,k+1,k+2,…,n-1,n,1,2,3,…,k-3,k-2]</p>\n<p>将其编号做下转换，有</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">k       1</span><br><span class=\"line\">k+1     2</span><br><span class=\"line\">k+2     3</span><br><span class=\"line\">...</span><br><span class=\"line\">k-1     n-2</span><br><span class=\"line\">k-2     n-1</span><br></pre></td></tr></table></figure>\n\n<p>对于上述的例子 [4,5,6,7,1,2] 和 [5,1,2,3] ，转换即为</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">4   1</span><br><span class=\"line\">5   2</span><br><span class=\"line\">6   3</span><br><span class=\"line\">7   4</span><br><span class=\"line\">1   5</span><br><span class=\"line\">2   6</span><br><span class=\"line\">和</span><br><span class=\"line\">5   1</span><br><span class=\"line\">1   2</span><br><span class=\"line\">2   3</span><br><span class=\"line\">3   4</span><br></pre></td></tr></table></figure>\n\n<p>假如我们知道这个子问题f(n-1,m)的解，就能用递归得到问题答案。</p>\n<p>假设数字编号转换前为x’，转换后为x。则有这样的关系</p>\n<p>$x’&#x3D;(x+m-1)\\mod n+1$</p>\n<p>f(n,m)的公式可表示为</p>\n<p>$f(1,m)&#x3D;1$</p>\n<p>$f(n,m)&#x3D;(f(n-1)+m-1)\\mod n+1 , (n\\neq 1)$</p>\n<h2 id=\"例\"><a href=\"#例\" class=\"headerlink\" title=\"例\"></a>例</h2><p>例：leetcode-1823 find-the-winner-of-the-circular-game 找出游戏的获胜者</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">findTheWinner</span><span class=\"params\">(<span class=\"type\">int</span> n, <span class=\"type\">int</span> k)</span> &#123; <span class=\"comment\">//递归</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (n == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (k + findTheWinner(n - <span class=\"number\">1</span>, k) - <span class=\"number\">1</span>) % n + <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">findTheWinner</span><span class=\"params\">(<span class=\"type\">int</span> n, <span class=\"type\">int</span> k)</span> &#123; <span class=\"comment\">//迭代</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">winner</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">2</span>; i &lt;= n; i++) &#123;</span><br><span class=\"line\">            winner = (k + winner - <span class=\"number\">1</span>) % i + <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> winner;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["算法"],"tags":["Java"]},{"title":"Morris遍历","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/Morris%E9%81%8D%E5%8E%86/","content":"<h2 id=\"Morris遍历\"><a href=\"#Morris遍历\" class=\"headerlink\" title=\"Morris遍历\"></a>Morris遍历</h2><h3 id=\"Morris遍历步骤\"><a href=\"#Morris遍历步骤\" class=\"headerlink\" title=\"Morris遍历步骤\"></a>Morris遍历步骤</h3><p>假设来到当前节点cur，开始时cur来到头节点位置</p>\n<ul>\n<li>如果cur没有左孩子，cur向右移动 cur&#x3D;cur.right</li>\n<li>如果cur有左孩子，找到左子树上最右的节点mostRight<ul>\n<li>如果mostRight的右指针指向空，让其指向cur，然后cur向左移动 cur&#x3D;cur.left</li>\n<li>如果mostRight的右指针指向cur，让其指向null，然后cur向右移动 cur&#x3D;cur.right</li>\n</ul>\n</li>\n<li>cur为空时遍历停止。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">morris</span><span class=\"params\">(TreeNode root)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == root) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">TreeNode</span> <span class=\"variable\">cur</span> <span class=\"operator\">=</span> root;</span><br><span class=\"line\">    <span class=\"type\">TreeNode</span> <span class=\"variable\">mostRight</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"literal\">null</span> != cur) &#123;</span><br><span class=\"line\">        mostRight = cur.left;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> != mostRight) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (mostRight.right != <span class=\"literal\">null</span> &amp;&amp; mostRight.right != cur)&#123;</span><br><span class=\"line\">                mostRight = mostRight.right;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == mostRight.right) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//System.out.print(cur.value + &quot; &quot;); 前序遍历a，第一次访问有左子树节点时。</span></span><br><span class=\"line\">                mostRight.right = cur;</span><br><span class=\"line\">                cur = cur.left;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                mostRight.right = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//System.out.print(cur.value + &quot; &quot;); 前序遍历a，没有左子树的情况时。</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.print(cur.value + <span class=\"string\">&quot; &quot;</span>); <span class=\"comment\">// 中序遍历，没有左子树，或者第二次访问有左子树的节点时。</span></span><br><span class=\"line\">        cur = cur.right;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对于一颗1-7的完全二叉树，其递归序即为 [1,2,4,2,5,1,3,6,3,7]</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">   1  </span><br><span class=\"line\"> 2   3</span><br><span class=\"line\">4 5 6 7</span><br></pre></td></tr></table></figure>\n\n<p>一个节点如果有左子树，会被访问两次；如果没有左子树，只会被访问一次。</p>\n<p>中序遍历的处理：<br>没有左子树的节点，访问时直接打印；有左子树的节点，第二次访问时才打印。</p>\n<p>前序遍历的处理：<br>没有左子树的节点，访问时直接打印；有左子树的节点，第一次访问时就打印。</p>\n<p>后序遍历的处理：<br>没有左子树的节点，不作处理；有左子树的节点，第二次访问时，逆序打印左子树的右边界。<br>第一次遍历完成后，再逆序打印整棵树的右边界。</p>\n<p>如何逆序打印：<br>因为是打印右边界，只和节点的right成员有关，所以就是对一个链表做逆序，打印完后再恢复。</p>\n","categories":["算法"],"tags":["Java"]},{"title":"二叉树","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%8F%89%E6%A0%91/","content":"<h2 id=\"二叉树结构\"><a href=\"#二叉树结构\" class=\"headerlink\" title=\"二叉树结构\"></a>二叉树结构</h2><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">TreeNode</span>&lt;V&gt; &#123;</span><br><span class=\"line\">    V value;</span><br><span class=\"line\">    TreeNode&lt;V&gt; left;</span><br><span class=\"line\">    TreeNode&lt;V&gt; right;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"二叉树的递归序\"><a href=\"#二叉树的递归序\" class=\"headerlink\" title=\"二叉树的递归序\"></a>二叉树的递归序</h2><p>对于一颗二叉树，按下列代码，访问到树节点的顺序。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">recOrder</span><span class=\"params\">(TreeNode root)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"literal\">null</span> == root) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 第一次访问到当前节点</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    recOrder(root.left);</span><br><span class=\"line\">    <span class=\"comment\">// 第二次访问到当前节点，从左子树回来</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    recOrder(root.right);</span><br><span class=\"line\">    <span class=\"comment\">// 第三次访问到当前节点，从右子树回来</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对于一颗1-7的完全二叉树，其递归序即为 [1,2,4,4,4,2,5,5,5,2,1,3,6,6,6,3,7,7,7,3,1]</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">   1</span><br><span class=\"line\"> 2   3</span><br><span class=\"line\">4 5 6 7</span><br></pre></td></tr></table></figure>\n\n<p>先序遍历（头-左-右）：在第一次访问当前节点时打印<br>中序遍历（左-头-右）：在第二次访问当前节点时打印<br>后序遍历（左-右-头）：在第三次访问当前节点时打印</p>\n<h2 id=\"非递归遍历二叉树\"><a href=\"#非递归遍历二叉树\" class=\"headerlink\" title=\"非递归遍历二叉树\"></a>非递归遍历二叉树</h2><h3 id=\"前序遍历\"><a href=\"#前序遍历\" class=\"headerlink\" title=\"前序遍历\"></a>前序遍历</h3><ol>\n<li>创建栈，压入根节点。</li>\n<li>栈中弹出树节点cur，并打印。</li>\n<li>先将cur右孩子压栈，再将cur左孩子压栈。</li>\n<li>重复2-3步至栈空。</li>\n</ol>\n<h3 id=\"后序遍历\"><a href=\"#后序遍历\" class=\"headerlink\" title=\"后序遍历\"></a>后序遍历</h3><p>因为后序遍历和先序遍历’（头右左）是完全相反的顺序。所以直接用先序遍历’节点将节点放入收集栈中，再打印收集栈。</p>\n<ol>\n<li>创建栈，压入根节点。</li>\n<li>创建收集栈。</li>\n<li>栈中弹出树节点cur，将节点值压入到收集栈。</li>\n<li>先将cur左孩子压栈，再将cur右孩子压栈。</li>\n<li>重复3-4步至栈空。</li>\n<li>打印收集栈。</li>\n</ol>\n<h3 id=\"中序遍历\"><a href=\"#中序遍历\" class=\"headerlink\" title=\"中序遍历\"></a>中序遍历</h3><ol>\n<li>创建栈，压入根节点。</li>\n<li>循环将左孩子节点压栈，即将树的左边界入栈。</li>\n<li>栈中弹出树节点cur并打印。对cur的右孩子执行步骤2。</li>\n<li>重复2-3步至栈空。</li>\n</ol>\n<h3 id=\"深度优先遍历\"><a href=\"#深度优先遍历\" class=\"headerlink\" title=\"深度优先遍历\"></a>深度优先遍历</h3><p>中序遍历即为深度优先遍历。</p>\n<h3 id=\"宽度优先遍历\"><a href=\"#宽度优先遍历\" class=\"headerlink\" title=\"宽度优先遍历\"></a>宽度优先遍历</h3><ol>\n<li>创建队列，压入根节点。</li>\n<li>队列中获取树节点cur，并打印。</li>\n<li>先将cur左孩子添加至队列，再将cur右孩子添加至队列。</li>\n<li>重复2-3步至栈空。</li>\n</ol>\n<p>例：leetcode-662 二叉树最大宽度 maximum-width-of-binary-tree<br>求二叉树的最大宽度。</p>\n<p>解1：<br>创建哈希表记录节点和深度的映射。宽度优先遍历树，维护当前遍历树节点的深度，和当前深度的节点数量。  </p>\n<p>解2：<br>宽度优先遍历。遍历过程中，维护当前深度和下一个深度的最后一个节点。为当前深度的节点数量计数，并维护最大值。</p>\n<h2 id=\"搜索二叉树\"><a href=\"#搜索二叉树\" class=\"headerlink\" title=\"搜索二叉树\"></a>搜索二叉树</h2><ul>\n<li>节点的左子树只包含 小于 当前节点的数。</li>\n<li>节点的右子树只包含 大于 当前节点的数。</li>\n<li>所有左子树和右子树自身必须也是二叉搜索树。</li>\n</ul>\n<p>搜索二叉树的中序遍历，一定为升序。</p>\n<p>例：leetcode-98 验证二叉搜索树 validate-binary-search-tree<br>给定一个二叉树的根节点 root ，判断其是否是一个有效的二叉搜索树。</p>\n<p>解：<br>中序遍历，判断遍历过程中节点值是否为升序。</p>\n<h2 id=\"完全二叉树\"><a href=\"#完全二叉树\" class=\"headerlink\" title=\"完全二叉树\"></a>完全二叉树</h2><p>在一个 完全二叉树 中，除了最后一层外，所有层都是完全被填满的，并且最后一层中的所有节点都是尽可能靠左的。</p>\n<p>例：leetcode-958 二叉树的完全性检验 check-completeness-of-a-binary-tree<br>给定一个二叉树的 root ，确定它是否是一个 完全二叉树。</p>\n<p>解：</p>\n<ul>\n<li>宽度优先遍历树。</li>\n<li>若存在只有右孩子的节点，则不是完全二叉树。</li>\n<li>遇到第一个左右孩子不双全的节点后，之后的节点都必须为叶子节点，即无孩子节点。</li>\n</ul>\n<h2 id=\"满二叉树\"><a href=\"#满二叉树\" class=\"headerlink\" title=\"满二叉树\"></a>满二叉树</h2><p>除最后一层无任何子节点外，每一层上的所有结点都有两个子结点的二叉树。</p>\n<p>用代码判断：树的节点数量 &#x3D; 2^(树的深度) - 1 。</p>\n<h2 id=\"平衡二叉树\"><a href=\"#平衡二叉树\" class=\"headerlink\" title=\"平衡二叉树\"></a>平衡二叉树</h2><p>一个二叉树每个节点 的左右两个子树的高度差的绝对值不超过1。</p>\n<p>例：leetcode-110 平衡二叉树 balanced-binary-tree</p>\n<p>解：<br>二叉树递归解题技巧：<br><strong>树形DP</strong>：当前问题中，需要左右子树分别提供什么样的信息。</p>\n<p>当前问题中，需要左右子树分别提供，子树是否是平衡二叉树，以及子树的高度。</p>\n<p>例：leetcode-236 二叉树的最近公共祖先 lowest-common-ancestor-of-a-binary-tree<br>给定一个二叉树, 找到该树中两个指定节点的最近公共祖先。<br>最近公共祖先的定义为：对于有根树 T 的两个节点 p、q，最近公共祖先表示为一个节点 x，满足 x 是 p、q 的祖先且 x 的深度尽可能大（一个节点也可以是它自己的祖先）。</p>\n<p>解：  </p>\n<ol>\n<li>设置哈希表记录节点与其父节点的映射。</li>\n<li>回溯节点p的所有父节点，放入集合中。</li>\n<li>回溯节点q的所有父节点，第一个在集合中的节点即为最近公共祖先。</li>\n</ol>\n<p>解：<br>递归。<br>递归方法：  </p>\n<ul>\n<li>当前节点为空，返回空。</li>\n<li>当前节点为p或q，返回p或q。</li>\n<li>否则，</li>\n<li>当前节点左右孩子都为空，返回空。</li>\n<li>当前节点左右孩子有一个不为空，返回不为空的节点。</li>\n<li>当前节点左右孩子都不为空，返回当前节点。</li>\n</ul>\n<h2 id=\"前驱节点和后继节点\"><a href=\"#前驱节点和后继节点\" class=\"headerlink\" title=\"前驱节点和后继节点\"></a>前驱节点和后继节点</h2><p>前驱节点：中序遍历中，一个节点上一次访问的节点。<br>后继节点：中序遍历中，一个节点下一个要访问的节点。</p>\n<p>例：找出后继节点<br>给定一个二叉树，树节点中记录了当前节点的父节点。找出当前节点的后继节点。</p>\n<p>解<br>从树的结构上寻找答案。</p>\n<ol>\n<li>当前节点有右子树时，其后继节点即为其右子树的最左节点。</li>\n<li>当前节点无右子树时，判断节点是否为其父节点的左孩子，是则其父节点就是后继节点；否则一路向上找，找到第一个左孩子节点，其父节点就是后继节点。</li>\n</ol>\n<h2 id=\"二叉树的序列化和反序列化\"><a href=\"#二叉树的序列化和反序列化\" class=\"headerlink\" title=\"二叉树的序列化和反序列化\"></a>二叉树的序列化和反序列化</h2><p>将树的遍历结果存成字符串</p>\n<p>例：<br>一张纸条，多次向内折叠，展开口向内的折痕称为凹，向外的折痕称为凸。给定一个整数N，按顺序输出纸条折叠N次展开后的折痕。<br>比如折叠一次，只有1条折痕，为 凸。<br>折叠两次，有3条折痕，为 凸-凸-凹。<br>折叠3次，有8条折痕，为 凸-凸-凹-凸-凸-凹-凹-凸。</p>\n<p>解：<br>折叠的过程，就是构建满二叉树的过程，根节点为凸，多折叠一次即多加一层，所有节点的左孩子为凸，右孩子为凹。最终中序遍历输出节点即可。</p>\n","categories":["算法"],"tags":["Java"]},{"title":"复杂度和位运算","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E4%BD%8D%E8%BF%90%E7%AE%97/","content":"<h2 id=\"异或\"><a href=\"#异或\" class=\"headerlink\" title=\"异或\"></a>异或</h2><ul>\n<li>符号：^</li>\n<li>满足交换律和结合律</li>\n<li>0 ^ N &#x3D; N; N ^ N &#x3D; 0; 这两个特性用得比较多</li>\n</ul>\n<p>例：<br>不额外开辟内存交换两个int类型的值数据a,b</p>\n<p>解：<br>使用异或临时存储</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">a = a ^ b; <span class=\"comment\">// A ^ B</span></span><br><span class=\"line\">b = a ^ b; <span class=\"comment\">// (A ^ B) ^ B = A</span></span><br><span class=\"line\">a = a ^ b; <span class=\"comment\">// (A ^ B) ^ A = B</span></span><br></pre></td></tr></table></figure>\n\n<p>例：<br>(N+1)^1-1 交换相邻的奇偶数</p>\n<p>解：<br>使用表达式 (N+1)^1-1</p>\n<p>如果N是偶数，则 (N+1) 为奇数，(N+1)^1&#x3D;(N+1)-1，最终结果就是N-1；<br>如果N是奇数，则 (N+1) 为偶数，(N+1)^1&#x3D;(N+1)+1，最终结果就是N+1；</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">N</th>\n<th align=\"center\">(N+1)^1-1</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">1</td>\n<td align=\"center\">2</td>\n</tr>\n<tr>\n<td align=\"center\">2</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">3</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">4</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">5</td>\n<td align=\"center\">6</td>\n</tr>\n</tbody></table>\n<p>例：<br>一个数组中有一个数字出现了奇数次，其余数字全部出现了偶数次，找到出现奇数次的数字</p>\n<p>解：<br>全部异或。运用特性 N ^ N &#x3D; 0;出现偶数次的数字全部互相抵消，剩下就是出现奇数次的数字</p>\n<p>例：<br>int类型的数，只保留二进制数中最右侧的1</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">N &amp; ((~N) + 1)</span><br><span class=\"line\">N =       0xb 0010 1100</span><br><span class=\"line\">~(N) =    0xb 1101 0011</span><br><span class=\"line\">(~N)+1 =  0xb 1101 0100</span><br><span class=\"line\">原理在于，N&amp;(~N)=0，而(~N)+1 后，由于二进制数右侧的1，加上1不断进位，直到第一个0处，将其变成1。这里也就是原数字中最右侧的1</span><br></pre></td></tr></table></figure>\n\n<p>例：<br>一个数组中有两个数字出现了奇数次，其余数字全部出现了偶数次，找到出现奇数次的数</p>\n<p>解：</p>\n<ol>\n<li>全部异或。运用特性 N ^ N &#x3D; 0; 得到两个数字异或的结果eor &#x3D; a ^ b，必然不为0</li>\n<li>由于eor是异或的结果，所以a和b，在eor的1位上，必然有一个是1，有一个是0</li>\n<li>提取eor最右侧的1,获得新值rightOne</li>\n<li>数组的值和rightOne做与操作，返回值不为0的全部异或，得到a或b其中一个值</li>\n</ol>\n<p>例：<br>返回二进制数中1的个数</p>\n<p>解：</p>\n<ol>\n<li>rightOne &#x3D; N &amp; ((~N) + 1) &#x2F;&#x2F;找到最右侧的1</li>\n<li>N &#x3D; N ^ rightOne; &#x2F;&#x2F; 消去最右侧的1</li>\n<li>记录N等于0之前，上述步骤操作的次数。</li>\n</ol>\n<h2 id=\"计算掩码\"><a href=\"#计算掩码\" class=\"headerlink\" title=\"计算掩码\"></a>计算掩码</h2><p>对于0xb 0010 1100 返回 0xb 0011 1111 。将二进制数最左侧的1的右侧数字全部变成1</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">func</span><span class=\"params\">(<span class=\"type\">int</span> n)</span>&#123; <span class=\"comment\">// 举两个例子，对于0xb 1000 0000  和  0xb 0010 1100</span></span><br><span class=\"line\">  n = n | (n &gt;&gt; <span class=\"number\">1</span>); <span class=\"comment\">// 变为 0xb 1100 0000  和  0xb 0011 1110</span></span><br><span class=\"line\">  n = n | (n &gt;&gt; <span class=\"number\">2</span>); <span class=\"comment\">// 变为 0xb 1111 0000  和  0xb 0011 1111</span></span><br><span class=\"line\">  n = n | (n &gt;&gt; <span class=\"number\">4</span>); <span class=\"comment\">// 变为 0xb 1111 1111  和  0xb 0011 1111</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>例：给定两个有符号整数a和b，返回a和b中较大的。要求不用做任何比较判断。</p>\n<p>解：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 负数返回0，非负数返回1</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">sign</span><span class=\"params\">(<span class=\"type\">int</span> n)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> flip((n &gt;&gt; <span class=\"number\">31</span>) &amp; <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 将0变为1，将1变为0</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">flip</span><span class=\"params\">(<span class=\"type\">int</span> n)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> n ^ <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">getMax</span><span class=\"params\">(<span class=\"type\">int</span> a, <span class=\"type\">int</span> b)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">c</span> <span class=\"operator\">=</span> a - b; <span class=\"comment\">// c可能溢出，可以先单独判断a和b的符号位，根据情况直接返回a或b</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">gt</span> <span class=\"operator\">=</span> sign(c);</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">lt</span> <span class=\"operator\">=</span> flip(gt);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> gt * a + lt * b;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>主要就是这个符号判断函数sign()。</p>\n<p>例：<br>判断一个32位正数是否为2的幂，是否为4的幂</p>\n<p>解：<br>利用 N &amp; ((~N) + 1) 找到数字最右侧的1，和原数字相等，则是2的幂。<br>数字如果是4的幂，首先需要是2的幂，故先使用上述方法判断，然后将 rightOne 和 0xb 1010 1010 相与，结果不为0，则是4的幂。</p>\n<p>解：<br>数字如果是2的幂，则需要满足 N &amp; (N - 1) &#x3D;&#x3D; 0</p>\n<p>例：<br>给定两个32位整数a和b，不能使用算数运算符，分别实现a和b的加、减、乘、除运算。</p>\n<p>解：<br>加法：使用异或计算无进位相加结果，使用与运算，计算进位信息。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">例如 13 + 7</span><br><span class=\"line\">0xb 0000 1101</span><br><span class=\"line\">0xb 0000 0111</span><br><span class=\"line\"></span><br><span class=\"line\">13^7算出无进位相加</span><br><span class=\"line\">0xb 0000 1010</span><br><span class=\"line\"></span><br><span class=\"line\">13&amp;7算出进位信息</span><br><span class=\"line\">0xb 0000 0101</span><br><span class=\"line\"></span><br><span class=\"line\">进位信息，向左移动一位后，和无进位相加结果相加</span><br><span class=\"line\">0xb 0000 1010</span><br><span class=\"line\">0xb 0000 1010</span><br><span class=\"line\"></span><br><span class=\"line\">无进位相加结果</span><br><span class=\"line\">0xb 0000 0000</span><br><span class=\"line\">进位信息</span><br><span class=\"line\">0xb 0000 1010</span><br><span class=\"line\"></span><br><span class=\"line\">进位信息，向左移动一位后，和无进位相加结果相加</span><br><span class=\"line\">0xb 0001 0100</span><br><span class=\"line\">0xb 0000 0000</span><br><span class=\"line\"></span><br><span class=\"line\">无进位相加结果</span><br><span class=\"line\">0xb 0001 0100</span><br><span class=\"line\">进位信息</span><br><span class=\"line\">0xb 0000 0000</span><br><span class=\"line\"></span><br><span class=\"line\">进位信息为0，此时得到结果</span><br></pre></td></tr></table></figure>\n\n<p>减法：加一个数的相反数就相当于减去这个数。</p>\n<p>利用 <code>(~N)+1</code> 计算得到N的相反数，再使用加法。</p>\n<p>乘法：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">例如 7 * 13</span><br><span class=\"line\">   00000111</span><br><span class=\"line\"> * 00001101</span><br><span class=\"line\">-------------</span><br><span class=\"line\">   00000111</span><br><span class=\"line\">  00000000</span><br><span class=\"line\"> 00000111</span><br><span class=\"line\">00000111</span><br><span class=\"line\">-------------相加</span><br></pre></td></tr></table></figure>\n\n<p>相除：逐一检查最终的结果各个位上是否为1。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">例如 91 / 7</span><br><span class=\"line\">0xb 0101 1011 除以</span><br><span class=\"line\">0xb 0000 0111</span><br><span class=\"line\"></span><br><span class=\"line\">0xb 0000 1000 *</span><br><span class=\"line\">0xb 0000 0111 =</span><br><span class=\"line\">0xb 0011 1000 (左移3位，也就是最终的结果第3位为1)</span><br><span class=\"line\"></span><br><span class=\"line\">0xb 0101 1011 -</span><br><span class=\"line\">0xb 0011 1000 =</span><br><span class=\"line\">0xb 0010 0011（被除数减去此部分结果）</span><br><span class=\"line\"></span><br><span class=\"line\">0xb 0000 0100 *</span><br><span class=\"line\">0xb 0000 0111 =</span><br><span class=\"line\">0xb 0001 1100 (左移2位，也就是最终的结果第2位为1)</span><br><span class=\"line\"></span><br><span class=\"line\">0xb 0010 0011 -</span><br><span class=\"line\">0xb 0001 1100 =</span><br><span class=\"line\">0xb 0000 0111（被除数减去此部分结果）</span><br><span class=\"line\"></span><br><span class=\"line\">0xb 0000 0001 *</span><br><span class=\"line\">0xb 0000 0111 =</span><br><span class=\"line\">0xb 0000 0111 (不左移，也就是最终的结果第0位为1)</span><br><span class=\"line\"></span><br><span class=\"line\">0xb 0000 0111 -</span><br><span class=\"line\">0xb 0000 0111 =</span><br><span class=\"line\">0xb 0000 0000（被除数减去此部分结果，得到0了）</span><br><span class=\"line\"></span><br><span class=\"line\">将之前的结果合并，有</span><br><span class=\"line\">0xb 0000 1000 +</span><br><span class=\"line\">0xb 0000 0100 +</span><br><span class=\"line\">0xb 0000 0001 =</span><br><span class=\"line\">0xb 0000 1101</span><br></pre></td></tr></table></figure>\n","categories":["算法"],"tags":["Java"]},{"title":"前缀树","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E5%89%8D%E7%BC%80%E6%A0%91/","content":"<h2 id=\"前缀树\"><a href=\"#前缀树\" class=\"headerlink\" title=\"前缀树\"></a>前缀树</h2><p>是一种哈希树的变种。典型应用是用于统计，排序和保存大量的字符串。也称为字典树。</p>\n<ul>\n<li>根节点不包含字符，除根节点外每一个节点都只包含一个字符；</li>\n<li>从根节点到某一节点，路径上经过的字符连接起来，为该节点对应的字符串；</li>\n<li>每个节点的所有子节点包含的字符都不相同。</li>\n</ul>\n<p>每个节点可以维护两个变量pass和end，pass表示添加字符串时经过这个节点几次，end表示添加字符串时，有多少个字符串以这个节点结束。<br>end可用于查询前缀树中某个字符串出现的次数，pass可用于查询树中存储的字符串某个特定前缀出现的次数。</p>\n<p>结构：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TrieNode</span> &#123; <span class=\"comment\">// 前缀树节点</span></span><br><span class=\"line\">    <span class=\"type\">int</span> pass; <span class=\"comment\">// 有多少个字符串使用到了这个字符</span></span><br><span class=\"line\">    <span class=\"type\">int</span> end; <span class=\"comment\">// 有多少个字符串以这个字符结尾</span></span><br><span class=\"line\">    TrieNode[] nexts; <span class=\"comment\">// HashMap&lt;Char,TrieNode&gt; nexts;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">TrieNode</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        pass = <span class=\"number\">0</span>;</span><br><span class=\"line\">        end = <span class=\"number\">0</span>;</span><br><span class=\"line\">        nexts = <span class=\"keyword\">new</span> <span class=\"title class_\">TrieNode</span>[<span class=\"number\">26</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加word单词</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(String word)</span>&#123;&#125;</span><br><span class=\"line\">    <span class=\"comment\">// word 这个单词之前加入过几次</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">search</span><span class=\"params\">(String word)</span>&#123;&#125;</span><br><span class=\"line\">    <span class=\"comment\">// 以 prefix 开头的单词加入过几次</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">preNum</span><span class=\"params\">(String prefix)</span>&#123;&#125;</span><br><span class=\"line\">    <span class=\"comment\">// 删除 word 这个单词</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">delete</span><span class=\"params\">(String word)</span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["算法"],"tags":["Java"]},{"title":"哈希","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E5%93%88%E5%B8%8C/","content":"<h2 id=\"哈希函数\"><a href=\"#哈希函数\" class=\"headerlink\" title=\"哈希函数\"></a>哈希函数</h2><ul>\n<li>输入域为无穷，输出域是有限的。</li>\n<li>相同的输入，会得到相同的输出。即哈希函数没有随机的成分。</li>\n<li>由于输入输出域的关系，必然存在输出不同，输出相同的情况，即哈希碰撞。</li>\n<li>离散性。哈希函数输出的值在输出域上整体分布均匀。</li>\n</ul>\n<h2 id=\"哈希表和有序表\"><a href=\"#哈希表和有序表\" class=\"headerlink\" title=\"哈希表和有序表\"></a>哈希表和有序表</h2><p>HashSet、HashMap</p>\n<ul>\n<li>哈希表的增删改查都是O(1)的，但此常数略大。</li>\n<li>哈希表的key，基础类型按值传递，引用类型按引用传递。</li>\n</ul>\n<h2 id=\"有序表\"><a href=\"#有序表\" class=\"headerlink\" title=\"有序表\"></a>有序表</h2><p>TreeSet、TreeMap</p>\n<ul>\n<li>有序表的增删改查都是O(logN)的。</li>\n<li>有序表的key，基础类型按值传递，引用类型按引用传递，且需自定义比较器。</li>\n</ul>\n<p>例：<br>设计一种数据结构，实现下列三个功能。</p>\n<ul>\n<li>insert(key) ：将key加入到该结构中，做到不重复加入。</li>\n<li>delete(key) ：将key从结构中删除。</li>\n<li>getRandom() ：等概率随机返回结构中的任何一个key。</li>\n</ul>\n<p>要求三种方法的时间复杂度都为O(1)。</p>\n<p>解：<br>数据结构内维护两个哈希表。Map&lt;Element, Index&gt; 和 Map&lt;Index, Element&gt; 。<br>增加元素时直接放入Map，Index值根据size获取，递增设置。<br>删除元素时，将最大Index的Element替换到即将删除的元素，最大Index也可以用size找。<br>获取随机key可以生成[0,size-1]内的随机整数，作为Index在Map&lt;Index, Element&gt;中获取。</p>\n","categories":["算法"],"tags":["Java"]},{"title":"图","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E5%9B%BE/","content":"<h2 id=\"图的表达方式\"><a href=\"#图的表达方式\" class=\"headerlink\" title=\"图的表达方式\"></a>图的表达方式</h2><h3 id=\"邻接表\"><a href=\"#邻接表\" class=\"headerlink\" title=\"邻接表\"></a>邻接表</h3><p>每个节点记录自己的直接邻居。<br>A:C,D<br>B:C<br>C:A,B,D<br>D:A</p>\n<h3 id=\"邻接矩阵\"><a href=\"#邻接矩阵\" class=\"headerlink\" title=\"邻接矩阵\"></a>邻接矩阵</h3><p>可方便地表示权重信息。</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\">A</th>\n<th align=\"center\">B</th>\n<th align=\"center\">C</th>\n<th align=\"center\">D</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">A</td>\n<td align=\"center\">0</td>\n<td align=\"center\">-1</td>\n<td align=\"center\">7</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">B</td>\n<td align=\"center\">-1</td>\n<td align=\"center\">0</td>\n<td align=\"center\">2</td>\n<td align=\"center\">-1</td>\n</tr>\n<tr>\n<td align=\"center\">C</td>\n<td align=\"center\">7</td>\n<td align=\"center\">2</td>\n<td align=\"center\">0</td>\n<td align=\"center\">5</td>\n</tr>\n<tr>\n<td align=\"center\">D</td>\n<td align=\"center\">3</td>\n<td align=\"center\">-1</td>\n<td align=\"center\">5</td>\n<td align=\"center\">0</td>\n</tr>\n</tbody></table>\n<h3 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h3><p>某些特殊的图还能用一维数组来表示。如记录父节点的数组。</p>\n<h2 id=\"图的遍历\"><a href=\"#图的遍历\" class=\"headerlink\" title=\"图的遍历\"></a>图的遍历</h2><h3 id=\"宽度优先遍历\"><a href=\"#宽度优先遍历\" class=\"headerlink\" title=\"宽度优先遍历\"></a>宽度优先遍历</h3><ul>\n<li>使用Queue队列实现。</li>\n<li>队列弹出节点时，使用Set集合记录已经遍历的节点，防止重复访问。</li>\n</ul>\n<h3 id=\"广度优先遍历\"><a href=\"#广度优先遍历\" class=\"headerlink\" title=\"广度优先遍历\"></a>广度优先遍历</h3><ul>\n<li>使用Stack栈实现。</li>\n<li>栈弹出节点时，使用Set集合记录已经遍历的节点，并将其相邻可到达，且未访问过的节点入栈。</li>\n</ul>\n<h2 id=\"拓扑排序算法\"><a href=\"#拓扑排序算法\" class=\"headerlink\" title=\"拓扑排序算法\"></a>拓扑排序算法</h2><blockquote>\n<p>对一个有向无环图(Directed Acyclic Graph简称DAG)G进行拓扑排序，是将G中所有顶点排成一个线性序列，使得图中任意一对顶点u和v，若边&lt;u, v&gt;∈E(G)，则u在线性序列中出现在v之前。</p>\n</blockquote>\n<p>对图结构的要求：</p>\n<ul>\n<li>有向图。</li>\n<li>存在入度为0的节点。</li>\n<li>图中无环。</li>\n</ul>\n<p>例如项目程序编译时，包A依赖于包B、包C、包D，而包B依赖于包C、包D、包E。求可行的包编译顺序。</p>\n<ol>\n<li>找到入度为0的节点，输出，并将其影响删除（减少其他节点的入度）。</li>\n<li>重复步骤1。</li>\n</ol>\n<ul>\n<li>哈希表记录节点及其入度。</li>\n<li>队列记录入度为0的节点。</li>\n</ul>\n<p>例：leetcode-210 课程表 II course-schedule-ii<br>总共有 numCourses 门课需要选，记为 0 到 numCourses - 1。给定一个数组 prerequisites ，其中 prerequisites[i] &#x3D; [ai, bi] ，表示在选修课程 ai 前 必须 先选修 bi 。<br>例如，想要学习课程 0 ，需要先完成课程 1 ，我们用一个匹配来表示：[0, 1] 。<br>返回你为了学完所有课程所安排的学习顺序。可能会有多个正确的顺序，你只要返回 任意一种 就可以了。如果不可能完成所有课程，返回一个空数组。</p>\n<h2 id=\"最小生成树\"><a href=\"#最小生成树\" class=\"headerlink\" title=\"最小生成树\"></a>最小生成树</h2><p>无向图的边带权重，在保证图的连通性不变的情况下，只保留较小权重的边，使得图中边的整体权重最小。</p>\n<h2 id=\"Kruskal算法\"><a href=\"#Kruskal算法\" class=\"headerlink\" title=\"Kruskal算法\"></a>Kruskal算法</h2><p>求图的最小生成树，要求无向图。</p>\n<ol>\n<li>先去除图中所有的边。</li>\n<li>从权重最小的边开始判断。若添加后图中未形成环，则添加；若形成了换，则不添加此边。</li>\n</ol>\n<p>如何判断图中是否有环：</p>\n<ol>\n<li>首先每个节点都单独放入一个集合。</li>\n<li>添加一条边之前，判断相连两节点对应集合是否是同一个。是则不添加，不是则添加。</li>\n<li>添加一条边之后，将相连两个节点对应的集合合并。</li>\n</ol>\n<h2 id=\"Prim算法\"><a href=\"#Prim算法\" class=\"headerlink\" title=\"Prim算法\"></a>Prim算法</h2><p>求图的最小生成树，要求无向图。</p>\n<ol>\n<li>从任意节点开始访问。</li>\n<li>将当前节点放入点集合中，其连接的所有边放入边集合中。</li>\n<li>从边的集合选出权重最小的边，判断其连接的节点是否都在点集合中。不是则此边为最小生成树的一部分，标记，并将此边连接的节点放入点集合中，新放入节点连接的所有新边放入边集合中。</li>\n<li>重复步骤2-3，直至所有节点都在点集合中。</li>\n</ol>\n<h2 id=\"Dijkstra算法\"><a href=\"#Dijkstra算法\" class=\"headerlink\" title=\"Dijkstra算法\"></a>Dijkstra算法</h2><p>图中指定起点到其他各个节点的 最短路径算法，要求没有权重累加为负数的环。</p>\n<ul>\n<li>初始化一张表，表示起点到各个节点的路径。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\">A</th>\n<th align=\"center\">B</th>\n<th align=\"center\">C</th>\n<th align=\"center\">D</th>\n<th align=\"center\">E</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">A</td>\n<td align=\"center\">0</td>\n<td align=\"center\">∞</td>\n<td align=\"center\">∞</td>\n<td align=\"center\">∞</td>\n<td align=\"center\">∞</td>\n</tr>\n</tbody></table>\n<ul>\n<li>在表中选出未锁定，且值最小的节点访问，遍历该节点连接的所有边，判断是否有能让表中值更小的路径，有则更新。遍历完毕后，将该节点锁定。</li>\n</ul>\n<h2 id=\"结构\"><a href=\"#结构\" class=\"headerlink\" title=\"结构\"></a>结构</h2><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Graph</span>&lt;T&gt; &#123; <span class=\"comment\">// 图</span></span><br><span class=\"line\">    HashMap&lt;T, GraphNode&gt; nodes; <span class=\"comment\">// 图的点集</span></span><br><span class=\"line\">    HashSet&lt;GraphNode&gt; edges; <span class=\"comment\">// 图的边集</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Graph</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        nodes = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">        edges = <span class=\"keyword\">new</span> <span class=\"title class_\">HashSet</span>&lt;&gt;();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GraphNode</span>&lt;T&gt; &#123; <span class=\"comment\">// 图中的点</span></span><br><span class=\"line\">    T value; <span class=\"comment\">// 点的标识</span></span><br><span class=\"line\">    <span class=\"type\">int</span> in; <span class=\"comment\">// 点的出度</span></span><br><span class=\"line\">    <span class=\"type\">int</span> out; <span class=\"comment\">// 点的入度</span></span><br><span class=\"line\">    ArrayList&lt;GraphNode&gt; nexts; <span class=\"comment\">// 相邻可到达的点集</span></span><br><span class=\"line\">    ArrayList&lt;GraphEdge&gt; edges; <span class=\"comment\">// 以该点作为起点的边集</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">GraphNode</span><span class=\"params\">(T value)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.value = value;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.in = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.out = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.nexts = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.edges = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GraphEdge</span> &#123;<span class=\"comment\">// 图的边</span></span><br><span class=\"line\">    <span class=\"type\">int</span> weight; <span class=\"comment\">// 边的权重</span></span><br><span class=\"line\">    GraphNode from; <span class=\"comment\">// 边的起点</span></span><br><span class=\"line\">    GraphNode to; <span class=\"comment\">// 边的终点</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">GraphEdge</span><span class=\"params\">(<span class=\"type\">int</span> weight, GraphNode from, GraphNode to)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.weight = weight;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.from = from;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.to = to;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["算法"],"tags":["Java"]},{"title":"堆排序","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E5%A0%86%E6%8E%92%E5%BA%8F/","content":"<h2 id=\"堆结构\"><a href=\"#堆结构\" class=\"headerlink\" title=\"堆结构\"></a>堆结构</h2><p>堆结构就是用数组实现的完全二叉树结构。</p>\n<p>使用数组表示完全二叉树，广度遍历方式。如此，树节点的左右子节点还有父节点，下标都可以使用当前下标计算获取。</p>\n<p>下标为i的节点，左孩子节点下标为2*i+1，右孩子节点下标为2*i+2，父节点下标为(i-1)&#x2F;2 。</p>\n<p>大根堆：根节点值为整个堆的最大值。小根堆：根节点值为整个堆的最小值。</p>\n<h3 id=\"堆排序\"><a href=\"#堆排序\" class=\"headerlink\" title=\"堆排序\"></a>堆排序</h3><p>首先将数组调整成大根堆结构，即heapInsert，做法是：堆的大小初始视为0，将数组中元素逐个加入到堆中，加入后和父节点比较，维持大根堆结构，堆大小也逐步增加。</p>\n<p>调整完毕后大根堆的大小与数组相等，堆的根节点，即数组下标为0的元素，是数组的最大值。将其与堆的最后一个数据<strong>互换</strong>。<br>将堆的大小减一，重新将数组调整成堆结构。调整的方式为：</p>\n<ul>\n<li>根节点值和两个子节点中的较大值比较。</li>\n<li>如果根节点值更小，则交换节点值，重复这个比较的过程。</li>\n<li>如果根节点值更大，则不做操作，调整结束。</li>\n</ul>\n<p>让整个数组都变成大根堆结构，建立堆的过程：</p>\n<ul>\n<li>从树的根到叶子节点，时间复杂度为 O(N*logN) 。</li>\n<li>从树的叶子到根节点，时间复杂度为 O(N) 。</li>\n</ul>\n<p>把堆的最大值和堆末尾的值交换，然后减少堆的大小之后，再去调整堆，堆的大小减小成0之后，排序完成。</p>\n<p>代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ArraySort</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 堆排序</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">heapSort</span><span class=\"params\">(<span class=\"type\">int</span>[] arr)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == arr || arr.length &lt; <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> arr.length;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">            heapInsert(arr, i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">heapSize</span> <span class=\"operator\">=</span> len;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (heapSize &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            swap(arr, <span class=\"number\">0</span>, --heapSize);</span><br><span class=\"line\">            heapify(arr, <span class=\"number\">0</span>, heapSize);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 某个元素在堆的index位置，能否向上移动</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">heapInsert</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (arr[index] &gt; arr[(index - <span class=\"number\">1</span>) / <span class=\"number\">2</span>]) &#123;</span><br><span class=\"line\">            swap(arr, index, (index - <span class=\"number\">1</span>) / <span class=\"number\">2</span>);</span><br><span class=\"line\">            index = (index - <span class=\"number\">1</span>) / <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 某个元素在堆的index位置，能否向下移动</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">heapify</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> index, <span class=\"type\">int</span> heapSize)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">left</span> <span class=\"operator\">=</span> <span class=\"number\">2</span> * index + <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (left &lt; heapSize) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">largest</span> <span class=\"operator\">=</span> ((left + <span class=\"number\">1</span> &lt; heapSize) &amp;&amp; (arr[left + <span class=\"number\">1</span>] &gt; arr[left])) ? (left + <span class=\"number\">1</span>) : left;</span><br><span class=\"line\"></span><br><span class=\"line\">            largest = arr[index] &lt; arr[largest] ? largest : index;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (largest == index) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            swap(arr, index, largest);</span><br><span class=\"line\">            index = largest;</span><br><span class=\"line\">            left = <span class=\"number\">2</span> * index + <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 交换数组的两个元素</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">swap</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> i, <span class=\"type\">int</span> j)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">temp</span> <span class=\"operator\">=</span> arr[i];</span><br><span class=\"line\">        arr[i] = arr[j];</span><br><span class=\"line\">        arr[j] = temp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>PriorityQueue，优先级队列是用小根堆实现的。</p>\n</blockquote>\n<p>例：<br>一个数据流中，随时可以取得中位数。</p>\n<p>解：  </p>\n<ol>\n<li>准备一个大根堆和小根堆。</li>\n<li>当两个堆都为空时，将数据加入大根堆中。</li>\n<li>判断需要加入的数组是否小于等于大根堆的堆顶，是则放入大根堆，否则放入小根堆。</li>\n<li>判断两个堆的size差值是否等于2了，是则将较大堆堆顶元素弹出进入另一个堆。</li>\n<li>两堆各自存储了一半的元素，其堆顶元素维护着中位数的信息。</li>\n</ol>\n","categories":["算法"],"tags":["Java"]},{"title":"大数据场景处理技巧","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9C%BA%E6%99%AF%E5%A4%84%E7%90%86%E6%8A%80%E5%B7%A7/","content":"<h2 id=\"大数据场景处理技巧\"><a href=\"#大数据场景处理技巧\" class=\"headerlink\" title=\"大数据场景处理技巧\"></a>大数据场景处理技巧</h2><ul>\n<li>哈希函数可以把数据按照种类均匀分流</li>\n<li>布隆过滤器用于集合的建立与查询，并可以节省大量空间</li>\n<li>一致性哈希解决数据服务器的负载管理问题</li>\n<li>利用并查集结构做岛问题的并行计算</li>\n<li>位图解决某一范围上数字的出现情况，并可以节省大量空间</li>\n<li>利用分段统计思想，并进一步节省空间</li>\n<li>利用堆、外排序来做多个处理单元的结果合并</li>\n</ul>\n<h2 id=\"哈希分流\"><a href=\"#哈希分流\" class=\"headerlink\" title=\"哈希分流\"></a>哈希分流</h2><p>Hash() % max结果会在0 ~ max-1间均匀分布，由此可以做负载均衡。</p>\n<p>例：<br>假设有0~42亿(2^32-1)个整数，如何求出其中出现次数最多的数字。</p>\n<p>解：<br>直接用哈希表的话，至少需要32G的空间。</p>\n<p>解：</p>\n<ol>\n<li>设置100个文件，并且编号。  </li>\n<li>对于每个整数计算哈希值，对100取模，记录在编号相同的文件中。相同的数字计算出得到哈希值相同，故必然在同一个文件。</li>\n<li>对每个文件中的数字再用哈希表记录出现次数，求出出现次数最多的数字。</li>\n</ol>\n<p>如此内存的花销就能缩小100倍。</p>\n<h2 id=\"布隆过滤器\"><a href=\"#布隆过滤器\" class=\"headerlink\" title=\"布隆过滤器\"></a>布隆过滤器</h2><p>两种常用场景：巨大的url黑名单 和 爬虫访问url去重。</p>\n<h3 id=\"位图\"><a href=\"#位图\" class=\"headerlink\" title=\"位图\"></a>位图</h3><p>布隆过滤器需要使用位图。<br>位图就是 bit[]，bit类型数据的数组。但是没有直接的，所以可以用int数组间接实现。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span>[] arr = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[<span class=\"number\">10</span>]; <span class=\"comment\">// 可以表示320个bit</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">178</span>; <span class=\"comment\">// 想取得第178位bit的状态</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">numberIndex</span> <span class=\"operator\">=</span> <span class=\"number\">178</span>/<span class=\"number\">32</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">bitIndex</span> <span class=\"operator\">=</span> <span class=\"number\">178</span>%<span class=\"number\">32</span>;</span><br><span class=\"line\"><span class=\"comment\">// 获取第178位bit的状态</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> (arr[numberIndex] &gt;&gt; bitIndex) &amp; <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"comment\">// 将第178位bit状态设置为1</span></span><br><span class=\"line\">arr[numberIndex] = arr[numberIndex] | (<span class=\"number\">1</span> &lt;&lt; bitIndex);</span><br><span class=\"line\"><span class=\"comment\">// 将第178位bit状态设置为0</span></span><br><span class=\"line\">arr[numberIndex] = arr[numberIndex] &amp; (~(<span class=\"number\">1</span> &lt;&lt; bitIndex));</span><br></pre></td></tr></table></figure>\n\n<p>例：<br>32位无符号整数的范围是0~4294967295(2^32-1)，现在有一个正好包含40亿个无符号整数的文件，所以在整个范围中必然存在没出现过的数。可以使用最多1GB的内存，怎么找到所有未出现过的数。</p>\n<p>解：位图<br>准备一个长度为2^32-1的数组，遍历这40亿个数字，为数组元素做标记，则没标记过的就是未出现过的数。<br>2^32-1bit -&gt; (2^32-1)&#x2F;8 Byte -&gt; 2^29 Byte -&gt; 2^19 KB -&gt; 2^9 MB -&gt; 512M</p>\n<p>例：<br>上例中，规定最多可以使用3KB的内存，只需要找到一个未出现过的数字，如何找到。</p>\n<p>解：范围统计</p>\n<ul>\n<li>设置一个长度为512的整数数组，用于计数。2^32&#x2F;512&#x3D;2^23&#x3D;8388608  </li>\n<li>0至8388607范围内的数字每出现一次，int[0]增加1；8388608至16777216范围内的数每出现一次，int[1]增加1；以此类推。</li>\n<li>计数数组中，必然有一个元素值未达到8388608，如此就确定了缺少数字的范围。</li>\n<li>然后在这个数字返回内，重新设置长度为512的整数数组，用于计数。2^23&#x2F;512&#x3D;2^14&#x3D;16384</li>\n<li>再次计数。不断缩小范围，直至找到一个词频为0的数字。</li>\n</ul>\n<p>int[512]的内存消耗。4Byte*512&#x3D;2048Byte&lt;3KB</p>\n<p>例：32位无符号整数的范围是0~4294967295(2^32-1)，现在有一个正好包含40亿个无符号整数。可以使用最多1GB的内存，怎么找到所有出现过2次的数。</p>\n<p>解：哈希分流，计算词频</p>\n<p>解：位图</p>\n<p>使用2bit表示一个数字出现的词频，00表示未出现，01表示出现1次，10表示出现2次，11表示出现2次以上。</p>\n<p>例：<br>上例中，可以使用最多10MB的内存，如何找到这40亿个整数的中位数。</p>\n<p>解：范围统计</p>\n<ul>\n<li>设置一个长度为512的整数数组，用于计数。2^32&#x2F;512&#x3D;2^23&#x3D;8388608  </li>\n<li>0至8388607范围内的数字每出现一次，int[0]增加1；8388608至16777216范围内的数每出现一次，int[1]增加1；以此类推。</li>\n<li>中位数也就是40亿个数中的第20亿个数字，根据词频统计数组，就能够确定中位数在哪一个范围。</li>\n<li>然后在这个数字返回内，重新设置词频数组。</li>\n<li>再次计数。不断缩小范围，直至找到第20亿个数字，即中位数。</li>\n</ul>\n<h3 id=\"布隆过滤器原理\"><a href=\"#布隆过滤器原理\" class=\"headerlink\" title=\"布隆过滤器原理\"></a>布隆过滤器原理</h3><p>例：<br>假设黑名单中有100亿条url，每条url占64Byte，用户访问网站时，若url在黑名单内则不允许访问。</p>\n<p>解：<br>设置一个很大的位图，假设长度为m。</p>\n<ol>\n<li>黑名单中的url通过第一个哈希函数，计算出哈希值，对m取模，位图对应位置置1。</li>\n<li>共有k个哈希函数，全部按照步骤1的操作，对位图的k个位置置1。（重复的保持为1）。</li>\n<li>查询时，对url经过k个哈希函数的计算取模后，得到的k个位置，在位图上全都是1时，认为此url在黑名单中。</li>\n</ol>\n<p>布隆过滤器必定有误差，可能会将不在黑名单中的url，认为在黑名单中。<br>位图大小m尽可能设置大，哈希函数k选择合适的数量，可减少失误率。</p>\n<p>设 样本量为n ，失误率为p 。则合适的位图大小公式为：  </p>\n<p>$m&#x3D;\\frac{n*lnp}{(ln2)^{2}}$</p>\n<p>向上取整。</p>\n<p>根据理论的m和n，算出需要的哈希函数个数：</p>\n<p>$k&#x3D;ln2<em>\\frac mn \\approx 0.7</em>\\frac mn$</p>\n<p>向上取整。</p>\n<p>$p_{实际}&#x3D;(1-e^{-\\frac{n*k_{实际}}{m_{实际}}})^{k_{实际}}$</p>\n<h2 id=\"一致性哈希\"><a href=\"#一致性哈希\" class=\"headerlink\" title=\"一致性哈希\"></a>一致性哈希</h2><p>是一种特殊的哈希算法，目的是解决分布式缓存的问题。</p>\n<p>首先，对存储节点的哈希值进行计算，其将存储空间抽象为一个环，将存储节点配置到环上。环上所有的节点都有一个值。其次，对数据进行哈希计算，按顺时针方向将其映射到离其最近的节点上去。当有节点出现故障离线时，按照算法的映射方法，受影响的仅仅为环上故障节点开始逆时针方向至下一个节点之间区间的数据对象，而这些对象本身就是映射到故障节点之上的。当有节点增加时，比如，在节点A和B之间重新添加一个节点H，受影响的也仅仅是节点H逆时针遍历直到B之间的数据对象，将这些重新映射到H上即可，因此，当有节点出现变动时，<strong>不会使得整个存储空间上的数据都进行重新映射</strong>，解决了简单哈希算法增删节点，重新映射所有数据带来的效率低下的问题。</p>\n<p>当把服务器映射到hash环上的时候，如果服务器数量很少，很有可能出现hash环偏斜的情况，当hash环偏斜以后，缓存往往会极度不均衡的分布在各服务器上。将现有的物理节点通过虚拟的方法复制出来，这些由实际节点虚拟复制而来的节点被称为”虚拟节点”。加入虚拟节点数量很多以后，hash环上节点的分布就是均匀的了。</p>\n<h2 id=\"利用堆排序\"><a href=\"#利用堆排序\" class=\"headerlink\" title=\"利用堆排序\"></a>利用堆排序</h2><p>例：<br>某搜索公司一天的用户搜索词汇是百亿级别的数据量，请设计一种求出每天热门Top100词汇的可行办法。</p>\n<p>解：堆上加堆，二维堆</p>\n<ol>\n<li>利用哈希分流，将搜索词汇和对应词频分流到多个服务器（或区域），每个区域的词汇，根据词频大小组成大根堆。  </li>\n<li>取每个区域的堆顶元素，组织成一个总的大根堆。</li>\n<li>取出总堆的堆顶元素，即为全局最大值。</li>\n<li>取出的元素来自于哪个堆，则再将这个堆的堆顶元素加入到总堆中。</li>\n<li>重复步骤3-4，直至取出100个元素。</li>\n</ol>\n<p>例：<br>有10亿个无符号整数0~4294967295(2^32-1)，最多使用5G内存，对这10亿个整数排序。</p>\n<p>解：大小限定的堆</p>\n<ul>\n<li>根据内存大小设置使用堆的大小。大根堆。</li>\n<li>堆内元素结构存储 [数字,词频] ，根据数字大小排序。</li>\n<li>遍历这10亿个数字，数字小于堆顶元素的加入堆，堆如果满了则弹出。</li>\n<li>如此找到全局最小的一些数字，输出到结果文件中。</li>\n<li>重复遍历10亿个数字，直至排序完成。</li>\n<li>之后的遍历，需要记录阈值，忽略之前已排序过的数字。</li>\n</ul>\n","categories":["算法"],"tags":["Java"]},{"title":"字符串匹配算法","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95/","content":"<h2 id=\"KMP算法\"><a href=\"#KMP算法\" class=\"headerlink\" title=\"KMP算法\"></a>KMP算法</h2><p>例：<br>给出字符串str1和str2、长度分别为N和M，返回字符串str2在str1中第一次出现的位置，若找不到返回-1。<br>如何做到时间复杂度为O(N)。</p>\n<p>暴力匹配，时间复杂度为O(M*N)。</p>\n<h3 id=\"next数组\"><a href=\"#next数组\" class=\"headerlink\" title=\"next数组\"></a>next数组</h3><p>next[i]表示，下标i之前（包括i）的字符串中，有多大长度的相同前缀后缀。</p>\n<p>对于str2求next数组。</p>\n<p>例如str为 “aabaaf”<br>arr[0]默认为-1，arr[1]默认为0；<br>计算arr[2]时，str.substring(0,2) &#x3D; “aa”，最长相同前缀后缀为”a”，长度为1，故arr[2] &#x3D; 1;<br>计算arr[3]时，str.substring(0,3) &#x3D; “aab”，没有最长前缀后缀，故arr[2] &#x3D; 0;<br>计算arr[4]时，str.substring(0,4) &#x3D; “aaba”，最长前缀后缀为”a”，长度为1，故arr[4] &#x3D; 1;<br>计算arr[5]时，str.substring(0,5) &#x3D; “aabaa”，最长前缀后缀为”aa”，长度为2，故arr[5] &#x3D; 2;<br>计算arr[6]时，str.substring(0,6) &#x3D; “aabaaf”，没有最长前缀后缀，故arr[6] &#x3D; 0;</p>\n<p>arr[7]{-1,0,1,0,1,2,0}</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 返回字符串m在字符串s中第一次出现的位置，未找到返回-1</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">methodKMP</span><span class=\"params\">(String s, String m)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == s || <span class=\"literal\">null</span> == m || m.length() &lt; <span class=\"number\">1</span> || s.length() &lt; m.length()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">char</span>[] str1 = s.toCharArray();</span><br><span class=\"line\">    <span class=\"type\">char</span>[] str2 = m.toCharArray();</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">i1</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">i2</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span>[] next = getNextArray(str2);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i1 &lt; str1.length &amp;&amp; i2 &lt; str2.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (str1[i1] == str2[i2]) &#123;</span><br><span class=\"line\">            i1++;</span><br><span class=\"line\">            i2++;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (-<span class=\"number\">1</span> == next[i2]) &#123;</span><br><span class=\"line\">            i1++;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            i2 = next[i2];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (i2 == str2.length) ? i1 - i2 : -<span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取next数组</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span>[] getNextArray(<span class=\"type\">char</span>[] m) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"number\">1</span> == m.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[]&#123;-<span class=\"number\">1</span>&#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">int</span>[] next = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[m.length];</span><br><span class=\"line\">    next[<span class=\"number\">0</span>] = -<span class=\"number\">1</span>;</span><br><span class=\"line\">    next[<span class=\"number\">1</span>] = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">cnt</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &lt; next.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m[i - <span class=\"number\">1</span>] == m[cnt]) &#123;</span><br><span class=\"line\">            cnt++;</span><br><span class=\"line\">            next[i] = cnt;</span><br><span class=\"line\">            i++;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (cnt &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            cnt = next[cnt];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            next[i] = <span class=\"number\">0</span>;</span><br><span class=\"line\">            i++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> next;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Manacher算法\"><a href=\"#Manacher算法\" class=\"headerlink\" title=\"Manacher算法\"></a>Manacher算法</h2><p>例：leetcode-5 最长回文串 longest-palindromic-substring<br>给定一个字符串 s，找到 s 中最长的回文子串。<br>如何做到时间复杂度为O(N)。</p>\n<h3 id=\"回文直径和回文半径\"><a href=\"#回文直径和回文半径\" class=\"headerlink\" title=\"回文直径和回文半径\"></a>回文直径和回文半径</h3><p>首先，处理字符串，在开头、结尾、以及每个字符之间插入特殊字符。<br>例如将”abccba” 处理成”#a#b#c#c#b#a#”，便于处理对称轴在字符之间的情况。</p>\n<p>回文半径：以一个中心位置i，向两边扩展，得到的回文串的长度叫做该位置的回文直径，回文串一半的长度叫做该位置的回文半径。</p>\n<p>遍历字符串的字符，每次记录，维护回文右侧半径到达的最远位置，和当时的中心位置。</p>\n<p>如此，遍历字符串时会有两种大情况：</p>\n<ol>\n<li>当前字符位置在最远回文位置左侧</li>\n<li>当前字符位置在最远回文位置上，或其右侧。</li>\n</ol>\n<p>对于情况1，可以进行优化：</p>\n<p>当前最大回文半径中心位置在c，其回文半径为()；当前遍历到的字符位置i，关于中心c的对称点i’的回文半径用[]来表示。</p>\n<ul>\n<li>最远回文半径c完全包含i’的回文半径时。i的回文半径长度和i’相同。</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">__(__[__i&#x27;__]__c____i____)__</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>最远回文半径c和i’的回文半径有交叉部分，或者边界重合时。则i的回文半径至少是i位置和当前最远回文半径的距离。</li>\n</ul>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">__[__(__i&#x27;____]_c_____i___)__</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">__([___i&#x27;___]_c____i____)__</span><br></pre></td></tr></table></figure>\n\n<p>以上逻辑，试过了拿去直接code的话，各种边界条件判断麻烦死了…</p>\n<p>实际上只需要通过之前记录过字符的回文半径，算出当前位置可以确定为回文的半径。从这里继续判断回文半径是否能增大。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">manacher</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == s || <span class=\"number\">0</span> == s.length()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">char</span>[] str = manacherString(s);</span><br><span class=\"line\">    <span class=\"type\">int</span>[] pArr = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[str.length]; <span class=\"comment\">//pArr[i]实际上表示的是，i位置回文半径+1</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">R</span> <span class=\"operator\">=</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">C</span> <span class=\"operator\">=</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">max</span> <span class=\"operator\">=</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; str.length; i++) &#123;</span><br><span class=\"line\">        pArr[i] = R &gt; i ? Math.min(R - i, pArr[<span class=\"number\">2</span> * C - i]) : <span class=\"number\">1</span>; <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"comment\">//从这个地方开始，继续判断回文半径能否增大。主要就在这里优化</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (i - pArr[i] &gt; -<span class=\"number\">1</span> &amp;&amp; i + pArr[i] &lt; str.length) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (str[i - pArr[i]] == str[i + pArr[i]]) &#123;</span><br><span class=\"line\">                pArr[i]++;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        max = Math.max(max, pArr[i]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> max - <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">char</span>[] manacherString(String str) &#123;</span><br><span class=\"line\">    <span class=\"type\">char</span>[] charArr = str.toCharArray();</span><br><span class=\"line\">    <span class=\"type\">char</span>[] res = <span class=\"keyword\">new</span> <span class=\"title class_\">char</span>[<span class=\"number\">2</span> * str.length() + <span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; res.length; i++) &#123;</span><br><span class=\"line\">        res[i] = (i &amp; <span class=\"number\">1</span>) == <span class=\"number\">0</span> ? <span class=\"string\">&#x27;#&#x27;</span> : charArr[i / <span class=\"number\">2</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["算法"],"tags":["Java"]},{"title":"并查集","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E5%B9%B6%E6%9F%A5%E9%9B%86/","content":"<h2 id=\"并查集\"><a href=\"#并查集\" class=\"headerlink\" title=\"并查集\"></a>并查集</h2><p>并查集是一种树型的数据结构，用于处理一些不相交集合（disjoint sets）的合并及查询问题。</p>\n<p>主要实现两个方法：</p>\n<ul>\n<li>isSameSet(ElementA, ElementB); &#x2F;&#x2F; 判断两元素是否处于同一个集合。</li>\n<li>union(SetA, SetB); &#x2F;&#x2F; 将两个集合合并为一个集合。</li>\n</ul>\n<p>例：leetcode-695 岛屿的最大面积 max-area-of-island<br>一个矩阵中只有0和1两种值，每个位置可以和自己的上下左右相连，如果有一片1连在一起，这个部分被称为一座岛，求一个矩阵中有多少座岛，最大面积是多少。  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">例如：  </span><br><span class=\"line\"><span class=\"number\">001010</span></span><br><span class=\"line\"><span class=\"number\">111010</span></span><br><span class=\"line\"><span class=\"number\">100100</span></span><br><span class=\"line\"><span class=\"number\">000000</span></span><br><span class=\"line\">这个矩阵中有<span class=\"number\">3</span>座岛，最大面积为<span class=\"number\">4</span></span><br></pre></td></tr></table></figure>\n\n<p>解：普通遍历扫描，传染算法。</p>\n<p>问：如何设计一个并行算法解决这个问题</p>\n<p>答：<br>将矩阵分为多个区域，每个区域单独计算岛屿。<br>为分割边界，且是岛屿的点，记录其是哪个岛屿上的，可用岛屿最左上角的点来代表。<br>遍历岛屿点在边界相邻的情况，使用并查集，将每个区域单独计算的岛屿合并起来。</p>\n<h3 id=\"并查集原理\"><a href=\"#并查集原理\" class=\"headerlink\" title=\"并查集原理\"></a>并查集原理</h3><p>树形结构。每个元素有一个next指针<br>每个集合内有一个代表节点，其next指针指向自己。<br>判断两元素是否处于同一个集合时，通过判断当前集合代表节点是否为同一个来实现。<br>将两个集合合并为一个集合时，将元素数量较少集合的代表节点的next指针，指向另一集合代表节点上。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Element</span>&lt;V&gt; &#123; <span class=\"comment\">// 为容器内元素做一层封装，节点</span></span><br><span class=\"line\">    V value;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Element</span><span class=\"params\">(V value)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.value = value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">UnionFindSet</span>&lt;V&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 元素 和 元素封装 的映射</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> HashMap&lt;V, Element&lt;V&gt;&gt; elementMap;</span><br><span class=\"line\">    <span class=\"comment\">// 元素 和 父元素 的映射，即next指针</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> HashMap&lt;Element&lt;V&gt;, Element&lt;V&gt;&gt; fatherMap;</span><br><span class=\"line\">    <span class=\"comment\">// 集合的代表元素节点 和 集合大小 的映射</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> HashMap&lt;Element&lt;V&gt;, Integer&gt; sizeMap;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 构造函数，初始化</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">UnionFindSet</span><span class=\"params\">(List&lt;V&gt; list)</span> &#123;</span><br><span class=\"line\">        elementMap = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">        fatherMap = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">        sizeMap = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (V value : list) &#123;</span><br><span class=\"line\">            Element&lt;V&gt; element = <span class=\"keyword\">new</span> <span class=\"title class_\">Element</span>&lt;V&gt;(value);</span><br><span class=\"line\">            elementMap.put(value, element);</span><br><span class=\"line\">            fatherMap.put(element, element);</span><br><span class=\"line\">            sizeMap.put(element, <span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 寻找节点所在集合的代表节点</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Element&lt;V&gt; <span class=\"title function_\">findHead</span><span class=\"params\">(Element&lt;V&gt; element)</span> &#123;</span><br><span class=\"line\">        Deque&lt;Element&lt;V&gt;&gt; path = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayDeque</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (element != fatherMap.get(element)) &#123;</span><br><span class=\"line\">            path.push(element);</span><br><span class=\"line\">            element = fatherMap.get(element);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (!path.isEmpty()) &#123;</span><br><span class=\"line\">            fatherMap.put(path.pop(), element);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> element;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 判断两元素是否处于同一个集合</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isSameSet</span><span class=\"params\">(V a, V b)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (elementMap.containsKey(a) &amp;&amp; elementMap.containsKey(b)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> findHead(elementMap.get(a)) == findHead(elementMap.get(b));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 合并两个集合</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">union</span><span class=\"params\">(V a, V b)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (elementMap.containsKey(a) &amp;&amp; elementMap.containsKey(b)) &#123;</span><br><span class=\"line\">            Element&lt;V&gt; aF = findHead(elementMap.get(a));</span><br><span class=\"line\">            Element&lt;V&gt; bF = findHead(elementMap.get(b));</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (aF != bF) &#123;</span><br><span class=\"line\">                Element&lt;V&gt; big = sizeMap.get(aF) &gt;= sizeMap.get(bF) ? aF : bF;</span><br><span class=\"line\">                Element&lt;V&gt; small = big == aF ? bF : aF;</span><br><span class=\"line\">                fatherMap.put(small, big);</span><br><span class=\"line\">                sizeMap.put(big, sizeMap.get(aF) + sizeMap.get(bF));</span><br><span class=\"line\">                sizeMap.remove(small);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["算法"],"tags":["Java"]},{"title":"归并排序和随机快排","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%92%8C%E9%9A%8F%E6%9C%BA%E5%BF%AB%E6%8E%92/","content":"<h2 id=\"归并排序\"><a href=\"#归并排序\" class=\"headerlink\" title=\"归并排序\"></a>归并排序</h2><p>整体是递归：分成两个子数组，左边排好序，右边排好序，merge让整体有序。时间复杂度O(N*logN)，空间复杂度O(N*logN)。</p>\n<p>归并排序的实质是把比较行为变成了有序信息并传递，比O(N^2)的排序快。</p>\n<h3 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 归并排序</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">mergeSort</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> left, <span class=\"type\">int</span> right)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 递归中止条件</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (left &gt;= right) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 中点下标值</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">mid</span> <span class=\"operator\">=</span> left + ((right - left) &gt;&gt; <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 左右子数组各自排序</span></span><br><span class=\"line\">    mergeSort(arr, left, mid);</span><br><span class=\"line\">    mergeSort(arr, mid + <span class=\"number\">1</span>, right);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 将左右子数组合并，也可以另写一个merge函数</span></span><br><span class=\"line\">    <span class=\"type\">int</span>[] arr_new = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[right - left + <span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">index1</span> <span class=\"operator\">=</span> left;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">index2</span> <span class=\"operator\">=</span> mid + <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (; index1 &lt;= mid &amp;&amp; index2 &lt;= right;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (arr[index1] &lt;= arr[index2]) &#123;</span><br><span class=\"line\">            arr_new[index++] = arr[index1++];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            arr_new[index++] = arr[index2++];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (index1 &lt;= mid) &#123;</span><br><span class=\"line\">        arr_new[index++] = arr[index1++];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (index2 &lt;= right) &#123;</span><br><span class=\"line\">        arr_new[index++] = arr[index2++];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; arr_new.length; i++) &#123;</span><br><span class=\"line\">        arr[left + i] = arr_new[i];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h3><p>在一个数组中，一个数左边比它小的数的总和，叫数的小和，所有数的小和累加起来，叫数组小和。设计算法求数组小和。</p>\n<p>思路：</p>\n<p>转换计算方式，一个数字右边有几个比它更大的数字，则计算小和的时候，就被计算几次。</p>\n<p>进行归并排序，在merge的过程中，如果左边数组的数字比右边数组中的数字小，说明左边的数字会被计算进小和，计算的次数是比右边数字更大数字的个数，即在右边数字位置更靠右数字的个数。</p>\n<h2 id=\"快速排序\"><a href=\"#快速排序\" class=\"headerlink\" title=\"快速排序\"></a>快速排序</h2><p>选中数组中的一个数num，将数组分成两部分，小于等于num的在数组左边，大于num的在数组右边。如此保证数组部分有序，然后对子数组做相同的操作。</p>\n<p>划分值越靠近中间，性能越好。所以随机快排，是随机选择划分值num的，时间复杂度O(N*logN)，额外空间复杂度O(logN)。</p>\n<h3 id=\"代码-1\"><a href=\"#代码-1\" class=\"headerlink\" title=\"代码\"></a>代码</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 随机快速排序</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">quickSort</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> left, <span class=\"type\">int</span> right)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 递归中止条件</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (left &gt;= right) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 随机选取比较的值</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> left + (<span class=\"type\">int</span>) ((right - left + <span class=\"number\">1</span>) * Math.random());</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">pivot</span> <span class=\"operator\">=</span> arr[index];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 定义小于区和大于区边界</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">ltIndex</span> <span class=\"operator\">=</span> left - <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">gtIndex</span> <span class=\"operator\">=</span> right + <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> left; i &lt; gtIndex;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (arr[i] &lt; pivot) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> arr[ltIndex + <span class=\"number\">1</span>];</span><br><span class=\"line\">            arr[ltIndex + <span class=\"number\">1</span>] = arr[i];</span><br><span class=\"line\">            arr[i] = t;</span><br><span class=\"line\"></span><br><span class=\"line\">            ltIndex++;</span><br><span class=\"line\">            i++;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (arr[i] &gt; pivot) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> arr[gtIndex - <span class=\"number\">1</span>];</span><br><span class=\"line\">            arr[gtIndex - <span class=\"number\">1</span>] = arr[i];</span><br><span class=\"line\">            arr[i] = t;</span><br><span class=\"line\"></span><br><span class=\"line\">            gtIndex--;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            i++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 将小于区和大于区的子数组分别排序</span></span><br><span class=\"line\">    quickSort(arr, left, ltIndex);</span><br><span class=\"line\">    quickSort(arr, gtIndex, right);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["算法"],"tags":["Java"]},{"title":"暴力递归和动态规划","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E6%9A%B4%E5%8A%9B%E9%80%92%E5%BD%92%E5%92%8C%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/","content":"<h2 id=\"递归转换为动态规划\"><a href=\"#递归转换为动态规划\" class=\"headerlink\" title=\"递归转换为动态规划\"></a>递归转换为动态规划</h2><p>暴力递归就是尝试</p>\n<ul>\n<li>把所有问题转化为规模更小的同类子问题。</li>\n<li>有明确的不需要递归的子条件 base case。</li>\n<li>得到子问题的结果后，有明确的决策方案。</li>\n<li>不记录每个子问题的解。</li>\n</ul>\n<p>尝试方式，尽量让单个可变参数维度低，尽量让可变参数数量少。<br>（比如int就是0维，int[]是1维）</p>\n<p>暴力递归可以转换为动态对话，整个流程为：</p>\n<ol>\n<li>从业务逻辑尝试，找出暴力递归的方法</li>\n<li>转为记忆化搜索动态规划，不整理各个状态之间的依赖。</li>\n<li>严格表结构的动态规划。（在某些问题上，记忆化搜索动态规划和严格表结构的动态规划有同样的复杂度）</li>\n<li>根据严格表结构的动态规划进一步优化。</li>\n</ol>\n<p>记忆化搜索动态规划转换为严格表结构的动态规划步骤：</p>\n<ol>\n<li>分析可变参数的变化范围</li>\n<li>标出计算的终止位置。</li>\n<li>标出初始状态。（base case）</li>\n<li>分析表格依赖</li>\n<li>确定计算顺序，进行计算。</li>\n</ol>\n<p>例：leetcode-51 N皇后 n-queens<br>n 皇后问题 研究的是如何将 n 个皇后放置在 n×n 的棋盘上，并且使皇后彼此之间不能相互攻击。<br>给你一个整数 n ，返回所有不同的 n 皇后问题的解决方案。<br>每一种解法包含一个不同的 n 皇后问题 的棋子放置方案，该方案中 ‘Q’ 和 ‘.’ 分别代表了皇后和空位。</p>\n<p>例：汉诺塔问题。</p>\n<p>解：  </p>\n<ol>\n<li>将三个柱子分为from、to、other。</li>\n<li>求解i层汉诺塔可记为func(i,from,to,other)。</li>\n<li>则移动步骤可分为3步：将上i-1层的塔移动到other柱上，将底层塔移动到to柱上，将上层i-1层塔从other柱上移到to柱上。</li>\n<li>func(i-1,from,other,to) -&gt; func(1,from,to,other) -&gt; func(i-1,other,from,to) 。</li>\n</ol>\n<p>例：打印一个字符串的全部子序列，包括空字符串。</p>\n<p>解：全排列。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">process</span><span class=\"params\">(<span class=\"type\">char</span>[] str,<span class=\"type\">int</span> i)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(i == str.length-<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">        System.out.println(String.valueOf(str));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> i;j&lt;str.length;j++)&#123;</span><br><span class=\"line\">        swap(str,i,j);</span><br><span class=\"line\">        process(str,i+<span class=\"number\">1</span>);</span><br><span class=\"line\">        swap(str,i,j);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>例：leetcode-486 预测赢家 predict-the-winner<br>给你一个整数数组 nums 。玩家 1 和玩家 2 基于这个数组设计了一个游戏。<br>玩家 1 和玩家 2 轮流进行自己的回合，玩家 1 先手。开始时，两个玩家的初始分值都是 0 。每一回合，玩家从数组的任意一端取一个数字（即，nums[0] 或 nums[nums.length - 1]），取到的数字将会从数组中移除（数组长度减 1 ）。玩家选中的数字将会加到他的得分上。当数组中没有剩余数字可取时，游戏结束。<br>如果玩家 1 能成为赢家，返回 true 。如果两个玩家得分相等，同样认为玩家 1 是游戏的赢家，也返回 true 。你可以假设每个玩家的玩法都会使他的分数最大化。</p>\n<p>例：<br>输入：nums &#x3D; [1,5,233,7]<br>输出：true<br>解释：玩家 1 一开始选择 1 。然后玩家 2 必须从 5 和 7 中进行选择。无论玩家 2 选择了哪个，玩家 1 都可以选择 233 。<br>最终，玩家 1（234 分）比玩家 2（12 分）获得更多的分数，所以返回 true，表示玩家 1 可以成为赢家。</p>\n<p>解：暴力递归<br>先手对数组l到r范围，拿到的分数定义为funcF(arr,l,r)。则有</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">funcF(arr, l, r)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(l == r) <span class=\"keyword\">return</span> arr[l];</span><br><span class=\"line\">    max(arr[l] + funcS(arr, l+<span class=\"number\">1</span>, r), arr[r]+funcS(arr, l, r+<span class=\"number\">1</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>后手对数组l到r范围，拿到的分数定义为funcS(arr,l,r)。则有</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">funcS(arr, l, r)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(l == r) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    min(arr[l] + funcF(arr, l+<span class=\"number\">1</span>, r), arr[r]+funcF(arr, l, r+<span class=\"number\">1</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>解：动态规划</p>\n<p>因为有两个递归函数，所以如果改成动态规划，则需要两个dp数组。<br>dp数组的计算顺序，按对角线推进；并且，两个数组的值需要交替计算。</p>\n<p>例：将栈中，不显式申请额外空间，利用系统调用栈。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">func</span><span class=\"params\">(Stack&lt;Integer&gt; stack)</span>&#123; <span class=\"comment\">// 将栈底元素弹出，其他元素顺序布标</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> stack.pop();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(stack.isEmpty())&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> value;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">last</span> <span class=\"operator\">=</span> func(stack); <span class=\"comment\">// 会获得栈底元素</span></span><br><span class=\"line\">        stack.push(value); <span class=\"comment\">// 栈空后才会执行到这里，执行入栈的元素顺序，，是原先的栈底元素到栈顶</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> last; <span class=\"comment\">// 栈底元素在调用栈中一路向上传递</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">reverse</span><span class=\"params\">(Stack&lt;Integer&gt; stack)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(stack.isEmpty())&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> func(stack); <span class=\"comment\">// 获取栈底元素</span></span><br><span class=\"line\">        reverse(stack);</span><br><span class=\"line\">        stack.push(value); <span class=\"comment\">// 栈空后才会执行到这里，而执行入栈的元素顺序，是原先的栈顶元素到栈底（由于func拿的是栈底元素）</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>例：<br>规定1对应A，2对应B，3对应C…<br>那么一串数字”111”，就可以转换为”AAA”,”AK”,”KA” 。<br>给定一串数字，返回有多少种转化结果。</p>\n<p>解：<br>对于数字字符串在i-1位置都确定的情况下，可能的转化结果用func(str, i)表示<br>func的逻辑<br>如果i &#x3D;&#x3D; str.length(); return 1；<br>如果str.charAt(i) &#x3D;&#x3D; ‘0’; return 0;<br>如果能和i+1位置的数字组成可转化的两位数，则返回值加上func(str, i+1)和func(str, i+2)的结果。<br>否则只加上func(str, i+1)的结果。</p>\n<p>例：<br>给定两个数组weights[i] 和 values[i] 分别代表第i号货物的重量和价值。<br>给定一个正数bag，表示一个袋子的载重量，返回袋子能装下货物价值的最大值。</p>\n<p>解：暴力递归  </p>\n<ol>\n<li>遍历</li>\n<li>如果袋中已有重量超过了载重量，代表方案不应存在，返回一个绝对劣势值0；</li>\n<li>如果已经遍历完，i &#x3D;&#x3D; weights.length; 返回 0；</li>\n<li>对于将i号货物装入或不装入两种情况，递归调用此方法，返回较大值。</li>\n</ol>\n<p>解：动态规划</p>\n<p>例：<br>给定整数N，表示有N个位置1~N，给定机器人的初始位置S和目标位置E，给定机器人必须走的步数K。<br>求出机器人从初始位置走到到目标位置，一共有几种行走路径。<br>机器人的行走规则，每次可以向左走一步（N到N-1），或者向右走一步（N到N+1）。在1位置只能向右走，在N位置只能向左走。</p>\n<p>解：递归</p>\n<p>用函数 f(N, E, rest, cur) ，表示N个位置，目标位置是e，剩余步数为rest，当前位置为cur时，有几种到达目标位置的路径。</p>\n<p>则有</p>\n<p>f(N, E, rest, cur) &#x3D; f(N, E, rest - 1, cur - 1) + f(N, E, rest - 1, cur + 1); (cur !&#x3D; 1 &amp;&amp; cur !&#x3D; N)<br>f(N, E, rest, cur) &#x3D; f(N, E, rest - 1, cur - 1); (cur &#x3D;&#x3D; N)<br>f(N, E, rest, cur) &#x3D; f(N, E, rest - 1, cur + 1); (cur &#x3D;&#x3D; 1)</p>\n<p>base case则是</p>\n<p>f(N, E, 0, cur) &#x3D; 1; (cur &#x3D;&#x3D; E)<br>f(N, E, 0, cur) &#x3D; 0; (cur !&#x3D; E)</p>\n<p>使用递归解题的代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">f</span><span class=\"params\">(<span class=\"type\">int</span> N, <span class=\"type\">int</span> E, <span class=\"type\">int</span> rest, <span class=\"type\">int</span> cur)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (rest == <span class=\"number\">0</span>) &#123; <span class=\"comment\">// base case</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (cur == E) ? <span class=\"number\">1</span> : <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cur == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> f(N, E, rest - <span class=\"number\">1</span>, cur + <span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (cur == N) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> f(N, E, rest - <span class=\"number\">1</span>, cur - <span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> f(N, E, rest - <span class=\"number\">1</span>, cur + <span class=\"number\">1</span>) + f(N, E, rest - <span class=\"number\">1</span>, cur - <span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>转换为记忆化搜索，加了一个缓存数组，避免递归过程中的重复计算。<br>例如f(N, E, 3, 1) 和 f(N, E, 3, 3)下一步都会调用 f(N, E, 2, 2) 造成重复计算。<br>此时f(N, E, 2, 2)的计算结果，和是谁调用的它，没有关系。称为<strong>无后效性</strong>。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">K</span> <span class=\"operator\">=</span> <span class=\"number\">4</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">N</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span>[][] dp = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[K + <span class=\"number\">1</span>][N + <span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt;= K; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; j &lt;= N; j++) &#123;</span><br><span class=\"line\">            dp[i][j] = -<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    System.out.println(f(N, <span class=\"number\">4</span>, K, <span class=\"number\">2</span>, dp));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">f</span><span class=\"params\">(<span class=\"type\">int</span> N, <span class=\"type\">int</span> E, <span class=\"type\">int</span> rest, <span class=\"type\">int</span> cur, <span class=\"type\">int</span>[][] dp)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dp[rest][cur] != -<span class=\"number\">1</span>) &#123; <span class=\"comment\">// 缓存命中</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> dp[rest][cur];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 缓存未命中</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (rest == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        dp[rest][cur] = (cur == E) ? <span class=\"number\">1</span> : <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dp[rest][cur];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cur == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        dp[rest][cur] = f(N, E, rest - <span class=\"number\">1</span>, cur + <span class=\"number\">1</span>, dp);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dp[rest][cur];</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (cur == N) &#123;</span><br><span class=\"line\">        dp[rest][cur] = f(N, E, rest - <span class=\"number\">1</span>, cur - <span class=\"number\">1</span>, dp);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dp[rest][cur];</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        dp[rest][cur] = f(N, E, rest - <span class=\"number\">1</span>, cur + <span class=\"number\">1</span>, dp) + f(N, E, rest - <span class=\"number\">1</span>, cur - <span class=\"number\">1</span>, dp);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dp[rest][cur];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>转换成 严格表结构的动态规划。<br>记忆化搜索，不关注dp表结构之间的关系，而严格表结构的动态规划，需要整理利用这些关系。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">f</span><span class=\"params\">(<span class=\"type\">int</span> N, <span class=\"type\">int</span> E, <span class=\"type\">int</span> K, <span class=\"type\">int</span> S)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span>[][] dp = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[K + <span class=\"number\">1</span>][N + <span class=\"number\">1</span>]; <span class=\"comment\">// i剩余步数，j当前位置</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; j &lt;= N; j++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (j == E) &#123;</span><br><span class=\"line\">            dp[<span class=\"number\">0</span>][j] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            dp[<span class=\"number\">0</span>][j] = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; i &lt;= K; i++) &#123;</span><br><span class=\"line\">        dp[i][<span class=\"number\">1</span>] = dp[i - <span class=\"number\">1</span>][<span class=\"number\">2</span>];</span><br><span class=\"line\">        dp[i][N] = dp[i - <span class=\"number\">1</span>][N - <span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">2</span>; j &lt; N; j++) &#123;</span><br><span class=\"line\">            dp[i][j] = dp[i - <span class=\"number\">1</span>][j + <span class=\"number\">1</span>] + dp[i - <span class=\"number\">1</span>][j - <span class=\"number\">1</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> dp[K][S];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>例：<br>给定一个正数数组，其中每一个元素代表一枚硬币，元素值代表硬币面值，再给定一个目标值aim。从数组中拿出若干枚硬币，硬币面值的和为aim。<br>求如何拿硬币能使得硬币数目最少。</p>\n<p>解：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// arr：硬币数组</span></span><br><span class=\"line\"><span class=\"comment\">// index：从index开始的硬币进行自由选择</span></span><br><span class=\"line\"><span class=\"comment\">// rest：剩余的目标值</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">f</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> index, <span class=\"type\">int</span> rest)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (rest &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (rest == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index == arr.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">p1</span> <span class=\"operator\">=</span> f(arr, index + <span class=\"number\">1</span>, rest);</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">p2</span> <span class=\"operator\">=</span> f(arr, index + <span class=\"number\">1</span>, rest - arr[index]);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (p1 == -<span class=\"number\">1</span> &amp;&amp; p2 == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (p1 == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> p2 + <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (p2 == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> p1;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Math.min(p1, p2 + <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>转换成记忆化搜索</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span>[] arr = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[]&#123;<span class=\"number\">2</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">6</span>&#125;;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">aim</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span>[][] dp = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[arr.length + <span class=\"number\">1</span>][aim + <span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt;= arr.length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; j &lt;= aim; j++) &#123;</span><br><span class=\"line\">            dp[i][j] = -<span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    System.out.println(f(arr, <span class=\"number\">0</span>, aim, dp));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">f</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> index, <span class=\"type\">int</span> rest, <span class=\"type\">int</span>[][] dp)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (rest &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dp[index][rest] != -<span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dp[index][rest];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (rest == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        dp[index][rest] = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (index == arr.length) &#123;</span><br><span class=\"line\">        dp[index][rest] = -<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">p1</span> <span class=\"operator\">=</span> f(arr, index + <span class=\"number\">1</span>, rest, dp);</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">p2</span> <span class=\"operator\">=</span> f(arr, index + <span class=\"number\">1</span>, rest - arr[index], dp);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (p1 == -<span class=\"number\">1</span> &amp;&amp; p2 == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            dp[index][rest] = -<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (p1 == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                dp[index][rest] = p2 + <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (p2 == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                dp[index][rest] = p1;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                dp[index][rest] = Math.min(p1, p2 + <span class=\"number\">1</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> dp[index][rest];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>转换成严格表结构的动态规划</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span>[] arr = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[]&#123;<span class=\"number\">2</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">9</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">6</span>&#125;;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">aim</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    System.out.println(f(arr, aim));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">f</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> aim)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span>[][] dp = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[arr.length + <span class=\"number\">1</span>][aim + <span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt;= arr.length; i++) &#123;</span><br><span class=\"line\">        dp[i][<span class=\"number\">0</span>] = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; j &lt;= aim; j++) &#123;</span><br><span class=\"line\">        dp[arr.length][j] = -<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> arr.length - <span class=\"number\">1</span>; i &gt;= <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; j &lt;= aim; j++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">p1</span> <span class=\"operator\">=</span> dp[i + <span class=\"number\">1</span>][j];</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">p2</span> <span class=\"operator\">=</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (j - arr[i] &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                p2 = dp[i + <span class=\"number\">1</span>][j - arr[i]];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> (p1 == -<span class=\"number\">1</span> &amp;&amp; p2 == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                dp[i][j] = -<span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (p1 == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                    dp[i][j] = p2 + <span class=\"number\">1</span>;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (p2 == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                    dp[i][j] = p1;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    dp[i][j] = Math.min(p1, p2 + <span class=\"number\">1</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> dp[<span class=\"number\">0</span>][aim];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>例：将象棋棋盘转换为坐标系，左下角为(0,0)。当前马在(0,0)位置。规定马到达(x,y)位置，且只能走K步，问有多少种路径。</p>\n<p>解：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">process</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y, <span class=\"type\">int</span> step)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (x &lt; <span class=\"number\">0</span> || x &gt;= <span class=\"number\">9</span> || y &lt; <span class=\"number\">0</span> || y &gt;= <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (step == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (x == <span class=\"number\">0</span> &amp;&amp; y == <span class=\"number\">0</span>) ? <span class=\"number\">1</span> : <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> process(x - <span class=\"number\">1</span>, y - <span class=\"number\">2</span>, step - <span class=\"number\">1</span>) +</span><br><span class=\"line\">            process(x - <span class=\"number\">2</span>, y - <span class=\"number\">1</span>, step - <span class=\"number\">1</span>) +</span><br><span class=\"line\">            process(x + <span class=\"number\">1</span>, y - <span class=\"number\">2</span>, step - <span class=\"number\">1</span>) +</span><br><span class=\"line\">            process(x + <span class=\"number\">2</span>, y - <span class=\"number\">1</span>, step - <span class=\"number\">1</span>) +</span><br><span class=\"line\">            process(x + <span class=\"number\">2</span>, y + <span class=\"number\">1</span>, step - <span class=\"number\">1</span>) +</span><br><span class=\"line\">            process(x + <span class=\"number\">1</span>, y + <span class=\"number\">2</span>, step - <span class=\"number\">1</span>) +</span><br><span class=\"line\">            process(x - <span class=\"number\">1</span>, y + <span class=\"number\">2</span>, step - <span class=\"number\">1</span>) +</span><br><span class=\"line\">            process(x - <span class=\"number\">2</span>, y + <span class=\"number\">1</span>, step - <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>转成递归方式的话，则需要三维数组dp[x][y][step]。</p>\n<p>数组计算的顺序：<br>step&#x3D;0时，除了dp[0][0][0]&#x3D;1之外，其余dp[x][y][0]的值全为0；<br>step&#x3D;1时的数组值，可以由step&#x3D;0时的值推出，就这样一层一层计算。</p>\n<p>例：给定一个M*N的方格，玩家初始位置在(a,b) （不一定在表格中），需要行走K步，每一步等概率向上下左右走一格子。途中如果超过了MN方格的范围，则会立即死亡。求玩家存活概率。</p>\n<p>解：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 玩家行走路径一共有4^K种，只需计算玩家走完K步之后的方法数</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">process</span><span class=\"params\">(<span class=\"type\">int</span> M, <span class=\"type\">int</span> N, <span class=\"type\">int</span> x, <span class=\"type\">int</span> y, <span class=\"type\">int</span> step)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (x &lt; <span class=\"number\">0</span> || x &gt;= M || y &lt; <span class=\"number\">0</span> || y &gt;= N) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (step == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> process(M, N, x - <span class=\"number\">1</span>, y - <span class=\"number\">1</span>, step - <span class=\"number\">1</span>) +</span><br><span class=\"line\">            process(M, N, x - <span class=\"number\">1</span>, y + <span class=\"number\">1</span>, step - <span class=\"number\">1</span>) +</span><br><span class=\"line\">            process(M, N, x + <span class=\"number\">1</span>, y - <span class=\"number\">1</span>, step - <span class=\"number\">1</span>) +</span><br><span class=\"line\">            process(M, N, x + <span class=\"number\">1</span>, y + <span class=\"number\">1</span>, step - <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>例：给定一个正数数组arr，其中元素值表示货币的面值，只要拥有该面值的货币，就可以无限制拿取；给定aim，求拿取货币合计面值为aim的方法数。</p>\n<p>解：递归</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">process</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> index, <span class=\"type\">int</span> rest)</span> &#123; <span class=\"comment\">// arr 面值数组，index之前的面值已经决定好，rest剩余目标合计值</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index == arr.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> rest == <span class=\"number\">0</span> ? <span class=\"number\">1</span> : <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">sum</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">take</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; take * arr[index] &lt;= rest; take++) &#123;</span><br><span class=\"line\">        sum = sum + process(arr, index + <span class=\"number\">1</span>, rest - take * arr[index]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sum;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>解：动态规划</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">process</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> aim)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> arr.length;</span><br><span class=\"line\">    <span class=\"type\">int</span>[][] dp = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[len + <span class=\"number\">1</span>][aim + <span class=\"number\">1</span>];</span><br><span class=\"line\">    dp[len][<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> len - <span class=\"number\">1</span>; index &gt;= <span class=\"number\">0</span>; index--) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">rest</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; rest &lt;= aim; rest++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">sum</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">take</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; take * arr[index] &lt;= rest; take++) &#123;</span><br><span class=\"line\">                sum = sum + dp[index + <span class=\"number\">1</span>][rest - take * arr[index]];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            dp[index][rest] = sum;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> dp[<span class=\"number\">0</span>][aim];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>斜率优化</p>\n<p>根据dp表结构，和计算顺序。<br>dp[index][rest]的计算，需要依赖dp[index+1][rest]、dp[index+1][rest-1*arr[index]]、dp[index+1][rest-2*arr[index]]、…、dp[index+1][接近0]。<br>而在计算dp[index][rest-1*arr[index]]的时候，dp[index+1][rest-2*arr[index]]、dp[index+1][rest-3*arr[index]]、…、dp[index+1][接近0]的和值就已经计算过了。<br>所以dp数组计算方式可以优化为dp[index][rest] &#x3D; dp[index+1][rest] + dp[index][rest-arr[index]]</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">process</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> aim)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> arr.length;</span><br><span class=\"line\">    <span class=\"type\">int</span>[][] dp = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[len + <span class=\"number\">1</span>][aim + <span class=\"number\">1</span>];</span><br><span class=\"line\">    dp[len][<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> len - <span class=\"number\">1</span>; index &gt;= <span class=\"number\">0</span>; index--) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">rest</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; rest &lt;= aim; rest++) &#123;</span><br><span class=\"line\">            dp[index][rest] = dp[index + <span class=\"number\">1</span>][rest];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (rest - arr[index] &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                dp[index][rest] = dp[index][rest] + dp[index][rest - arr[index]];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> dp[<span class=\"number\">0</span>][aim];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["算法"],"tags":["Java"]},{"title":"有序表","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E6%9C%89%E5%BA%8F%E8%A1%A8/","content":"<h2 id=\"有序表\"><a href=\"#有序表\" class=\"headerlink\" title=\"有序表\"></a>有序表</h2><p>有序表可以用以下数据结构实现。</p>\n<ul>\n<li>红黑树</li>\n<li>AVL树</li>\n<li>SizeBalanced树</li>\n<li>skiplist，跳表</li>\n</ul>\n<p>前三种同属于平衡搜索二叉树系列。常用的、比较容易修改的结构是SizeBalanced树</p>\n<h2 id=\"搜索二叉树\"><a href=\"#搜索二叉树\" class=\"headerlink\" title=\"搜索二叉树\"></a>搜索二叉树</h2><p>若它的左子树不空，则左子树上所有结点的值均小于它的根结点的值；若它的右子树不空，则右子树上所有结点的值均大于它的根结点的值；它的左、右子树也分别为搜索二叉树。</p>\n<h3 id=\"增\"><a href=\"#增\" class=\"headerlink\" title=\"增\"></a>增</h3><p>从根节点开始，新增的节点与树上的节点比较，如果小于已有节点值，则增加到左子树上；如果大于，则增加到右子树上。再在子树上重复做这样的判断，直到叶子节点。</p>\n<p>搜索二叉树中，一般是没有重复节点的。如果需要用重复key的结构，节点可以改成复杂结构，用Map，List之类的容器。</p>\n<h3 id=\"查\"><a href=\"#查\" class=\"headerlink\" title=\"查\"></a>查</h3><p>给定一个值，查找树中元素值比给定值小，且最接近给定值的节点。</p>\n<p>给定一个值，查找树中元素值比给定值大，且最接近给定值的节点。</p>\n<h3 id=\"删\"><a href=\"#删\" class=\"headerlink\" title=\"删\"></a>删</h3><p>找到需删除节点右子树上的最左节点，记为节点A。将节点A的右孩子，赋给节点A的父节点的左孩子；用节点A替代需删除的节点。</p>\n<h3 id=\"平衡性\"><a href=\"#平衡性\" class=\"headerlink\" title=\"平衡性\"></a>平衡性</h3><p>搜索二叉树，如果不考虑平衡性，最坏情况下，会变成棒状结构，即单链表，数据增删改查的时间复杂度，会从O(logN)退化成O(N)。</p>\n<p>严格的平衡，要求树上任意一个节点的左子树和右子树高度相差不超过1。</p>\n<p>宽松的平衡，只需要树上节点的左子树和右子树规模，不需要相差太悬殊。</p>\n<blockquote>\n<p>问：多少算悬殊，多少不算？</p>\n</blockquote>\n<h2 id=\"树的左旋、右旋\"><a href=\"#树的左旋、右旋\" class=\"headerlink\" title=\"树的左旋、右旋\"></a>树的左旋、右旋</h2><p>树通过旋转操作变平衡。一般在增加或删除节点时检查树的平衡性，有必要时进行旋转调整。</p>\n<p>AVL树、红黑树、SizeBalanced树的 增删改查、左旋右旋操作、平衡检查时机都一样，不同的只有<strong>进行旋转调整的条件</strong>。</p>\n<p>一棵树发生左旋，表示这棵树的根节点“向左边倒”。右旋类似。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">原树：</span><br><span class=\"line\"></span><br><span class=\"line\">   A</span><br><span class=\"line\"> B   C</span><br><span class=\"line\">D E F G</span><br><span class=\"line\"></span><br><span class=\"line\">原树进行左旋后:</span><br><span class=\"line\"></span><br><span class=\"line\">      C</span><br><span class=\"line\">   A     G</span><br><span class=\"line\"> B   F</span><br><span class=\"line\">D E</span><br><span class=\"line\"></span><br><span class=\"line\">原树进行右旋后：</span><br><span class=\"line\"></span><br><span class=\"line\">   B</span><br><span class=\"line\">D     A</span><br><span class=\"line\">    E   C</span><br><span class=\"line\">       F G</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"AVL树\"><a href=\"#AVL树\" class=\"headerlink\" title=\"AVL树\"></a>AVL树</h2><p>平衡条件，要求树上任意一个节点的左子树和右子树高度相差不超过1。</p>\n<p>在增删节点后，检查以改动节点为根的树的平衡性。并依次以相同的方式一路向上检查改动节点的父节点。<br>删除节点时，改动节点为删除节点右子树上的最左节点，或删除节点左子树上的最右节点，即前述的节点A。</p>\n<p>破坏AVL树平衡的四种情况：</p>\n<h3 id=\"LL型\"><a href=\"#LL型\" class=\"headerlink\" title=\"LL型\"></a>LL型</h3><p>左子树的左子树过高，做一次右旋即可。</p>\n<h3 id=\"RR型\"><a href=\"#RR型\" class=\"headerlink\" title=\"RR型\"></a>RR型</h3><p>右子树的右子树过高，做一次左旋即可。</p>\n<h3 id=\"LR型\"><a href=\"#LR型\" class=\"headerlink\" title=\"LR型\"></a>LR型</h3><p>左子树的右子树过高，如下图所示。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">     Z</span><br><span class=\"line\">  Y     d</span><br><span class=\"line\">a   X</span><br><span class=\"line\">   b c</span><br></pre></td></tr></table></figure>\n\n<p>需要想办法将节点X调整到整个树的根位置。<br>先让以Y为根的子树做一次左旋，再让以Z为根的子树做一次右旋：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">      Z</span><br><span class=\"line\">   X     d</span><br><span class=\"line\"> Y   c</span><br><span class=\"line\">a b</span><br><span class=\"line\"></span><br><span class=\"line\">   X</span><br><span class=\"line\"> Y   Z</span><br><span class=\"line\">a b c d</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"RL型\"><a href=\"#RL型\" class=\"headerlink\" title=\"RL型\"></a>RL型</h3><p>右子树的左子树过高。</p>\n<p>想办法让右子树的左子树变为整棵树的根。先让根节点的右子树做一次右旋，再让整棵树做一次左旋。</p>\n<h2 id=\"SizeBalanced树\"><a href=\"#SizeBalanced树\" class=\"headerlink\" title=\"SizeBalanced树\"></a>SizeBalanced树</h2><p>平衡条件，每颗子树的大小，不小于其兄弟子树大小。<br>即每颗叔叔树的大小，不小于其侄子树大小。</p>\n<p>这里的大小，指的是节点个数。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">   A</span><br><span class=\"line\"> B   C</span><br><span class=\"line\">D E F G</span><br></pre></td></tr></table></figure>\n\n<p>以上树为例，B树的大小，一定不小于F树和G树的大小。</p>\n<h3 id=\"LL型-1\"><a href=\"#LL型-1\" class=\"headerlink\" title=\"LL型\"></a>LL型</h3><p>左子树的左子树大小，比右子树大。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">   T</span><br><span class=\"line\"> L   R</span><br><span class=\"line\">a b c d</span><br></pre></td></tr></table></figure>\n\n<p>a树的大小，比R树大。</p>\n<p>先做右旋：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">   L</span><br><span class=\"line\">a     T</span><br><span class=\"line\">    b   R</span><br><span class=\"line\">       c d</span><br></pre></td></tr></table></figure>\n\n<p>旋转之后，T节点和L节点的孩子节点有变化，故需要重新判断并调整。递归过程。</p>\n<h3 id=\"RR型-1\"><a href=\"#RR型-1\" class=\"headerlink\" title=\"RR型\"></a>RR型</h3><p>右子树的右子树大小，比左子树大。</p>\n<h3 id=\"LR型-1\"><a href=\"#LR型-1\" class=\"headerlink\" title=\"LR型\"></a>LR型</h3><p>左子树的右子树大小，比右子树大。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">     T</span><br><span class=\"line\">  L     R</span><br><span class=\"line\">a   B c   d</span><br><span class=\"line\">   e f</span><br></pre></td></tr></table></figure>\n\n<p>B树的大小，比R树大。</p>\n<p>将B树调整为整棵树的根。<br>先左旋L树</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">      T</span><br><span class=\"line\">   B     R</span><br><span class=\"line\"> L   f c   d</span><br><span class=\"line\">a e  </span><br></pre></td></tr></table></figure>\n\n<p>再右旋T树</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">     B</span><br><span class=\"line\">  L     T</span><br><span class=\"line\">a   e f   R</span><br><span class=\"line\">         c d</span><br></pre></td></tr></table></figure>\n\n<p>旋转之后，节点T、L、R的孩子节点都有变化，故需要重新判断并调整。递归过程。</p>\n<h2 id=\"红黑树\"><a href=\"#红黑树\" class=\"headerlink\" title=\"红黑树\"></a>红黑树</h2><h3 id=\"红黑树性质\"><a href=\"#红黑树性质\" class=\"headerlink\" title=\"红黑树性质\"></a>红黑树性质</h3><ol>\n<li>节点是红色或黑色</li>\n<li>根节点是黑色</li>\n<li>所有叶子节点都是黑色</li>\n<li>每个红节点的两个子节点都是黑色（任意两个红节点不能相邻）</li>\n<li>从任意节点到其每个叶子节点的所有路径都包含相同数目的黑节点</li>\n</ol>\n<p>实际上，红黑树维持的状态，是每个节点到其叶子节点路径长度的倍数关系，不会超过两倍。</p>\n<p>例如，一个节点N到其叶子节点路径上包含的黑节点个数为3个。<br>那么其到叶子节点最短路径为 节点N-黑节点-黑节点-黑节点，距离为3；<br>其到叶子节点最长路径为 节点N-红街店-黑节点-红街店-黑节点-红街店-黑节点，距离为6。</p>\n<h2 id=\"跳表\"><a href=\"#跳表\" class=\"headerlink\" title=\"跳表\"></a>跳表</h2><p>增删改查（待补充）</p>\n","categories":["算法"],"tags":["Java"]},{"title":"栈和队列和链表","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97%E5%92%8C%E9%93%BE%E8%A1%A8/","content":"<h2 id=\"链表\"><a href=\"#链表\" class=\"headerlink\" title=\"链表\"></a>链表</h2><h3 id=\"哨兵节点\"><a href=\"#哨兵节点\" class=\"headerlink\" title=\"哨兵节点\"></a>哨兵节点</h3><p>附加在原链表最前面用来简化边界条件的附加节点，它的值域不存储任何东西，只是为了操作方便而引入。</p>\n<p>为什么需要引入哨兵节点呢？举个例子，比如要删除某链表的第一个元素，常见的删除链表的操作是找到要删元素的前一个元素，假如记为 pre。通过：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">pre.Next = pre.Next.Next;</span><br></pre></td></tr></table></figure>\n\n<p>来进行删除链表的操作。但是此时若是删除第一个元素的话，就很难进行了，因为此时第一个元素的前一个元素就是nil（空的），使用pre会报错。若此时设置了哨兵节点，pre就是哨兵节点了。这样对于链表中任何一个元素，删除都可以通过pre.Next&#x3D;pre.Next.Next的方式进行，这就是哨兵节点的作用。</p>\n<h2 id=\"栈和队列\"><a href=\"#栈和队列\" class=\"headerlink\" title=\"栈和队列\"></a>栈和队列</h2><p>栈：先入后出<br>队列：先入先出</p>\n<h3 id=\"双向链表实现队列和栈\"><a href=\"#双向链表实现队列和栈\" class=\"headerlink\" title=\"双向链表实现队列和栈\"></a>双向链表实现队列和栈</h3><p>没啥好说的，两个指针记录头和尾。</p>\n<h3 id=\"数组实现队列和栈\"><a href=\"#数组实现队列和栈\" class=\"headerlink\" title=\"数组实现队列和栈\"></a>数组实现队列和栈</h3><p>RingBuffer</p>\n<p>同样是使用两个指针记录头和尾，但不去判断比较头尾指针位置大小，而是另外记录一个变量size记录已经存了多少数据。使用size判断栈和队列是空还是满了。</p>\n<h3 id=\"常见面试题\"><a href=\"#常见面试题\" class=\"headerlink\" title=\"常见面试题\"></a>常见面试题</h3><ul>\n<li><p>实现一个特殊的栈，在基本功能的基础上，再实现返回栈中最小元素的功能。pop、push、getMin操作的时间复杂度都为O(1)</p>\n<p>准备两个栈：Data栈和min栈。</p>\n<p>push时，元素正常入Data栈，入min栈时，判断当前元素和min栈顶，哪个元素更小，谁小push谁。</p>\n<p>pop时，Data栈和min栈同步出栈，但只返回Data栈的元素。</p>\n<p>getMin时，看下当前min栈顶的元素就行。</p>\n<p>另外一种做法是：</p>\n<p>push时，元素正常入Data栈，入min栈时，判断当前元素和min栈顶大小，仅在当前元素更小的情况下，元素入min栈。</p>\n<p>pop时，判断Data栈和min栈栈顶元素，仅当两数相同时，min同步做出栈操作。</p>\n</li>\n<li><p>用栈结构实现队列结构</p>\n<p>两个栈，push栈和pop栈，入栈的时候元素直接入push栈。</p>\n<p>出栈的时候，从pop栈出，pop栈里没有元素，将push栈中所有元素全部依次弹出，入pop栈，然后从pop出栈。</p>\n<p>将push栈中所有元素全部依次弹出，入pop栈的时候，两个原则：</p>\n<ol>\n<li>pop栈必须为空</li>\n<li>push栈必须全部弹出</li>\n</ol>\n</li>\n<li><p>用队列结构实现栈结构</p>\n<p>两个队列，Data队列和help队列，元素出栈的时候，Data队列输出数据到help队列，只留最后一个元素，做最后的输出。</p>\n</li>\n</ul>\n<h2 id=\"一些技巧\"><a href=\"#一些技巧\" class=\"headerlink\" title=\"一些技巧\"></a>一些技巧</h2><ul>\n<li>额外数据结构记录（哈希表等）。</li>\n<li>快慢指针。</li>\n</ul>\n<p>例：leetcode-234 回文链表 palindrome-linked-list<br>判断链表是否为回文结构。<br>1-&gt;2-&gt;1 返回 true ，1-&gt;2-&gt;3 返回 false 。<br>要求时间复杂度为O(N)，空间复杂度为O(1) 。  </p>\n<p>解：<br>快慢指针找到链表中点，从中点开始，将链表后半部分逆序。<br>两个指针分别从链表两端next遍历比较元素值。<br>遍历过程中再将链表还原。</p>\n<p>例：将单链表按某值划分为左边小、中间相等、右边大的形式。<br>要求调整后要有稳定性。<br>要求时间复杂度为O(N)，空间复杂度为O(1)。  </p>\n<p>解：<br>新建6个节点，小于部分的头节点和尾节点，等于部分的头节点和尾节点，于部分的头节点和尾节点。遍历链表，填充三个部分，最后拼接。</p>\n<p>例：leetcode-138 复制带随机指针的链表 copy-list-with-random-pointer<br>复制含有随机指针节点的链表。<br>单链表节点里新增了Node rand; 成员。该指针可以指向链表中的任何节点或空节点。构造这个链表的<strong>深拷贝</strong>，复制链表中的指针都不应指向原链表中的节点。  </p>\n<p>解：<br>常规思路。哈希表，键值对分别设置为 旧节点、新节点。<br>优化思路。遍历旧链表，创建克隆节点，插入在原节点的next中。<br>链表就变成了 旧节点1-&gt;新节点1-&gt;旧节点2-&gt;新节点2-&gt;… 的结构，用两个节点一组的方式再次遍历，设置新节点的rand成员。</p>\n<p>例：leetcode-160 相交链表 intersection-of-two-linked-lists<br>给出两个单链表的头节点 headA 和 headB，找出并返回两个单链表相交的起始节点。如果两个链表不存在相交节点，返回 null 。<br><strong>链表可能有环，可能无环。</strong><br>要求时间复杂度为O(N)，空间复杂度为O(1)。  </p>\n<p>解：<br>情况1：headA和headB都无环。<br>分别遍历两个链表，记录链表长度。<br>链表结尾若节点相同，则有相交节点，不同则没有。<br>找相交：设置两指针指向两个链表头，更长的链表先走 两链表长度差值 的步数，然后两指针同步向下走，第一次相同的节点即为相交节点。</p>\n<p>情况2：headA和headB，其中一个有环，一个无环。<br>这种情况下两链表不可能相交。</p>\n<p>情况3：headA和headB都有环。且不相交。<br>找出两个链表入环时的第一个节点loopA和loopB。loopA不断向下走，在遇到自己之前没遇到过loopB。</p>\n<p>情况4：headA和headB都有环，且相交节点在环外。<br>找出两个链表入环时的第一个节点loopA和loopB。此情况下loopA和loopB是同节点。按照两无环链表的方式找相交节点。</p>\n<p>情况5：headA和headB都有环，且相交节点在环内。<br>找出两个链表入环时的第一个节点loopA和loopB。loopA不断向下走，在遇到自己之前遇到了loopB。则loopA和loopB都可称作两链表的第一个相交节点。</p>\n","categories":["算法"],"tags":["Java"]},{"title":"树形DP","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E6%A0%91%E5%BD%A2DP/","content":"<h2 id=\"树形DP套路\"><a href=\"#树形DP套路\" class=\"headerlink\" title=\"树形DP套路\"></a>树形DP套路</h2><p>使用前提：如果题目求解目标是S规则，则求解流程可以定成以每一个节点为头节点的子树在S规则下的每一个答案，并且最终答案一定在其中。</p>\n<p>套路：</p>\n<ol>\n<li>以某个节点X为头节点的子树中，分析答案有哪些可能性，这种分析多是以X的左子树、X的右子树和X整棵树的角度来考虑的。</li>\n<li>根据第一步的可能性分析，列出所有需要的信息。</li>\n<li>合并第二步的信息，对左子树和右子树提出同样的要求，并写出信息结构。</li>\n<li>设计递归函数，处理以X为头节点情况下的答案。包括设计递归的base case，<strong>默认直接得到左子树和右子树的所有信息</strong>，以及把可能性整合，返回第三步设计的信息结构。</li>\n</ol>\n<p>例：<br>从二叉树中节点a出发，可以往上走或往下走，但沿途节点只能经过一次，到达节点b时路径上的节点个数称为a到b的距离，那么二叉树的任意两节点之间都有距离，求整棵树上的最大节点距离。</p>\n<p>解：<br>当根节点不在最大节点距离的路径上时，最大节点距离为左子树最大距离和右子树最大距离的较大值。<br>当根节点在最大节点距离路径上时，最大节点距离为左子树高度+右子树高度+1。<br>base case为根节点为空时，最大距离为0，子树高度为0。<br>最终取上述两种情况的最大值。</p>\n<p>例：多叉树节点中，每个节点都有一个正整数值，从树中取出若干个节点，求出节点值的和，选择的节点遵循以下规则：<br>如果一个节点被选中，则这个节点的父节点和所有子节点都不能被选中。即选中的节点都不能直接相邻。<br>给定树的根节点，返回选出节点值的和的最大值。</p>\n<p>解：<br>当根节点被选中时，最大和值为所有子树头节点不被选中时的最大和值。<br>当根节点没被选中时，最大和值为，所有子树，头节点被选中，和头节点不被选中时，最大和值中的最大值。<br>base case为根节点为叶子节点时，头节点被选中最大和值为头节点值，头节点不被选中最大和值为0。</p>\n","categories":["算法"],"tags":["Java"]},{"title":"桶排序和排序总结","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E6%A1%B6%E6%8E%92%E5%BA%8F%E5%92%8C%E6%8E%92%E5%BA%8F%E6%80%BB%E7%BB%93/","content":"<h2 id=\"比较器\"><a href=\"#比较器\" class=\"headerlink\" title=\"比较器\"></a>比较器</h2><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@FunctionalInterface</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Comparator</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@return</span> a negative integer, zero, or a positive integer as the</span></span><br><span class=\"line\"><span class=\"comment\">    *         first argument is less than, equal to, or greater than the</span></span><br><span class=\"line\"><span class=\"comment\">    *         second.</span></span><br><span class=\"line\"><span class=\"comment\">    **/</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"title function_\">compare</span><span class=\"params\">(T o1, T o2)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>比较器的实质就是重载比较运算符。</li>\n<li>可以很好地应用在特殊规则的排序或排序结构上。</li>\n</ul>\n<h2 id=\"不基于比较的排序\"><a href=\"#不基于比较的排序\" class=\"headerlink\" title=\"不基于比较的排序\"></a>不基于比较的排序</h2><h3 id=\"计数排序\"><a href=\"#计数排序\" class=\"headerlink\" title=\"计数排序\"></a>计数排序</h3><p>统计词频。例如年龄排序。</p>\n<h3 id=\"基数排序\"><a href=\"#基数排序\" class=\"headerlink\" title=\"基数排序\"></a>基数排序</h3><p>也叫桶排序。</p>\n<h2 id=\"复杂度\"><a href=\"#复杂度\" class=\"headerlink\" title=\"复杂度\"></a>复杂度</h2><ul>\n<li>计算时间和数据量无关的操作，称为常数操作</li>\n<li>复杂度和数据相关时，O()复杂度取最坏情况</li>\n<li>相同复杂度的算法，哪个更好，最好是实际运行测试去评判</li>\n</ul>\n<h2 id=\"递归\"><a href=\"#递归\" class=\"headerlink\" title=\"递归\"></a>递归</h2><h3 id=\"时间复杂度\"><a href=\"#时间复杂度\" class=\"headerlink\" title=\"时间复杂度\"></a>时间复杂度</h3><p>对于子问题规模一致的递归行为，复杂度可以由master公式确认：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">T</span>(N) = <span class=\"title function_\">aT</span>(N/b) + <span class=\"title function_\">O</span>(N^d);</span><br></pre></td></tr></table></figure>\n\n<p>其中a、b、d都为常数。</p>\n<p>子问题的规模为N&#x2F;b，子问题调用了a次，除了子问题调用，其余操作的时间复杂度为O(N^d)。结论：</p>\n<ol>\n<li>满足 logb(a) &gt; d , 递归复杂度为 O(N^(log(b,a)))</li>\n<li>满足 logb(a) &lt; d , 递归复杂度为 O(N^d)</li>\n<li>满足 logb(a) &#x3D; d , 递归复杂度为 O(N^d * (log(2,N)))</li>\n</ol>\n<p>公式直接记</p>\n<h2 id=\"稳定性\"><a href=\"#稳定性\" class=\"headerlink\" title=\"稳定性\"></a>稳定性</h2><p>排序后，值相同的元素能否保持排序前原有次序不变。<br>对于对象的排序比较有用。比如先按价格排序再按好评率排序，此时在首位的就是好评率高且便宜的商品。</p>\n<h2 id=\"排序算法总结\"><a href=\"#排序算法总结\" class=\"headerlink\" title=\"排序算法总结\"></a>排序算法总结</h2><table>\n<thead>\n<tr>\n<th align=\"center\">算法</th>\n<th align=\"center\">时间复杂度</th>\n<th align=\"center\">空间复杂度</th>\n<th align=\"center\">是否稳定</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">选择排序</td>\n<td align=\"center\">O(N^2)</td>\n<td align=\"center\">O(1)</td>\n<td align=\"center\">否</td>\n</tr>\n<tr>\n<td align=\"center\">冒泡排序</td>\n<td align=\"center\">O(N^2)</td>\n<td align=\"center\">O(1)</td>\n<td align=\"center\">是</td>\n</tr>\n<tr>\n<td align=\"center\">插入排序</td>\n<td align=\"center\">O(N^2)</td>\n<td align=\"center\">O(1)</td>\n<td align=\"center\">是</td>\n</tr>\n<tr>\n<td align=\"center\">归并排序</td>\n<td align=\"center\">O(N*logN)</td>\n<td align=\"center\">O(N)</td>\n<td align=\"center\">是</td>\n</tr>\n<tr>\n<td align=\"center\">随机快排</td>\n<td align=\"center\">O(N*logN)</td>\n<td align=\"center\">O(logN)</td>\n<td align=\"center\">否</td>\n</tr>\n<tr>\n<td align=\"center\">堆排序</td>\n<td align=\"center\">O(N*logN)</td>\n<td align=\"center\">O(1)</td>\n<td align=\"center\">否</td>\n</tr>\n</tbody></table>\n<ul>\n<li>基于比较的排序，时间复杂度最快是O(N*logN)。</li>\n<li>时间复杂度为O(N*logN)，且有稳定性的排序，空间复杂度最小是O(N)。</li>\n</ul>\n<h2 id=\"排序算法的改进\"><a href=\"#排序算法的改进\" class=\"headerlink\" title=\"排序算法的改进\"></a>排序算法的改进</h2><ul>\n<li><p>充分利用O(N*logN)和O(N^2)排序算法的优势。<br>例如快排的调度优势，结合插入排序小样本量下常数时间低的优势。</p>\n</li>\n<li><p>稳定性的考虑。</p>\n</li>\n</ul>\n","categories":["算法"],"tags":["Java"]},{"title":"滑动窗口和单调栈","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E5%92%8C%E5%8D%95%E8%B0%83%E6%A0%88/","content":"<h2 id=\"滑动窗口\"><a href=\"#滑动窗口\" class=\"headerlink\" title=\"滑动窗口\"></a>滑动窗口</h2><p>例：<br>有一个整型数组arr和一个大小为w的窗口从数组的最左边滑到最右边，窗口每次向右边滑动一个位置。<br>例如，数组为[4,3,5,2,8,1,6,7]，窗口大小为3时：</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">[4 3 5] 2 8 1 6 7 //最大值为5</span><br><span class=\"line\">4 [3 5 2] 8 1 6 7 //最大值为5</span><br><span class=\"line\">4 3 [5 2 8] 1 6 7 //最大值为8</span><br><span class=\"line\">4 3 5 [2 8 1] 6 7 //最大值为8</span><br><span class=\"line\">4 3 5 2 [8 1 6] 7 //最大值为8</span><br><span class=\"line\">4 3 5 2 8 [1 6 7] //最大值为7</span><br></pre></td></tr></table></figure>\n\n<p>一共输出arr.length - w + 1 个窗口最大值。实现一个函数，输入arr和窗口大小，输出窗口最大值数组。</p>\n<p>解：<br>使用双端队列。从头到尾需要保持从大到小的顺序。双端队列头部的值即为窗口内最大值。<br>当数组中一个新元素进入窗口内时，比较其和双端队列尾部元素的大小。能够严格保证从大到小的单调性时，元素直接加入双端队列尾部（入栈）。如果无法保证单调性，则队列从尾部弹出元素，直至新元素加入队列后，仍能维持队列单调性。<br>当一个新元素离开窗口（过期）时，判断这个元素和双端队列头部是否是同一个，如果是，则队列头部弹出这个值，如果不是则不需要操作。</p>\n<p>队列中记录下标更方便，举例说明用元素值是因为更清晰些。</p>\n<p>双端队列维持的实际是，<strong>在元素依次过期的情况下，元素成为窗口最大值的可能性。</strong></p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">举例，初始情况下，前三个元素进入窗口。</span><br><span class=\"line\">Deque&#123;4&#125;</span><br><span class=\"line\">Deque&#123;4,3&#125;</span><br><span class=\"line\">Deque&#123;5&#125; // 在原先元素为4,3的情况下，加上5的话， 4,3,5无法严格保证从大到小的单调性，故从尾部弹出元素4和3，在加入5。</span><br><span class=\"line\"></span><br><span class=\"line\">窗口右滑一格</span><br><span class=\"line\">元素2进入窗口，进入队列</span><br><span class=\"line\">Deque&#123;5,2&#125;</span><br><span class=\"line\">元素4出窗口，其不为头元素，不操作。</span><br><span class=\"line\"></span><br><span class=\"line\">窗口右滑一格</span><br><span class=\"line\">元素8进窗口，入队，需先弹出原先比它小的元素5和2</span><br><span class=\"line\">Deque&#123;8&#125;</span><br><span class=\"line\">元素3出窗口，其不为头元素，不操作。</span><br><span class=\"line\"></span><br><span class=\"line\">窗口右滑一格</span><br><span class=\"line\">元素1入窗口，入队</span><br><span class=\"line\">Deque&#123;8,1&#125;</span><br><span class=\"line\">元素5出窗口，不操作</span><br><span class=\"line\"></span><br><span class=\"line\">窗口右滑一格</span><br><span class=\"line\">元素6入窗口，入队，需先弹出1</span><br><span class=\"line\">Deque&#123;8,6&#125;</span><br><span class=\"line\">元素2出窗口，不操作</span><br><span class=\"line\"></span><br><span class=\"line\">窗口右滑一格</span><br><span class=\"line\">元素7入窗口，入队，先弹出6</span><br><span class=\"line\">Deque&#123;8,7&#125;</span><br><span class=\"line\">元素8出窗口，其为头元素，从队头弹出</span><br><span class=\"line\">Deque&#123;7&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"单调栈\"><a href=\"#单调栈\" class=\"headerlink\" title=\"单调栈\"></a>单调栈</h2><p>例：<br>在数组中，找到对于每个元素，左边离它最近的，且比它大的那个元素。以及右边离它最近的，且比它大的那个元素。</p>\n<p>解：<br>使用单调栈，保证从栈底到栈顶从大到小的顺序。<br>遍历数组，将元素按要求压栈。元素即将入栈时，此时栈顶元素即为左边离它最近的，且比它大的元素。当元素由于需保持单调性而被弹出时，此时即将入栈的元素，即为右边离它最近的，且比它大的元素。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">举例，现有数组[5,4,3,6,1,2,0]</span><br><span class=\"line\">元素5入栈</span><br><span class=\"line\">stack&#123;5&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">元素4入栈</span><br><span class=\"line\">stack&#123;5,4&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">元素3入栈</span><br><span class=\"line\">stack&#123;5,4,3&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">元素6入栈，栈顶元素3由于比6小，需保持栈单调性，故3出栈。元素3左近大为4，右近大便为6。</span><br><span class=\"line\">stack&#123;5,4&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">栈顶元素4出栈，元素4左近大为5，右近大为6。</span><br><span class=\"line\">stack&#123;5&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">栈顶元素5出栈，元素5左近大为无，右近大为6。</span><br><span class=\"line\">stack&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">元素6入栈</span><br><span class=\"line\">stack&#123;6&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">元素1入栈</span><br><span class=\"line\">stack&#123;6,1&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">元素2入栈，弹出元素1，左近大为6，右近大为2</span><br><span class=\"line\">stack&#123;6,2&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">元素0入栈</span><br><span class=\"line\">stack&#123;6,2,0&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">最终栈内元素全部弹出进行结算。</span><br><span class=\"line\">元素&#123;6,2,0&#125;出栈，右近大为无，左近大分别为无,6,2</span><br></pre></td></tr></table></figure>\n\n<p>如果数组内有重复值时，将数组元素压在一起，可以用链表或动态数组的方式。</p>\n<p>例：<br>定义数组中累计值和最小值得到乘积，叫指标A，给定一个正数数组，返回子数组中，指标A最大的值。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"code\"><pre><span class=\"line\">举例，现有数组[4,3,5,2,8,1,6,7]</span><br><span class=\"line\">以元素5为最小值的子数组，只有[4]，所以其的最大指标A，为4*4=16</span><br><span class=\"line\">以元素3为最小值的子数组，有[3]、[4,3]、[3,5]、[4,3,5]，所以其的最大指标A，为3*(4+3+5)=36</span><br></pre></td></tr></table></figure>\n\n<p>解：<br>利用单调栈，求出数组中每个元素的左近大和右近大，即可求出以当前元素为最小值时，能够包含最多元素的子数组，也就是有最大的指标A。<br>比较以每个元素为最小值时的最大指标A，求出其中最大的指标A。</p>\n","categories":["算法"],"tags":["Java"]},{"title":"贪心算法","url":"/%E7%AC%94%E8%AE%B0/Java/%E7%AE%97%E6%B3%95/%E5%B7%A6%E7%A8%8B%E4%BA%91%E7%AE%97%E6%B3%95/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95/","content":"<h2 id=\"贪心算法\"><a href=\"#贪心算法\" class=\"headerlink\" title=\"贪心算法\"></a>贪心算法</h2><p>在对问题求解时，总是做出在当前看来是最好的选择。也就是说，不从整体最优上加以考虑，算法得到的是在某种意义上的局部最优解。</p>\n<p>不要纠结贪心算法的证明方式。</p>\n<p>例：<br>将字符串数组进行排序，使所有字符串拼接后，有最小的字典序。</p>\n<p>解：<br>设置字符串的比较策略为，若strA+strB的字典序比strB+strA更大，则strA&gt;strB。</p>\n<p>例：<br>切割金条。将一根金条切割成两份，需要划分和金条原长的费用。比如长度为20的金条，无论切割成多大的两份，都要花费20。<br>现有一群人想整分一根金条，输入一个整数数组表示每个人需求的长度，求如何分割最省费用。</p>\n<p>解：<br>霍夫曼编码。  </p>\n<ol>\n<li>将需求数组从小到大排序，可借助小根堆结构。</li>\n<li>取出最小的两个值相加，将和值加到结果中。</li>\n<li>将和值放回小根堆。</li>\n<li>重复步骤2-3至小根堆中只有一个元素。</li>\n</ol>\n<p>例：<br>输入<br>正数数组costs<br>正数数组profits<br>正数k<br>正数m<br>含义为<br>costs[i]表示i号项目的花费<br>profits[i]表示i号项目的纯利润<br>k表示最多可选择做的项目数量<br>m表示初始资金</p>\n<p>输出最后获得的最大钱数。</p>\n<p>解：  </p>\n<p>总是选择花费小于等于当前钱数，且项目利润最大的项目。<br>可通过两个堆结构来排序。</p>\n","categories":["算法"],"tags":["Java"]}]